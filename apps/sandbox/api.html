<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<title>OpenLayers Basic Single WMS Example</title>
		<script type="text/javascript" src="/api/v1/js/api.js"></script>

		<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyA-DSPlhVi52zBadpyTRa4cOtSr6WKDOgA&sensor=false">
            ">
		</script>

		<link rel="stylesheet" type="text/css" href="/js/ext/resources/css/ext-all.css"/>
		<script type="text/javascript">
            var fireSql;
            var ogrid;
            // Define three colors that will be used to style the cluster features
            // depending on the number of features they contain.
            var colors = {
                low : "rgb(181, 226, 140)",
                middle : "rgb(241, 211, 87)",
                high : "rgb(253, 156, 115)"
            };

            // Define three rules to style the cluster features.
            var lowRule = new OpenLayers.Rule({
                filter : new OpenLayers.Filter.Comparison({
                    type : OpenLayers.Filter.Comparison.LESS_THAN,
                    property : "count",
                    value : 15
                }),
                symbolizer : {
                    fillColor : colors.low,
                    fillOpacity : 0.9,
                    strokeColor : colors.low,
                    strokeOpacity : 0.5,
                    strokeWidth : 12,
                    pointRadius : 10,
                    label : "${count}",
                    labelOutlineWidth : 1,
                    fontColor : "#ffffff",
                    fontOpacity : 0.8,
                    fontSize : "12px"
                }
            });
            var middleRule = new OpenLayers.Rule({
                filter : new OpenLayers.Filter.Comparison({
                    type : OpenLayers.Filter.Comparison.BETWEEN,
                    property : "count",
                    lowerBoundary : 15,
                    upperBoundary : 50
                }),
                symbolizer : {
                    fillColor : colors.middle,
                    fillOpacity : 0.9,
                    strokeColor : colors.middle,
                    strokeOpacity : 0.5,
                    strokeWidth : 12,
                    pointRadius : 15,
                    label : "${count}",
                    labelOutlineWidth : 1,
                    fontColor : "#ffffff",
                    fontOpacity : 0.8,
                    fontSize : "12px"
                }
            });
            var highRule = new OpenLayers.Rule({
                filter : new OpenLayers.Filter.Comparison({
                    type : OpenLayers.Filter.Comparison.GREATER_THAN,
                    property : "count",
                    value : 50
                }),
                symbolizer : {
                    fillColor : colors.high,
                    fillOpacity : 0.9,
                    strokeColor : colors.high,
                    strokeOpacity : 0.5,
                    strokeWidth : 12,
                    pointRadius : 20,
                    label : "${count}",
                    labelOutlineWidth : 1,
                    fontColor : "#ffffff",
                    fontOpacity : 0.8,
                    fontSize : "12px"
                }
            });

            // Create a Style that uses the three previous rules
            var style = new OpenLayers.Style(null, {
                rules : [lowRule, middleRule, highRule]
            });
            var styleMap = new OpenLayers.StyleMap(style);
			var store1;
            $(window).load(function() {
                var cloud = new mygeocloud_ol.map("map", "mh");
                //cloud.zoomToExtent([1048024.7345447, 7787676.97359, 1080128.2864201, 7793409.7507106],true);
                
                store1 = new mygeocloud_ol.geoJsonStore("mh",{visibility:false});
                store2 = new mygeocloud_ol.geoJsonStore("mh",{styleMap:styleMap});
                store1.moved = function() {
                	console.log(cloud.getExtent());
                  //store1.load();
                }
                store1.layer.setVisibility(true);
                cloud.addGeoJsonStore(store2);
                cloud.addGeoJsonStore(store1);
                store2.clusterActivate();
                //store1.polygonControl.activate();
                store1.sql = "select the_geom from public.adresser order by gid limit 10";
                store2.sql = "select the_geom from public.adresser order by gid limit 1000";
                store1.load();
                
                
                store1.onLoad = function() {
                    $("#grid").empty();
                    //ogrid = new mygeocloud_ol.grid("grid",store1);
                    //cloud.zoomToExtentOfgeoJsonStore(store1);
                    store2.load();
                    store1.onLoad = function() {};
                };

                //cloud.addTileLayers(["public.test2"]);
            })
		</script>
	</head>
	<body>
		<div id="map" style="width: 100%;height: 300px"></div>
		<div id="grid" style="width: 500px;height: 1px"></div>
		<textarea id="sql">select the_geom from test2</textarea>
		<button value"Click" onclick="store1.clusterActivate()">
			Activate
		</button>
		<button value"Click" onclick="store1.clusterDeactivate()">
			Deactivate
		</button>
	</body>

</html>
