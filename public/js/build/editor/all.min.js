function startWfsEdition(a,b,c,d,e){"use strict";var f,g,h,i,j,k,l=!0,m=Ext.getCmp("attrtable"),n=d;layerBeingEditing=a,layerBeingEditingGeomField=b;try{drawControl.deactivate(),layer.removeAllFeatures(),map.removeLayer(layer)}catch(o){}try{m.remove(grid)}catch(o){}$.ajax({url:"/controllers/table/columns/"+a,async:!1,dataType:"json",type:"GET",success:function(a,b,c){if(4===c.readyState&&200===c.status){var d=a;f=d.forStore,g=d.forGrid,h=d.type,i=d.multi;for(var e in g)g[e].editable=l,void 0!==g[e].typeObj&&("int"===g[e].typeObj.type?g[e].editor=new Ext.form.NumberField({decimalPrecision:0,decimalSeparator:"Â¤"}):"decimal"===g[e].typeObj.type?g[e].editor=new Ext.form.NumberField({decimalPrecision:g[e].typeObj.scale,decimalSeparator:"."}):"string"===g[e].typeObj.type?g[e].editor=new Ext.form.TextField:"text"===g[e].typeObj.type&&(g[e].editor=new Ext.form.TextArea))}}}),"Point"===h?j=OpenLayers.Handler.Point:"Polygon"===h?j=OpenLayers.Handler.Polygon:"Path"===h&&(j=OpenLayers.Handler.Path),m.expand(!0);var p={rules:[new OpenLayers.Rule({filter:new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.NOT_EQUAL_TO,property:"gc2_version_end_date",value:"null"}),symbolizer:{fillColor:"#000000",fillOpacity:0,strokeColor:"#FF0000",strokeWidth:2,strokeDashstyle:"dash",strokeOpacity:.7,graphicZIndex:1}}),new OpenLayers.Rule({filter:new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO,property:"gc2_version_end_date",value:null}),symbolizer:{fillColor:"#000000",fillOpacity:0,strokeColor:"#0000FF",strokeWidth:3,strokeOpacity:.7,graphicZIndex:3,strokeDashstyle:"solid"}})]},q=new OpenLayers.StyleMap({"default":new OpenLayers.Style({fillColor:"#000000",fillOpacity:0,pointRadius:5,strokeColor:"#0000FF",strokeWidth:3,strokeOpacity:.7,graphicZIndex:3},p),temporary:new OpenLayers.Style({fillColor:"#FFFFFF",fillOpacity:.7,pointRadius:5,strokeColor:"#0000FF",strokeWidth:1,strokeOpacity:.7,graphicZIndex:1}),select:new OpenLayers.Style({fillColor:"#000000",fillOpacity:.2,pointRadius:8,strokeColor:"#0000FF",strokeWidth:3,strokeOpacity:1,graphicZIndex:3},p)});layer=new OpenLayers.Layer.Vector("vector",{strategies:[new OpenLayers.Strategy.Fixed,saveStrategy],protocol:new OpenLayers.Protocol.WFS.v1_0_0({url:"/wfs/"+(subUser?subUser+"@"+screenName:screenName)+"/"+schema+"/900913"+(e?"/"+e:"")+"?",version:"1.0.0",featureType:a,featureNS:"http://twitter/"+screenName,srsName:"EPSG:900913",geometryName:b,defaultFilter:c}),styleMap:q}),map.addLayers([layer]),layer.events.register("loadend",layer,function(){var a=layer.features.length;window.parent.App.setAlert(App.STATUS_NOTICE,a+" features loaded"),layer.features.length>0&&map.zoomToExtent(layer.getDataExtent()),n&&(setTimeout(function(){map.controls[map.controls.length-1].selectControl.select(layer.features[0])},600),n=!1)}),layer.events.register("loadstart",layer,function(){}),drawControl=new OpenLayers.Control.DrawFeature(layer,j,{featureAdded:onInsert,handlerOptions:{multi:i,handlerOptions:{holeModifier:"altKey"}}}),l?(wfsTools[2].control=drawControl,map.addControl(drawControl),modifyControl=new OpenLayers.Control.ModifyFeature(layer,{vertexRenderIntent:"temporary",displayClass:"olControlModifyFeature"}),map.addControl(modifyControl),modifyControl.activate(),k=new GeoExt.grid.FeatureSelectionModel({selectControl:modifyControl.selectControl,singleSelect:!0,listeners:{rowselect:function(a,b,c){try{attributeForm.form.getForm().loadRecord(c)}catch(d){}}}})):k=new GeoExt.grid.FeatureSelectionModel({singleSelect:!1}),store=new GeoExt.data.FeatureStore({proxy:new GeoExt.data.ProtocolProxy({protocol:layer.protocol}),fields:f,layer:layer,featureFilter:new OpenLayers.Filter({evaluate:function(a){return a.state!==OpenLayers.State.DELETE}})}),grid=new Ext.grid.EditorGridPanel({id:"gridpanel",region:"center",disabled:!1,viewConfig:{forceFit:!0},store:store,listeners:{afteredit:function(a){var b=a.record.get("feature");b.state!==OpenLayers.State.INSERT&&(b.state=OpenLayers.State.UPDATE)}},sm:k,cm:new Ext.grid.ColumnModel({defaults:{sortable:!0,editor:{xtype:"textfield"}},columns:g})}),m.add(grid),gridPanel=Ext.getCmp("gridpanel"),m.doLayout(),attributeForm.win=new Ext.Window({title:"Attributes",modal:!1,layout:"fit",initCenter:!0,border:!1,width:270,height:300,closeAction:"hide",plain:!0,items:[new Ext.Panel({frame:!1,layout:"border",items:[attributeForm.form]})]}),Ext.getCmp("editcreatebutton").toggle(!1),Ext.getCmp("editcreatebutton").setDisabled(!1),Ext.getCmp("editdeletebutton").setDisabled(!1),Ext.getCmp("editsavebutton").setDisabled(!1),Ext.getCmp("editstopbutton").setDisabled(!1),Ext.getCmp("infobutton").setDisabled(!1)}function stopEdit(){"use strict";layerBeingEditing=null;try{filter.win.hide(),filter.win=!1}catch(a){}Ext.getCmp("editcreatebutton").toggle(!1),Ext.getCmp("editcreatebutton").setDisabled(!0),Ext.getCmp("editdeletebutton").setDisabled(!0),Ext.getCmp("editsavebutton").setDisabled(!0),Ext.getCmp("editstopbutton").setDisabled(!0),Ext.getCmp("infobutton").setDisabled(!0);try{drawControl.deactivate(),layer.removeAllFeatures(),map.removeLayer(layer)}catch(a){}Ext.getCmp("attrtable").collapse(!0)}function onInsert(){var a=grid.getStore().getCount()-1;grid.selModel.selectRow(a)}function array_unique(a){var b={},c=[];if(a.length&&"string"!=typeof a)for(var d=0,e=a.length;e>d;d++)b[a[d]+typeof a[d]]||(c.push(a[d]),b[a[d]+typeof a[d]]=!0);return c||a}function getFieldType(a){"use strict";return{"xs:boolean":"boolean","xs:int":"int","xs:integer":"int","xs:short":"int","xs:long":"int","xs:date":"date","xs:string":"string","xs:float":"float","xs:double":"float","gml:PointPropertyType":"int"}[a]}function phi4z(a,b,c,d,e,f,g,h,i){var j,k,l,m,n,o,p,q,r;for(i=f,r=1;15>=r;r++)if(j=Math.sin(i),tanphi=Math.tan(i),h=tanphi*Math.sqrt(1-a*j*j),k=Math.sin(2*i),l=b*i-c*k+d*Math.sin(4*i)-e*Math.sin(6*i),m=b-2*c*Math.cos(2*i)+4*d*Math.cos(4*i)-6*e*Math.cos(6*i),n=2*l+h*(l*l+g)-2*f*(h*l+1),o=a*k*(l*l+g-2*f*l)/(2*h),p=2*(f-l)*(h*m-2/k)-2*m,q=n/(o+p),i+=q,Math.abs(q)<=1e-10)return i;return Proj4js.reportError("phi4z: No convergence"),null}function e4fn(a){var b,c;return b=1+a,c=1-a,Math.sqrt(Math.pow(b,b)*Math.pow(c,c))}!function(a,b){function c(a){var b=a.length,c=kb.type(a);return kb.isWindow(a)?!1:1===a.nodeType&&b?!0:"array"===c||"function"!==c&&(0===b||"number"==typeof b&&b>0&&b-1 in a)}function d(a){var b=zb[a]={};return kb.each(a.match(mb)||[],function(a,c){b[c]=!0}),b}function e(a,c,d,e){if(kb.acceptData(a)){var f,g,h=kb.expando,i=a.nodeType,j=i?kb.cache:a,k=i?a[h]:a[h]&&h;if(k&&j[k]&&(e||j[k].data)||d!==b||"string"!=typeof c)return k||(k=i?a[h]=bb.pop()||kb.guid++:h),j[k]||(j[k]=i?{}:{toJSON:kb.noop}),("object"==typeof c||"function"==typeof c)&&(e?j[k]=kb.extend(j[k],c):j[k].data=kb.extend(j[k].data,c)),g=j[k],e||(g.data||(g.data={}),g=g.data),d!==b&&(g[kb.camelCase(c)]=d),"string"==typeof c?(f=g[c],null==f&&(f=g[kb.camelCase(c)])):f=g,f}}function f(a,b,c){if(kb.acceptData(a)){var d,e,f=a.nodeType,g=f?kb.cache:a,i=f?a[kb.expando]:kb.expando;if(g[i]){if(b&&(d=c?g[i]:g[i].data)){kb.isArray(b)?b=b.concat(kb.map(b,kb.camelCase)):b in d?b=[b]:(b=kb.camelCase(b),b=b in d?[b]:b.split(" ")),e=b.length;for(;e--;)delete d[b[e]];if(c?!h(d):!kb.isEmptyObject(d))return}(c||(delete g[i].data,h(g[i])))&&(f?kb.cleanData([a],!0):kb.support.deleteExpando||g!=g.window?delete g[i]:g[i]=null)}}}function g(a,c,d){if(d===b&&1===a.nodeType){var e="data-"+c.replace(Bb,"-$1").toLowerCase();if(d=a.getAttribute(e),"string"==typeof d){try{d="true"===d?!0:"false"===d?!1:"null"===d?null:+d+""===d?+d:Ab.test(d)?kb.parseJSON(d):d}catch(f){}kb.data(a,c,d)}else d=b}return d}function h(a){var b;for(b in a)if(("data"!==b||!kb.isEmptyObject(a[b]))&&"toJSON"!==b)return!1;return!0}function i(){return!0}function j(){return!1}function k(){try{return Y.activeElement}catch(a){}}function l(a,b){do a=a[b];while(a&&1!==a.nodeType);return a}function m(a,b,c){if(kb.isFunction(b))return kb.grep(a,function(a,d){return!!b.call(a,d,a)!==c});if(b.nodeType)return kb.grep(a,function(a){return a===b!==c});if("string"==typeof b){if(Qb.test(b))return kb.filter(b,a,c);b=kb.filter(b,a)}return kb.grep(a,function(a){return kb.inArray(a,b)>=0!==c})}function n(a){var b=Ub.split("|"),c=a.createDocumentFragment();if(c.createElement)for(;b.length;)c.createElement(b.pop());return c}function o(a,b){return kb.nodeName(a,"table")&&kb.nodeName(1===b.nodeType?b:b.firstChild,"tr")?a.getElementsByTagName("tbody")[0]||a.appendChild(a.ownerDocument.createElement("tbody")):a}function p(a){return a.type=(null!==kb.find.attr(a,"type"))+"/"+a.type,a}function q(a){var b=ec.exec(a.type);return b?a.type=b[1]:a.removeAttribute("type"),a}function r(a,b){for(var c,d=0;null!=(c=a[d]);d++)kb._data(c,"globalEval",!b||kb._data(b[d],"globalEval"))}function s(a,b){if(1===b.nodeType&&kb.hasData(a)){var c,d,e,f=kb._data(a),g=kb._data(b,f),h=f.events;if(h){delete g.handle,g.events={};for(c in h)for(d=0,e=h[c].length;e>d;d++)kb.event.add(b,c,h[c][d])}g.data&&(g.data=kb.extend({},g.data))}}function t(a,b){var c,d,e;if(1===b.nodeType){if(c=b.nodeName.toLowerCase(),!kb.support.noCloneEvent&&b[kb.expando]){e=kb._data(b);for(d in e.events)kb.removeEvent(b,d,e.handle);b.removeAttribute(kb.expando)}"script"===c&&b.text!==a.text?(p(b).text=a.text,q(b)):"object"===c?(b.parentNode&&(b.outerHTML=a.outerHTML),kb.support.html5Clone&&a.innerHTML&&!kb.trim(b.innerHTML)&&(b.innerHTML=a.innerHTML)):"input"===c&&bc.test(a.type)?(b.defaultChecked=b.checked=a.checked,b.value!==a.value&&(b.value=a.value)):"option"===c?b.defaultSelected=b.selected=a.defaultSelected:("input"===c||"textarea"===c)&&(b.defaultValue=a.defaultValue)}}function u(a,c){var d,e,f=0,g=typeof a.getElementsByTagName!==W?a.getElementsByTagName(c||"*"):typeof a.querySelectorAll!==W?a.querySelectorAll(c||"*"):b;if(!g)for(g=[],d=a.childNodes||a;null!=(e=d[f]);f++)!c||kb.nodeName(e,c)?g.push(e):kb.merge(g,u(e,c));return c===b||c&&kb.nodeName(a,c)?kb.merge([a],g):g}function v(a){bc.test(a.type)&&(a.defaultChecked=a.checked)}function w(a,b){if(b in a)return b;for(var c=b.charAt(0).toUpperCase()+b.slice(1),d=b,e=yc.length;e--;)if(b=yc[e]+c,b in a)return b;return d}function x(a,b){return a=b||a,"none"===kb.css(a,"display")||!kb.contains(a.ownerDocument,a)}function y(a,b){for(var c,d,e,f=[],g=0,h=a.length;h>g;g++)d=a[g],d.style&&(f[g]=kb._data(d,"olddisplay"),c=d.style.display,b?(f[g]||"none"!==c||(d.style.display=""),""===d.style.display&&x(d)&&(f[g]=kb._data(d,"olddisplay",C(d.nodeName)))):f[g]||(e=x(d),(c&&"none"!==c||!e)&&kb._data(d,"olddisplay",e?c:kb.css(d,"display"))));for(g=0;h>g;g++)d=a[g],d.style&&(b&&"none"!==d.style.display&&""!==d.style.display||(d.style.display=b?f[g]||"":"none"));return a}function z(a,b,c){var d=rc.exec(b);return d?Math.max(0,d[1]-(c||0))+(d[2]||"px"):b}function A(a,b,c,d,e){for(var f=c===(d?"border":"content")?4:"width"===b?1:0,g=0;4>f;f+=2)"margin"===c&&(g+=kb.css(a,c+xc[f],!0,e)),d?("content"===c&&(g-=kb.css(a,"padding"+xc[f],!0,e)),"margin"!==c&&(g-=kb.css(a,"border"+xc[f]+"Width",!0,e))):(g+=kb.css(a,"padding"+xc[f],!0,e),"padding"!==c&&(g+=kb.css(a,"border"+xc[f]+"Width",!0,e)));return g}function B(a,b,c){var d=!0,e="width"===b?a.offsetWidth:a.offsetHeight,f=kc(a),g=kb.support.boxSizing&&"border-box"===kb.css(a,"boxSizing",!1,f);if(0>=e||null==e){if(e=lc(a,b,f),(0>e||null==e)&&(e=a.style[b]),sc.test(e))return e;d=g&&(kb.support.boxSizingReliable||e===a.style[b]),e=parseFloat(e)||0}return e+A(a,b,c||(g?"border":"content"),d,f)+"px"}function C(a){var b=Y,c=uc[a];return c||(c=D(a,b),"none"!==c&&c||(jc=(jc||kb("<iframe frameborder='0' width='0' height='0'/>").css("cssText","display:block !important")).appendTo(b.documentElement),b=(jc[0].contentWindow||jc[0].contentDocument).document,b.write("<!doctype html><html><body>"),b.close(),c=D(a,b),jc.detach()),uc[a]=c),c}function D(a,b){var c=kb(b.createElement(a)).appendTo(b.body),d=kb.css(c[0],"display");return c.remove(),d}function E(a,b,c,d){var e;if(kb.isArray(b))kb.each(b,function(b,e){c||Ac.test(a)?d(a,e):E(a+"["+("object"==typeof e?b:"")+"]",e,c,d)});else if(c||"object"!==kb.type(b))d(a,b);else for(e in b)E(a+"["+e+"]",b[e],c,d)}function F(a){return function(b,c){"string"!=typeof b&&(c=b,b="*");var d,e=0,f=b.toLowerCase().match(mb)||[];if(kb.isFunction(c))for(;d=f[e++];)"+"===d[0]?(d=d.slice(1)||"*",(a[d]=a[d]||[]).unshift(c)):(a[d]=a[d]||[]).push(c)}}function G(a,c,d,e){function f(i){var j;return g[i]=!0,kb.each(a[i]||[],function(a,i){var k=i(c,d,e);return"string"!=typeof k||h||g[k]?h?!(j=k):b:(c.dataTypes.unshift(k),f(k),!1)}),j}var g={},h=a===Rc;return f(c.dataTypes[0])||!g["*"]&&f("*")}function H(a,c){var d,e,f=kb.ajaxSettings.flatOptions||{};for(e in c)c[e]!==b&&((f[e]?a:d||(d={}))[e]=c[e]);return d&&kb.extend(!0,a,d),a}function I(a,c,d){for(var e,f,g,h,i=a.contents,j=a.dataTypes;"*"===j[0];)j.shift(),f===b&&(f=a.mimeType||c.getResponseHeader("Content-Type"));if(f)for(h in i)if(i[h]&&i[h].test(f)){j.unshift(h);break}if(j[0]in d)g=j[0];else{for(h in d){if(!j[0]||a.converters[h+" "+j[0]]){g=h;break}e||(e=h)}g=g||e}return g?(g!==j[0]&&j.unshift(g),d[g]):b}function J(a,b,c,d){var e,f,g,h,i,j={},k=a.dataTypes.slice();if(k[1])for(g in a.converters)j[g.toLowerCase()]=a.converters[g];for(f=k.shift();f;)if(a.responseFields[f]&&(c[a.responseFields[f]]=b),!i&&d&&a.dataFilter&&(b=a.dataFilter(b,a.dataType)),i=f,f=k.shift())if("*"===f)f=i;else if("*"!==i&&i!==f){if(g=j[i+" "+f]||j["* "+f],!g)for(e in j)if(h=e.split(" "),h[1]===f&&(g=j[i+" "+h[0]]||j["* "+h[0]])){g===!0?g=j[e]:j[e]!==!0&&(f=h[0],k.unshift(h[1]));break}if(g!==!0)if(g&&a["throws"])b=g(b);else try{b=g(b)}catch(l){return{state:"parsererror",error:g?l:"No conversion from "+i+" to "+f}}}return{state:"success",data:b}}function K(){try{return new a.XMLHttpRequest}catch(b){}}function L(){try{return new a.ActiveXObject("Microsoft.XMLHTTP")}catch(b){}}function M(){return setTimeout(function(){$c=b}),$c=kb.now()}function N(a,b,c){for(var d,e=(ed[b]||[]).concat(ed["*"]),f=0,g=e.length;g>f;f++)if(d=e[f].call(c,b,a))return d}function O(a,b,c){var d,e,f=0,g=dd.length,h=kb.Deferred().always(function(){delete i.elem}),i=function(){if(e)return!1;for(var b=$c||M(),c=Math.max(0,j.startTime+j.duration-b),d=c/j.duration||0,f=1-d,g=0,i=j.tweens.length;i>g;g++)j.tweens[g].run(f);return h.notifyWith(a,[j,f,c]),1>f&&i?c:(h.resolveWith(a,[j]),!1)},j=h.promise({elem:a,props:kb.extend({},b),opts:kb.extend(!0,{specialEasing:{}},c),originalProperties:b,originalOptions:c,startTime:$c||M(),duration:c.duration,tweens:[],createTween:function(b,c){var d=kb.Tween(a,j.opts,b,c,j.opts.specialEasing[b]||j.opts.easing);return j.tweens.push(d),d},stop:function(b){var c=0,d=b?j.tweens.length:0;if(e)return this;for(e=!0;d>c;c++)j.tweens[c].run(1);return b?h.resolveWith(a,[j,b]):h.rejectWith(a,[j,b]),this}}),k=j.props;for(P(k,j.opts.specialEasing);g>f;f++)if(d=dd[f].call(j,a,k,j.opts))return d;return kb.map(k,N,j),kb.isFunction(j.opts.start)&&j.opts.start.call(a,j),kb.fx.timer(kb.extend(i,{elem:a,anim:j,queue:j.opts.queue})),j.progress(j.opts.progress).done(j.opts.done,j.opts.complete).fail(j.opts.fail).always(j.opts.always)}function P(a,b){var c,d,e,f,g;for(c in a)if(d=kb.camelCase(c),e=b[d],f=a[c],kb.isArray(f)&&(e=f[1],f=a[c]=f[0]),c!==d&&(a[d]=f,delete a[c]),g=kb.cssHooks[d],g&&"expand"in g){f=g.expand(f),delete a[d];for(c in f)c in a||(a[c]=f[c],b[c]=e)}else b[d]=e}function Q(a,b,c){var d,e,f,g,h,i,j=this,k={},l=a.style,m=a.nodeType&&x(a),n=kb._data(a,"fxshow");c.queue||(h=kb._queueHooks(a,"fx"),null==h.unqueued&&(h.unqueued=0,i=h.empty.fire,h.empty.fire=function(){h.unqueued||i()}),h.unqueued++,j.always(function(){j.always(function(){h.unqueued--,kb.queue(a,"fx").length||h.empty.fire()})})),1===a.nodeType&&("height"in b||"width"in b)&&(c.overflow=[l.overflow,l.overflowX,l.overflowY],"inline"===kb.css(a,"display")&&"none"===kb.css(a,"float")&&(kb.support.inlineBlockNeedsLayout&&"inline"!==C(a.nodeName)?l.zoom=1:l.display="inline-block")),c.overflow&&(l.overflow="hidden",kb.support.shrinkWrapBlocks||j.always(function(){l.overflow=c.overflow[0],l.overflowX=c.overflow[1],l.overflowY=c.overflow[2]}));for(d in b)if(e=b[d],ad.exec(e)){if(delete b[d],f=f||"toggle"===e,e===(m?"hide":"show"))continue;k[d]=n&&n[d]||kb.style(a,d)}if(!kb.isEmptyObject(k)){n?"hidden"in n&&(m=n.hidden):n=kb._data(a,"fxshow",{}),f&&(n.hidden=!m),m?kb(a).show():j.done(function(){kb(a).hide()}),j.done(function(){var b;kb._removeData(a,"fxshow");for(b in k)kb.style(a,b,k[b])});for(d in k)g=N(m?n[d]:0,d,j),d in n||(n[d]=g.start,m&&(g.end=g.start,g.start="width"===d||"height"===d?1:0))}}function R(a,b,c,d,e){return new R.prototype.init(a,b,c,d,e)}function S(a,b){var c,d={height:a},e=0;for(b=b?1:0;4>e;e+=2-b)c=xc[e],d["margin"+c]=d["padding"+c]=a;return b&&(d.opacity=d.width=a),d}function T(a){return kb.isWindow(a)?a:9===a.nodeType?a.defaultView||a.parentWindow:!1}var U,V,W=typeof b,X=a.location,Y=a.document,Z=Y.documentElement,$=a.jQuery,_=a.$,ab={},bb=[],cb="1.10.0",db=bb.concat,eb=bb.push,fb=bb.slice,gb=bb.indexOf,hb=ab.toString,ib=ab.hasOwnProperty,jb=cb.trim,kb=function(a,b){return new kb.fn.init(a,b,V)},lb=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,mb=/\S+/g,nb=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,ob=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/,pb=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,qb=/^[\],:{}\s]*$/,rb=/(?:^|:|,)(?:\s*\[)+/g,sb=/\\(?:["\\\/bfnrt]|u[\da-fA-F]{4})/g,tb=/"[^"\\\r\n]*"|true|false|null|-?(?:\d+\.|)\d+(?:[eE][+-]?\d+|)/g,ub=/^-ms-/,vb=/-([\da-z])/gi,wb=function(a,b){return b.toUpperCase()},xb=function(a){(Y.addEventListener||"load"===a.type||"complete"===Y.readyState)&&(yb(),kb.ready())},yb=function(){Y.addEventListener?(Y.removeEventListener("DOMContentLoaded",xb,!1),a.removeEventListener("load",xb,!1)):(Y.detachEvent("onreadystatechange",xb),a.detachEvent("onload",xb))};kb.fn=kb.prototype={jquery:cb,constructor:kb,init:function(a,c,d){var e,f;if(!a)return this;if("string"==typeof a){if(e="<"===a.charAt(0)&&">"===a.charAt(a.length-1)&&a.length>=3?[null,a,null]:ob.exec(a),!e||!e[1]&&c)return!c||c.jquery?(c||d).find(a):this.constructor(c).find(a);if(e[1]){if(c=c instanceof kb?c[0]:c,kb.merge(this,kb.parseHTML(e[1],c&&c.nodeType?c.ownerDocument||c:Y,!0)),pb.test(e[1])&&kb.isPlainObject(c))for(e in c)kb.isFunction(this[e])?this[e](c[e]):this.attr(e,c[e]);return this}if(f=Y.getElementById(e[2]),f&&f.parentNode){if(f.id!==e[2])return d.find(a);this.length=1,this[0]=f}return this.context=Y,this.selector=a,this}return a.nodeType?(this.context=this[0]=a,this.length=1,this):kb.isFunction(a)?d.ready(a):(a.selector!==b&&(this.selector=a.selector,this.context=a.context),kb.makeArray(a,this))},selector:"",length:0,toArray:function(){return fb.call(this)},get:function(a){return null==a?this.toArray():0>a?this[this.length+a]:this[a]},pushStack:function(a){var b=kb.merge(this.constructor(),a);return b.prevObject=this,b.context=this.context,b},each:function(a,b){return kb.each(this,a,b)},ready:function(a){return kb.ready.promise().done(a),this},slice:function(){return this.pushStack(fb.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(a){var b=this.length,c=+a+(0>a?b:0);return this.pushStack(c>=0&&b>c?[this[c]]:[])},map:function(a){return this.pushStack(kb.map(this,function(b,c){return a.call(b,c,b)}))},end:function(){return this.prevObject||this.constructor(null)},push:eb,sort:[].sort,splice:[].splice},kb.fn.init.prototype=kb.fn,kb.extend=kb.fn.extend=function(){var a,c,d,e,f,g,h=arguments[0]||{},i=1,j=arguments.length,k=!1;for("boolean"==typeof h&&(k=h,h=arguments[1]||{},i=2),"object"==typeof h||kb.isFunction(h)||(h={}),j===i&&(h=this,--i);j>i;i++)if(null!=(f=arguments[i]))for(e in f)a=h[e],d=f[e],h!==d&&(k&&d&&(kb.isPlainObject(d)||(c=kb.isArray(d)))?(c?(c=!1,g=a&&kb.isArray(a)?a:[]):g=a&&kb.isPlainObject(a)?a:{},h[e]=kb.extend(k,g,d)):d!==b&&(h[e]=d));return h},kb.extend({expando:"jQuery"+(cb+Math.random()).replace(/\D/g,""),noConflict:function(b){return a.$===kb&&(a.$=_),b&&a.jQuery===kb&&(a.jQuery=$),kb},isReady:!1,readyWait:1,holdReady:function(a){a?kb.readyWait++:kb.ready(!0)},ready:function(a){if(a===!0?!--kb.readyWait:!kb.isReady){if(!Y.body)return setTimeout(kb.ready);kb.isReady=!0,a!==!0&&--kb.readyWait>0||(U.resolveWith(Y,[kb]),kb.fn.trigger&&kb(Y).trigger("ready").off("ready"))}},isFunction:function(a){return"function"===kb.type(a)},isArray:Array.isArray||function(a){return"array"===kb.type(a)},isWindow:function(a){return null!=a&&a==a.window},isNumeric:function(a){return!isNaN(parseFloat(a))&&isFinite(a)},type:function(a){return null==a?a+"":"object"==typeof a||"function"==typeof a?ab[hb.call(a)]||"object":typeof a},isPlainObject:function(a){var c;if(!a||"object"!==kb.type(a)||a.nodeType||kb.isWindow(a))return!1;try{if(a.constructor&&!ib.call(a,"constructor")&&!ib.call(a.constructor.prototype,"isPrototypeOf"))return!1}catch(d){return!1}if(kb.support.ownLast)for(c in a)return ib.call(a,c);for(c in a);return c===b||ib.call(a,c)},isEmptyObject:function(a){var b;for(b in a)return!1;return!0},error:function(a){throw Error(a)},parseHTML:function(a,b,c){if(!a||"string"!=typeof a)return null;"boolean"==typeof b&&(c=b,b=!1),b=b||Y;var d=pb.exec(a),e=!c&&[];return d?[b.createElement(d[1])]:(d=kb.buildFragment([a],b,e),e&&kb(e).remove(),kb.merge([],d.childNodes))},parseJSON:function(c){return a.JSON&&a.JSON.parse?a.JSON.parse(c):null===c?c:"string"==typeof c&&(c=kb.trim(c),c&&qb.test(c.replace(sb,"@").replace(tb,"]").replace(rb,"")))?Function("return "+c)():(kb.error("Invalid JSON: "+c),b)},parseXML:function(c){var d,e;if(!c||"string"!=typeof c)return null;try{a.DOMParser?(e=new DOMParser,d=e.parseFromString(c,"text/xml")):(d=new ActiveXObject("Microsoft.XMLDOM"),d.async="false",d.loadXML(c))}catch(f){d=b}return d&&d.documentElement&&!d.getElementsByTagName("parsererror").length||kb.error("Invalid XML: "+c),d},noop:function(){},globalEval:function(b){b&&kb.trim(b)&&(a.execScript||function(b){a.eval.call(a,b)})(b)},camelCase:function(a){return a.replace(ub,"ms-").replace(vb,wb)},nodeName:function(a,b){return a.nodeName&&a.nodeName.toLowerCase()===b.toLowerCase()},each:function(a,b,d){var e,f=0,g=a.length,h=c(a);if(d){if(h)for(;g>f&&(e=b.apply(a[f],d),e!==!1);f++);else for(f in a)if(e=b.apply(a[f],d),e===!1)break}else if(h)for(;g>f&&(e=b.call(a[f],f,a[f]),e!==!1);f++);else for(f in a)if(e=b.call(a[f],f,a[f]),e===!1)break;return a},trim:jb&&!jb.call("ï»¿Â ")?function(a){return null==a?"":jb.call(a)}:function(a){return null==a?"":(a+"").replace(nb,"")},makeArray:function(a,b){var d=b||[];return null!=a&&(c(Object(a))?kb.merge(d,"string"==typeof a?[a]:a):eb.call(d,a)),d},inArray:function(a,b,c){var d;if(b){if(gb)return gb.call(b,a,c);for(d=b.length,c=c?0>c?Math.max(0,d+c):c:0;d>c;c++)if(c in b&&b[c]===a)return c}return-1},merge:function(a,c){var d=c.length,e=a.length,f=0;if("number"==typeof d)for(;d>f;f++)a[e++]=c[f];else for(;c[f]!==b;)a[e++]=c[f++];return a.length=e,a},grep:function(a,b,c){var d,e=[],f=0,g=a.length;for(c=!!c;g>f;f++)d=!!b(a[f],f),c!==d&&e.push(a[f]);return e},map:function(a,b,d){var e,f=0,g=a.length,h=c(a),i=[];if(h)for(;g>f;f++)e=b(a[f],f,d),null!=e&&(i[i.length]=e);else for(f in a)e=b(a[f],f,d),null!=e&&(i[i.length]=e);return db.apply([],i)},guid:1,proxy:function(a,c){var d,e,f;return"string"==typeof c&&(f=a[c],c=a,a=f),kb.isFunction(a)?(d=fb.call(arguments,2),e=function(){return a.apply(c||this,d.concat(fb.call(arguments)))},e.guid=a.guid=a.guid||kb.guid++,e):b},access:function(a,c,d,e,f,g,h){var i=0,j=a.length,k=null==d;if("object"===kb.type(d)){f=!0;for(i in d)kb.access(a,c,i,d[i],!0,g,h)}else if(e!==b&&(f=!0,kb.isFunction(e)||(h=!0),k&&(h?(c.call(a,e),c=null):(k=c,c=function(a,b,c){return k.call(kb(a),c)})),c))for(;j>i;i++)c(a[i],d,h?e:e.call(a[i],i,c(a[i],d)));return f?a:k?c.call(a):j?c(a[0],d):g},now:function(){return(new Date).getTime()},swap:function(a,b,c,d){var e,f,g={};for(f in b)g[f]=a.style[f],a.style[f]=b[f];e=c.apply(a,d||[]);for(f in b)a.style[f]=g[f];return e}}),kb.ready.promise=function(b){if(!U)if(U=kb.Deferred(),"complete"===Y.readyState)setTimeout(kb.ready);else if(Y.addEventListener)Y.addEventListener("DOMContentLoaded",xb,!1),a.addEventListener("load",xb,!1);else{Y.attachEvent("onreadystatechange",xb),a.attachEvent("onload",xb);var c=!1;try{c=null==a.frameElement&&Y.documentElement}catch(d){}c&&c.doScroll&&function e(){if(!kb.isReady){try{c.doScroll("left")}catch(a){return setTimeout(e,50)}yb(),kb.ready()}}()}return U.promise(b)},kb.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(a,b){ab["[object "+b+"]"]=b.toLowerCase()}),V=kb(Y),function(a,b){function c(a,b,c,d){var e,f,g,h,i,j,k,l,m,n;if((b?b.ownerDocument||b:S)!==K&&J(b),b=b||K,c=c||[],!a||"string"!=typeof a)return c;if(1!==(h=b.nodeType)&&9!==h)return[];if(M&&!d){if(e=xb.exec(a))if(g=e[1]){if(9===h){if(f=b.getElementById(g),!f||!f.parentNode)return c;if(f.id===g)return c.push(f),c}else if(b.ownerDocument&&(f=b.ownerDocument.getElementById(g))&&Q(b,f)&&f.id===g)return c.push(f),c}else{if(e[2])return eb.apply(c,b.getElementsByTagName(a)),c;if((g=e[3])&&B.getElementsByClassName&&b.getElementsByClassName)return eb.apply(c,b.getElementsByClassName(g)),c}if(B.qsa&&(!N||!N.test(a))){if(l=k=R,m=b,n=9===h&&a,1===h&&"object"!==b.nodeName.toLowerCase()){for(j=p(a),(k=b.getAttribute("id"))?l=k.replace(Ab,"\\$&"):b.setAttribute("id",l),l="[id='"+l+"'] ",i=j.length;i--;)j[i]=l+q(j[i]);m=rb.test(a)&&b.parentNode||b,n=j.join(",")}if(n)try{return eb.apply(c,m.querySelectorAll(n)),c}catch(o){}finally{k||b.removeAttribute("id")}}}return y(a.replace(ob,"$1"),b,c,d)}function d(a){return wb.test(a+"")}function e(){function a(c,d){return b.push(c+=" ")>D.cacheLength&&delete a[b.shift()],a[c]=d}var b=[];return a}function f(a){return a[R]=!0,a}function g(a){var b=K.createElement("div");try{return!!a(b)}catch(c){return!1}finally{b.parentNode&&b.parentNode.removeChild(b),b=null}}function h(a,b,c){a=a.split("|");for(var d,e=a.length,f=c?null:b;e--;)(d=D.attrHandle[a[e]])&&d!==b||(D.attrHandle[a[e]]=f)}function i(a,b){var c=a.getAttributeNode(b);return c&&c.specified?c.value:a[b]===!0?b.toLowerCase():null}function j(a,b){return a.getAttribute(b,"type"===b.toLowerCase()?1:2)}function k(a){return"input"===a.nodeName.toLowerCase()?a.defaultValue:b}function l(a,b){var c=b&&a,d=c&&1===a.nodeType&&1===b.nodeType&&(~b.sourceIndex||_)-(~a.sourceIndex||_);if(d)return d;if(c)for(;c=c.nextSibling;)if(c===b)return-1;return a?1:-1}function m(a){return function(b){var c=b.nodeName.toLowerCase();return"input"===c&&b.type===a}}function n(a){return function(b){var c=b.nodeName.toLowerCase();return("input"===c||"button"===c)&&b.type===a}}function o(a){return f(function(b){return b=+b,f(function(c,d){for(var e,f=a([],c.length,b),g=f.length;g--;)c[e=f[g]]&&(c[e]=!(d[e]=c[e]))})})}function p(a,b){var d,e,f,g,h,i,j,k=W[a+" "];if(k)return b?0:k.slice(0);for(h=a,i=[],j=D.preFilter;h;){(!d||(e=pb.exec(h)))&&(e&&(h=h.slice(e[0].length)||h),i.push(f=[])),d=!1,(e=qb.exec(h))&&(d=e.shift(),f.push({value:d,type:e[0].replace(ob," ")}),h=h.slice(d.length));for(g in D.filter)!(e=vb[g].exec(h))||j[g]&&!(e=j[g](e))||(d=e.shift(),f.push({value:d,type:g,matches:e}),h=h.slice(d.length));if(!d)break}return b?h.length:h?c.error(a):W(a,i).slice(0)}function q(a){for(var b=0,c=a.length,d="";c>b;b++)d+=a[b].value;return d}function r(a,b,c){var d=b.dir,e=c&&"parentNode"===d,f=U++;return b.first?function(b,c,f){for(;b=b[d];)if(1===b.nodeType||e)return a(b,c,f)}:function(b,c,g){var h,i,j,k=T+" "+f;if(g){for(;b=b[d];)if((1===b.nodeType||e)&&a(b,c,g))return!0}else for(;b=b[d];)if(1===b.nodeType||e)if(j=b[R]||(b[R]={}),(i=j[d])&&i[0]===k){if((h=i[1])===!0||h===C)return h===!0}else if(i=j[d]=[k],i[1]=a(b,c,g)||C,i[1]===!0)return!0}}function s(a){return a.length>1?function(b,c,d){for(var e=a.length;e--;)if(!a[e](b,c,d))return!1;return!0}:a[0]}function t(a,b,c,d,e){for(var f,g=[],h=0,i=a.length,j=null!=b;i>h;h++)(f=a[h])&&(!c||c(f,d,e))&&(g.push(f),j&&b.push(h));return g}function u(a,b,c,d,e,g){return d&&!d[R]&&(d=u(d)),e&&!e[R]&&(e=u(e,g)),f(function(f,g,h,i){var j,k,l,m=[],n=[],o=g.length,p=f||x(b||"*",h.nodeType?[h]:h,[]),q=!a||!f&&b?p:t(p,m,a,h,i),r=c?e||(f?a:o||d)?[]:g:q;if(c&&c(q,r,h,i),d)for(j=t(r,n),d(j,[],h,i),k=j.length;k--;)(l=j[k])&&(r[n[k]]=!(q[n[k]]=l));if(f){if(e||a){if(e){for(j=[],k=r.length;k--;)(l=r[k])&&j.push(q[k]=l);e(null,r=[],j,i)}for(k=r.length;k--;)(l=r[k])&&(j=e?gb.call(f,l):m[k])>-1&&(f[j]=!(g[j]=l))}}else r=t(r===g?r.splice(o,r.length):r),e?e(null,g,r,i):eb.apply(g,r)})}function v(a){for(var b,c,d,e=a.length,f=D.relative[a[0].type],g=f||D.relative[" "],h=f?1:0,i=r(function(a){return a===b},g,!0),j=r(function(a){return gb.call(b,a)>-1},g,!0),k=[function(a,c,d){return!f&&(d||c!==H)||((b=c).nodeType?i(a,c,d):j(a,c,d))}];e>h;h++)if(c=D.relative[a[h].type])k=[r(s(k),c)];else{if(c=D.filter[a[h].type].apply(null,a[h].matches),c[R]){for(d=++h;e>d&&!D.relative[a[d].type];d++);return u(h>1&&s(k),h>1&&q(a.slice(0,h-1).concat({value:" "===a[h-2].type?"*":""})).replace(ob,"$1"),c,d>h&&v(a.slice(h,d)),e>d&&v(a=a.slice(d)),e>d&&q(a))}k.push(c)}return s(k)}function w(a,b){var d=0,e=b.length>0,g=a.length>0,h=function(f,h,i,j,k){var l,m,n,o=[],p=0,q="0",r=f&&[],s=null!=k,u=H,v=f||g&&D.find.TAG("*",k&&h.parentNode||h),w=T+=null==u?1:Math.random()||.1;for(s&&(H=h!==K&&h,C=d);null!=(l=v[q]);q++){if(g&&l){for(m=0;n=a[m++];)if(n(l,h,i)){j.push(l);break}s&&(T=w,C=++d)}e&&((l=!n&&l)&&p--,f&&r.push(l))}if(p+=q,e&&q!==p){for(m=0;n=b[m++];)n(r,o,h,i);if(f){if(p>0)for(;q--;)r[q]||o[q]||(o[q]=cb.call(j));o=t(o)}eb.apply(j,o),s&&!f&&o.length>0&&p+b.length>1&&c.uniqueSort(j)}return s&&(T=w,H=u),r};return e?f(h):h}function x(a,b,d){for(var e=0,f=b.length;f>e;e++)c(a,b[e],d);return d}function y(a,b,c,d){var e,f,g,h,i,j=p(a);if(!d&&1===j.length){if(f=j[0]=j[0].slice(0),f.length>2&&"ID"===(g=f[0]).type&&B.getById&&9===b.nodeType&&M&&D.relative[f[1].type]){if(b=(D.find.ID(g.matches[0].replace(Bb,Cb),b)||[])[0],!b)return c;a=a.slice(f.shift().value.length)}for(e=vb.needsContext.test(a)?0:f.length;e--&&(g=f[e],!D.relative[h=g.type]);)if((i=D.find[h])&&(d=i(g.matches[0].replace(Bb,Cb),rb.test(f[0].type)&&b.parentNode||b))){if(f.splice(e,1),a=d.length&&q(f),!a)return eb.apply(c,d),c;break}}return G(a,j)(d,b,!M,c,rb.test(a)),c}function z(){}var A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R="sizzle"+-new Date,S=a.document,T=0,U=0,V=e(),W=e(),X=e(),Y=!1,Z=function(){return 0},$=typeof b,_=1<<31,ab={}.hasOwnProperty,bb=[],cb=bb.pop,db=bb.push,eb=bb.push,fb=bb.slice,gb=bb.indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(this[b]===a)return b;return-1},hb="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",ib="[\\x20\\t\\r\\n\\f]",jb="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",lb=jb.replace("w","w#"),mb="\\["+ib+"*("+jb+")"+ib+"*(?:([*^$|!~]?=)"+ib+"*(?:(['\"])((?:\\\\.|[^\\\\])*?)\\3|("+lb+")|)|)"+ib+"*\\]",nb=":("+jb+")(?:\\(((['\"])((?:\\\\.|[^\\\\])*?)\\3|((?:\\\\.|[^\\\\()[\\]]|"+mb.replace(3,8)+")*)|.*)\\)|)",ob=RegExp("^"+ib+"+|((?:^|[^\\\\])(?:\\\\.)*)"+ib+"+$","g"),pb=RegExp("^"+ib+"*,"+ib+"*"),qb=RegExp("^"+ib+"*([>+~]|"+ib+")"+ib+"*"),rb=RegExp(ib+"*[+~]"),sb=RegExp("="+ib+"*([^\\]'\"]*)"+ib+"*\\]","g"),tb=RegExp(nb),ub=RegExp("^"+lb+"$"),vb={ID:RegExp("^#("+jb+")"),CLASS:RegExp("^\\.("+jb+")"),TAG:RegExp("^("+jb.replace("w","w*")+")"),ATTR:RegExp("^"+mb),PSEUDO:RegExp("^"+nb),CHILD:RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+ib+"*(even|odd|(([+-]|)(\\d*)n|)"+ib+"*(?:([+-]|)"+ib+"*(\\d+)|))"+ib+"*\\)|)","i"),bool:RegExp("^(?:"+hb+")$","i"),needsContext:RegExp("^"+ib+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+ib+"*((?:-\\d)?\\d*)"+ib+"*\\)|)(?=[^-]|$)","i")},wb=/^[^{]+\{\s*\[native \w/,xb=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,yb=/^(?:input|select|textarea|button)$/i,zb=/^h\d$/i,Ab=/'|\\/g,Bb=RegExp("\\\\([\\da-f]{1,6}"+ib+"?|("+ib+")|.)","ig"),Cb=function(a,b,c){var d="0x"+b-65536;return d!==d||c?b:0>d?String.fromCharCode(d+65536):String.fromCharCode(55296|d>>10,56320|1023&d)
};try{eb.apply(bb=fb.call(S.childNodes),S.childNodes),bb[S.childNodes.length].nodeType}catch(Db){eb={apply:bb.length?function(a,b){db.apply(a,fb.call(b))}:function(a,b){for(var c=a.length,d=0;a[c++]=b[d++];);a.length=c-1}}}F=c.isXML=function(a){var b=a&&(a.ownerDocument||a).documentElement;return b?"HTML"!==b.nodeName:!1},B=c.support={},J=c.setDocument=function(a){var c=a?a.ownerDocument||a:S;return c!==K&&9===c.nodeType&&c.documentElement?(K=c,L=c.documentElement,M=!F(c),B.attributes=g(function(a){return a.innerHTML="<a href='#'></a>",h("type|href|height|width",j,"#"===a.firstChild.getAttribute("href")),h(hb,i,null==a.getAttribute("disabled")),a.className="i",!a.getAttribute("className")}),B.input=g(function(a){return a.innerHTML="<input>",a.firstChild.setAttribute("value",""),""===a.firstChild.getAttribute("value")}),h("value",k,B.attributes&&B.input),B.getElementsByTagName=g(function(a){return a.appendChild(c.createComment("")),!a.getElementsByTagName("*").length}),B.getElementsByClassName=g(function(a){return a.innerHTML="<div class='a'></div><div class='a i'></div>",a.firstChild.className="i",2===a.getElementsByClassName("i").length}),B.getById=g(function(a){return L.appendChild(a).id=R,!c.getElementsByName||!c.getElementsByName(R).length}),B.getById?(D.find.ID=function(a,b){if(typeof b.getElementById!==$&&M){var c=b.getElementById(a);return c&&c.parentNode?[c]:[]}},D.filter.ID=function(a){var b=a.replace(Bb,Cb);return function(a){return a.getAttribute("id")===b}}):(delete D.find.ID,D.filter.ID=function(a){var b=a.replace(Bb,Cb);return function(a){var c=typeof a.getAttributeNode!==$&&a.getAttributeNode("id");return c&&c.value===b}}),D.find.TAG=B.getElementsByTagName?function(a,c){return typeof c.getElementsByTagName!==$?c.getElementsByTagName(a):b}:function(a,b){var c,d=[],e=0,f=b.getElementsByTagName(a);if("*"===a){for(;c=f[e++];)1===c.nodeType&&d.push(c);return d}return f},D.find.CLASS=B.getElementsByClassName&&function(a,c){return typeof c.getElementsByClassName!==$&&M?c.getElementsByClassName(a):b},O=[],N=[],(B.qsa=d(c.querySelectorAll))&&(g(function(a){a.innerHTML="<select><option selected=''></option></select>",a.querySelectorAll("[selected]").length||N.push("\\["+ib+"*(?:value|"+hb+")"),a.querySelectorAll(":checked").length||N.push(":checked")}),g(function(a){var b=c.createElement("input");b.setAttribute("type","hidden"),a.appendChild(b).setAttribute("t",""),a.querySelectorAll("[t^='']").length&&N.push("[*^$]="+ib+"*(?:''|\"\")"),a.querySelectorAll(":enabled").length||N.push(":enabled",":disabled"),a.querySelectorAll("*,:x"),N.push(",.*:")})),(B.matchesSelector=d(P=L.webkitMatchesSelector||L.mozMatchesSelector||L.oMatchesSelector||L.msMatchesSelector))&&g(function(a){B.disconnectedMatch=P.call(a,"div"),P.call(a,"[s!='']:x"),O.push("!=",nb)}),N=N.length&&RegExp(N.join("|")),O=O.length&&RegExp(O.join("|")),Q=d(L.contains)||L.compareDocumentPosition?function(a,b){var c=9===a.nodeType?a.documentElement:a,d=b&&b.parentNode;return a===d||!(!d||1!==d.nodeType||!(c.contains?c.contains(d):a.compareDocumentPosition&&16&a.compareDocumentPosition(d)))}:function(a,b){if(b)for(;b=b.parentNode;)if(b===a)return!0;return!1},B.sortDetached=g(function(a){return 1&a.compareDocumentPosition(c.createElement("div"))}),Z=L.compareDocumentPosition?function(a,b){if(a===b)return Y=!0,0;var d=b.compareDocumentPosition&&a.compareDocumentPosition&&a.compareDocumentPosition(b);return d?1&d||!B.sortDetached&&b.compareDocumentPosition(a)===d?a===c||Q(S,a)?-1:b===c||Q(S,b)?1:I?gb.call(I,a)-gb.call(I,b):0:4&d?-1:1:a.compareDocumentPosition?-1:1}:function(a,b){var d,e=0,f=a.parentNode,g=b.parentNode,h=[a],i=[b];if(a===b)return Y=!0,0;if(!f||!g)return a===c?-1:b===c?1:f?-1:g?1:I?gb.call(I,a)-gb.call(I,b):0;if(f===g)return l(a,b);for(d=a;d=d.parentNode;)h.unshift(d);for(d=b;d=d.parentNode;)i.unshift(d);for(;h[e]===i[e];)e++;return e?l(h[e],i[e]):h[e]===S?-1:i[e]===S?1:0},c):K},c.matches=function(a,b){return c(a,null,null,b)},c.matchesSelector=function(a,b){if((a.ownerDocument||a)!==K&&J(a),b=b.replace(sb,"='$1']"),!(!B.matchesSelector||!M||O&&O.test(b)||N&&N.test(b)))try{var d=P.call(a,b);if(d||B.disconnectedMatch||a.document&&11!==a.document.nodeType)return d}catch(e){}return c(b,K,null,[a]).length>0},c.contains=function(a,b){return(a.ownerDocument||a)!==K&&J(a),Q(a,b)},c.attr=function(a,c){(a.ownerDocument||a)!==K&&J(a);var d=D.attrHandle[c.toLowerCase()],e=d&&ab.call(D.attrHandle,c.toLowerCase())?d(a,c,!M):b;return e===b?B.attributes||!M?a.getAttribute(c):(e=a.getAttributeNode(c))&&e.specified?e.value:null:e},c.error=function(a){throw Error("Syntax error, unrecognized expression: "+a)},c.uniqueSort=function(a){var b,c=[],d=0,e=0;if(Y=!B.detectDuplicates,I=!B.sortStable&&a.slice(0),a.sort(Z),Y){for(;b=a[e++];)b===a[e]&&(d=c.push(e));for(;d--;)a.splice(c[d],1)}return a},E=c.getText=function(a){var b,c="",d=0,e=a.nodeType;if(e){if(1===e||9===e||11===e){if("string"==typeof a.textContent)return a.textContent;for(a=a.firstChild;a;a=a.nextSibling)c+=E(a)}else if(3===e||4===e)return a.nodeValue}else for(;b=a[d];d++)c+=E(b);return c},D=c.selectors={cacheLength:50,createPseudo:f,match:vb,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(a){return a[1]=a[1].replace(Bb,Cb),a[3]=(a[4]||a[5]||"").replace(Bb,Cb),"~="===a[2]&&(a[3]=" "+a[3]+" "),a.slice(0,4)},CHILD:function(a){return a[1]=a[1].toLowerCase(),"nth"===a[1].slice(0,3)?(a[3]||c.error(a[0]),a[4]=+(a[4]?a[5]+(a[6]||1):2*("even"===a[3]||"odd"===a[3])),a[5]=+(a[7]+a[8]||"odd"===a[3])):a[3]&&c.error(a[0]),a},PSEUDO:function(a){var c,d=!a[5]&&a[2];return vb.CHILD.test(a[0])?null:(a[3]&&a[4]!==b?a[2]=a[4]:d&&tb.test(d)&&(c=p(d,!0))&&(c=d.indexOf(")",d.length-c)-d.length)&&(a[0]=a[0].slice(0,c),a[2]=d.slice(0,c)),a.slice(0,3))}},filter:{TAG:function(a){var b=a.replace(Bb,Cb).toLowerCase();return"*"===a?function(){return!0}:function(a){return a.nodeName&&a.nodeName.toLowerCase()===b}},CLASS:function(a){var b=V[a+" "];return b||(b=RegExp("(^|"+ib+")"+a+"("+ib+"|$)"))&&V(a,function(a){return b.test("string"==typeof a.className&&a.className||typeof a.getAttribute!==$&&a.getAttribute("class")||"")})},ATTR:function(a,b,d){return function(e){var f=c.attr(e,a);return null==f?"!="===b:b?(f+="","="===b?f===d:"!="===b?f!==d:"^="===b?d&&0===f.indexOf(d):"*="===b?d&&f.indexOf(d)>-1:"$="===b?d&&f.slice(-d.length)===d:"~="===b?(" "+f+" ").indexOf(d)>-1:"|="===b?f===d||f.slice(0,d.length+1)===d+"-":!1):!0}},CHILD:function(a,b,c,d,e){var f="nth"!==a.slice(0,3),g="last"!==a.slice(-4),h="of-type"===b;return 1===d&&0===e?function(a){return!!a.parentNode}:function(b,c,i){var j,k,l,m,n,o,p=f!==g?"nextSibling":"previousSibling",q=b.parentNode,r=h&&b.nodeName.toLowerCase(),s=!i&&!h;if(q){if(f){for(;p;){for(l=b;l=l[p];)if(h?l.nodeName.toLowerCase()===r:1===l.nodeType)return!1;o=p="only"===a&&!o&&"nextSibling"}return!0}if(o=[g?q.firstChild:q.lastChild],g&&s){for(k=q[R]||(q[R]={}),j=k[a]||[],n=j[0]===T&&j[1],m=j[0]===T&&j[2],l=n&&q.childNodes[n];l=++n&&l&&l[p]||(m=n=0)||o.pop();)if(1===l.nodeType&&++m&&l===b){k[a]=[T,n,m];break}}else if(s&&(j=(b[R]||(b[R]={}))[a])&&j[0]===T)m=j[1];else for(;(l=++n&&l&&l[p]||(m=n=0)||o.pop())&&((h?l.nodeName.toLowerCase()!==r:1!==l.nodeType)||!++m||(s&&((l[R]||(l[R]={}))[a]=[T,m]),l!==b)););return m-=e,m===d||0===m%d&&m/d>=0}}},PSEUDO:function(a,b){var d,e=D.pseudos[a]||D.setFilters[a.toLowerCase()]||c.error("unsupported pseudo: "+a);return e[R]?e(b):e.length>1?(d=[a,a,"",b],D.setFilters.hasOwnProperty(a.toLowerCase())?f(function(a,c){for(var d,f=e(a,b),g=f.length;g--;)d=gb.call(a,f[g]),a[d]=!(c[d]=f[g])}):function(a){return e(a,0,d)}):e}},pseudos:{not:f(function(a){var b=[],c=[],d=G(a.replace(ob,"$1"));return d[R]?f(function(a,b,c,e){for(var f,g=d(a,null,e,[]),h=a.length;h--;)(f=g[h])&&(a[h]=!(b[h]=f))}):function(a,e,f){return b[0]=a,d(b,null,f,c),!c.pop()}}),has:f(function(a){return function(b){return c(a,b).length>0}}),contains:f(function(a){return function(b){return(b.textContent||b.innerText||E(b)).indexOf(a)>-1}}),lang:f(function(a){return ub.test(a||"")||c.error("unsupported lang: "+a),a=a.replace(Bb,Cb).toLowerCase(),function(b){var c;do if(c=M?b.lang:b.getAttribute("xml:lang")||b.getAttribute("lang"))return c=c.toLowerCase(),c===a||0===c.indexOf(a+"-");while((b=b.parentNode)&&1===b.nodeType);return!1}}),target:function(b){var c=a.location&&a.location.hash;return c&&c.slice(1)===b.id},root:function(a){return a===L},focus:function(a){return a===K.activeElement&&(!K.hasFocus||K.hasFocus())&&!!(a.type||a.href||~a.tabIndex)},enabled:function(a){return a.disabled===!1},disabled:function(a){return a.disabled===!0},checked:function(a){var b=a.nodeName.toLowerCase();return"input"===b&&!!a.checked||"option"===b&&!!a.selected},selected:function(a){return a.parentNode&&a.parentNode.selectedIndex,a.selected===!0},empty:function(a){for(a=a.firstChild;a;a=a.nextSibling)if(a.nodeName>"@"||3===a.nodeType||4===a.nodeType)return!1;return!0},parent:function(a){return!D.pseudos.empty(a)},header:function(a){return zb.test(a.nodeName)},input:function(a){return yb.test(a.nodeName)},button:function(a){var b=a.nodeName.toLowerCase();return"input"===b&&"button"===a.type||"button"===b},text:function(a){var b;return"input"===a.nodeName.toLowerCase()&&"text"===a.type&&(null==(b=a.getAttribute("type"))||b.toLowerCase()===a.type)},first:o(function(){return[0]}),last:o(function(a,b){return[b-1]}),eq:o(function(a,b,c){return[0>c?c+b:c]}),even:o(function(a,b){for(var c=0;b>c;c+=2)a.push(c);return a}),odd:o(function(a,b){for(var c=1;b>c;c+=2)a.push(c);return a}),lt:o(function(a,b,c){for(var d=0>c?c+b:c;--d>=0;)a.push(d);return a}),gt:o(function(a,b,c){for(var d=0>c?c+b:c;b>++d;)a.push(d);return a})}};for(A in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})D.pseudos[A]=m(A);for(A in{submit:!0,reset:!0})D.pseudos[A]=n(A);G=c.compile=function(a,b){var c,d=[],e=[],f=X[a+" "];if(!f){for(b||(b=p(a)),c=b.length;c--;)f=v(b[c]),f[R]?d.push(f):e.push(f);f=X(a,w(e,d))}return f},D.pseudos.nth=D.pseudos.eq,z.prototype=D.filters=D.pseudos,D.setFilters=new z,B.sortStable=R.split("").sort(Z).join("")===R,J(),[0,0].sort(Z),B.detectDuplicates=Y,kb.find=c,kb.expr=c.selectors,kb.expr[":"]=kb.expr.pseudos,kb.unique=c.uniqueSort,kb.text=c.getText,kb.isXMLDoc=c.isXML,kb.contains=c.contains}(a);var zb={};kb.Callbacks=function(a){a="string"==typeof a?zb[a]||d(a):kb.extend({},a);var c,e,f,g,h,i,j=[],k=!a.once&&[],l=function(b){for(e=a.memory&&b,f=!0,h=i||0,i=0,g=j.length,c=!0;j&&g>h;h++)if(j[h].apply(b[0],b[1])===!1&&a.stopOnFalse){e=!1;break}c=!1,j&&(k?k.length&&l(k.shift()):e?j=[]:m.disable())},m={add:function(){if(j){var b=j.length;!function d(b){kb.each(b,function(b,c){var e=kb.type(c);"function"===e?a.unique&&m.has(c)||j.push(c):c&&c.length&&"string"!==e&&d(c)})}(arguments),c?g=j.length:e&&(i=b,l(e))}return this},remove:function(){return j&&kb.each(arguments,function(a,b){for(var d;(d=kb.inArray(b,j,d))>-1;)j.splice(d,1),c&&(g>=d&&g--,h>=d&&h--)}),this},has:function(a){return a?kb.inArray(a,j)>-1:!(!j||!j.length)},empty:function(){return j=[],g=0,this},disable:function(){return j=k=e=b,this},disabled:function(){return!j},lock:function(){return k=b,e||m.disable(),this},locked:function(){return!k},fireWith:function(a,b){return b=b||[],b=[a,b.slice?b.slice():b],!j||f&&!k||(c?k.push(b):l(b)),this},fire:function(){return m.fireWith(this,arguments),this},fired:function(){return!!f}};return m},kb.extend({Deferred:function(a){var b=[["resolve","done",kb.Callbacks("once memory"),"resolved"],["reject","fail",kb.Callbacks("once memory"),"rejected"],["notify","progress",kb.Callbacks("memory")]],c="pending",d={state:function(){return c},always:function(){return e.done(arguments).fail(arguments),this},then:function(){var a=arguments;return kb.Deferred(function(c){kb.each(b,function(b,f){var g=f[0],h=kb.isFunction(a[b])&&a[b];e[f[1]](function(){var a=h&&h.apply(this,arguments);a&&kb.isFunction(a.promise)?a.promise().done(c.resolve).fail(c.reject).progress(c.notify):c[g+"With"](this===d?c.promise():this,h?[a]:arguments)})}),a=null}).promise()},promise:function(a){return null!=a?kb.extend(a,d):d}},e={};return d.pipe=d.then,kb.each(b,function(a,f){var g=f[2],h=f[3];d[f[1]]=g.add,h&&g.add(function(){c=h},b[1^a][2].disable,b[2][2].lock),e[f[0]]=function(){return e[f[0]+"With"](this===e?d:this,arguments),this},e[f[0]+"With"]=g.fireWith}),d.promise(e),a&&a.call(e,e),e},when:function(a){var b,c,d,e=0,f=fb.call(arguments),g=f.length,h=1!==g||a&&kb.isFunction(a.promise)?g:0,i=1===h?a:kb.Deferred(),j=function(a,c,d){return function(e){c[a]=this,d[a]=arguments.length>1?fb.call(arguments):e,d===b?i.notifyWith(c,d):--h||i.resolveWith(c,d)}};if(g>1)for(b=Array(g),c=Array(g),d=Array(g);g>e;e++)f[e]&&kb.isFunction(f[e].promise)?f[e].promise().done(j(e,d,f)).fail(i.reject).progress(j(e,c,b)):--h;return h||i.resolveWith(d,f),i.promise()}}),kb.support=function(b){var c,d,e,f,g,h,i,j,k,l=Y.createElement("div");if(l.setAttribute("className","t"),l.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",c=l.getElementsByTagName("*")||[],d=l.getElementsByTagName("a")[0],!d||!d.style||!c.length)return b;f=Y.createElement("select"),h=f.appendChild(Y.createElement("option")),e=l.getElementsByTagName("input")[0],d.style.cssText="top:1px;float:left;opacity:.5",b.getSetAttribute="t"!==l.className,b.leadingWhitespace=3===l.firstChild.nodeType,b.tbody=!l.getElementsByTagName("tbody").length,b.htmlSerialize=!!l.getElementsByTagName("link").length,b.style=/top/.test(d.getAttribute("style")),b.hrefNormalized="/a"===d.getAttribute("href"),b.opacity=/^0.5/.test(d.style.opacity),b.cssFloat=!!d.style.cssFloat,b.checkOn=!!e.value,b.optSelected=h.selected,b.enctype=!!Y.createElement("form").enctype,b.html5Clone="<:nav></:nav>"!==Y.createElement("nav").cloneNode(!0).outerHTML,b.inlineBlockNeedsLayout=!1,b.shrinkWrapBlocks=!1,b.pixelPosition=!1,b.deleteExpando=!0,b.noCloneEvent=!0,b.reliableMarginRight=!0,b.boxSizingReliable=!0,e.checked=!0,b.noCloneChecked=e.cloneNode(!0).checked,f.disabled=!0,b.optDisabled=!h.disabled;try{delete l.test}catch(m){b.deleteExpando=!1}e=Y.createElement("input"),e.setAttribute("value",""),b.input=""===e.getAttribute("value"),e.value="t",e.setAttribute("type","radio"),b.radioValue="t"===e.value,e.setAttribute("checked","t"),e.setAttribute("name","t"),g=Y.createDocumentFragment(),g.appendChild(e),b.appendChecked=e.checked,b.checkClone=g.cloneNode(!0).cloneNode(!0).lastChild.checked,l.attachEvent&&(l.attachEvent("onclick",function(){b.noCloneEvent=!1}),l.cloneNode(!0).click());for(k in{submit:!0,change:!0,focusin:!0})l.setAttribute(i="on"+k,"t"),b[k+"Bubbles"]=i in a||l.attributes[i].expando===!1;l.style.backgroundClip="content-box",l.cloneNode(!0).style.backgroundClip="",b.clearCloneStyle="content-box"===l.style.backgroundClip;for(k in kb(b))break;return b.ownLast="0"!==k,kb(function(){var c,d,e,f="padding:0;margin:0;border:0;display:block;box-sizing:content-box;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;",g=Y.getElementsByTagName("body")[0];g&&(c=Y.createElement("div"),c.style.cssText="border:0;width:0;height:0;position:absolute;top:0;left:-9999px;margin-top:1px",g.appendChild(c).appendChild(l),l.innerHTML="<table><tr><td></td><td>t</td></tr></table>",e=l.getElementsByTagName("td"),e[0].style.cssText="padding:0;margin:0;border:0;display:none",j=0===e[0].offsetHeight,e[0].style.display="",e[1].style.display="none",b.reliableHiddenOffsets=j&&0===e[0].offsetHeight,l.innerHTML="",l.style.cssText="box-sizing:border-box;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;padding:1px;border:1px;display:block;width:4px;margin-top:1%;position:absolute;top:1%;",kb.swap(g,null!=g.style.zoom?{zoom:1}:{},function(){b.boxSizing=4===l.offsetWidth}),a.getComputedStyle&&(b.pixelPosition="1%"!==(a.getComputedStyle(l,null)||{}).top,b.boxSizingReliable="4px"===(a.getComputedStyle(l,null)||{width:"4px"}).width,d=l.appendChild(Y.createElement("div")),d.style.cssText=l.style.cssText=f,d.style.marginRight=d.style.width="0",l.style.width="1px",b.reliableMarginRight=!parseFloat((a.getComputedStyle(d,null)||{}).marginRight)),typeof l.style.zoom!==W&&(l.innerHTML="",l.style.cssText=f+"width:1px;padding:1px;display:inline;zoom:1",b.inlineBlockNeedsLayout=3===l.offsetWidth,l.style.display="block",l.innerHTML="<div></div>",l.firstChild.style.width="5px",b.shrinkWrapBlocks=3!==l.offsetWidth,b.inlineBlockNeedsLayout&&(g.style.zoom=1)),g.removeChild(c),c=l=e=d=null)}),c=f=g=h=d=e=null,b}({});var Ab=/(?:\{[\s\S]*\}|\[[\s\S]*\])$/,Bb=/([A-Z])/g;kb.extend({cache:{},noData:{applet:!0,embed:!0,object:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"},hasData:function(a){return a=a.nodeType?kb.cache[a[kb.expando]]:a[kb.expando],!!a&&!h(a)},data:function(a,b,c){return e(a,b,c)},removeData:function(a,b){return f(a,b)},_data:function(a,b,c){return e(a,b,c,!0)},_removeData:function(a,b){return f(a,b,!0)},acceptData:function(a){if(a.nodeType&&1!==a.nodeType&&9!==a.nodeType)return!1;var b=a.nodeName&&kb.noData[a.nodeName.toLowerCase()];return!b||b!==!0&&a.getAttribute("classid")===b}}),kb.fn.extend({data:function(a,c){var d,e,f=null,h=0,i=this[0];if(a===b){if(this.length&&(f=kb.data(i),1===i.nodeType&&!kb._data(i,"parsedAttrs"))){for(d=i.attributes;d.length>h;h++)e=d[h].name,0===e.indexOf("data-")&&(e=kb.camelCase(e.slice(5)),g(i,e,f[e]));kb._data(i,"parsedAttrs",!0)}return f}return"object"==typeof a?this.each(function(){kb.data(this,a)}):arguments.length>1?this.each(function(){kb.data(this,a,c)}):i?g(i,a,kb.data(i,a)):null},removeData:function(a){return this.each(function(){kb.removeData(this,a)})}}),kb.extend({queue:function(a,c,d){var e;return a?(c=(c||"fx")+"queue",e=kb._data(a,c),d&&(!e||kb.isArray(d)?e=kb._data(a,c,kb.makeArray(d)):e.push(d)),e||[]):b},dequeue:function(a,b){b=b||"fx";var c=kb.queue(a,b),d=c.length,e=c.shift(),f=kb._queueHooks(a,b),g=function(){kb.dequeue(a,b)};"inprogress"===e&&(e=c.shift(),d--),f.cur=e,e&&("fx"===b&&c.unshift("inprogress"),delete f.stop,e.call(a,g,f)),!d&&f&&f.empty.fire()},_queueHooks:function(a,b){var c=b+"queueHooks";return kb._data(a,c)||kb._data(a,c,{empty:kb.Callbacks("once memory").add(function(){kb._removeData(a,b+"queue"),kb._removeData(a,c)})})}}),kb.fn.extend({queue:function(a,c){var d=2;return"string"!=typeof a&&(c=a,a="fx",d--),d>arguments.length?kb.queue(this[0],a):c===b?this:this.each(function(){var b=kb.queue(this,a,c);kb._queueHooks(this,a),"fx"===a&&"inprogress"!==b[0]&&kb.dequeue(this,a)})},dequeue:function(a){return this.each(function(){kb.dequeue(this,a)})},delay:function(a,b){return a=kb.fx?kb.fx.speeds[a]||a:a,b=b||"fx",this.queue(b,function(b,c){var d=setTimeout(b,a);c.stop=function(){clearTimeout(d)}})},clearQueue:function(a){return this.queue(a||"fx",[])},promise:function(a,c){var d,e=1,f=kb.Deferred(),g=this,h=this.length,i=function(){--e||f.resolveWith(g,[g])};for("string"!=typeof a&&(c=a,a=b),a=a||"fx";h--;)d=kb._data(g[h],a+"queueHooks"),d&&d.empty&&(e++,d.empty.add(i));return i(),f.promise(c)}});var Cb,Db,Eb=/[\t\r\n\f]/g,Fb=/\r/g,Gb=/^(?:input|select|textarea|button|object)$/i,Hb=/^(?:a|area)$/i,Ib=/^(?:checked|selected)$/i,Jb=kb.support.getSetAttribute,Kb=kb.support.input;kb.fn.extend({attr:function(a,b){return kb.access(this,kb.attr,a,b,arguments.length>1)},removeAttr:function(a){return this.each(function(){kb.removeAttr(this,a)})},prop:function(a,b){return kb.access(this,kb.prop,a,b,arguments.length>1)},removeProp:function(a){return a=kb.propFix[a]||a,this.each(function(){try{this[a]=b,delete this[a]}catch(c){}})},addClass:function(a){var b,c,d,e,f,g=0,h=this.length,i="string"==typeof a&&a;if(kb.isFunction(a))return this.each(function(b){kb(this).addClass(a.call(this,b,this.className))});if(i)for(b=(a||"").match(mb)||[];h>g;g++)if(c=this[g],d=1===c.nodeType&&(c.className?(" "+c.className+" ").replace(Eb," "):" ")){for(f=0;e=b[f++];)0>d.indexOf(" "+e+" ")&&(d+=e+" ");c.className=kb.trim(d)}return this},removeClass:function(a){var b,c,d,e,f,g=0,h=this.length,i=0===arguments.length||"string"==typeof a&&a;if(kb.isFunction(a))return this.each(function(b){kb(this).removeClass(a.call(this,b,this.className))});if(i)for(b=(a||"").match(mb)||[];h>g;g++)if(c=this[g],d=1===c.nodeType&&(c.className?(" "+c.className+" ").replace(Eb," "):"")){for(f=0;e=b[f++];)for(;d.indexOf(" "+e+" ")>=0;)d=d.replace(" "+e+" "," ");c.className=a?kb.trim(d):""}return this},toggleClass:function(a,b){var c=typeof a,d="boolean"==typeof b;return this.each(kb.isFunction(a)?function(c){kb(this).toggleClass(a.call(this,c,this.className,b),b)}:function(){if("string"===c)for(var e,f=0,g=kb(this),h=b,i=a.match(mb)||[];e=i[f++];)h=d?h:!g.hasClass(e),g[h?"addClass":"removeClass"](e);else(c===W||"boolean"===c)&&(this.className&&kb._data(this,"__className__",this.className),this.className=this.className||a===!1?"":kb._data(this,"__className__")||"")})},hasClass:function(a){for(var b=" "+a+" ",c=0,d=this.length;d>c;c++)if(1===this[c].nodeType&&(" "+this[c].className+" ").replace(Eb," ").indexOf(b)>=0)return!0;return!1},val:function(a){var c,d,e,f=this[0];return arguments.length?(e=kb.isFunction(a),this.each(function(c){var f;1===this.nodeType&&(f=e?a.call(this,c,kb(this).val()):a,null==f?f="":"number"==typeof f?f+="":kb.isArray(f)&&(f=kb.map(f,function(a){return null==a?"":a+""})),d=kb.valHooks[this.type]||kb.valHooks[this.nodeName.toLowerCase()],d&&"set"in d&&d.set(this,f,"value")!==b||(this.value=f))})):f?(d=kb.valHooks[f.type]||kb.valHooks[f.nodeName.toLowerCase()],d&&"get"in d&&(c=d.get(f,"value"))!==b?c:(c=f.value,"string"==typeof c?c.replace(Fb,""):null==c?"":c)):void 0}}),kb.extend({valHooks:{option:{get:function(a){var b=kb.find.attr(a,"value");return null!=b?b:a.text}},select:{get:function(a){for(var b,c,d=a.options,e=a.selectedIndex,f="select-one"===a.type||0>e,g=f?null:[],h=f?e+1:d.length,i=0>e?h:f?e:0;h>i;i++)if(c=d[i],!(!c.selected&&i!==e||(kb.support.optDisabled?c.disabled:null!==c.getAttribute("disabled"))||c.parentNode.disabled&&kb.nodeName(c.parentNode,"optgroup"))){if(b=kb(c).val(),f)return b;g.push(b)}return g},set:function(a,b){for(var c,d,e=a.options,f=kb.makeArray(b),g=e.length;g--;)d=e[g],(d.selected=kb.inArray(kb(d).val(),f)>=0)&&(c=!0);return c||(a.selectedIndex=-1),f}}},attr:function(a,c,d){var e,f,g=a.nodeType;return a&&3!==g&&8!==g&&2!==g?typeof a.getAttribute===W?kb.prop(a,c,d):(1===g&&kb.isXMLDoc(a)||(c=c.toLowerCase(),e=kb.attrHooks[c]||(kb.expr.match.bool.test(c)?Db:Cb)),d===b?e&&"get"in e&&null!==(f=e.get(a,c))?f:(f=kb.find.attr(a,c),null==f?b:f):null!==d?e&&"set"in e&&(f=e.set(a,d,c))!==b?f:(a.setAttribute(c,d+""),d):(kb.removeAttr(a,c),b)):void 0},removeAttr:function(a,b){var c,d,e=0,f=b&&b.match(mb);if(f&&1===a.nodeType)for(;c=f[e++];)d=kb.propFix[c]||c,kb.expr.match.bool.test(c)?Kb&&Jb||!Ib.test(c)?a[d]=!1:a[kb.camelCase("default-"+c)]=a[d]=!1:kb.attr(a,c,""),a.removeAttribute(Jb?c:d)},attrHooks:{type:{set:function(a,b){if(!kb.support.radioValue&&"radio"===b&&kb.nodeName(a,"input")){var c=a.value;return a.setAttribute("type",b),c&&(a.value=c),b}}}},propFix:{"for":"htmlFor","class":"className"},prop:function(a,c,d){var e,f,g,h=a.nodeType;return a&&3!==h&&8!==h&&2!==h?(g=1!==h||!kb.isXMLDoc(a),g&&(c=kb.propFix[c]||c,f=kb.propHooks[c]),d!==b?f&&"set"in f&&(e=f.set(a,d,c))!==b?e:a[c]=d:f&&"get"in f&&null!==(e=f.get(a,c))?e:a[c]):void 0},propHooks:{tabIndex:{get:function(a){var b=kb.find.attr(a,"tabindex");return b?parseInt(b,10):Gb.test(a.nodeName)||Hb.test(a.nodeName)&&a.href?0:-1}}}}),Db={set:function(a,b,c){return b===!1?kb.removeAttr(a,c):Kb&&Jb||!Ib.test(c)?a.setAttribute(!Jb&&kb.propFix[c]||c,c):a[kb.camelCase("default-"+c)]=a[c]=!0,c}},kb.each(kb.expr.match.bool.source.match(/\w+/g),function(a,c){var d=kb.expr.attrHandle[c]||kb.find.attr;kb.expr.attrHandle[c]=Kb&&Jb||!Ib.test(c)?function(a,c,e){var f=kb.expr.attrHandle[c],g=e?b:(kb.expr.attrHandle[c]=b)!=d(a,c,e)?c.toLowerCase():null;return kb.expr.attrHandle[c]=f,g}:function(a,c,d){return d?b:a[kb.camelCase("default-"+c)]?c.toLowerCase():null}}),Kb&&Jb||(kb.attrHooks.value={set:function(a,c,d){return kb.nodeName(a,"input")?(a.defaultValue=c,b):Cb&&Cb.set(a,c,d)}}),Jb||(Cb={set:function(a,c,d){var e=a.getAttributeNode(d);return e||a.setAttributeNode(e=a.ownerDocument.createAttribute(d)),e.value=c+="","value"===d||c===a.getAttribute(d)?c:b}},kb.expr.attrHandle.id=kb.expr.attrHandle.name=kb.expr.attrHandle.coords=function(a,c,d){var e;return d?b:(e=a.getAttributeNode(c))&&""!==e.value?e.value:null},kb.valHooks.button={get:function(a,c){var d=a.getAttributeNode(c);return d&&d.specified?d.value:b},set:Cb.set},kb.attrHooks.contenteditable={set:function(a,b,c){Cb.set(a,""===b?!1:b,c)}},kb.each(["width","height"],function(a,c){kb.attrHooks[c]={set:function(a,d){return""===d?(a.setAttribute(c,"auto"),d):b}}})),kb.support.hrefNormalized||kb.each(["href","src"],function(a,b){kb.propHooks[b]={get:function(a){return a.getAttribute(b,4)}}}),kb.support.style||(kb.attrHooks.style={get:function(a){return a.style.cssText||b},set:function(a,b){return a.style.cssText=b+""}}),kb.support.optSelected||(kb.propHooks.selected={get:function(a){var b=a.parentNode;return b&&(b.selectedIndex,b.parentNode&&b.parentNode.selectedIndex),null}}),kb.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){kb.propFix[this.toLowerCase()]=this}),kb.support.enctype||(kb.propFix.enctype="encoding"),kb.each(["radio","checkbox"],function(){kb.valHooks[this]={set:function(a,c){return kb.isArray(c)?a.checked=kb.inArray(kb(a).val(),c)>=0:b}},kb.support.checkOn||(kb.valHooks[this].get=function(a){return null===a.getAttribute("value")?"on":a.value})});var Lb=/^(?:input|select|textarea)$/i,Mb=/^key/,Nb=/^(?:mouse|contextmenu)|click/,Ob=/^(?:focusinfocus|focusoutblur)$/,Pb=/^([^.]*)(?:\.(.+)|)$/;kb.event={global:{},add:function(a,c,d,e,f){var g,h,i,j,k,l,m,n,o,p,q,r=kb._data(a);if(r){for(d.handler&&(j=d,d=j.handler,f=j.selector),d.guid||(d.guid=kb.guid++),(h=r.events)||(h=r.events={}),(l=r.handle)||(l=r.handle=function(a){return typeof kb===W||a&&kb.event.triggered===a.type?b:kb.event.dispatch.apply(l.elem,arguments)},l.elem=a),c=(c||"").match(mb)||[""],i=c.length;i--;)g=Pb.exec(c[i])||[],o=q=g[1],p=(g[2]||"").split(".").sort(),o&&(k=kb.event.special[o]||{},o=(f?k.delegateType:k.bindType)||o,k=kb.event.special[o]||{},m=kb.extend({type:o,origType:q,data:e,handler:d,guid:d.guid,selector:f,needsContext:f&&kb.expr.match.needsContext.test(f),namespace:p.join(".")},j),(n=h[o])||(n=h[o]=[],n.delegateCount=0,k.setup&&k.setup.call(a,e,p,l)!==!1||(a.addEventListener?a.addEventListener(o,l,!1):a.attachEvent&&a.attachEvent("on"+o,l))),k.add&&(k.add.call(a,m),m.handler.guid||(m.handler.guid=d.guid)),f?n.splice(n.delegateCount++,0,m):n.push(m),kb.event.global[o]=!0);a=null}},remove:function(a,b,c,d,e){var f,g,h,i,j,k,l,m,n,o,p,q=kb.hasData(a)&&kb._data(a);if(q&&(k=q.events)){for(b=(b||"").match(mb)||[""],j=b.length;j--;)if(h=Pb.exec(b[j])||[],n=p=h[1],o=(h[2]||"").split(".").sort(),n){for(l=kb.event.special[n]||{},n=(d?l.delegateType:l.bindType)||n,m=k[n]||[],h=h[2]&&RegExp("(^|\\.)"+o.join("\\.(?:.*\\.|)")+"(\\.|$)"),i=f=m.length;f--;)g=m[f],!e&&p!==g.origType||c&&c.guid!==g.guid||h&&!h.test(g.namespace)||d&&d!==g.selector&&("**"!==d||!g.selector)||(m.splice(f,1),g.selector&&m.delegateCount--,l.remove&&l.remove.call(a,g));i&&!m.length&&(l.teardown&&l.teardown.call(a,o,q.handle)!==!1||kb.removeEvent(a,n,q.handle),delete k[n])}else for(n in k)kb.event.remove(a,n+b[j],c,d,!0);kb.isEmptyObject(k)&&(delete q.handle,kb._removeData(a,"events"))}},trigger:function(c,d,e,f){var g,h,i,j,k,l,m,n=[e||Y],o=ib.call(c,"type")?c.type:c,p=ib.call(c,"namespace")?c.namespace.split("."):[];if(i=l=e=e||Y,3!==e.nodeType&&8!==e.nodeType&&!Ob.test(o+kb.event.triggered)&&(o.indexOf(".")>=0&&(p=o.split("."),o=p.shift(),p.sort()),h=0>o.indexOf(":")&&"on"+o,c=c[kb.expando]?c:new kb.Event(o,"object"==typeof c&&c),c.isTrigger=f?2:3,c.namespace=p.join("."),c.namespace_re=c.namespace?RegExp("(^|\\.)"+p.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,c.result=b,c.target||(c.target=e),d=null==d?[c]:kb.makeArray(d,[c]),k=kb.event.special[o]||{},f||!k.trigger||k.trigger.apply(e,d)!==!1)){if(!f&&!k.noBubble&&!kb.isWindow(e)){for(j=k.delegateType||o,Ob.test(j+o)||(i=i.parentNode);i;i=i.parentNode)n.push(i),l=i;l===(e.ownerDocument||Y)&&n.push(l.defaultView||l.parentWindow||a)}for(m=0;(i=n[m++])&&!c.isPropagationStopped();)c.type=m>1?j:k.bindType||o,g=(kb._data(i,"events")||{})[c.type]&&kb._data(i,"handle"),g&&g.apply(i,d),g=h&&i[h],g&&kb.acceptData(i)&&g.apply&&g.apply(i,d)===!1&&c.preventDefault();if(c.type=o,!f&&!c.isDefaultPrevented()&&(!k._default||k._default.apply(n.pop(),d)===!1)&&kb.acceptData(e)&&h&&e[o]&&!kb.isWindow(e)){l=e[h],l&&(e[h]=null),kb.event.triggered=o;try{e[o]()}catch(q){}kb.event.triggered=b,l&&(e[h]=l)}return c.result}},dispatch:function(a){a=kb.event.fix(a);var c,d,e,f,g,h=[],i=fb.call(arguments),j=(kb._data(this,"events")||{})[a.type]||[],k=kb.event.special[a.type]||{};if(i[0]=a,a.delegateTarget=this,!k.preDispatch||k.preDispatch.call(this,a)!==!1){for(h=kb.event.handlers.call(this,a,j),c=0;(f=h[c++])&&!a.isPropagationStopped();)for(a.currentTarget=f.elem,g=0;(e=f.handlers[g++])&&!a.isImmediatePropagationStopped();)(!a.namespace_re||a.namespace_re.test(e.namespace))&&(a.handleObj=e,a.data=e.data,d=((kb.event.special[e.origType]||{}).handle||e.handler).apply(f.elem,i),d!==b&&(a.result=d)===!1&&(a.preventDefault(),a.stopPropagation()));return k.postDispatch&&k.postDispatch.call(this,a),a.result}},handlers:function(a,c){var d,e,f,g,h=[],i=c.delegateCount,j=a.target;if(i&&j.nodeType&&(!a.button||"click"!==a.type))for(;j!=this;j=j.parentNode||this)if(1===j.nodeType&&(j.disabled!==!0||"click"!==a.type)){for(f=[],g=0;i>g;g++)e=c[g],d=e.selector+" ",f[d]===b&&(f[d]=e.needsContext?kb(d,this).index(j)>=0:kb.find(d,this,null,[j]).length),f[d]&&f.push(e);f.length&&h.push({elem:j,handlers:f})}return c.length>i&&h.push({elem:this,handlers:c.slice(i)}),h},fix:function(a){if(a[kb.expando])return a;var b,c,d,e=a.type,f=a,g=this.fixHooks[e];for(g||(this.fixHooks[e]=g=Nb.test(e)?this.mouseHooks:Mb.test(e)?this.keyHooks:{}),d=g.props?this.props.concat(g.props):this.props,a=new kb.Event(f),b=d.length;b--;)c=d[b],a[c]=f[c];return a.target||(a.target=f.srcElement||Y),3===a.target.nodeType&&(a.target=a.target.parentNode),a.metaKey=!!a.metaKey,g.filter?g.filter(a,f):a},props:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(a,b){return null==a.which&&(a.which=null!=b.charCode?b.charCode:b.keyCode),a}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(a,c){var d,e,f,g=c.button,h=c.fromElement;return null==a.pageX&&null!=c.clientX&&(e=a.target.ownerDocument||Y,f=e.documentElement,d=e.body,a.pageX=c.clientX+(f&&f.scrollLeft||d&&d.scrollLeft||0)-(f&&f.clientLeft||d&&d.clientLeft||0),a.pageY=c.clientY+(f&&f.scrollTop||d&&d.scrollTop||0)-(f&&f.clientTop||d&&d.clientTop||0)),!a.relatedTarget&&h&&(a.relatedTarget=h===a.target?c.toElement:h),a.which||g===b||(a.which=1&g?1:2&g?3:4&g?2:0),a}},special:{load:{noBubble:!0},focus:{trigger:function(){if(this!==k()&&this.focus)try{return this.focus(),!1}catch(a){}},delegateType:"focusin"},blur:{trigger:function(){return this===k()&&this.blur?(this.blur(),!1):b},delegateType:"focusout"},click:{trigger:function(){return kb.nodeName(this,"input")&&"checkbox"===this.type&&this.click?(this.click(),!1):b},_default:function(a){return kb.nodeName(a.target,"a")}},beforeunload:{postDispatch:function(a){a.result!==b&&(a.originalEvent.returnValue=a.result)}}},simulate:function(a,b,c,d){var e=kb.extend(new kb.Event,c,{type:a,isSimulated:!0,originalEvent:{}});
d?kb.event.trigger(e,null,b):kb.event.dispatch.call(b,e),e.isDefaultPrevented()&&c.preventDefault()}},kb.removeEvent=Y.removeEventListener?function(a,b,c){a.removeEventListener&&a.removeEventListener(b,c,!1)}:function(a,b,c){var d="on"+b;a.detachEvent&&(typeof a[d]===W&&(a[d]=null),a.detachEvent(d,c))},kb.Event=function(a,c){return this instanceof kb.Event?(a&&a.type?(this.originalEvent=a,this.type=a.type,this.isDefaultPrevented=a.defaultPrevented||a.returnValue===!1||a.getPreventDefault&&a.getPreventDefault()?i:j):this.type=a,c&&kb.extend(this,c),this.timeStamp=a&&a.timeStamp||kb.now(),this[kb.expando]=!0,b):new kb.Event(a,c)},kb.Event.prototype={isDefaultPrevented:j,isPropagationStopped:j,isImmediatePropagationStopped:j,preventDefault:function(){var a=this.originalEvent;this.isDefaultPrevented=i,a&&(a.preventDefault?a.preventDefault():a.returnValue=!1)},stopPropagation:function(){var a=this.originalEvent;this.isPropagationStopped=i,a&&(a.stopPropagation&&a.stopPropagation(),a.cancelBubble=!0)},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=i,this.stopPropagation()}},kb.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(a,b){kb.event.special[a]={delegateType:b,bindType:b,handle:function(a){var c,d=this,e=a.relatedTarget,f=a.handleObj;return(!e||e!==d&&!kb.contains(d,e))&&(a.type=f.origType,c=f.handler.apply(this,arguments),a.type=b),c}}}),kb.support.submitBubbles||(kb.event.special.submit={setup:function(){return kb.nodeName(this,"form")?!1:(kb.event.add(this,"click._submit keypress._submit",function(a){var c=a.target,d=kb.nodeName(c,"input")||kb.nodeName(c,"button")?c.form:b;d&&!kb._data(d,"submitBubbles")&&(kb.event.add(d,"submit._submit",function(a){a._submit_bubble=!0}),kb._data(d,"submitBubbles",!0))}),b)},postDispatch:function(a){a._submit_bubble&&(delete a._submit_bubble,this.parentNode&&!a.isTrigger&&kb.event.simulate("submit",this.parentNode,a,!0))},teardown:function(){return kb.nodeName(this,"form")?!1:(kb.event.remove(this,"._submit"),b)}}),kb.support.changeBubbles||(kb.event.special.change={setup:function(){return Lb.test(this.nodeName)?(("checkbox"===this.type||"radio"===this.type)&&(kb.event.add(this,"propertychange._change",function(a){"checked"===a.originalEvent.propertyName&&(this._just_changed=!0)}),kb.event.add(this,"click._change",function(a){this._just_changed&&!a.isTrigger&&(this._just_changed=!1),kb.event.simulate("change",this,a,!0)})),!1):(kb.event.add(this,"beforeactivate._change",function(a){var b=a.target;Lb.test(b.nodeName)&&!kb._data(b,"changeBubbles")&&(kb.event.add(b,"change._change",function(a){!this.parentNode||a.isSimulated||a.isTrigger||kb.event.simulate("change",this.parentNode,a,!0)}),kb._data(b,"changeBubbles",!0))}),b)},handle:function(a){var c=a.target;return this!==c||a.isSimulated||a.isTrigger||"radio"!==c.type&&"checkbox"!==c.type?a.handleObj.handler.apply(this,arguments):b},teardown:function(){return kb.event.remove(this,"._change"),!Lb.test(this.nodeName)}}),kb.support.focusinBubbles||kb.each({focus:"focusin",blur:"focusout"},function(a,b){var c=0,d=function(a){kb.event.simulate(b,a.target,kb.event.fix(a),!0)};kb.event.special[b]={setup:function(){0===c++&&Y.addEventListener(a,d,!0)},teardown:function(){0===--c&&Y.removeEventListener(a,d,!0)}}}),kb.fn.extend({on:function(a,c,d,e,f){var g,h;if("object"==typeof a){"string"!=typeof c&&(d=d||c,c=b);for(g in a)this.on(g,c,d,a[g],f);return this}if(null==d&&null==e?(e=c,d=c=b):null==e&&("string"==typeof c?(e=d,d=b):(e=d,d=c,c=b)),e===!1)e=j;else if(!e)return this;return 1===f&&(h=e,e=function(a){return kb().off(a),h.apply(this,arguments)},e.guid=h.guid||(h.guid=kb.guid++)),this.each(function(){kb.event.add(this,a,e,d,c)})},one:function(a,b,c,d){return this.on(a,b,c,d,1)},off:function(a,c,d){var e,f;if(a&&a.preventDefault&&a.handleObj)return e=a.handleObj,kb(a.delegateTarget).off(e.namespace?e.origType+"."+e.namespace:e.origType,e.selector,e.handler),this;if("object"==typeof a){for(f in a)this.off(f,c,a[f]);return this}return(c===!1||"function"==typeof c)&&(d=c,c=b),d===!1&&(d=j),this.each(function(){kb.event.remove(this,a,d,c)})},trigger:function(a,b){return this.each(function(){kb.event.trigger(a,b,this)})},triggerHandler:function(a,c){var d=this[0];return d?kb.event.trigger(a,c,d,!0):b}});var Qb=/^.[^:#\[\.,]*$/,Rb=/^(?:parents|prev(?:Until|All))/,Sb=kb.expr.match.needsContext,Tb={children:!0,contents:!0,next:!0,prev:!0};kb.fn.extend({find:function(a){var b,c=[],d=this,e=d.length;if("string"!=typeof a)return this.pushStack(kb(a).filter(function(){for(b=0;e>b;b++)if(kb.contains(d[b],this))return!0}));for(b=0;e>b;b++)kb.find(a,d[b],c);return c=this.pushStack(e>1?kb.unique(c):c),c.selector=this.selector?this.selector+" "+a:a,c},has:function(a){var b,c=kb(a,this),d=c.length;return this.filter(function(){for(b=0;d>b;b++)if(kb.contains(this,c[b]))return!0})},not:function(a){return this.pushStack(m(this,a||[],!0))},filter:function(a){return this.pushStack(m(this,a||[],!1))},is:function(a){return!!m(this,"string"==typeof a&&Sb.test(a)?kb(a):a||[],!1).length},closest:function(a,b){for(var c,d=0,e=this.length,f=[],g=Sb.test(a)||"string"!=typeof a?kb(a,b||this.context):0;e>d;d++)for(c=this[d];c&&c!==b;c=c.parentNode)if(11>c.nodeType&&(g?g.index(c)>-1:1===c.nodeType&&kb.find.matchesSelector(c,a))){c=f.push(c);break}return this.pushStack(f.length>1?kb.unique(f):f)},index:function(a){return a?"string"==typeof a?kb.inArray(this[0],kb(a)):kb.inArray(a.jquery?a[0]:a,this):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(a,b){var c="string"==typeof a?kb(a,b):kb.makeArray(a&&a.nodeType?[a]:a),d=kb.merge(this.get(),c);return this.pushStack(kb.unique(d))},addBack:function(a){return this.add(null==a?this.prevObject:this.prevObject.filter(a))}}),kb.each({parent:function(a){var b=a.parentNode;return b&&11!==b.nodeType?b:null},parents:function(a){return kb.dir(a,"parentNode")},parentsUntil:function(a,b,c){return kb.dir(a,"parentNode",c)},next:function(a){return l(a,"nextSibling")},prev:function(a){return l(a,"previousSibling")},nextAll:function(a){return kb.dir(a,"nextSibling")},prevAll:function(a){return kb.dir(a,"previousSibling")},nextUntil:function(a,b,c){return kb.dir(a,"nextSibling",c)},prevUntil:function(a,b,c){return kb.dir(a,"previousSibling",c)},siblings:function(a){return kb.sibling((a.parentNode||{}).firstChild,a)},children:function(a){return kb.sibling(a.firstChild)},contents:function(a){return kb.nodeName(a,"iframe")?a.contentDocument||a.contentWindow.document:kb.merge([],a.childNodes)}},function(a,b){kb.fn[a]=function(c,d){var e=kb.map(this,b,c);return"Until"!==a.slice(-5)&&(d=c),d&&"string"==typeof d&&(e=kb.filter(d,e)),this.length>1&&(Tb[a]||(e=kb.unique(e)),Rb.test(a)&&(e=e.reverse())),this.pushStack(e)}}),kb.extend({filter:function(a,b,c){var d=b[0];return c&&(a=":not("+a+")"),1===b.length&&1===d.nodeType?kb.find.matchesSelector(d,a)?[d]:[]:kb.find.matches(a,kb.grep(b,function(a){return 1===a.nodeType}))},dir:function(a,c,d){for(var e=[],f=a[c];f&&9!==f.nodeType&&(d===b||1!==f.nodeType||!kb(f).is(d));)1===f.nodeType&&e.push(f),f=f[c];return e},sibling:function(a,b){for(var c=[];a;a=a.nextSibling)1===a.nodeType&&a!==b&&c.push(a);return c}});var Ub="abbr|article|aside|audio|bdi|canvas|data|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",Vb=/ jQuery\d+="(?:null|\d+)"/g,Wb=RegExp("<(?:"+Ub+")[\\s/>]","i"),Xb=/^\s+/,Yb=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,Zb=/<([\w:]+)/,$b=/<tbody/i,_b=/<|&#?\w+;/,ac=/<(?:script|style|link)/i,bc=/^(?:checkbox|radio)$/i,cc=/checked\s*(?:[^=]|=\s*.checked.)/i,dc=/^$|\/(?:java|ecma)script/i,ec=/^true\/(.*)/,fc=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,gc={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],area:[1,"<map>","</map>"],param:[1,"<object>","</object>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:kb.support.htmlSerialize?[0,"",""]:[1,"X<div>","</div>"]},hc=n(Y),ic=hc.appendChild(Y.createElement("div"));gc.optgroup=gc.option,gc.tbody=gc.tfoot=gc.colgroup=gc.caption=gc.thead,gc.th=gc.td,kb.fn.extend({text:function(a){return kb.access(this,function(a){return a===b?kb.text(this):this.empty().append((this[0]&&this[0].ownerDocument||Y).createTextNode(a))},null,a,arguments.length)},append:function(){return this.domManip(arguments,function(a){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var b=o(this,a);b.appendChild(a)}})},prepend:function(){return this.domManip(arguments,function(a){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var b=o(this,a);b.insertBefore(a,b.firstChild)}})},before:function(){return this.domManip(arguments,function(a){this.parentNode&&this.parentNode.insertBefore(a,this)})},after:function(){return this.domManip(arguments,function(a){this.parentNode&&this.parentNode.insertBefore(a,this.nextSibling)})},remove:function(a,b){for(var c,d=a?kb.filter(a,this):this,e=0;null!=(c=d[e]);e++)b||1!==c.nodeType||kb.cleanData(u(c)),c.parentNode&&(b&&kb.contains(c.ownerDocument,c)&&r(u(c,"script")),c.parentNode.removeChild(c));return this},empty:function(){for(var a,b=0;null!=(a=this[b]);b++){for(1===a.nodeType&&kb.cleanData(u(a,!1));a.firstChild;)a.removeChild(a.firstChild);a.options&&kb.nodeName(a,"select")&&(a.options.length=0)}return this},clone:function(a,b){return a=null==a?!1:a,b=null==b?a:b,this.map(function(){return kb.clone(this,a,b)})},html:function(a){return kb.access(this,function(a){var c=this[0]||{},d=0,e=this.length;if(a===b)return 1===c.nodeType?c.innerHTML.replace(Vb,""):b;if(!("string"!=typeof a||ac.test(a)||!kb.support.htmlSerialize&&Wb.test(a)||!kb.support.leadingWhitespace&&Xb.test(a)||gc[(Zb.exec(a)||["",""])[1].toLowerCase()])){a=a.replace(Yb,"<$1></$2>");try{for(;e>d;d++)c=this[d]||{},1===c.nodeType&&(kb.cleanData(u(c,!1)),c.innerHTML=a);c=0}catch(f){}}c&&this.empty().append(a)},null,a,arguments.length)},replaceWith:function(){var a=kb.map(this,function(a){return[a.nextSibling,a.parentNode]}),b=0;return this.domManip(arguments,function(c){var d=a[b++],e=a[b++];e&&(d&&d.parentNode!==e&&(d=this.nextSibling),kb(this).remove(),e.insertBefore(c,d))},!0),b?this:this.remove()},detach:function(a){return this.remove(a,!0)},domManip:function(a,b,c){a=db.apply([],a);var d,e,f,g,h,i,j=0,k=this.length,l=this,m=k-1,n=a[0],o=kb.isFunction(n);if(o||!(1>=k||"string"!=typeof n||kb.support.checkClone)&&cc.test(n))return this.each(function(d){var e=l.eq(d);o&&(a[0]=n.call(this,d,e.html())),e.domManip(a,b,c)});if(k&&(i=kb.buildFragment(a,this[0].ownerDocument,!1,!c&&this),d=i.firstChild,1===i.childNodes.length&&(i=d),d)){for(g=kb.map(u(i,"script"),p),f=g.length;k>j;j++)e=i,j!==m&&(e=kb.clone(e,!0,!0),f&&kb.merge(g,u(e,"script"))),b.call(this[j],e,j);if(f)for(h=g[g.length-1].ownerDocument,kb.map(g,q),j=0;f>j;j++)e=g[j],dc.test(e.type||"")&&!kb._data(e,"globalEval")&&kb.contains(h,e)&&(e.src?kb._evalUrl(e.src):kb.globalEval((e.text||e.textContent||e.innerHTML||"").replace(fc,"")));i=d=null}return this}}),kb.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(a,b){kb.fn[a]=function(a){for(var c,d=0,e=[],f=kb(a),g=f.length-1;g>=d;d++)c=d===g?this:this.clone(!0),kb(f[d])[b](c),eb.apply(e,c.get());return this.pushStack(e)}}),kb.extend({clone:function(a,b,c){var d,e,f,g,h,i=kb.contains(a.ownerDocument,a);if(kb.support.html5Clone||kb.isXMLDoc(a)||!Wb.test("<"+a.nodeName+">")?f=a.cloneNode(!0):(ic.innerHTML=a.outerHTML,ic.removeChild(f=ic.firstChild)),!(kb.support.noCloneEvent&&kb.support.noCloneChecked||1!==a.nodeType&&11!==a.nodeType||kb.isXMLDoc(a)))for(d=u(f),h=u(a),g=0;null!=(e=h[g]);++g)d[g]&&t(e,d[g]);if(b)if(c)for(h=h||u(a),d=d||u(f),g=0;null!=(e=h[g]);g++)s(e,d[g]);else s(a,f);return d=u(f,"script"),d.length>0&&r(d,!i&&u(a,"script")),d=h=e=null,f},buildFragment:function(a,b,c,d){for(var e,f,g,h,i,j,k,l=a.length,m=n(b),o=[],p=0;l>p;p++)if(f=a[p],f||0===f)if("object"===kb.type(f))kb.merge(o,f.nodeType?[f]:f);else if(_b.test(f)){for(h=h||m.appendChild(b.createElement("div")),i=(Zb.exec(f)||["",""])[1].toLowerCase(),k=gc[i]||gc._default,h.innerHTML=k[1]+f.replace(Yb,"<$1></$2>")+k[2],e=k[0];e--;)h=h.lastChild;if(!kb.support.leadingWhitespace&&Xb.test(f)&&o.push(b.createTextNode(Xb.exec(f)[0])),!kb.support.tbody)for(f="table"!==i||$b.test(f)?"<table>"!==k[1]||$b.test(f)?0:h:h.firstChild,e=f&&f.childNodes.length;e--;)kb.nodeName(j=f.childNodes[e],"tbody")&&!j.childNodes.length&&f.removeChild(j);for(kb.merge(o,h.childNodes),h.textContent="";h.firstChild;)h.removeChild(h.firstChild);h=m.lastChild}else o.push(b.createTextNode(f));for(h&&m.removeChild(h),kb.support.appendChecked||kb.grep(u(o,"input"),v),p=0;f=o[p++];)if((!d||-1===kb.inArray(f,d))&&(g=kb.contains(f.ownerDocument,f),h=u(m.appendChild(f),"script"),g&&r(h),c))for(e=0;f=h[e++];)dc.test(f.type||"")&&c.push(f);return h=null,m},cleanData:function(a,b){for(var c,d,e,f,g=0,h=kb.expando,i=kb.cache,j=kb.support.deleteExpando,k=kb.event.special;null!=(c=a[g]);g++)if((b||kb.acceptData(c))&&(e=c[h],f=e&&i[e])){if(f.events)for(d in f.events)k[d]?kb.event.remove(c,d):kb.removeEvent(c,d,f.handle);i[e]&&(delete i[e],j?delete c[h]:typeof c.removeAttribute!==W?c.removeAttribute(h):c[h]=null,bb.push(e))}},_evalUrl:function(a){return kb.ajax({url:a,type:"GET",dataType:"script",async:!1,global:!1,"throws":!0})}}),kb.fn.extend({wrapAll:function(a){if(kb.isFunction(a))return this.each(function(b){kb(this).wrapAll(a.call(this,b))});if(this[0]){var b=kb(a,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&b.insertBefore(this[0]),b.map(function(){for(var a=this;a.firstChild&&1===a.firstChild.nodeType;)a=a.firstChild;return a}).append(this)}return this},wrapInner:function(a){return this.each(kb.isFunction(a)?function(b){kb(this).wrapInner(a.call(this,b))}:function(){var b=kb(this),c=b.contents();c.length?c.wrapAll(a):b.append(a)})},wrap:function(a){var b=kb.isFunction(a);return this.each(function(c){kb(this).wrapAll(b?a.call(this,c):a)})},unwrap:function(){return this.parent().each(function(){kb.nodeName(this,"body")||kb(this).replaceWith(this.childNodes)}).end()}});var jc,kc,lc,mc=/alpha\([^)]*\)/i,nc=/opacity\s*=\s*([^)]*)/,oc=/^(top|right|bottom|left)$/,pc=/^(none|table(?!-c[ea]).+)/,qc=/^margin/,rc=RegExp("^("+lb+")(.*)$","i"),sc=RegExp("^("+lb+")(?!px)[a-z%]+$","i"),tc=RegExp("^([+-])=("+lb+")","i"),uc={BODY:"block"},vc={position:"absolute",visibility:"hidden",display:"block"},wc={letterSpacing:0,fontWeight:400},xc=["Top","Right","Bottom","Left"],yc=["Webkit","O","Moz","ms"];kb.fn.extend({css:function(a,c){return kb.access(this,function(a,c,d){var e,f,g={},h=0;if(kb.isArray(c)){for(f=kc(a),e=c.length;e>h;h++)g[c[h]]=kb.css(a,c[h],!1,f);return g}return d!==b?kb.style(a,c,d):kb.css(a,c)},a,c,arguments.length>1)},show:function(){return y(this,!0)},hide:function(){return y(this)},toggle:function(a){var b="boolean"==typeof a;return this.each(function(){(b?a:x(this))?kb(this).show():kb(this).hide()})}}),kb.extend({cssHooks:{opacity:{get:function(a,b){if(b){var c=lc(a,"opacity");return""===c?"1":c}}}},cssNumber:{columnCount:!0,fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":kb.support.cssFloat?"cssFloat":"styleFloat"},style:function(a,c,d,e){if(a&&3!==a.nodeType&&8!==a.nodeType&&a.style){var f,g,h,i=kb.camelCase(c),j=a.style;if(c=kb.cssProps[i]||(kb.cssProps[i]=w(j,i)),h=kb.cssHooks[c]||kb.cssHooks[i],d===b)return h&&"get"in h&&(f=h.get(a,!1,e))!==b?f:j[c];if(g=typeof d,"string"===g&&(f=tc.exec(d))&&(d=(f[1]+1)*f[2]+parseFloat(kb.css(a,c)),g="number"),!(null==d||"number"===g&&isNaN(d)||("number"!==g||kb.cssNumber[i]||(d+="px"),kb.support.clearCloneStyle||""!==d||0!==c.indexOf("background")||(j[c]="inherit"),h&&"set"in h&&(d=h.set(a,d,e))===b)))try{j[c]=d}catch(k){}}},css:function(a,c,d,e){var f,g,h,i=kb.camelCase(c);return c=kb.cssProps[i]||(kb.cssProps[i]=w(a.style,i)),h=kb.cssHooks[c]||kb.cssHooks[i],h&&"get"in h&&(g=h.get(a,!0,d)),g===b&&(g=lc(a,c,e)),"normal"===g&&c in wc&&(g=wc[c]),""===d||d?(f=parseFloat(g),d===!0||kb.isNumeric(f)?f||0:g):g}}),a.getComputedStyle?(kc=function(b){return a.getComputedStyle(b,null)},lc=function(a,c,d){var e,f,g,h=d||kc(a),i=h?h.getPropertyValue(c)||h[c]:b,j=a.style;return h&&(""!==i||kb.contains(a.ownerDocument,a)||(i=kb.style(a,c)),sc.test(i)&&qc.test(c)&&(e=j.width,f=j.minWidth,g=j.maxWidth,j.minWidth=j.maxWidth=j.width=i,i=h.width,j.width=e,j.minWidth=f,j.maxWidth=g)),i}):Y.documentElement.currentStyle&&(kc=function(a){return a.currentStyle},lc=function(a,c,d){var e,f,g,h=d||kc(a),i=h?h[c]:b,j=a.style;return null==i&&j&&j[c]&&(i=j[c]),sc.test(i)&&!oc.test(c)&&(e=j.left,f=a.runtimeStyle,g=f&&f.left,g&&(f.left=a.currentStyle.left),j.left="fontSize"===c?"1em":i,i=j.pixelLeft+"px",j.left=e,g&&(f.left=g)),""===i?"auto":i}),kb.each(["height","width"],function(a,c){kb.cssHooks[c]={get:function(a,d,e){return d?0===a.offsetWidth&&pc.test(kb.css(a,"display"))?kb.swap(a,vc,function(){return B(a,c,e)}):B(a,c,e):b},set:function(a,b,d){var e=d&&kc(a);return z(a,b,d?A(a,c,d,kb.support.boxSizing&&"border-box"===kb.css(a,"boxSizing",!1,e),e):0)}}}),kb.support.opacity||(kb.cssHooks.opacity={get:function(a,b){return nc.test((b&&a.currentStyle?a.currentStyle.filter:a.style.filter)||"")?.01*parseFloat(RegExp.$1)+"":b?"1":""},set:function(a,b){var c=a.style,d=a.currentStyle,e=kb.isNumeric(b)?"alpha(opacity="+100*b+")":"",f=d&&d.filter||c.filter||"";c.zoom=1,(b>=1||""===b)&&""===kb.trim(f.replace(mc,""))&&c.removeAttribute&&(c.removeAttribute("filter"),""===b||d&&!d.filter)||(c.filter=mc.test(f)?f.replace(mc,e):f+" "+e)}}),kb(function(){kb.support.reliableMarginRight||(kb.cssHooks.marginRight={get:function(a,c){return c?kb.swap(a,{display:"inline-block"},lc,[a,"marginRight"]):b}}),!kb.support.pixelPosition&&kb.fn.position&&kb.each(["top","left"],function(a,c){kb.cssHooks[c]={get:function(a,d){return d?(d=lc(a,c),sc.test(d)?kb(a).position()[c]+"px":d):b}}})}),kb.expr&&kb.expr.filters&&(kb.expr.filters.hidden=function(a){return 0>=a.offsetWidth&&0>=a.offsetHeight||!kb.support.reliableHiddenOffsets&&"none"===(a.style&&a.style.display||kb.css(a,"display"))},kb.expr.filters.visible=function(a){return!kb.expr.filters.hidden(a)}),kb.each({margin:"",padding:"",border:"Width"},function(a,b){kb.cssHooks[a+b]={expand:function(c){for(var d=0,e={},f="string"==typeof c?c.split(" "):[c];4>d;d++)e[a+xc[d]+b]=f[d]||f[d-2]||f[0];return e}},qc.test(a)||(kb.cssHooks[a+b].set=z)});var zc=/%20/g,Ac=/\[\]$/,Bc=/\r?\n/g,Cc=/^(?:submit|button|image|reset|file)$/i,Dc=/^(?:input|select|textarea|keygen)/i;kb.fn.extend({serialize:function(){return kb.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var a=kb.prop(this,"elements");return a?kb.makeArray(a):this}).filter(function(){var a=this.type;return this.name&&!kb(this).is(":disabled")&&Dc.test(this.nodeName)&&!Cc.test(a)&&(this.checked||!bc.test(a))}).map(function(a,b){var c=kb(this).val();return null==c?null:kb.isArray(c)?kb.map(c,function(a){return{name:b.name,value:a.replace(Bc,"\r\n")}}):{name:b.name,value:c.replace(Bc,"\r\n")}}).get()}}),kb.param=function(a,c){var d,e=[],f=function(a,b){b=kb.isFunction(b)?b():null==b?"":b,e[e.length]=encodeURIComponent(a)+"="+encodeURIComponent(b)};if(c===b&&(c=kb.ajaxSettings&&kb.ajaxSettings.traditional),kb.isArray(a)||a.jquery&&!kb.isPlainObject(a))kb.each(a,function(){f(this.name,this.value)});else for(d in a)E(d,a[d],c,f);return e.join("&").replace(zc,"+")},kb.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(a,b){kb.fn[b]=function(a,c){return arguments.length>0?this.on(b,null,a,c):this.trigger(b)}}),kb.fn.extend({hover:function(a,b){return this.mouseenter(a).mouseleave(b||a)},bind:function(a,b,c){return this.on(a,null,b,c)},unbind:function(a,b){return this.off(a,null,b)},delegate:function(a,b,c,d){return this.on(b,a,c,d)},undelegate:function(a,b,c){return 1===arguments.length?this.off(a,"**"):this.off(b,a||"**",c)}});var Ec,Fc,Gc=kb.now(),Hc=/\?/,Ic=/#.*$/,Jc=/([?&])_=[^&]*/,Kc=/^(.*?):[ \t]*([^\r\n]*)\r?$/gm,Lc=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,Mc=/^(?:GET|HEAD)$/,Nc=/^\/\//,Oc=/^([\w.+-]+:)(?:\/\/([^\/?#:]*)(?::(\d+)|)|)/,Pc=kb.fn.load,Qc={},Rc={},Sc="*/".concat("*");try{Fc=X.href}catch(Tc){Fc=Y.createElement("a"),Fc.href="",Fc=Fc.href}Ec=Oc.exec(Fc.toLowerCase())||[],kb.fn.load=function(a,c,d){if("string"!=typeof a&&Pc)return Pc.apply(this,arguments);var e,f,g,h=this,i=a.indexOf(" ");return i>=0&&(e=a.slice(i,a.length),a=a.slice(0,i)),kb.isFunction(c)?(d=c,c=b):c&&"object"==typeof c&&(g="POST"),h.length>0&&kb.ajax({url:a,type:g,dataType:"html",data:c}).done(function(a){f=arguments,h.html(e?kb("<div>").append(kb.parseHTML(a)).find(e):a)}).complete(d&&function(a,b){h.each(d,f||[a.responseText,b,a])}),this},kb.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(a,b){kb.fn[b]=function(a){return this.on(b,a)}}),kb.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:Fc,type:"GET",isLocal:Lc.test(Ec[1]),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":Sc,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":kb.parseJSON,"text xml":kb.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(a,b){return b?H(H(a,kb.ajaxSettings),b):H(kb.ajaxSettings,a)},ajaxPrefilter:F(Qc),ajaxTransport:F(Rc),ajax:function(a,c){function d(a,c,d,e){var f,l,s,t,v,x=c;2!==u&&(u=2,i&&clearTimeout(i),k=b,h=e||"",w.readyState=a>0?4:0,f=a>=200&&300>a||304===a,d&&(t=I(m,w,d)),t=J(m,t,w,f),f?(m.ifModified&&(v=w.getResponseHeader("Last-Modified"),v&&(kb.lastModified[g]=v),v=w.getResponseHeader("etag"),v&&(kb.etag[g]=v)),204===a||"HEAD"===m.type?x="nocontent":304===a?x="notmodified":(x=t.state,l=t.data,s=t.error,f=!s)):(s=x,(a||!x)&&(x="error",0>a&&(a=0))),w.status=a,w.statusText=(c||x)+"",f?p.resolveWith(n,[l,x,w]):p.rejectWith(n,[w,x,s]),w.statusCode(r),r=b,j&&o.trigger(f?"ajaxSuccess":"ajaxError",[w,m,f?l:s]),q.fireWith(n,[w,x]),j&&(o.trigger("ajaxComplete",[w,m]),--kb.active||kb.event.trigger("ajaxStop")))}"object"==typeof a&&(c=a,a=b),c=c||{};var e,f,g,h,i,j,k,l,m=kb.ajaxSetup({},c),n=m.context||m,o=m.context&&(n.nodeType||n.jquery)?kb(n):kb.event,p=kb.Deferred(),q=kb.Callbacks("once memory"),r=m.statusCode||{},s={},t={},u=0,v="canceled",w={readyState:0,getResponseHeader:function(a){var b;if(2===u){if(!l)for(l={};b=Kc.exec(h);)l[b[1].toLowerCase()]=b[2];b=l[a.toLowerCase()]}return null==b?null:b},getAllResponseHeaders:function(){return 2===u?h:null},setRequestHeader:function(a,b){var c=a.toLowerCase();return u||(a=t[c]=t[c]||a,s[a]=b),this},overrideMimeType:function(a){return u||(m.mimeType=a),this},statusCode:function(a){var b;if(a)if(2>u)for(b in a)r[b]=[r[b],a[b]];else w.always(a[w.status]);return this},abort:function(a){var b=a||v;return k&&k.abort(b),d(0,b),this}};if(p.promise(w).complete=q.add,w.success=w.done,w.error=w.fail,m.url=((a||m.url||Fc)+"").replace(Ic,"").replace(Nc,Ec[1]+"//"),m.type=c.method||c.type||m.method||m.type,m.dataTypes=kb.trim(m.dataType||"*").toLowerCase().match(mb)||[""],null==m.crossDomain&&(e=Oc.exec(m.url.toLowerCase()),m.crossDomain=!(!e||e[1]===Ec[1]&&e[2]===Ec[2]&&(e[3]||("http:"===e[1]?"80":"443"))===(Ec[3]||("http:"===Ec[1]?"80":"443")))),m.data&&m.processData&&"string"!=typeof m.data&&(m.data=kb.param(m.data,m.traditional)),G(Qc,m,c,w),2===u)return w;j=m.global,j&&0===kb.active++&&kb.event.trigger("ajaxStart"),m.type=m.type.toUpperCase(),m.hasContent=!Mc.test(m.type),g=m.url,m.hasContent||(m.data&&(g=m.url+=(Hc.test(g)?"&":"?")+m.data,delete m.data),m.cache===!1&&(m.url=Jc.test(g)?g.replace(Jc,"$1_="+Gc++):g+(Hc.test(g)?"&":"?")+"_="+Gc++)),m.ifModified&&(kb.lastModified[g]&&w.setRequestHeader("If-Modified-Since",kb.lastModified[g]),kb.etag[g]&&w.setRequestHeader("If-None-Match",kb.etag[g])),(m.data&&m.hasContent&&m.contentType!==!1||c.contentType)&&w.setRequestHeader("Content-Type",m.contentType),w.setRequestHeader("Accept",m.dataTypes[0]&&m.accepts[m.dataTypes[0]]?m.accepts[m.dataTypes[0]]+("*"!==m.dataTypes[0]?", "+Sc+"; q=0.01":""):m.accepts["*"]);for(f in m.headers)w.setRequestHeader(f,m.headers[f]);if(m.beforeSend&&(m.beforeSend.call(n,w,m)===!1||2===u))return w.abort();v="abort";for(f in{success:1,error:1,complete:1})w[f](m[f]);if(k=G(Rc,m,c,w)){w.readyState=1,j&&o.trigger("ajaxSend",[w,m]),m.async&&m.timeout>0&&(i=setTimeout(function(){w.abort("timeout")},m.timeout));try{u=1,k.send(s,d)}catch(x){if(!(2>u))throw x;d(-1,x)}}else d(-1,"No Transport");return w},getJSON:function(a,b,c){return kb.get(a,b,c,"json")},getScript:function(a,c){return kb.get(a,b,c,"script")}}),kb.each(["get","post"],function(a,c){kb[c]=function(a,d,e,f){return kb.isFunction(d)&&(f=f||e,e=d,d=b),kb.ajax({url:a,type:c,dataType:f,data:d,success:e})}}),kb.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/(?:java|ecma)script/},converters:{"text script":function(a){return kb.globalEval(a),a}}}),kb.ajaxPrefilter("script",function(a){a.cache===b&&(a.cache=!1),a.crossDomain&&(a.type="GET",a.global=!1)}),kb.ajaxTransport("script",function(a){if(a.crossDomain){var c,d=Y.head||kb("head")[0]||Y.documentElement;return{send:function(b,e){c=Y.createElement("script"),c.async=!0,a.scriptCharset&&(c.charset=a.scriptCharset),c.src=a.url,c.onload=c.onreadystatechange=function(a,b){(b||!c.readyState||/loaded|complete/.test(c.readyState))&&(c.onload=c.onreadystatechange=null,c.parentNode&&c.parentNode.removeChild(c),c=null,b||e(200,"success"))},d.insertBefore(c,d.firstChild)},abort:function(){c&&c.onload(b,!0)}}}});var Uc=[],Vc=/(=)\?(?=&|$)|\?\?/;kb.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var a=Uc.pop()||kb.expando+"_"+Gc++;return this[a]=!0,a}}),kb.ajaxPrefilter("json jsonp",function(c,d,e){var f,g,h,i=c.jsonp!==!1&&(Vc.test(c.url)?"url":"string"==typeof c.data&&!(c.contentType||"").indexOf("application/x-www-form-urlencoded")&&Vc.test(c.data)&&"data");return i||"jsonp"===c.dataTypes[0]?(f=c.jsonpCallback=kb.isFunction(c.jsonpCallback)?c.jsonpCallback():c.jsonpCallback,i?c[i]=c[i].replace(Vc,"$1"+f):c.jsonp!==!1&&(c.url+=(Hc.test(c.url)?"&":"?")+c.jsonp+"="+f),c.converters["script json"]=function(){return h||kb.error(f+" was not called"),h[0]},c.dataTypes[0]="json",g=a[f],a[f]=function(){h=arguments},e.always(function(){a[f]=g,c[f]&&(c.jsonpCallback=d.jsonpCallback,Uc.push(f)),h&&kb.isFunction(g)&&g(h[0]),h=g=b}),"script"):b});var Wc,Xc,Yc=0,Zc=a.ActiveXObject&&function(){var a;for(a in Wc)Wc[a](b,!0)};kb.ajaxSettings.xhr=a.ActiveXObject?function(){return!this.isLocal&&K()||L()}:K,Xc=kb.ajaxSettings.xhr(),kb.support.cors=!!Xc&&"withCredentials"in Xc,Xc=kb.support.ajax=!!Xc,Xc&&kb.ajaxTransport(function(c){if(!c.crossDomain||kb.support.cors){var d;return{send:function(e,f){var g,h,i=c.xhr();if(c.username?i.open(c.type,c.url,c.async,c.username,c.password):i.open(c.type,c.url,c.async),c.xhrFields)for(h in c.xhrFields)i[h]=c.xhrFields[h];c.mimeType&&i.overrideMimeType&&i.overrideMimeType(c.mimeType),c.crossDomain||e["X-Requested-With"]||(e["X-Requested-With"]="XMLHttpRequest");try{for(h in e)i.setRequestHeader(h,e[h])}catch(j){}i.send(c.hasContent&&c.data||null),d=function(a,e){var h,j,k,l;try{if(d&&(e||4===i.readyState))if(d=b,g&&(i.onreadystatechange=kb.noop,Zc&&delete Wc[g]),e)4!==i.readyState&&i.abort();else{l={},h=i.status,j=i.getAllResponseHeaders(),"string"==typeof i.responseText&&(l.text=i.responseText);try{k=i.statusText}catch(m){k=""}h||!c.isLocal||c.crossDomain?1223===h&&(h=204):h=l.text?200:404}}catch(n){e||f(-1,n)}l&&f(h,k,l,j)},c.async?4===i.readyState?setTimeout(d):(g=++Yc,Zc&&(Wc||(Wc={},kb(a).unload(Zc)),Wc[g]=d),i.onreadystatechange=d):d()},abort:function(){d&&d(b,!0)}}}});var $c,_c,ad=/^(?:toggle|show|hide)$/,bd=RegExp("^(?:([+-])=|)("+lb+")([a-z%]*)$","i"),cd=/queueHooks$/,dd=[Q],ed={"*":[function(a,b){var c=this.createTween(a,b),d=c.cur(),e=bd.exec(b),f=e&&e[3]||(kb.cssNumber[a]?"":"px"),g=(kb.cssNumber[a]||"px"!==f&&+d)&&bd.exec(kb.css(c.elem,a)),h=1,i=20;if(g&&g[3]!==f){f=f||g[3],e=e||[],g=+d||1;do h=h||".5",g/=h,kb.style(c.elem,a,g+f);while(h!==(h=c.cur()/d)&&1!==h&&--i)}return e&&(c.unit=f,c.start=+g||+d||0,c.end=e[1]?g+(e[1]+1)*e[2]:+e[2]),c}]};kb.Animation=kb.extend(O,{tweener:function(a,b){kb.isFunction(a)?(b=a,a=["*"]):a=a.split(" ");for(var c,d=0,e=a.length;e>d;d++)c=a[d],ed[c]=ed[c]||[],ed[c].unshift(b)},prefilter:function(a,b){b?dd.unshift(a):dd.push(a)}}),kb.Tween=R,R.prototype={constructor:R,init:function(a,b,c,d,e,f){this.elem=a,this.prop=c,this.easing=e||"swing",this.options=b,this.start=this.now=this.cur(),this.end=d,this.unit=f||(kb.cssNumber[c]?"":"px")},cur:function(){var a=R.propHooks[this.prop];return a&&a.get?a.get(this):R.propHooks._default.get(this)},run:function(a){var b,c=R.propHooks[this.prop];return this.pos=b=this.options.duration?kb.easing[this.easing](a,this.options.duration*a,0,1,this.options.duration):a,this.now=(this.end-this.start)*b+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),c&&c.set?c.set(this):R.propHooks._default.set(this),this}},R.prototype.init.prototype=R.prototype,R.propHooks={_default:{get:function(a){var b;return null==a.elem[a.prop]||a.elem.style&&null!=a.elem.style[a.prop]?(b=kb.css(a.elem,a.prop,""),b&&"auto"!==b?b:0):a.elem[a.prop]},set:function(a){kb.fx.step[a.prop]?kb.fx.step[a.prop](a):a.elem.style&&(null!=a.elem.style[kb.cssProps[a.prop]]||kb.cssHooks[a.prop])?kb.style(a.elem,a.prop,a.now+a.unit):a.elem[a.prop]=a.now}}},R.propHooks.scrollTop=R.propHooks.scrollLeft={set:function(a){a.elem.nodeType&&a.elem.parentNode&&(a.elem[a.prop]=a.now)}},kb.each(["toggle","show","hide"],function(a,b){var c=kb.fn[b];kb.fn[b]=function(a,d,e){return null==a||"boolean"==typeof a?c.apply(this,arguments):this.animate(S(b,!0),a,d,e)}}),kb.fn.extend({fadeTo:function(a,b,c,d){return this.filter(x).css("opacity",0).show().end().animate({opacity:b},a,c,d)},animate:function(a,b,c,d){var e=kb.isEmptyObject(a),f=kb.speed(b,c,d),g=function(){var b=O(this,kb.extend({},a),f);g.finish=function(){b.stop(!0)},(e||kb._data(this,"finish"))&&b.stop(!0)};return g.finish=g,e||f.queue===!1?this.each(g):this.queue(f.queue,g)},stop:function(a,c,d){var e=function(a){var b=a.stop;delete a.stop,b(d)};return"string"!=typeof a&&(d=c,c=a,a=b),c&&a!==!1&&this.queue(a||"fx",[]),this.each(function(){var b=!0,c=null!=a&&a+"queueHooks",f=kb.timers,g=kb._data(this);if(c)g[c]&&g[c].stop&&e(g[c]);else for(c in g)g[c]&&g[c].stop&&cd.test(c)&&e(g[c]);for(c=f.length;c--;)f[c].elem!==this||null!=a&&f[c].queue!==a||(f[c].anim.stop(d),b=!1,f.splice(c,1));(b||!d)&&kb.dequeue(this,a)})},finish:function(a){return a!==!1&&(a=a||"fx"),this.each(function(){var b,c=kb._data(this),d=c[a+"queue"],e=c[a+"queueHooks"],f=kb.timers,g=d?d.length:0;for(c.finish=!0,kb.queue(this,a,[]),e&&e.cur&&e.cur.finish&&e.cur.finish.call(this),b=f.length;b--;)f[b].elem===this&&f[b].queue===a&&(f[b].anim.stop(!0),f.splice(b,1));for(b=0;g>b;b++)d[b]&&d[b].finish&&d[b].finish.call(this);delete c.finish})}}),kb.each({slideDown:S("show"),slideUp:S("hide"),slideToggle:S("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(a,b){kb.fn[a]=function(a,c,d){return this.animate(b,a,c,d)}}),kb.speed=function(a,b,c){var d=a&&"object"==typeof a?kb.extend({},a):{complete:c||!c&&b||kb.isFunction(a)&&a,duration:a,easing:c&&b||b&&!kb.isFunction(b)&&b};
return d.duration=kb.fx.off?0:"number"==typeof d.duration?d.duration:d.duration in kb.fx.speeds?kb.fx.speeds[d.duration]:kb.fx.speeds._default,(null==d.queue||d.queue===!0)&&(d.queue="fx"),d.old=d.complete,d.complete=function(){kb.isFunction(d.old)&&d.old.call(this),d.queue&&kb.dequeue(this,d.queue)},d},kb.easing={linear:function(a){return a},swing:function(a){return.5-Math.cos(a*Math.PI)/2}},kb.timers=[],kb.fx=R.prototype.init,kb.fx.tick=function(){var a,c=kb.timers,d=0;for($c=kb.now();c.length>d;d++)a=c[d],a()||c[d]!==a||c.splice(d--,1);c.length||kb.fx.stop(),$c=b},kb.fx.timer=function(a){a()&&kb.timers.push(a)&&kb.fx.start()},kb.fx.interval=13,kb.fx.start=function(){_c||(_c=setInterval(kb.fx.tick,kb.fx.interval))},kb.fx.stop=function(){clearInterval(_c),_c=null},kb.fx.speeds={slow:600,fast:200,_default:400},kb.fx.step={},kb.expr&&kb.expr.filters&&(kb.expr.filters.animated=function(a){return kb.grep(kb.timers,function(b){return a===b.elem}).length}),kb.fn.offset=function(a){if(arguments.length)return a===b?this:this.each(function(b){kb.offset.setOffset(this,a,b)});var c,d,e={top:0,left:0},f=this[0],g=f&&f.ownerDocument;return g?(c=g.documentElement,kb.contains(c,f)?(typeof f.getBoundingClientRect!==W&&(e=f.getBoundingClientRect()),d=T(g),{top:e.top+(d.pageYOffset||c.scrollTop)-(c.clientTop||0),left:e.left+(d.pageXOffset||c.scrollLeft)-(c.clientLeft||0)}):e):void 0},kb.offset={setOffset:function(a,b,c){var d=kb.css(a,"position");"static"===d&&(a.style.position="relative");var e,f,g=kb(a),h=g.offset(),i=kb.css(a,"top"),j=kb.css(a,"left"),k=("absolute"===d||"fixed"===d)&&kb.inArray("auto",[i,j])>-1,l={},m={};k?(m=g.position(),e=m.top,f=m.left):(e=parseFloat(i)||0,f=parseFloat(j)||0),kb.isFunction(b)&&(b=b.call(a,c,h)),null!=b.top&&(l.top=b.top-h.top+e),null!=b.left&&(l.left=b.left-h.left+f),"using"in b?b.using.call(a,l):g.css(l)}},kb.fn.extend({position:function(){if(this[0]){var a,b,c={top:0,left:0},d=this[0];return"fixed"===kb.css(d,"position")?b=d.getBoundingClientRect():(a=this.offsetParent(),b=this.offset(),kb.nodeName(a[0],"html")||(c=a.offset()),c.top+=kb.css(a[0],"borderTopWidth",!0),c.left+=kb.css(a[0],"borderLeftWidth",!0)),{top:b.top-c.top-kb.css(d,"marginTop",!0),left:b.left-c.left-kb.css(d,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var a=this.offsetParent||Z;a&&!kb.nodeName(a,"html")&&"static"===kb.css(a,"position");)a=a.offsetParent;return a||Z})}}),kb.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(a,c){var d=/Y/.test(c);kb.fn[a]=function(e){return kb.access(this,function(a,e,f){var g=T(a);return f===b?g?c in g?g[c]:g.document.documentElement[e]:a[e]:(g?g.scrollTo(d?kb(g).scrollLeft():f,d?f:kb(g).scrollTop()):a[e]=f,b)},a,e,arguments.length,null)}}),kb.each({Height:"height",Width:"width"},function(a,c){kb.each({padding:"inner"+a,content:c,"":"outer"+a},function(d,e){kb.fn[e]=function(e,f){var g=arguments.length&&(d||"boolean"!=typeof e),h=d||(e===!0||f===!0?"margin":"border");return kb.access(this,function(c,d,e){var f;return kb.isWindow(c)?c.document.documentElement["client"+a]:9===c.nodeType?(f=c.documentElement,Math.max(c.body["scroll"+a],f["scroll"+a],c.body["offset"+a],f["offset"+a],f["client"+a])):e===b?kb.css(c,d,h):kb.style(c,d,e,h)},c,g?e:b,g,null)}})}),kb.fn.size=function(){return this.length},kb.fn.andSelf=kb.fn.addBack,"object"==typeof module&&"object"==typeof module.exports?module.exports=kb:(a.jQuery=a.$=kb,"function"==typeof define&&define.amd&&define("jquery",[],function(){return kb}))}(window),Ext.App=function(a){this.views=[],Ext.apply(this,a),this.api.actions||(this.api.actions={}),Ext.onReady(this.onReady,this),Ext.App.superclass.constructor.apply(this,arguments)},Ext.extend(Ext.App,Ext.util.Observable,{STATUS_EXCEPTION:"exception",STATUS_VALIDATION_ERROR:"validation",STATUS_ERROR:"error",STATUS_NOTICE:"notice",STATUS_OK:"ok",STATUS_HELP:"help",api:{url:null,type:null,actions:{}},msgCt:null,onReady:function(){this.msgCt=Ext.DomHelper.insertFirst(document.body,{id:"msg-div"},!0),this.msgCt.setStyle("position","absolute"),this.msgCt.setStyle("z-index",9999),this.msgCt.setWidth(300)},initStateProvider:function(){var a="";if(a){var b=new Date;b.setTime(b.getTime()+24*a*60*60*1e3);var c="; expires="+b.toGMTString()}else var c=null;Ext.state.Manager.setProvider(new Ext.state.CookieProvider({path:"/",expires:c,domain:null,secure:!1}))},registerView:function(a){this.views.push(a)},getViews:function(){return this.views},registerActions:function(a){Ext.apply(this.api.actions,a)},getAPI:function(){return this.api},setAlert:function(a,b){this.addMessage(a,b)},addMessage:function(a,b){var c=3;a===!1&&(c=5),c=b.length/13.3,3>c?c=3:c>9&&(c=9),this.msgCt.alignTo(document,"t-t"),Ext.DomHelper.append(this.msgCt,{html:this.buildMessageBox(a,String.format.apply(String,Array.prototype.slice.call(arguments,1)))},!0).slideIn("t").pause(c).ghost("t",{remove:!0})},buildMessageBox:function(a,b){switch(a){case!0:a=this.STATUS_OK;break;case!1:a=this.STATUS_ERROR}return['<div class="app-msg">','<div class="x-box-tl"><div class="x-box-tr"><div class="x-box-tc"></div></div></div>','<div class="x-box-ml"><div class="x-box-mr"><div class="x-box-mc"><h3>',a,"</h3>",b,"</div></div></div>",'<div class="x-box-bl"><div class="x-box-br"><div class="x-box-bc"></div></div></div>',"</div>"].join("")},decodeStatusIcon:function(a){switch(iconCls="",a){case!0:case this.STATUS_OK:iconCls=this.ICON_OK;break;case this.STATUS_NOTICE:iconCls=this.ICON_NOTICE;break;case!1:case this.STATUS_ERROR:iconCls=this.ICON_ERROR;break;case this.STATUS_HELP:iconCls=this.ICON_HELP}return iconCls},setViewState:function(a,b){Ext.state.Manager.set(a,b)},getViewState:function(a){return Ext.state.Manager.get(a)},t:function(a){return a},handleResponse:function(a){return a.type==this.STATUS_EXCEPTION?this.handleException(a):void(a.message.length>0&&this.setAlert(a.status,a.message))},handleException:function(a){Ext.MessageBox.alert(a.type.toUpperCase(),a.message)}});var OpenLayers={VERSION_NUMBER:"Release 2.12 HACKED BY MapCentia",singleFile:!0,_getScriptLocation:function(){for(var a,b=/(^|(.*?\/))(OpenLayers[^\/]*?\.js)(\?|$)/,c=document.getElementsByTagName("script"),d="",e=0,f=c.length;f>e;e++)if((a=c[e].getAttribute("src"))&&(a=a.match(b))){d=a[1];break}return function(){return d}}(),ImgPath:""};OpenLayers.Class=function(){var a=arguments.length,b=arguments[0],c=arguments[a-1],d="function"==typeof c.initialize?c.initialize:function(){b.prototype.initialize.apply(this,arguments)};return a>1?(a=[d,b].concat(Array.prototype.slice.call(arguments).slice(1,a-1),c),OpenLayers.inherit.apply(null,a)):d.prototype=c,d},OpenLayers.inherit=function(a,b){var c=function(){};c.prototype=b.prototype,a.prototype=new c;var d,e,c=2;for(d=arguments.length;d>c;c++)e=arguments[c],"function"==typeof e&&(e=e.prototype),OpenLayers.Util.extend(a.prototype,e)},OpenLayers.Util=OpenLayers.Util||{},OpenLayers.Util.extend=function(a,b){if(a=a||{},b){for(var c in b){var d=b[c];void 0!==d&&(a[c]=d)}!("function"==typeof window.Event&&b instanceof window.Event)&&b.hasOwnProperty&&b.hasOwnProperty("toString")&&(a.toString=b.toString)}return a},OpenLayers.String={startsWith:function(a,b){return 0==a.indexOf(b)},contains:function(a,b){return-1!=a.indexOf(b)},trim:function(a){return a.replace(/^\s\s*/,"").replace(/\s\s*$/,"")},camelize:function(a){for(var a=a.split("-"),b=a[0],c=1,d=a.length;d>c;c++)var e=a[c],b=b+(e.charAt(0).toUpperCase()+e.substring(1));return b},format:function(a,b,c){return b||(b=window),a.replace(OpenLayers.String.tokenRegEx,function(a,d){for(var e,f=d.split(/\.+/),g=0;g<f.length;g++)0==g&&(e=b),e=e[f[g]];return"function"==typeof e&&(e=c?e.apply(null,c):e()),"undefined"==typeof e?"undefined":e})},tokenRegEx:/\$\{([\w.]+?)\}/g,numberRegEx:/^([+-]?)(?=\d|\.\d)\d*(\.\d*)?([Ee]([+-]?\d+))?$/,isNumeric:function(a){return OpenLayers.String.numberRegEx.test(a)},numericIf:function(a){return OpenLayers.String.isNumeric(a)?parseFloat(a):a}},OpenLayers.Number={decimalSeparator:".",thousandsSeparator:",",limitSigDigs:function(a,b){var c=0;return b>0&&(c=parseFloat(a.toPrecision(b))),c},format:function(a,b,c,d){b="undefined"!=typeof b?b:0,c="undefined"!=typeof c?c:OpenLayers.Number.thousandsSeparator,d="undefined"!=typeof d?d:OpenLayers.Number.decimalSeparator,null!=b&&(a=parseFloat(a.toFixed(b)));var e=a.toString().split(".");if(1==e.length&&null==b&&(b=0),a=e[0],c)for(var f=/(-?[0-9]+)([0-9]{3})/;f.test(a);)a=a.replace(f,"$1"+c+"$2");return 0==b?b=a:(c=1<e.length?e[1]:"0",null!=b&&(c+=Array(b-c.length+1).join("0")),b=a+d+c),b}},OpenLayers.Function={bind:function(a,b){var c=Array.prototype.slice.apply(arguments,[2]);return function(){var d=c.concat(Array.prototype.slice.apply(arguments,[0]));return a.apply(b,d)}},bindAsEventListener:function(a,b){return function(c){return a.call(b,c||window.event)}},False:function(){return!1},True:function(){return!0},Void:function(){}},OpenLayers.Array={filter:function(a,b,c){var d=[];if(Array.prototype.filter)d=a.filter(b,c);else{var e=a.length;if("function"!=typeof b)throw new TypeError;for(var f=0;e>f;f++)if(f in a){var g=a[f];b.call(c,g,f,a)&&d.push(g)}}return d}},OpenLayers.Bounds=OpenLayers.Class({left:null,bottom:null,right:null,top:null,centerLonLat:null,initialize:function(a,b,c,d){OpenLayers.Util.isArray(a)&&(d=a[3],c=a[2],b=a[1],a=a[0]),null!=a&&(this.left=OpenLayers.Util.toFloat(a)),null!=b&&(this.bottom=OpenLayers.Util.toFloat(b)),null!=c&&(this.right=OpenLayers.Util.toFloat(c)),null!=d&&(this.top=OpenLayers.Util.toFloat(d))},clone:function(){return new OpenLayers.Bounds(this.left,this.bottom,this.right,this.top)},equals:function(a){var b=!1;return null!=a&&(b=this.left==a.left&&this.right==a.right&&this.top==a.top&&this.bottom==a.bottom),b},toString:function(){return[this.left,this.bottom,this.right,this.top].join()},toArray:function(a){return!0===a?[this.bottom,this.left,this.top,this.right]:[this.left,this.bottom,this.right,this.top]},toBBOX:function(a,b){null==a&&(a=6);var c=Math.pow(10,a),d=Math.round(this.left*c)/c,e=Math.round(this.bottom*c)/c,f=Math.round(this.right*c)/c,c=Math.round(this.top*c)/c;return!0===b?e+","+d+","+c+","+f:d+","+e+","+f+","+c},toGeometry:function(){return new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing([new OpenLayers.Geometry.Point(this.left,this.bottom),new OpenLayers.Geometry.Point(this.right,this.bottom),new OpenLayers.Geometry.Point(this.right,this.top),new OpenLayers.Geometry.Point(this.left,this.top)])])},getWidth:function(){return this.right-this.left},getHeight:function(){return this.top-this.bottom},getSize:function(){return new OpenLayers.Size(this.getWidth(),this.getHeight())},getCenterPixel:function(){return new OpenLayers.Pixel((this.left+this.right)/2,(this.bottom+this.top)/2)},getCenterLonLat:function(){return this.centerLonLat||(this.centerLonLat=new OpenLayers.LonLat((this.left+this.right)/2,(this.bottom+this.top)/2)),this.centerLonLat},scale:function(a,b){null==b&&(b=this.getCenterLonLat());var c,d;return"OpenLayers.LonLat"==b.CLASS_NAME?(c=b.lon,d=b.lat):(c=b.x,d=b.y),new OpenLayers.Bounds((this.left-c)*a+c,(this.bottom-d)*a+d,(this.right-c)*a+c,(this.top-d)*a+d)},add:function(a,b){if(null==a||null==b)throw new TypeError("Bounds.add cannot receive null values");return new OpenLayers.Bounds(this.left+a,this.bottom+b,this.right+a,this.top+b)},extend:function(a){var b=null;if(a){switch(a.CLASS_NAME){case"OpenLayers.LonLat":b=new OpenLayers.Bounds(a.lon,a.lat,a.lon,a.lat);break;case"OpenLayers.Geometry.Point":b=new OpenLayers.Bounds(a.x,a.y,a.x,a.y);break;case"OpenLayers.Bounds":b=a}b&&(this.centerLonLat=null,(null==this.left||b.left<this.left)&&(this.left=b.left),(null==this.bottom||b.bottom<this.bottom)&&(this.bottom=b.bottom),(null==this.right||b.right>this.right)&&(this.right=b.right),(null==this.top||b.top>this.top)&&(this.top=b.top))}},containsLonLat:function(a,b){"boolean"==typeof b&&(b={inclusive:b});var b=b||{},c=this.contains(a.lon,a.lat,b.inclusive),d=b.worldBounds;return d&&!c&&(c=d.getWidth(),d=Math.round((a.lon-(d.left+d.right)/2)/c),c=this.containsLonLat({lon:a.lon-d*c,lat:a.lat},{inclusive:b.inclusive})),c},containsPixel:function(a,b){return this.contains(a.x,a.y,b)},contains:function(a,b,c){if(null==c&&(c=!0),null==a||null==b)return!1;var a=OpenLayers.Util.toFloat(a),b=OpenLayers.Util.toFloat(b),d=!1;return d=c?a>=this.left&&a<=this.right&&b>=this.bottom&&b<=this.top:a>this.left&&a<this.right&&b>this.bottom&&b<this.top},intersectsBounds:function(a,b){if("boolean"==typeof b&&(b={inclusive:b}),b=b||{},b.worldBounds)var c=this.wrapDateLine(b.worldBounds),a=a.wrapDateLine(b.worldBounds);else c=this;null==b.inclusive&&(b.inclusive=!0);var d=!1,e=c.left==a.right||c.right==a.left||c.top==a.bottom||c.bottom==a.top;if(b.inclusive||!e)var d=a.top>=c.bottom&&a.top<=c.top||c.top>a.bottom&&c.top<a.top,e=a.left>=c.left&&a.left<=c.right||c.left>=a.left&&c.left<=a.right,f=a.right>=c.left&&a.right<=c.right||c.right>=a.left&&c.right<=a.right,d=(a.bottom>=c.bottom&&a.bottom<=c.top||c.bottom>=a.bottom&&c.bottom<=a.top||d)&&(e||f);if(b.worldBounds&&!d){var g=b.worldBounds,e=g.getWidth(),f=!g.containsBounds(c),g=!g.containsBounds(a);f&&!g?(a=a.add(-e,0),d=c.intersectsBounds(a,{inclusive:b.inclusive})):g&&!f&&(c=c.add(-e,0),d=a.intersectsBounds(c,{inclusive:b.inclusive}))}return d},containsBounds:function(a,b,c){null==b&&(b=!1),null==c&&(c=!0);var d=this.contains(a.left,a.bottom,c),e=this.contains(a.right,a.bottom,c),f=this.contains(a.left,a.top,c),a=this.contains(a.right,a.top,c);return b?d||e||f||a:d&&e&&f&&a},determineQuadrant:function(a){var b="",c=this.getCenterLonLat(),b=b+(a.lat<c.lat?"b":"t");return b+=a.lon<c.lon?"l":"r"},transform:function(a,b){this.centerLonLat=null;var c=OpenLayers.Projection.transform({x:this.left,y:this.bottom},a,b),d=OpenLayers.Projection.transform({x:this.right,y:this.bottom},a,b),e=OpenLayers.Projection.transform({x:this.left,y:this.top},a,b),f=OpenLayers.Projection.transform({x:this.right,y:this.top},a,b);return this.left=Math.min(c.x,e.x),this.bottom=Math.min(c.y,d.y),this.right=Math.max(d.x,f.x),this.top=Math.max(e.y,f.y),this},wrapDateLine:function(a,b){var b=b||{},c=b.leftTolerance||0,d=b.rightTolerance||0,e=this.clone();if(a){for(var f=a.getWidth();e.left<a.left&&e.right-d<=a.left;)e=e.add(f,0);for(;e.left+c>=a.right&&e.right>a.right;)e=e.add(-f,0);c=e.left+c,c<a.right&&c>a.left&&e.right-d>a.right&&(e=e.add(-f,0))}return e},CLASS_NAME:"OpenLayers.Bounds"}),OpenLayers.Bounds.fromString=function(a,b){var c=a.split(",");return OpenLayers.Bounds.fromArray(c,b)},OpenLayers.Bounds.fromArray=function(a,b){return!0===b?new OpenLayers.Bounds(a[1],a[0],a[3],a[2]):new OpenLayers.Bounds(a[0],a[1],a[2],a[3])},OpenLayers.Bounds.fromSize=function(a){return new OpenLayers.Bounds(0,a.h,a.w,0)},OpenLayers.Bounds.oppositeQuadrant=function(a){var b;return b=""+("t"==a.charAt(0)?"b":"t"),b+="l"==a.charAt(1)?"r":"l"},OpenLayers.Element={visible:function(a){return"none"!=OpenLayers.Util.getElement(a).style.display},toggle:function(){for(var a=0,b=arguments.length;b>a;a++){var c=OpenLayers.Util.getElement(arguments[a]),d=OpenLayers.Element.visible(c)?"none":"";c.style.display=d}},remove:function(a){a=OpenLayers.Util.getElement(a),a.parentNode.removeChild(a)},getHeight:function(a){return a=OpenLayers.Util.getElement(a),a.offsetHeight},hasClass:function(a,b){var c=a.className;return!!c&&RegExp("(^|\\s)"+b+"(\\s|$)").test(c)},addClass:function(a,b){return OpenLayers.Element.hasClass(a,b)||(a.className+=(a.className?" ":"")+b),a},removeClass:function(a,b){var c=a.className;return c&&(a.className=OpenLayers.String.trim(c.replace(RegExp("(^|\\s+)"+b+"(\\s+|$)")," "))),a},toggleClass:function(a,b){return OpenLayers.Element.hasClass(a,b)?OpenLayers.Element.removeClass(a,b):OpenLayers.Element.addClass(a,b),a},getStyle:function(a,b){var a=OpenLayers.Util.getElement(a),c=null;if(a&&a.style){c=a.style[OpenLayers.String.camelize(b)],c||(document.defaultView&&document.defaultView.getComputedStyle?c=(c=document.defaultView.getComputedStyle(a,null))?c.getPropertyValue(b):null:a.currentStyle&&(c=a.currentStyle[OpenLayers.String.camelize(b)]));var d=["left","top","right","bottom"];window.opera&&-1!=OpenLayers.Util.indexOf(d,b)&&"static"==OpenLayers.Element.getStyle(a,"position")&&(c="auto")}return"auto"==c?null:c}},OpenLayers.LonLat=OpenLayers.Class({lon:0,lat:0,initialize:function(a,b){OpenLayers.Util.isArray(a)&&(b=a[1],a=a[0]),this.lon=OpenLayers.Util.toFloat(a),this.lat=OpenLayers.Util.toFloat(b)},toString:function(){return"lon="+this.lon+",lat="+this.lat},toShortString:function(){return this.lon+", "+this.lat},clone:function(){return new OpenLayers.LonLat(this.lon,this.lat)},add:function(a,b){if(null==a||null==b)throw new TypeError("LonLat.add cannot receive null values");return new OpenLayers.LonLat(this.lon+OpenLayers.Util.toFloat(a),this.lat+OpenLayers.Util.toFloat(b))},equals:function(a){var b=!1;return null!=a&&(b=this.lon==a.lon&&this.lat==a.lat||isNaN(this.lon)&&isNaN(this.lat)&&isNaN(a.lon)&&isNaN(a.lat)),b},transform:function(a,b){var c=OpenLayers.Projection.transform({x:this.lon,y:this.lat},a,b);return this.lon=c.x,this.lat=c.y,this},wrapDateLine:function(a){var b=this.clone();if(a){for(;b.lon<a.left;)b.lon+=a.getWidth();for(;b.lon>a.right;)b.lon-=a.getWidth()}return b},CLASS_NAME:"OpenLayers.LonLat"}),OpenLayers.LonLat.fromString=function(a){return a=a.split(","),new OpenLayers.LonLat(a[0],a[1])},OpenLayers.LonLat.fromArray=function(a){var b=OpenLayers.Util.isArray(a);return new OpenLayers.LonLat(b&&a[0],b&&a[1])},OpenLayers.Pixel=OpenLayers.Class({x:0,y:0,initialize:function(a,b){this.x=parseFloat(a),this.y=parseFloat(b)},toString:function(){return"x="+this.x+",y="+this.y},clone:function(){return new OpenLayers.Pixel(this.x,this.y)},equals:function(a){var b=!1;return null!=a&&(b=this.x==a.x&&this.y==a.y||isNaN(this.x)&&isNaN(this.y)&&isNaN(a.x)&&isNaN(a.y)),b},distanceTo:function(a){return Math.sqrt(Math.pow(this.x-a.x,2)+Math.pow(this.y-a.y,2))},add:function(a,b){if(null==a||null==b)throw new TypeError("Pixel.add cannot receive null values");return new OpenLayers.Pixel(this.x+a,this.y+b)},offset:function(a){var b=this.clone();return a&&(b=this.add(a.x,a.y)),b},CLASS_NAME:"OpenLayers.Pixel"}),OpenLayers.Size=OpenLayers.Class({w:0,h:0,initialize:function(a,b){this.w=parseFloat(a),this.h=parseFloat(b)},toString:function(){return"w="+this.w+",h="+this.h},clone:function(){return new OpenLayers.Size(this.w,this.h)},equals:function(a){var b=!1;return null!=a&&(b=this.w==a.w&&this.h==a.h||isNaN(this.w)&&isNaN(this.h)&&isNaN(a.w)&&isNaN(a.h)),b},CLASS_NAME:"OpenLayers.Size"}),OpenLayers.Console={log:function(){},debug:function(){},info:function(){},warn:function(){},error:function(){},userError:function(a){alert(a)},assert:function(){},dir:function(){},dirxml:function(){},trace:function(){},group:function(){},groupEnd:function(){},time:function(){},timeEnd:function(){},profile:function(){},profileEnd:function(){},count:function(){},CLASS_NAME:"OpenLayers.Console"},function(){for(var a=document.getElementsByTagName("script"),b=0,c=a.length;c>b;++b)if(-1!=a[b].src.indexOf("firebug.js")&&console){OpenLayers.Util.extend(OpenLayers.Console,console);break}}(),OpenLayers.Lang={code:null,defaultCode:"en",getCode:function(){return OpenLayers.Lang.code||OpenLayers.Lang.setCode(),OpenLayers.Lang.code},setCode:function(a){var b;if(a||(a="msie"==OpenLayers.BROWSER_NAME?navigator.userLanguage:navigator.language),a=a.split("-"),a[0]=a[0].toLowerCase(),"object"==typeof OpenLayers.Lang[a[0]]&&(b=a[0]),a[1]){var c=a[0]+"-"+a[1].toUpperCase();"object"==typeof OpenLayers.Lang[c]&&(b=c)}b||(OpenLayers.Console.warn("Failed to find OpenLayers.Lang."+a.join("-")+" dictionary, falling back to default language"),b=OpenLayers.Lang.defaultCode),OpenLayers.Lang.code=b},translate:function(a,b){var c=OpenLayers.Lang[OpenLayers.Lang.getCode()];return(c=c&&c[a])||(c=a),b&&(c=OpenLayers.String.format(c,b)),c}},OpenLayers.i18n=OpenLayers.Lang.translate,OpenLayers.Util=OpenLayers.Util||{},OpenLayers.Util.getElement=function(){for(var a=[],b=0,c=arguments.length;c>b;b++){var d=arguments[b];if("string"==typeof d&&(d=document.getElementById(d)),1==arguments.length)return d;a.push(d)}return a},OpenLayers.Util.isElement=function(a){return!(!a||1!==a.nodeType)},OpenLayers.Util.isArray=function(a){return"[object Array]"===Object.prototype.toString.call(a)},"undefined"==typeof window.$&&(window.$=OpenLayers.Util.getElement),OpenLayers.Util.removeItem=function(a,b){for(var c=a.length-1;c>=0;c--)a[c]==b&&a.splice(c,1);return a},OpenLayers.Util.indexOf=function(a,b){if("function"==typeof a.indexOf)return a.indexOf(b);for(var c=0,d=a.length;d>c;c++)if(a[c]==b)return c;return-1},OpenLayers.Util.modifyDOMElement=function(a,b,c,d,e,f,g,h){b&&(a.id=b),c&&(a.style.left=c.x+"px",a.style.top=c.y+"px"),d&&(a.style.width=d.w+"px",a.style.height=d.h+"px"),e&&(a.style.position=e),f&&(a.style.border=f),g&&(a.style.overflow=g),parseFloat(h)>=0&&parseFloat(h)<1?(a.style.filter="alpha(opacity="+100*h+")",a.style.opacity=h):1==parseFloat(h)&&(a.style.filter="",a.style.opacity="")},OpenLayers.Util.createDiv=function(a,b,c,d,e,f,g,h){var i=document.createElement("div");return d&&(i.style.backgroundImage="url("+d+")"),a||(a=OpenLayers.Util.createUniqueID("OpenLayersDiv")),e||(e="absolute"),OpenLayers.Util.modifyDOMElement(i,a,b,c,e,f,g,h),i},OpenLayers.Util.createImage=function(a,b,c,d,e,f,g,h){var i=document.createElement("img");return a||(a=OpenLayers.Util.createUniqueID("OpenLayersDiv")),e||(e="relative"),OpenLayers.Util.modifyDOMElement(i,a,b,c,e,f,null,g),h&&(i.style.display="none",b=function(){i.style.display="",OpenLayers.Event.stopObservingElement(i)},OpenLayers.Event.observe(i,"load",b),OpenLayers.Event.observe(i,"error",b)),i.style.alt=a,i.galleryImg="no",d&&(i.src=d),i},OpenLayers.IMAGE_RELOAD_ATTEMPTS=0,OpenLayers.Util.alphaHackNeeded=null,OpenLayers.Util.alphaHack=function(){if(null==OpenLayers.Util.alphaHackNeeded){var a=navigator.appVersion.split("MSIE"),a=parseFloat(a[1]),b=!1;try{b=!!document.body.filters}catch(c){}OpenLayers.Util.alphaHackNeeded=b&&a>=5.5&&7>a}return OpenLayers.Util.alphaHackNeeded},OpenLayers.Util.modifyAlphaImageDiv=function(a,b,c,d,e,f,g,h,i){OpenLayers.Util.modifyDOMElement(a,b,c,d,f,null,null,i),b=a.childNodes[0],e&&(b.src=e),OpenLayers.Util.modifyDOMElement(b,a.id+"_innerImage",null,d,"relative",g),OpenLayers.Util.alphaHack()&&("none"!=a.style.display&&(a.style.display="inline-block"),null==h&&(h="scale"),a.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+b.src+"', sizingMethod='"+h+"')",parseFloat(a.style.opacity)>=0&&parseFloat(a.style.opacity)<1&&(a.style.filter=a.style.filter+(" alpha(opacity="+100*a.style.opacity+")")),b.style.filter="alpha(opacity=0)")},OpenLayers.Util.createAlphaImageDiv=function(a,b,c,d,e,f,g,h,i){var j=OpenLayers.Util.createDiv(),i=OpenLayers.Util.createImage(null,null,null,null,null,null,null,i);return i.className="olAlphaImg",j.appendChild(i),OpenLayers.Util.modifyAlphaImageDiv(j,a,b,c,d,e,f,g,h),j},OpenLayers.Util.upperCaseObject=function(a){var b,c={};for(b in a)c[b.toUpperCase()]=a[b];return c},OpenLayers.Util.applyDefaults=function(a,b){var c,a=a||{},d="function"==typeof window.Event&&b instanceof window.Event;for(c in b)(void 0===a[c]||!d&&b.hasOwnProperty&&b.hasOwnProperty(c)&&!a.hasOwnProperty(c))&&(a[c]=b[c]);return!d&&b&&b.hasOwnProperty&&b.hasOwnProperty("toString")&&!a.hasOwnProperty("toString")&&(a.toString=b.toString),a},OpenLayers.Util.getParameterString=function(a){var b,c=[];for(b in a){var d=a[b];if(null!=d&&"function"!=typeof d){if("object"==typeof d&&d.constructor==Array){for(var e,f=[],g=0,h=d.length;h>g;g++)e=d[g],f.push(encodeURIComponent(null===e||void 0===e?"":e));d=f.join(",")}else d=encodeURIComponent(d);c.push(encodeURIComponent(b)+"="+d)}}return c.join("&")},OpenLayers.Util.urlAppend=function(a,b){var c=a;if(b)var d=(a+" ").split(/[?&]/),c=c+(" "===d.pop()?b:d.length?"&"+b:"?"+b);return c},OpenLayers.Util.getImagesLocation=function(){return OpenLayers.ImgPath||OpenLayers._getScriptLocation()+"img/"},OpenLayers.Util.getImageLocation=function(a){return OpenLayers.Util.getImagesLocation()+a},OpenLayers.Util.Try=function(){for(var a=null,b=0,c=arguments.length;c>b;b++){var d=arguments[b];try{a=d();break}catch(e){}}return a},OpenLayers.Util.getXmlNodeValue=function(a){var b=null;return OpenLayers.Util.Try(function(){b=a.text,b||(b=a.textContent),b||(b=a.firstChild.nodeValue)},function(){b=a.textContent}),b},OpenLayers.Util.mouseLeft=function(a,b){for(var c=a.relatedTarget?a.relatedTarget:a.toElement;c!=b&&null!=c;)c=c.parentNode;return c!=b},OpenLayers.Util.DEFAULT_PRECISION=14,OpenLayers.Util.toFloat=function(a,b){return null==b&&(b=OpenLayers.Util.DEFAULT_PRECISION),"number"!=typeof a&&(a=parseFloat(a)),0===b?a:parseFloat(a.toPrecision(b))},OpenLayers.Util.rad=function(a){return a*Math.PI/180},OpenLayers.Util.deg=function(a){return 180*a/Math.PI},OpenLayers.Util.VincentyConstants={a:6378137,b:6356752.3142,f:1/298.257223563},OpenLayers.Util.distVincenty=function(a,b){for(var c=OpenLayers.Util.VincentyConstants,d=c.a,e=c.b,c=c.f,f=OpenLayers.Util.rad(b.lon-a.lon),g=Math.atan((1-c)*Math.tan(OpenLayers.Util.rad(a.lat))),h=Math.atan((1-c)*Math.tan(OpenLayers.Util.rad(b.lat))),i=Math.sin(g),g=Math.cos(g),j=Math.sin(h),h=Math.cos(h),k=f,l=2*Math.PI,m=20;Math.abs(k-l)>1e-12&&--m>0;){var n=Math.sin(k),o=Math.cos(k),p=Math.sqrt(h*n*h*n+(g*j-i*h*o)*(g*j-i*h*o));if(0==p)return 0;var o=i*j+g*h*o,q=Math.atan2(p,o),r=Math.asin(g*h*n/p),s=Math.cos(r)*Math.cos(r),n=o-2*i*j/s,t=c/16*s*(4+c*(4-3*s)),l=k,k=f+(1-t)*c*Math.sin(r)*(q+t*p*(n+t*o*(-1+2*n*n)))}return 0==m?0/0:(d=s*(d*d-e*e)/(e*e),c=d/1024*(256+d*(-128+d*(74-47*d))),(e*(1+d/16384*(4096+d*(-768+d*(320-175*d))))*(q-c*p*(n+c/4*(o*(-1+2*n*n)-c/6*n*(-3+4*p*p)*(-3+4*n*n))))).toFixed(3)/1e3)},OpenLayers.Util.destinationVincenty=function(a,b,c){for(var d=OpenLayers.Util,e=d.VincentyConstants,f=e.a,g=e.b,h=e.f,e=a.lon,a=a.lat,i=d.rad(b),b=Math.sin(i),i=Math.cos(i),a=(1-h)*Math.tan(d.rad(a)),j=1/Math.sqrt(1+a*a),k=a*j,l=Math.atan2(a,i),a=j*b,m=1-a*a,f=m*(f*f-g*g)/(g*g),n=1+f/16384*(4096+f*(-768+f*(320-175*f))),o=f/1024*(256+f*(-128+f*(74-47*f))),f=c/(g*n),p=2*Math.PI;Math.abs(f-p)>1e-12;)var q=Math.cos(2*l+f),r=Math.sin(f),s=Math.cos(f),t=o*r*(q+o/4*(s*(-1+2*q*q)-o/6*q*(-3+4*r*r)*(-3+4*q*q))),p=f,f=c/(g*n)+t;return c=k*r-j*s*i,g=Math.atan2(k*s+j*r*i,(1-h)*Math.sqrt(a*a+c*c)),b=Math.atan2(r*b,j*s-k*r*i),i=h/16*m*(4+h*(4-3*m)),q=b-(1-i)*h*a*(f+i*r*(q+i*s*(-1+2*q*q))),Math.atan2(a,-c),new OpenLayers.LonLat(e+d.deg(q),d.deg(g))},OpenLayers.Util.getParameters=function(a){var a=null===a||void 0===a?window.location.href:a,b="";if(OpenLayers.String.contains(a,"?"))var b=a.indexOf("?")+1,c=OpenLayers.String.contains(a,"#")?a.indexOf("#"):a.length,b=a.substring(b,c);for(var a={},b=b.split(/[&;]/),c=0,d=b.length;d>c;++c){var e=b[c].split("=");if(e[0]){var f=e[0];try{f=decodeURIComponent(f)}catch(g){f=unescape(f)}e=(e[1]||"").replace(/\+/g," ");try{e=decodeURIComponent(e)}catch(h){e=unescape(e)}e=e.split(","),1==e.length&&(e=e[0]),a[f]=e}}return a},OpenLayers.Util.lastSeqID=0,OpenLayers.Util.createUniqueID=function(a){return null==a&&(a="id_"),OpenLayers.Util.lastSeqID=OpenLayers.Util.lastSeqID+1,a+OpenLayers.Util.lastSeqID},OpenLayers.INCHES_PER_UNIT={inches:1,ft:12,mi:63360,m:39.3701,km:39370.1,dd:4374754,yd:36},OpenLayers.INCHES_PER_UNIT["in"]=OpenLayers.INCHES_PER_UNIT.inches,OpenLayers.INCHES_PER_UNIT.degrees=OpenLayers.INCHES_PER_UNIT.dd,OpenLayers.INCHES_PER_UNIT.nmi=1852*OpenLayers.INCHES_PER_UNIT.m,OpenLayers.METERS_PER_INCH=.0254000508001016,OpenLayers.Util.extend(OpenLayers.INCHES_PER_UNIT,{Inch:OpenLayers.INCHES_PER_UNIT.inches,Meter:1/OpenLayers.METERS_PER_INCH,Foot:.3048006096012192/OpenLayers.METERS_PER_INCH,IFoot:.3048/OpenLayers.METERS_PER_INCH,ClarkeFoot:.3047972651151/OpenLayers.METERS_PER_INCH,SearsFoot:.30479947153867626/OpenLayers.METERS_PER_INCH,GoldCoastFoot:.3047997101815088/OpenLayers.METERS_PER_INCH,IInch:.0254/OpenLayers.METERS_PER_INCH,MicroInch:254e-7/OpenLayers.METERS_PER_INCH,Mil:2.54e-8/OpenLayers.METERS_PER_INCH,Centimeter:.01/OpenLayers.METERS_PER_INCH,Kilometer:1e3/OpenLayers.METERS_PER_INCH,Yard:.9144018288036576/OpenLayers.METERS_PER_INCH,SearsYard:.914398414616029/OpenLayers.METERS_PER_INCH,IndianYard:.9143985307444408/OpenLayers.METERS_PER_INCH,IndianYd37:.91439523/OpenLayers.METERS_PER_INCH,IndianYd62:.9143988/OpenLayers.METERS_PER_INCH,IndianYd75:.9143985/OpenLayers.METERS_PER_INCH,IndianFoot:.30479951/OpenLayers.METERS_PER_INCH,IndianFt37:.30479841/OpenLayers.METERS_PER_INCH,IndianFt62:.3047996/OpenLayers.METERS_PER_INCH,IndianFt75:.3047995/OpenLayers.METERS_PER_INCH,Mile:1609.3472186944373/OpenLayers.METERS_PER_INCH,IYard:.9144/OpenLayers.METERS_PER_INCH,IMile:1609.344/OpenLayers.METERS_PER_INCH,NautM:1852/OpenLayers.METERS_PER_INCH,"Lat-66":110943.31648893273/OpenLayers.METERS_PER_INCH,"Lat-83":110946.25736872235/OpenLayers.METERS_PER_INCH,Decimeter:.1/OpenLayers.METERS_PER_INCH,Millimeter:.001/OpenLayers.METERS_PER_INCH,Dekameter:10/OpenLayers.METERS_PER_INCH,Decameter:10/OpenLayers.METERS_PER_INCH,Hectometer:100/OpenLayers.METERS_PER_INCH,GermanMeter:1.0000135965/OpenLayers.METERS_PER_INCH,CaGrid:.999738/OpenLayers.METERS_PER_INCH,ClarkeChain:20.1166194976/OpenLayers.METERS_PER_INCH,GunterChain:20.11684023368047/OpenLayers.METERS_PER_INCH,BenoitChain:20.116782494375872/OpenLayers.METERS_PER_INCH,SearsChain:20.11676512155/OpenLayers.METERS_PER_INCH,ClarkeLink:.201166194976/OpenLayers.METERS_PER_INCH,GunterLink:.2011684023368047/OpenLayers.METERS_PER_INCH,BenoitLink:.20116782494375873/OpenLayers.METERS_PER_INCH,SearsLink:.2011676512155/OpenLayers.METERS_PER_INCH,Rod:5.02921005842012/OpenLayers.METERS_PER_INCH,IntnlChain:20.1168/OpenLayers.METERS_PER_INCH,IntnlLink:.201168/OpenLayers.METERS_PER_INCH,Perch:5.02921005842012/OpenLayers.METERS_PER_INCH,Pole:5.02921005842012/OpenLayers.METERS_PER_INCH,Furlong:201.1684023368046/OpenLayers.METERS_PER_INCH,Rood:3.778266898/OpenLayers.METERS_PER_INCH,CapeFoot:.3047972615/OpenLayers.METERS_PER_INCH,Brealey:375/OpenLayers.METERS_PER_INCH,ModAmFt:.304812252984506/OpenLayers.METERS_PER_INCH,Fathom:1.8288/OpenLayers.METERS_PER_INCH,"NautM-UK":1853.184/OpenLayers.METERS_PER_INCH,"50kilometers":5e4/OpenLayers.METERS_PER_INCH,"150kilometers":15e4/OpenLayers.METERS_PER_INCH}),OpenLayers.Util.extend(OpenLayers.INCHES_PER_UNIT,{mm:OpenLayers.INCHES_PER_UNIT.Meter/1e3,cm:OpenLayers.INCHES_PER_UNIT.Meter/100,dm:100*OpenLayers.INCHES_PER_UNIT.Meter,km:1e3*OpenLayers.INCHES_PER_UNIT.Meter,kmi:OpenLayers.INCHES_PER_UNIT.nmi,fath:OpenLayers.INCHES_PER_UNIT.Fathom,ch:OpenLayers.INCHES_PER_UNIT.IntnlChain,link:OpenLayers.INCHES_PER_UNIT.IntnlLink,"us-in":OpenLayers.INCHES_PER_UNIT.inches,"us-ft":OpenLayers.INCHES_PER_UNIT.Foot,"us-yd":OpenLayers.INCHES_PER_UNIT.Yard,"us-ch":OpenLayers.INCHES_PER_UNIT.GunterChain,"us-mi":OpenLayers.INCHES_PER_UNIT.Mile,"ind-yd":OpenLayers.INCHES_PER_UNIT.IndianYd37,"ind-ft":OpenLayers.INCHES_PER_UNIT.IndianFt37,"ind-ch":20.11669506/OpenLayers.METERS_PER_INCH}),OpenLayers.DOTS_PER_INCH=72,OpenLayers.Util.normalizeScale=function(a){return a>1?1/a:a},OpenLayers.Util.getResolutionFromScale=function(a,b){var c;return a&&(null==b&&(b="degrees"),c=1/(OpenLayers.Util.normalizeScale(a)*OpenLayers.INCHES_PER_UNIT[b]*OpenLayers.DOTS_PER_INCH)),c},OpenLayers.Util.getScaleFromResolution=function(a,b){return null==b&&(b="degrees"),a*OpenLayers.INCHES_PER_UNIT[b]*OpenLayers.DOTS_PER_INCH},OpenLayers.Util.pagePosition=function(a){var b=[0,0],c=OpenLayers.Util.getViewportElement();if(!a||a==window||a==c)return b;var d=OpenLayers.IS_GECKO&&document.getBoxObjectFor&&"absolute"==OpenLayers.Element.getStyle(a,"position")&&(""==a.style.top||""==a.style.left),e=null;if(a.getBoundingClientRect)a=a.getBoundingClientRect(),e=c.scrollTop,b[0]=a.left+c.scrollLeft,b[1]=a.top+e;else if(document.getBoxObjectFor&&!d)a=document.getBoxObjectFor(a),c=document.getBoxObjectFor(c),b[0]=a.screenX-c.screenX,b[1]=a.screenY-c.screenY;
else{if(b[0]=a.offsetLeft,b[1]=a.offsetTop,e=a.offsetParent,e!=a)for(;e;)b[0]=b[0]+e.offsetLeft,b[1]=b[1]+e.offsetTop,e=e.offsetParent;for(c=OpenLayers.BROWSER_NAME,("opera"==c||"safari"==c&&"absolute"==OpenLayers.Element.getStyle(a,"position"))&&(b[1]=b[1]-document.body.offsetTop),e=a.offsetParent;e&&e!=document.body;)b[0]=b[0]-e.scrollLeft,("opera"!=c||"TR"!=e.tagName)&&(b[1]=b[1]-e.scrollTop),e=e.offsetParent}return b},OpenLayers.Util.getViewportElement=function(){var a=arguments.callee.viewportElement;return void 0==a&&(a="msie"==OpenLayers.BROWSER_NAME&&"CSS1Compat"!=document.compatMode?document.body:document.documentElement,arguments.callee.viewportElement=a),a},OpenLayers.Util.isEquivalentUrl=function(a,b,c){c=c||{},OpenLayers.Util.applyDefaults(c,{ignoreCase:!0,ignorePort80:!0,ignoreHash:!0});var d,a=OpenLayers.Util.createUrlObject(a,c),b=OpenLayers.Util.createUrlObject(b,c);for(d in a)if("args"!==d&&a[d]!=b[d])return!1;for(d in a.args){if(a.args[d]!=b.args[d])return!1;delete b.args[d]}for(d in b.args)return!1;return!0},OpenLayers.Util.createUrlObject=function(a,b){if(b=b||{},!/^\w+:\/\//.test(a)){var c=window.location,d=c.port?":"+c.port:"",d=c.protocol+"//"+c.host.split(":").shift()+d;0===a.indexOf("/")?a=d+a:(c=c.pathname.split("/"),c.pop(),a=d+c.join("/")+"/"+a)}b.ignoreCase&&(a=a.toLowerCase()),c=document.createElement("a"),c.href=a,d={},d.host=c.host.split(":").shift(),d.protocol=c.protocol,d.port=b.ignorePort80?"80"==c.port||"0"==c.port?"":c.port:""==c.port||"0"==c.port?"80":c.port,d.hash=b.ignoreHash||"#"===c.hash?"":c.hash;var e=c.search;return e||(e=a.indexOf("?"),e=-1!=e?a.substr(e):""),d.args=OpenLayers.Util.getParameters(e),d.pathname="/"==c.pathname.charAt(0)?c.pathname:"/"+c.pathname,d},OpenLayers.Util.removeTail=function(a){var b=null,b=a.indexOf("?"),c=a.indexOf("#");return b=-1==b?-1!=c?a.substr(0,c):a:-1!=c?a.substr(0,Math.min(b,c)):a.substr(0,b)},OpenLayers.IS_GECKO=function(){var a=navigator.userAgent.toLowerCase();return-1==a.indexOf("webkit")&&-1!=a.indexOf("gecko")}(),OpenLayers.CANVAS_SUPPORTED=function(){var a=document.createElement("canvas");return!(!a.getContext||!a.getContext("2d"))}(),OpenLayers.BROWSER_NAME=function(){var a="",b=navigator.userAgent.toLowerCase();return-1!=b.indexOf("opera")?a="opera":-1!=b.indexOf("msie")?a="msie":-1!=b.indexOf("safari")?a="safari":-1!=b.indexOf("mozilla")&&(a=-1!=b.indexOf("firefox")?"firefox":"mozilla"),a}(),OpenLayers.Util.getBrowserName=function(){return OpenLayers.BROWSER_NAME},OpenLayers.Util.getRenderedDimensions=function(a,b,c){var d,e,f=document.createElement("div");f.style.visibility="hidden";for(var g=c&&c.containerElement?c.containerElement:document.body,h=!1,i=null,j=g;j&&"body"!=j.tagName.toLowerCase();){var k=OpenLayers.Element.getStyle(j,"position");if("absolute"==k){h=!0;break}if(k&&"static"!=k)break;j=j.parentNode}if(!h||0!==g.clientHeight&&0!==g.clientWidth||(i=document.createElement("div"),i.style.visibility="hidden",i.style.position="absolute",i.style.overflow="visible",i.style.width=document.body.clientWidth+"px",i.style.height=document.body.clientHeight+"px",i.appendChild(f)),f.style.position="absolute",b&&(b.w?(d=b.w,f.style.width=d+"px"):b.h&&(e=b.h,f.style.height=e+"px")),c&&c.displayClass&&(f.className=c.displayClass),b=document.createElement("div"),b.innerHTML=a,b.style.overflow="visible",b.childNodes)for(a=0,c=b.childNodes.length;c>a;a++)b.childNodes[a].style&&(b.childNodes[a].style.overflow="visible");return f.appendChild(b),g.appendChild(i?i:f),d||(d=parseInt(b.scrollWidth),f.style.width=d+"px"),e||(e=parseInt(b.scrollHeight)),f.removeChild(b),i?(i.removeChild(f),g.removeChild(i)):g.removeChild(f),new OpenLayers.Size(d,e)},OpenLayers.Util.getScrollbarWidth=function(){var a=OpenLayers.Util._scrollbarWidth;if(null==a){var b=null,c=null,b=a=0,b=document.createElement("div");b.style.position="absolute",b.style.top="-1000px",b.style.left="-1000px",b.style.width="100px",b.style.height="50px",b.style.overflow="hidden",c=document.createElement("div"),c.style.width="100%",c.style.height="200px",b.appendChild(c),document.body.appendChild(b),a=c.offsetWidth,b.style.overflow="scroll",b=c.offsetWidth,document.body.removeChild(document.body.lastChild),OpenLayers.Util._scrollbarWidth=a-b,a=OpenLayers.Util._scrollbarWidth}return a},OpenLayers.Util.getFormattedLonLat=function(a,b,c){c||(c="dms");var a=(a+540)%360-180,d=Math.abs(a),e=Math.floor(d),f=d=(d-e)/(1/60),d=Math.floor(d),f=Math.round((f-d)/(1/60)*10),f=f/10;return f>=60&&(f-=60,d+=1,d>=60&&(d-=60,e+=1)),10>e&&(e="0"+e),e+="Â°",c.indexOf("dm")>=0&&(10>d&&(d="0"+d),e+=d+"'",c.indexOf("dms")>=0&&(10>f&&(f="0"+f),e+=f+'"')),e="lon"==b?e+OpenLayers.i18n(0>a?"W":"E"):e+OpenLayers.i18n(0>a?"S":"N")},OpenLayers.Format=OpenLayers.Class({options:null,externalProjection:null,internalProjection:null,data:null,keepData:!1,initialize:function(a){OpenLayers.Util.extend(this,a),this.options=a},destroy:function(){},read:function(){throw Error("Read not implemented.")},write:function(){throw Error("Write not implemented.")},CLASS_NAME:"OpenLayers.Format"}),OpenLayers.Format.CSWGetRecords=function(a){var a=OpenLayers.Util.applyDefaults(a,OpenLayers.Format.CSWGetRecords.DEFAULTS),b=OpenLayers.Format.CSWGetRecords["v"+a.version.replace(/\./g,"_")];if(!b)throw"Unsupported CSWGetRecords version: "+a.version;return new b(a)},OpenLayers.Format.CSWGetRecords.DEFAULTS={version:"2.0.2"},OpenLayers.Control=OpenLayers.Class({id:null,map:null,div:null,type:null,allowSelection:!1,displayClass:"",title:"",autoActivate:!1,active:null,handler:null,eventListeners:null,events:null,initialize:function(a){this.displayClass=this.CLASS_NAME.replace("OpenLayers.","ol").replace(/\./g,""),OpenLayers.Util.extend(this,a),this.events=new OpenLayers.Events(this),this.eventListeners instanceof Object&&this.events.on(this.eventListeners),null==this.id&&(this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_"))},destroy:function(){if(this.events&&(this.eventListeners&&this.events.un(this.eventListeners),this.events.destroy(),this.events=null),this.eventListeners=null,this.handler&&(this.handler.destroy(),this.handler=null),this.handlers){for(var a in this.handlers)this.handlers.hasOwnProperty(a)&&"function"==typeof this.handlers[a].destroy&&this.handlers[a].destroy();this.handlers=null}this.map&&(this.map.removeControl(this),this.map=null),this.div=null},setMap:function(a){this.map=a,this.handler&&this.handler.setMap(a)},draw:function(a){return null==this.div&&(this.div=OpenLayers.Util.createDiv(this.id),this.div.className=this.displayClass,this.allowSelection||(this.div.className+=" olControlNoSelect",this.div.setAttribute("unselectable","on",0),this.div.onselectstart=OpenLayers.Function.False),""!=this.title)&&(this.div.title=this.title),null!=a&&(this.position=a.clone()),this.moveTo(this.position),this.div},moveTo:function(a){null!=a&&null!=this.div&&(this.div.style.left=a.x+"px",this.div.style.top=a.y+"px")},activate:function(){return this.active?!1:(this.handler&&this.handler.activate(),this.active=!0,this.map&&OpenLayers.Element.addClass(this.map.viewPortDiv,this.displayClass.replace(/ /g,"")+"Active"),this.events.triggerEvent("activate"),!0)},deactivate:function(){return this.active?(this.handler&&this.handler.deactivate(),this.active=!1,this.map&&OpenLayers.Element.removeClass(this.map.viewPortDiv,this.displayClass.replace(/ /g,"")+"Active"),this.events.triggerEvent("deactivate"),!0):!1},CLASS_NAME:"OpenLayers.Control"}),OpenLayers.Control.TYPE_BUTTON=1,OpenLayers.Control.TYPE_TOGGLE=2,OpenLayers.Control.TYPE_TOOL=3,OpenLayers.Event={observers:!1,KEY_SPACE:32,KEY_BACKSPACE:8,KEY_TAB:9,KEY_RETURN:13,KEY_ESC:27,KEY_LEFT:37,KEY_UP:38,KEY_RIGHT:39,KEY_DOWN:40,KEY_DELETE:46,element:function(a){return a.target||a.srcElement},isSingleTouch:function(a){return a.touches&&1==a.touches.length},isMultiTouch:function(a){return a.touches&&1<a.touches.length},isLeftClick:function(a){return a.which&&1==a.which||a.button&&1==a.button},isRightClick:function(a){return a.which&&3==a.which||a.button&&2==a.button},stop:function(a,b){b||(a.preventDefault?a.preventDefault():a.returnValue=!1),a.stopPropagation?a.stopPropagation():a.cancelBubble=!0},findElement:function(a,b){for(var c=OpenLayers.Event.element(a);c.parentNode&&(!c.tagName||c.tagName.toUpperCase()!=b.toUpperCase());)c=c.parentNode;return c},observe:function(a,b,c,d){if(a=OpenLayers.Util.getElement(a),d=d||!1,"keypress"==b&&(navigator.appVersion.match(/Konqueror|Safari|KHTML/)||a.attachEvent)&&(b="keydown"),this.observers||(this.observers={}),!a._eventCacheID){var e="eventCacheID_";a.id&&(e=a.id+"_"+e),a._eventCacheID=OpenLayers.Util.createUniqueID(e)}e=a._eventCacheID,this.observers[e]||(this.observers[e]=[]),this.observers[e].push({element:a,name:b,observer:c,useCapture:d}),a.addEventListener?a.addEventListener(b,c,d):a.attachEvent&&a.attachEvent("on"+b,c)},stopObservingElement:function(a){a=OpenLayers.Util.getElement(a)._eventCacheID,this._removeElementObservers(OpenLayers.Event.observers[a])},_removeElementObservers:function(a){if(a)for(var b=a.length-1;b>=0;b--){var c=a[b];OpenLayers.Event.stopObserving.apply(this,[c.element,c.name,c.observer,c.useCapture])}},stopObserving:function(a,b,c,d){var d=d||!1,a=OpenLayers.Util.getElement(a),e=a._eventCacheID;"keypress"==b&&(navigator.appVersion.match(/Konqueror|Safari|KHTML/)||a.detachEvent)&&(b="keydown");var f=!1,g=OpenLayers.Event.observers[e];if(g)for(var h=0;!f&&h<g.length;){var i=g[h];if(i.name==b&&i.observer==c&&i.useCapture==d){g.splice(h,1),0==g.length&&delete OpenLayers.Event.observers[e],f=!0;break}h++}return f&&(a.removeEventListener?a.removeEventListener(b,c,d):a&&a.detachEvent&&a.detachEvent("on"+b,c)),f},unloadCache:function(){if(OpenLayers.Event&&OpenLayers.Event.observers){for(var a in OpenLayers.Event.observers)OpenLayers.Event._removeElementObservers.apply(this,[OpenLayers.Event.observers[a]]);OpenLayers.Event.observers=!1}},CLASS_NAME:"OpenLayers.Event"},OpenLayers.Event.observe(window,"unload",OpenLayers.Event.unloadCache,!1),OpenLayers.Events=OpenLayers.Class({BROWSER_EVENTS:"mouseover mouseout mousedown mouseup mousemove click dblclick rightclick dblrightclick resize focus blur touchstart touchmove touchend keydown".split(" "),listeners:null,object:null,element:null,eventHandler:null,fallThrough:null,includeXY:!1,extensions:null,extensionCount:null,clearMouseListener:null,initialize:function(a,b,c,d,e){OpenLayers.Util.extend(this,e),this.object=a,this.fallThrough=d,this.listeners={},this.extensions={},this.extensionCount={},null!=b&&this.attachToElement(b)},destroy:function(){for(var a in this.extensions)"boolean"!=typeof this.extensions[a]&&this.extensions[a].destroy();this.extensions=null,this.element&&(OpenLayers.Event.stopObservingElement(this.element),this.element.hasScrollEvent&&OpenLayers.Event.stopObserving(window,"scroll",this.clearMouseListener)),this.eventHandler=this.fallThrough=this.object=this.listeners=this.element=null},addEventType:function(){},attachToElement:function(a){this.element?OpenLayers.Event.stopObservingElement(this.element):(this.eventHandler=OpenLayers.Function.bindAsEventListener(this.handleBrowserEvent,this),this.clearMouseListener=OpenLayers.Function.bind(this.clearMouseCache,this)),this.element=a;for(var b=0,c=this.BROWSER_EVENTS.length;c>b;b++)OpenLayers.Event.observe(a,this.BROWSER_EVENTS[b],this.eventHandler);OpenLayers.Event.observe(a,"dragstart",OpenLayers.Event.stop)},on:function(a){for(var b in a)"scope"!=b&&a.hasOwnProperty(b)&&this.register(b,a.scope,a[b])},register:function(a,b,c,d){if(a in OpenLayers.Events&&!this.extensions[a]&&(this.extensions[a]=new OpenLayers.Events[a](this)),null!=c){null==b&&(b=this.object);var e=this.listeners[a];e||(e=[],this.listeners[a]=e,this.extensionCount[a]=0),b={obj:b,func:c},d?(e.splice(this.extensionCount[a],0,b),"object"==typeof d&&d.extension&&this.extensionCount[a]++):e.push(b)}},registerPriority:function(a,b,c){this.register(a,b,c,!0)},un:function(a){for(var b in a)"scope"!=b&&a.hasOwnProperty(b)&&this.unregister(b,a.scope,a[b])},unregister:function(a,b,c){if(null==b&&(b=this.object),a=this.listeners[a],null!=a)for(var d=0,e=a.length;e>d;d++)if(a[d].obj==b&&a[d].func==c){a.splice(d,1);break}},remove:function(a){null!=this.listeners[a]&&(this.listeners[a]=[])},triggerEvent:function(a,b){var c=this.listeners[a];if(c&&0!=c.length){null==b&&(b={}),b.object=this.object,b.element=this.element,b.type||(b.type=a);for(var d,c=c.slice(),e=0,f=c.length;f>e&&(d=c[e],d=d.func.apply(d.obj,[b]),!(void 0!=d&&0==d));e++);return this.fallThrough||OpenLayers.Event.stop(b,!0),d}},handleBrowserEvent:function(a){var b=a.type,c=this.listeners[b];if(c&&0!=c.length){if((c=a.touches)&&c[0]){for(var d,e=0,f=0,g=c.length,h=0;g>h;++h)d=c[h],e+=d.clientX,f+=d.clientY;a.clientX=e/g,a.clientY=f/g}this.includeXY&&(a.xy=this.getMousePosition(a)),this.triggerEvent(b,a)}},clearMouseCache:function(){this.element.scrolls=null,this.element.lefttop=null;var a=document.body;a&&(0==a.scrollTop&&0==a.scrollLeft||!navigator.userAgent.match(/iPhone/i))&&(this.element.offsets=null)},getMousePosition:function(a){if(this.includeXY?this.element.hasScrollEvent||(OpenLayers.Event.observe(window,"scroll",this.clearMouseListener),this.element.hasScrollEvent=!0):this.clearMouseCache(),!this.element.scrolls){var b=OpenLayers.Util.getViewportElement();this.element.scrolls=[b.scrollLeft,b.scrollTop]}return this.element.lefttop||(this.element.lefttop=[document.documentElement.clientLeft||0,document.documentElement.clientTop||0]),this.element.offsets||(this.element.offsets=OpenLayers.Util.pagePosition(this.element)),new OpenLayers.Pixel(a.clientX+this.element.scrolls[0]-this.element.offsets[0]-this.element.lefttop[0],a.clientY+this.element.scrolls[1]-this.element.offsets[1]-this.element.lefttop[1])},CLASS_NAME:"OpenLayers.Events"}),OpenLayers.Events.buttonclick=OpenLayers.Class({target:null,events:"mousedown mouseup click dblclick touchstart touchmove touchend keydown".split(" "),startRegEx:/^mousedown|touchstart$/,cancelRegEx:/^touchmove$/,completeRegEx:/^mouseup|touchend$/,initialize:function(a){for(this.target=a,a=this.events.length-1;a>=0;--a)this.target.register(this.events[a],this,this.buttonClick,{extension:!0})},destroy:function(){for(var a=this.events.length-1;a>=0;--a)this.target.unregister(this.events[a],this,this.buttonClick);delete this.target},getPressedButton:function(a){var b,c=3;do{if(OpenLayers.Element.hasClass(a,"olButton")){b=a;break}a=a.parentNode}while(0<--c&&a);return b},buttonClick:function(a){var b=!0,c=OpenLayers.Event.element(a);if(c&&(OpenLayers.Event.isLeftClick(a)||!~a.type.indexOf("mouse")))if(c=this.getPressedButton(c)){if("keydown"===a.type)switch(a.keyCode){case OpenLayers.Event.KEY_RETURN:case OpenLayers.Event.KEY_SPACE:this.target.triggerEvent("buttonclick",{buttonElement:c}),OpenLayers.Event.stop(a),b=!1}else this.startEvt&&(this.completeRegEx.test(a.type)&&(b=OpenLayers.Util.pagePosition(c),this.target.triggerEvent("buttonclick",{buttonElement:c,buttonXY:{x:this.startEvt.clientX-b[0],y:this.startEvt.clientY-b[1]}})),this.cancelRegEx.test(a.type)&&delete this.startEvt,OpenLayers.Event.stop(a),b=!1);this.startRegEx.test(a.type)&&(this.startEvt=a,OpenLayers.Event.stop(a),b=!1)}else delete this.startEvt;return b}}),OpenLayers.Control.OverviewMap=OpenLayers.Class(OpenLayers.Control,{element:null,ovmap:null,size:{w:180,h:90},layers:null,minRectSize:15,minRectDisplayClass:"RectReplacement",minRatio:8,maxRatio:32,mapOptions:null,autoPan:!1,handlers:null,resolutionFactor:1,maximized:!1,initialize:function(a){this.layers=[],this.handlers={},OpenLayers.Control.prototype.initialize.apply(this,[a])},destroy:function(){this.mapDiv&&(this.handlers.click&&this.handlers.click.destroy(),this.handlers.drag&&this.handlers.drag.destroy(),this.ovmap&&this.ovmap.viewPortDiv.removeChild(this.extentRectangle),this.extentRectangle=null,this.rectEvents&&(this.rectEvents.destroy(),this.rectEvents=null),this.ovmap&&(this.ovmap.destroy(),this.ovmap=null),this.element.removeChild(this.mapDiv),this.mapDiv=null,this.div.removeChild(this.element),this.element=null,this.maximizeDiv&&(this.div.removeChild(this.maximizeDiv),this.maximizeDiv=null),this.minimizeDiv&&(this.div.removeChild(this.minimizeDiv),this.minimizeDiv=null),this.map.events.un({buttonclick:this.onButtonClick,moveend:this.update,changebaselayer:this.baseLayerDraw,scope:this}),OpenLayers.Control.prototype.destroy.apply(this,arguments))},draw:function(){if(OpenLayers.Control.prototype.draw.apply(this,arguments),0===this.layers.length){if(!this.map.baseLayer)return this.map.events.register("changebaselayer",this,this.baseLayerDraw),this.div;this.layers=[this.map.baseLayer.clone()]}if(this.element=document.createElement("div"),this.element.className=this.displayClass+"Element",this.element.style.display="none",this.mapDiv=document.createElement("div"),this.mapDiv.style.width=this.size.w+"px",this.mapDiv.style.height=this.size.h+"px",this.mapDiv.style.position="relative",this.mapDiv.style.overflow="hidden",this.mapDiv.id=OpenLayers.Util.createUniqueID("overviewMap"),this.extentRectangle=document.createElement("div"),this.extentRectangle.style.position="absolute",this.extentRectangle.style.zIndex=1e3,this.extentRectangle.className=this.displayClass+"ExtentRectangle",this.element.appendChild(this.mapDiv),this.div.appendChild(this.element),this.outsideViewport)this.element.style.display="";else{this.div.className+=" "+this.displayClass+"Container";var a=OpenLayers.Util.getImageLocation("layer-switcher-maximize.png");this.maximizeDiv=OpenLayers.Util.createAlphaImageDiv(this.displayClass+"MaximizeButton",null,null,a,"absolute"),this.maximizeDiv.style.display="none",this.maximizeDiv.className=this.displayClass+"MaximizeButton olButton",this.div.appendChild(this.maximizeDiv),a=OpenLayers.Util.getImageLocation("layer-switcher-minimize.png"),this.minimizeDiv=OpenLayers.Util.createAlphaImageDiv("OpenLayers_Control_minimizeDiv",null,null,a,"absolute"),this.minimizeDiv.style.display="none",this.minimizeDiv.className=this.displayClass+"MinimizeButton olButton",this.div.appendChild(this.minimizeDiv),this.minimizeControl()}return this.map.getExtent()&&this.update(),this.map.events.on({buttonclick:this.onButtonClick,moveend:this.update,scope:this}),this.maximized&&this.maximizeControl(),this.div},baseLayerDraw:function(){this.draw(),this.map.events.unregister("changebaselayer",this,this.baseLayerDraw)},rectDrag:function(a){var b=this.handlers.drag.last.x-a.x,c=this.handlers.drag.last.y-a.y;if(0!=b||0!=c){var d=this.rectPxBounds.top,e=this.rectPxBounds.left,a=Math.abs(this.rectPxBounds.getHeight()),f=this.rectPxBounds.getWidth(),c=Math.max(0,d-c),c=Math.min(c,this.ovmap.size.h-this.hComp-a),b=Math.max(0,e-b),b=Math.min(b,this.ovmap.size.w-this.wComp-f);this.setRectPxBounds(new OpenLayers.Bounds(b,c+a,b+f,c))}},mapDivClick:function(a){var b=this.rectPxBounds.getCenterPixel(),c=a.xy.x-b.x,d=a.xy.y-b.y,e=this.rectPxBounds.top,f=this.rectPxBounds.left,a=Math.abs(this.rectPxBounds.getHeight()),b=this.rectPxBounds.getWidth(),d=Math.max(0,e+d),d=Math.min(d,this.ovmap.size.h-a),c=Math.max(0,f+c),c=Math.min(c,this.ovmap.size.w-b);this.setRectPxBounds(new OpenLayers.Bounds(c,d+a,c+b,d)),this.updateMapToRect()},onButtonClick:function(a){a.buttonElement===this.minimizeDiv?this.minimizeControl():a.buttonElement===this.maximizeDiv&&this.maximizeControl()},maximizeControl:function(a){this.element.style.display="",this.showToggle(!1),null!=a&&OpenLayers.Event.stop(a)},minimizeControl:function(a){this.element.style.display="none",this.showToggle(!0),null!=a&&OpenLayers.Event.stop(a)},showToggle:function(a){this.maximizeDiv.style.display=a?"":"none",this.minimizeDiv.style.display=a?"none":""},update:function(){null==this.ovmap&&this.createMap(),(this.autoPan||!this.isSuitableOverview())&&this.updateOverview(),this.updateRectToMap()},isSuitableOverview:function(){var a=this.map.getExtent(),b=this.map.maxExtent,a=new OpenLayers.Bounds(Math.max(a.left,b.left),Math.max(a.bottom,b.bottom),Math.min(a.right,b.right),Math.min(a.top,b.top));return this.ovmap.getProjection()!=this.map.getProjection()&&(a=a.transform(this.map.getProjectionObject(),this.ovmap.getProjectionObject())),b=this.ovmap.getResolution()/this.map.getResolution(),b>this.minRatio&&b<=this.maxRatio&&this.ovmap.getExtent().containsBounds(a)},updateOverview:function(){var a=this.map.getResolution(),b=this.ovmap.getResolution(),c=b/a;c>this.maxRatio?b=this.minRatio*a:c<=this.minRatio&&(b=this.maxRatio*a),this.ovmap.getProjection()!=this.map.getProjection()?(a=this.map.center.clone(),a.transform(this.map.getProjectionObject(),this.ovmap.getProjectionObject())):a=this.map.center,this.ovmap.setCenter(a,this.ovmap.getZoomForResolution(b*this.resolutionFactor)),this.updateRectToMap()},createMap:function(){var a=OpenLayers.Util.extend({controls:[],maxResolution:"auto",fallThrough:!1},this.mapOptions);if(this.ovmap=new OpenLayers.Map(this.mapDiv,a),this.ovmap.viewPortDiv.appendChild(this.extentRectangle),OpenLayers.Event.stopObserving(window,"unload",this.ovmap.unloadDestroy),this.ovmap.addLayers(this.layers),this.ovmap.zoomToMaxExtent(),this.wComp=(this.wComp=parseInt(OpenLayers.Element.getStyle(this.extentRectangle,"border-left-width"))+parseInt(OpenLayers.Element.getStyle(this.extentRectangle,"border-right-width")))?this.wComp:2,this.hComp=(this.hComp=parseInt(OpenLayers.Element.getStyle(this.extentRectangle,"border-top-width"))+parseInt(OpenLayers.Element.getStyle(this.extentRectangle,"border-bottom-width")))?this.hComp:2,this.handlers.drag=new OpenLayers.Handler.Drag(this,{move:this.rectDrag,done:this.updateMapToRect},{map:this.ovmap}),this.handlers.click=new OpenLayers.Handler.Click(this,{click:this.mapDivClick},{single:!0,"double":!1,stopSingle:!0,stopDouble:!0,pixelTolerance:1,map:this.ovmap}),this.handlers.click.activate(),this.rectEvents=new OpenLayers.Events(this,this.extentRectangle,null,!0),this.rectEvents.register("mouseover",this,function(){!this.handlers.drag.active&&!this.map.dragging&&this.handlers.drag.activate()}),this.rectEvents.register("mouseout",this,function(){this.handlers.drag.dragging||this.handlers.drag.deactivate()}),this.ovmap.getProjection()!=this.map.getProjection()){var a=this.map.getProjectionObject().getUnits()||this.map.units||this.map.baseLayer.units,b=this.ovmap.getProjectionObject().getUnits()||this.ovmap.units||this.ovmap.baseLayer.units;this.resolutionFactor=a&&b?OpenLayers.INCHES_PER_UNIT[a]/OpenLayers.INCHES_PER_UNIT[b]:1}},updateRectToMap:function(){var a=this.getRectBoundsFromMapBounds(this.ovmap.getProjection()!=this.map.getProjection()?this.map.getExtent().transform(this.map.getProjectionObject(),this.ovmap.getProjectionObject()):this.map.getExtent());a&&this.setRectPxBounds(a)},updateMapToRect:function(){var a=this.getMapBoundsFromRectBounds(this.rectPxBounds);this.ovmap.getProjection()!=this.map.getProjection()&&(a=a.transform(this.ovmap.getProjectionObject(),this.map.getProjectionObject())),this.map.panTo(a.getCenterLonLat())},setRectPxBounds:function(a){var b=Math.max(a.top,0),c=Math.max(a.left,0),d=Math.min(a.top+Math.abs(a.getHeight()),this.ovmap.size.h-this.hComp),a=Math.min(a.left+a.getWidth(),this.ovmap.size.w-this.wComp),e=Math.max(a-c,0),f=Math.max(d-b,0);e<this.minRectSize||f<this.minRectSize?(this.extentRectangle.className=this.displayClass+this.minRectDisplayClass,e=c+e/2-this.minRectSize/2,this.extentRectangle.style.top=Math.round(b+f/2-this.minRectSize/2)+"px",this.extentRectangle.style.left=Math.round(e)+"px",this.extentRectangle.style.height=this.minRectSize+"px",this.extentRectangle.style.width=this.minRectSize+"px"):(this.extentRectangle.className=this.displayClass+"ExtentRectangle",this.extentRectangle.style.top=Math.round(b)+"px",this.extentRectangle.style.left=Math.round(c)+"px",this.extentRectangle.style.height=Math.round(f)+"px",this.extentRectangle.style.width=Math.round(e)+"px"),this.rectPxBounds=new OpenLayers.Bounds(Math.round(c),Math.round(d),Math.round(a),Math.round(b))},getRectBoundsFromMapBounds:function(a){var b=this.getOverviewPxFromLonLat({lon:a.left,lat:a.bottom}),a=this.getOverviewPxFromLonLat({lon:a.right,lat:a.top}),c=null;return b&&a&&(c=new OpenLayers.Bounds(b.x,b.y,a.x,a.y)),c},getMapBoundsFromRectBounds:function(a){var b=this.getLonLatFromOverviewPx({x:a.left,y:a.bottom}),a=this.getLonLatFromOverviewPx({x:a.right,y:a.top});return new OpenLayers.Bounds(b.lon,b.lat,a.lon,a.lat)},getLonLatFromOverviewPx:function(a){var b=this.ovmap.size,c=this.ovmap.getResolution(),d=this.ovmap.getExtent().getCenterLonLat();return{lon:d.lon+(a.x-b.w/2)*c,lat:d.lat-(a.y-b.h/2)*c}},getOverviewPxFromLonLat:function(a){var b=this.ovmap.getResolution(),c=this.ovmap.getExtent();return c?{x:Math.round(1/b*(a.lon-c.left)),y:Math.round(1/b*(c.top-a.lat))}:void 0},CLASS_NAME:"OpenLayers.Control.OverviewMap"}),OpenLayers.Animation=function(a){var b=!!(a.requestAnimationFrame||a.webkitRequestAnimationFrame||a.mozRequestAnimationFrame||a.oRequestAnimationFrame||a.msRequestAnimationFrame),c=function(){var b=a.requestAnimationFrame||a.webkitRequestAnimationFrame||a.mozRequestAnimationFrame||a.oRequestAnimationFrame||a.msRequestAnimationFrame||function(b){a.setTimeout(b,16)};return function(c,d){b.apply(a,[c,d])}}(),d=0,e={};return{isNative:b,requestFrame:c,start:function(a,b,f){var b=b>0?b:Number.POSITIVE_INFINITY,g=++d,h=+new Date;return e[g]=function(){e[g]&&+new Date-h<=b?(a(),e[g]&&c(e[g],f)):delete e[g]},c(e[g],f),g},stop:function(a){delete e[a]}}}(window),OpenLayers.Tween=OpenLayers.Class({easing:null,begin:null,finish:null,duration:null,callbacks:null,time:null,animationId:null,playing:!1,initialize:function(a){this.easing=a?a:OpenLayers.Easing.Expo.easeOut},start:function(a,b,c,d){this.playing=!0,this.begin=a,this.finish=b,this.duration=c,this.callbacks=d.callbacks,this.time=0,OpenLayers.Animation.stop(this.animationId),this.animationId=null,this.callbacks&&this.callbacks.start&&this.callbacks.start.call(this,this.begin),this.animationId=OpenLayers.Animation.start(OpenLayers.Function.bind(this.play,this))},stop:function(){this.playing&&(this.callbacks&&this.callbacks.done&&this.callbacks.done.call(this,this.finish),OpenLayers.Animation.stop(this.animationId),this.animationId=null,this.playing=!1)},play:function(){var a,b={};for(a in this.begin){var c=this.begin[a],d=this.finish[a];if(null==c||null==d||isNaN(c)||isNaN(d))throw new TypeError("invalid value for Tween");b[a]=this.easing.apply(this,[this.time,c,d-c,this.duration])}this.time++,this.callbacks&&this.callbacks.eachStep&&this.callbacks.eachStep.call(this,b),this.time>this.duration&&this.stop()},CLASS_NAME:"OpenLayers.Tween"}),OpenLayers.Easing={CLASS_NAME:"OpenLayers.Easing"},OpenLayers.Easing.Linear={easeIn:function(a,b,c,d){return c*a/d+b},easeOut:function(a,b,c,d){return c*a/d+b},easeInOut:function(a,b,c,d){return c*a/d+b},CLASS_NAME:"OpenLayers.Easing.Linear"},OpenLayers.Easing.Expo={easeIn:function(a,b,c,d){return 0==a?b:c*Math.pow(2,10*(a/d-1))+b},easeOut:function(a,b,c,d){return a==d?b+c:c*(-Math.pow(2,-10*a/d)+1)+b},easeInOut:function(a,b,c,d){return 0==a?b:a==d?b+c:1>(a/=d/2)?c/2*Math.pow(2,10*(a-1))+b:c/2*(-Math.pow(2,-10*--a)+2)+b},CLASS_NAME:"OpenLayers.Easing.Expo"},OpenLayers.Easing.Quad={easeIn:function(a,b,c,d){return c*(a/=d)*a+b},easeOut:function(a,b,c,d){return-c*(a/=d)*(a-2)+b},easeInOut:function(a,b,c,d){return 1>(a/=d/2)?c/2*a*a+b:-c/2*(--a*(a-2)-1)+b},CLASS_NAME:"OpenLayers.Easing.Quad"},OpenLayers.Projection=OpenLayers.Class({proj:null,projCode:null,titleRegEx:/\+title=[^\+]*/,initialize:function(a,b){OpenLayers.Util.extend(this,b),this.projCode=a,window.Proj4js&&(this.proj=new Proj4js.Proj(a))},getCode:function(){return this.proj?this.proj.srsCode:this.projCode},getUnits:function(){return this.proj?this.proj.units:null},toString:function(){return this.getCode()},equals:function(a){var b=!1;return a&&(a instanceof OpenLayers.Projection||(a=new OpenLayers.Projection(a)),window.Proj4js&&this.proj.defData&&a.proj.defData?b=this.proj.defData.replace(this.titleRegEx,"")==a.proj.defData.replace(this.titleRegEx,""):a.getCode&&(b=this.getCode(),a=a.getCode(),b=b==a||!!OpenLayers.Projection.transforms[b]&&OpenLayers.Projection.transforms[b][a]===OpenLayers.Projection.nullTransform)),b},destroy:function(){delete this.proj,delete this.projCode},CLASS_NAME:"OpenLayers.Projection"}),OpenLayers.Projection.transforms={},OpenLayers.Projection.defaults={"EPSG:4326":{units:"degrees",maxExtent:[-180,-90,180,90],yx:!0},"CRS:84":{units:"degrees",maxExtent:[-180,-90,180,90]},"EPSG:900913":{units:"m",maxExtent:[-20037508.34,-20037508.34,20037508.34,20037508.34]}},OpenLayers.Projection.addTransform=function(a,b,c){if(c===OpenLayers.Projection.nullTransform){var d=OpenLayers.Projection.defaults[a];d&&!OpenLayers.Projection.defaults[b]&&(OpenLayers.Projection.defaults[b]=d)}OpenLayers.Projection.transforms[a]||(OpenLayers.Projection.transforms[a]={}),OpenLayers.Projection.transforms[a][b]=c},OpenLayers.Projection.transform=function(a,b,c){if(b&&c)if(b instanceof OpenLayers.Projection||(b=new OpenLayers.Projection(b)),c instanceof OpenLayers.Projection||(c=new OpenLayers.Projection(c)),b.proj&&c.proj)a=Proj4js.transform(b.proj,c.proj,a);else{var b=b.getCode(),c=c.getCode(),d=OpenLayers.Projection.transforms;d[b]&&d[b][c]&&d[b][c](a)}return a},OpenLayers.Projection.nullTransform=function(a){return a},function(){function a(a){return a.x=180*a.x/e,a.y=180/Math.PI*(2*Math.atan(Math.exp(a.y/e*Math.PI))-Math.PI/2),a}function b(a){return a.x=a.x*e/180,a.y=Math.log(Math.tan((90+a.y)*Math.PI/360))/Math.PI*e,a}function c(c,d){var e,f,g,h,i,j=OpenLayers.Projection.addTransform,k=OpenLayers.Projection.nullTransform;for(e=0,f=d.length;f>e;++e)for(g=d[e],j(c,g,b),j(g,c,a),i=e+1;f>i;++i)h=d[i],j(g,h,k),j(h,g,k)}var d,e=20037508.34,f=["EPSG:900913","EPSG:3857","EPSG:102113","EPSG:102100"],g=["CRS:84","urn:ogc:def:crs:EPSG:6.6:4326","EPSG:4326"];for(d=f.length-1;d>=0;--d)c(f[d],g);for(d=g.length-1;d>=0;--d)c(g[d],f)}(),OpenLayers.Map=OpenLayers.Class({Z_INDEX_BASE:{BaseLayer:100,Overlay:325,Feature:725,Popup:750,Control:1e3},id:null,fractionalZoom:!1,events:null,allOverlays:!1,div:null,dragging:!1,size:null,viewPortDiv:null,layerContainerOrigin:null,layerContainerDiv:null,layers:null,controls:null,popups:null,baseLayer:null,center:null,resolution:null,zoom:0,panRatio:1.5,options:null,tileSize:null,projection:"EPSG:4326",units:null,resolutions:null,maxResolution:null,minResolution:null,maxScale:null,minScale:null,maxExtent:null,minExtent:null,restrictedExtent:null,numZoomLevels:16,theme:null,displayProjection:null,fallThrough:!0,panTween:null,eventListeners:null,panMethod:OpenLayers.Easing.Expo.easeOut,panDuration:50,paddingForPopups:null,minPx:null,maxPx:null,initialize:function(a,b){1===arguments.length&&"object"==typeof a&&(a=(b=a)&&b.div),this.tileSize=new OpenLayers.Size(OpenLayers.Map.TILE_WIDTH,OpenLayers.Map.TILE_HEIGHT),this.paddingForPopups=new OpenLayers.Bounds(15,15,15,15),this.theme="/js/openlayers/theme/default/style.css",this.options=OpenLayers.Util.extend({},b),OpenLayers.Util.extend(this,b),OpenLayers.Util.applyDefaults(this,OpenLayers.Projection.defaults[this.projection instanceof OpenLayers.Projection?this.projection.projCode:this.projection]),this.maxExtent&&!(this.maxExtent instanceof OpenLayers.Bounds)&&(this.maxExtent=new OpenLayers.Bounds(this.maxExtent)),this.minExtent&&!(this.minExtent instanceof OpenLayers.Bounds)&&(this.minExtent=new OpenLayers.Bounds(this.minExtent)),this.restrictedExtent&&!(this.restrictedExtent instanceof OpenLayers.Bounds)&&(this.restrictedExtent=new OpenLayers.Bounds(this.restrictedExtent)),this.center&&!(this.center instanceof OpenLayers.LonLat)&&(this.center=new OpenLayers.LonLat(this.center)),this.layers=[],this.id=OpenLayers.Util.createUniqueID("OpenLayers.Map_"),this.div=OpenLayers.Util.getElement(a),this.div||(this.div=document.createElement("div"),this.div.style.height="1px",this.div.style.width="1px"),OpenLayers.Element.addClass(this.div,"olMap");
var c=this.id+"_OpenLayers_ViewPort";if(this.viewPortDiv=OpenLayers.Util.createDiv(c,null,null,null,"relative",null,"hidden"),this.viewPortDiv.style.width="100%",this.viewPortDiv.style.height="100%",this.viewPortDiv.className="olMapViewport",this.div.appendChild(this.viewPortDiv),this.events=new OpenLayers.Events(this,this.viewPortDiv,null,this.fallThrough,{includeXY:!0}),c=this.id+"_OpenLayers_Container",this.layerContainerDiv=OpenLayers.Util.createDiv(c),this.layerContainerDiv.style.width="100px",this.layerContainerDiv.style.height="100px",this.layerContainerDiv.style.zIndex=this.Z_INDEX_BASE.Popup-1,this.viewPortDiv.appendChild(this.layerContainerDiv),this.updateSize(),this.eventListeners instanceof Object&&this.events.on(this.eventListeners),9>parseFloat(navigator.appVersion.split("MSIE")[1])?this.events.register("resize",this,this.updateSize):(this.updateSizeDestroy=OpenLayers.Function.bind(this.updateSize,this),OpenLayers.Event.observe(window,"resize",this.updateSizeDestroy)),this.theme){for(var c=!0,d=document.getElementsByTagName("link"),e=0,f=d.length;f>e;++e)if(OpenLayers.Util.isEquivalentUrl(d.item(e).href,this.theme)){c=!1;break}c&&(c=document.createElement("link"),c.setAttribute("rel","stylesheet"),c.setAttribute("type","text/css"),c.setAttribute("href",this.theme),document.getElementsByTagName("head")[0].appendChild(c))}for(null==this.controls&&(this.controls=[],null!=OpenLayers.Control&&(OpenLayers.Control.Navigation?this.controls.push(new OpenLayers.Control.Navigation):OpenLayers.Control.TouchNavigation&&this.controls.push(new OpenLayers.Control.TouchNavigation),OpenLayers.Control.Zoom?this.controls.push(new OpenLayers.Control.Zoom):OpenLayers.Control.PanZoom&&this.controls.push(new OpenLayers.Control.PanZoom),OpenLayers.Control.ArgParser&&this.controls.push(new OpenLayers.Control.ArgParser),OpenLayers.Control.Attribution&&this.controls.push(new OpenLayers.Control.Attribution))),e=0,f=this.controls.length;f>e;e++)this.addControlToMap(this.controls[e]);this.popups=[],this.unloadDestroy=OpenLayers.Function.bind(this.destroy,this),OpenLayers.Event.observe(window,"unload",this.unloadDestroy),b&&b.layers&&(delete this.center,this.addLayers(b.layers),b.center&&!this.getCenter()&&this.setCenter(b.center,b.zoom))},getViewport:function(){return this.viewPortDiv},render:function(a){this.div=OpenLayers.Util.getElement(a),OpenLayers.Element.addClass(this.div,"olMap"),this.viewPortDiv.parentNode.removeChild(this.viewPortDiv),this.div.appendChild(this.viewPortDiv),this.updateSize()},unloadDestroy:null,updateSizeDestroy:null,destroy:function(){if(!this.unloadDestroy)return!1;if(this.panTween&&(this.panTween.stop(),this.panTween=null),OpenLayers.Event.stopObserving(window,"unload",this.unloadDestroy),this.unloadDestroy=null,this.updateSizeDestroy?OpenLayers.Event.stopObserving(window,"resize",this.updateSizeDestroy):this.events.unregister("resize",this,this.updateSize),this.paddingForPopups=null,null!=this.controls){for(var a=this.controls.length-1;a>=0;--a)this.controls[a].destroy();this.controls=null}if(null!=this.layers){for(a=this.layers.length-1;a>=0;--a)this.layers[a].destroy(!1);this.layers=null}this.viewPortDiv&&this.div.removeChild(this.viewPortDiv),this.viewPortDiv=null,this.eventListeners&&(this.events.un(this.eventListeners),this.eventListeners=null),this.events.destroy(),this.options=this.events=null},setOptions:function(a){var b=this.minPx&&a.restrictedExtent!=this.restrictedExtent;OpenLayers.Util.extend(this,a),b&&this.moveTo(this.getCachedCenter(),this.zoom,{forceZoomChange:!0})},getTileSize:function(){return this.tileSize},getBy:function(a,b,c){var d="function"==typeof c.test;return OpenLayers.Array.filter(this[a],function(a){return a[b]==c||d&&c.test(a[b])})},getLayersBy:function(a,b){return this.getBy("layers",a,b)},getLayersByName:function(a){return this.getLayersBy("name",a)},getLayersByClass:function(a){return this.getLayersBy("CLASS_NAME",a)},getControlsBy:function(a,b){return this.getBy("controls",a,b)},getControlsByClass:function(a){return this.getControlsBy("CLASS_NAME",a)},getLayer:function(a){for(var b=null,c=0,d=this.layers.length;d>c;c++){var e=this.layers[c];if(e.id==a){b=e;break}}return b},setLayerZIndex:function(a,b){a.setZIndex(this.Z_INDEX_BASE[a.isBaseLayer?"BaseLayer":"Overlay"]+5*b)},resetLayersZIndex:function(){for(var a=0,b=this.layers.length;b>a;a++)this.setLayerZIndex(this.layers[a],a)},addLayer:function(a){for(var b=0,c=this.layers.length;c>b;b++)if(this.layers[b]==a)return!1;return!1===this.events.triggerEvent("preaddlayer",{layer:a})?!1:(this.allOverlays&&(a.isBaseLayer=!1),a.div.className="olLayerDiv",a.div.style.overflow="",this.setLayerZIndex(a,this.layers.length),a.isFixed?this.viewPortDiv.appendChild(a.div):this.layerContainerDiv.appendChild(a.div),this.layers.push(a),a.setMap(this),a.isBaseLayer||this.allOverlays&&!this.baseLayer?null==this.baseLayer?this.setBaseLayer(a):a.setVisibility(!1):a.redraw(),this.events.triggerEvent("addlayer",{layer:a}),a.events.triggerEvent("added",{map:this,layer:a}),a.afterAdd(),!0)},addLayers:function(a){for(var b=0,c=a.length;c>b;b++)this.addLayer(a[b])},removeLayer:function(a,b){if(!1!==this.events.triggerEvent("preremovelayer",{layer:a})){if(null==b&&(b=!0),a.isFixed?this.viewPortDiv.removeChild(a.div):this.layerContainerDiv.removeChild(a.div),OpenLayers.Util.removeItem(this.layers,a),a.removeMap(this),a.map=null,this.baseLayer==a&&(this.baseLayer=null,b))for(var c=0,d=this.layers.length;d>c;c++){var e=this.layers[c];if(e.isBaseLayer||this.allOverlays){this.setBaseLayer(e);break}}this.resetLayersZIndex(),this.events.triggerEvent("removelayer",{layer:a}),a.events.triggerEvent("removed",{map:this,layer:a})}},getNumLayers:function(){return this.layers.length},getLayerIndex:function(a){return OpenLayers.Util.indexOf(this.layers,a)},setLayerIndex:function(a,b){var c=this.getLayerIndex(a);if(0>b?b=0:b>this.layers.length&&(b=this.layers.length),c!=b){this.layers.splice(c,1),this.layers.splice(b,0,a);for(var c=0,d=this.layers.length;d>c;c++)this.setLayerZIndex(this.layers[c],c);this.events.triggerEvent("changelayer",{layer:a,property:"order"}),this.allOverlays&&(0===b?this.setBaseLayer(a):this.baseLayer!==this.layers[0]&&this.setBaseLayer(this.layers[0]))}},raiseLayer:function(a,b){var c=this.getLayerIndex(a)+b;this.setLayerIndex(a,c)},setBaseLayer:function(a){if(a!=this.baseLayer&&-1!=OpenLayers.Util.indexOf(this.layers,a)){var b=this.getCachedCenter(),c=OpenLayers.Util.getResolutionFromScale(this.getScale(),a.units);null!=this.baseLayer&&!this.allOverlays&&this.baseLayer.setVisibility(!1),this.baseLayer=a,(!this.allOverlays||this.baseLayer.visibility)&&(this.baseLayer.setVisibility(!0),!1===this.baseLayer.inRange&&this.baseLayer.redraw()),null!=b&&(a=this.getZoomForResolution(c||this.resolution,!0),this.setCenter(b,a,!1,!0)),this.events.triggerEvent("changebaselayer",{layer:this.baseLayer})}},addControl:function(a,b){this.controls.push(a),this.addControlToMap(a,b)},addControls:function(a,b){for(var c=1===arguments.length?[]:b,d=0,e=a.length;e>d;d++)this.addControl(a[d],c[d]?c[d]:null)},addControlToMap:function(a,b){a.outsideViewport=null!=a.div,this.displayProjection&&!a.displayProjection&&(a.displayProjection=this.displayProjection),a.setMap(this);var c=a.draw(b);c&&!a.outsideViewport&&(c.style.zIndex=this.Z_INDEX_BASE.Control+this.controls.length,this.viewPortDiv.appendChild(c)),a.autoActivate&&a.activate()},getControl:function(a){for(var b=null,c=0,d=this.controls.length;d>c;c++){var e=this.controls[c];if(e.id==a){b=e;break}}return b},removeControl:function(a){a&&a==this.getControl(a.id)&&(a.div&&a.div.parentNode==this.viewPortDiv&&this.viewPortDiv.removeChild(a.div),OpenLayers.Util.removeItem(this.controls,a))},addPopup:function(a,b){if(b)for(var c=this.popups.length-1;c>=0;--c)this.removePopup(this.popups[c]);a.map=this,this.popups.push(a),(c=a.draw())&&(c.style.zIndex=this.Z_INDEX_BASE.Popup+this.popups.length,this.layerContainerDiv.appendChild(c))},removePopup:function(a){if(OpenLayers.Util.removeItem(this.popups,a),a.div)try{this.layerContainerDiv.removeChild(a.div)}catch(b){}a.map=null},getSize:function(){var a=null;return null!=this.size&&(a=this.size.clone()),a},updateSize:function(){var a=this.getCurrentSize();if(a&&!isNaN(a.h)&&!isNaN(a.w)){this.events.clearMouseCache();var b=this.getSize();if(null==b&&(this.size=b=a),!a.equals(b)){for(this.size=a,a=0,b=this.layers.length;b>a;a++)this.layers[a].onMapResize();a=this.getCachedCenter(),null!=this.baseLayer&&null!=a&&(b=this.getZoom(),this.zoom=null,this.setCenter(a,b))}}},getCurrentSize:function(){var a=new OpenLayers.Size(this.div.clientWidth,this.div.clientHeight);return(0==a.w&&0==a.h||isNaN(a.w)&&isNaN(a.h))&&(a.w=this.div.offsetWidth,a.h=this.div.offsetHeight),(0==a.w&&0==a.h||isNaN(a.w)&&isNaN(a.h))&&(a.w=parseInt(this.div.style.width),a.h=parseInt(this.div.style.height)),a},calculateBounds:function(a,b){var c=null;if(null==a&&(a=this.getCachedCenter()),null==b&&(b=this.getResolution()),null!=a&&null!=b)var c=this.size.w*b/2,d=this.size.h*b/2,c=new OpenLayers.Bounds(a.lon-c,a.lat-d,a.lon+c,a.lat+d);return c},getCenter:function(){var a=null,b=this.getCachedCenter();return b&&(a=b.clone()),a},getCachedCenter:function(){return!this.center&&this.size&&(this.center=this.getLonLatFromViewPortPx({x:this.size.w/2,y:this.size.h/2})),this.center},getZoom:function(){return this.zoom},pan:function(a,b,c){if(c=OpenLayers.Util.applyDefaults(c,{animate:!0,dragging:!1}),c.dragging)(0!=a||0!=b)&&this.moveByPx(a,b);else{var d=this.getViewPortPxFromLonLat(this.getCachedCenter()),a=d.add(a,b);(this.dragging||!a.equals(d))&&(d=this.getLonLatFromViewPortPx(a),c.animate?this.panTo(d):(this.moveTo(d),this.dragging&&(this.dragging=!1,this.events.triggerEvent("moveend"))))}},panTo:function(a){if(this.panMethod&&this.getExtent().scale(this.panRatio).containsLonLat(a)){this.panTween||(this.panTween=new OpenLayers.Tween(this.panMethod));var b=this.getCachedCenter();if(!a.equals(b)){var b=this.getPixelFromLonLat(b),c=this.getPixelFromLonLat(a),d=0,e=0;this.panTween.start({x:0,y:0},{x:c.x-b.x,y:c.y-b.y},this.panDuration,{callbacks:{eachStep:OpenLayers.Function.bind(function(a){this.moveByPx(a.x-d,a.y-e),d=Math.round(a.x),e=Math.round(a.y)},this),done:OpenLayers.Function.bind(function(){this.moveTo(a),this.dragging=!1,this.events.triggerEvent("moveend")},this)}})}}else this.setCenter(a)},setCenter:function(a,b,c,d){this.panTween&&this.panTween.stop(),this.moveTo(a,b,{dragging:c,forceZoomChange:d})},moveByPx:function(a,b){var c=this.size.w/2,d=this.size.h/2,e=c+a,f=d+b,g=this.baseLayer.wrapDateLine,h=0,i=0;if(this.restrictedExtent&&(h=c,i=d,g=!1),a=g||e<=this.maxPx.x-h&&e>=this.minPx.x+h?Math.round(a):0,b=f<=this.maxPx.y-i&&f>=this.minPx.y+i?Math.round(b):0,a||b){for(this.dragging||(this.dragging=!0,this.events.triggerEvent("movestart")),this.center=null,a&&(this.layerContainerDiv.style.left=parseInt(this.layerContainerDiv.style.left)-a+"px",this.minPx.x-=a,this.maxPx.x-=a),b&&(this.layerContainerDiv.style.top=parseInt(this.layerContainerDiv.style.top)-b+"px",this.minPx.y-=b,this.maxPx.y-=b),d=0,e=this.layers.length;e>d;++d)c=this.layers[d],c.visibility&&(c===this.baseLayer||c.inRange)&&(c.moveByPx(a,b),c.events.triggerEvent("move"));this.events.triggerEvent("move")}},adjustZoom:function(a){var b=this.baseLayer.resolutions,c=this.getMaxExtent().getWidth()/this.size.w;if(this.getResolutionForZoom(a)>c)for(var d=0|a,e=b.length;e>d;++d)if(b[d]<=c){a=d;break}return a},moveTo:function(a,b,c){if(null!=a&&!(a instanceof OpenLayers.LonLat)&&(a=new OpenLayers.LonLat(a)),c||(c={}),null!=b&&(b=parseFloat(b),this.fractionalZoom||(b=Math.round(b))),this.baseLayer.wrapDateLine){var d=b,b=this.adjustZoom(b);b!==d&&(a=this.getCenter())}var d=c.dragging||this.dragging,e=c.forceZoomChange;if(!this.getCachedCenter()&&!this.isValidLonLat(a)&&(a=this.maxExtent.getCenterLonLat(),this.center=a.clone()),null!=this.restrictedExtent){null==a&&(a=this.center),null==b&&(b=this.getZoom());var f=this.getResolutionForZoom(b),f=this.calculateBounds(a,f);if(!this.restrictedExtent.containsBounds(f)){var g=this.restrictedExtent.getCenterLonLat();f.getWidth()>this.restrictedExtent.getWidth()?a=new OpenLayers.LonLat(g.lon,a.lat):f.left<this.restrictedExtent.left?a=a.add(this.restrictedExtent.left-f.left,0):f.right>this.restrictedExtent.right&&(a=a.add(this.restrictedExtent.right-f.right,0)),f.getHeight()>this.restrictedExtent.getHeight()?a=new OpenLayers.LonLat(a.lon,g.lat):f.bottom<this.restrictedExtent.bottom?a=a.add(0,this.restrictedExtent.bottom-f.bottom):f.top>this.restrictedExtent.top&&(a=a.add(0,this.restrictedExtent.top-f.top))}}if(e=e||this.isValidZoomLevel(b)&&b!=this.getZoom(),f=this.isValidLonLat(a)&&!a.equals(this.center),e||f||d){if(d||this.events.triggerEvent("movestart"),f&&(!e&&this.center&&this.centerLayerContainer(a),this.center=a.clone()),a=e?this.getResolutionForZoom(b):this.getResolution(),e||null==this.layerContainerOrigin){this.layerContainerOrigin=this.getCachedCenter(),this.layerContainerDiv.style.left="0px",this.layerContainerDiv.style.top="0px";var f=this.getMaxExtent({restricted:!0}),h=f.getCenterLonLat(),g=this.center.lon-h.lon,h=h.lat-this.center.lat,i=Math.round(f.getWidth()/a),j=Math.round(f.getHeight()/a);this.minPx={x:(this.size.w-i)/2-g/a,y:(this.size.h-j)/2-h/a},this.maxPx={x:this.minPx.x+Math.round(f.getWidth()/a),y:this.minPx.y+Math.round(f.getHeight()/a)}}for(e&&(this.zoom=b,this.resolution=a),a=this.getExtent(),this.baseLayer.visibility&&(this.baseLayer.moveTo(a,e,c.dragging),c.dragging||this.baseLayer.events.triggerEvent("moveend",{zoomChanged:e})),a=this.baseLayer.getExtent(),b=this.layers.length-1;b>=0;--b)f=this.layers[b],f!==this.baseLayer&&!f.isBaseLayer&&(g=f.calculateInRange(),f.inRange!=g&&((f.inRange=g)||f.display(!1),this.events.triggerEvent("changelayer",{layer:f,property:"visibility"})),g&&f.visibility)&&(f.moveTo(a,e,c.dragging),c.dragging||f.events.triggerEvent("moveend",{zoomChanged:e}));if(this.events.triggerEvent("move"),d||this.events.triggerEvent("moveend"),e){for(b=0,c=this.popups.length;c>b;b++)this.popups[b].updatePosition();this.events.triggerEvent("zoomend")}}},centerLayerContainer:function(a){var b=this.getViewPortPxFromLonLat(this.layerContainerOrigin),c=this.getViewPortPxFromLonLat(a);if(null!=b&&null!=c){var d=parseInt(this.layerContainerDiv.style.left),a=parseInt(this.layerContainerDiv.style.top),e=Math.round(b.x-c.x),b=Math.round(b.y-c.y);this.layerContainerDiv.style.left=e+"px",this.layerContainerDiv.style.top=b+"px",d-=e,a-=b,this.minPx.x-=d,this.maxPx.x-=d,this.minPx.y-=a,this.maxPx.y-=a}},isValidZoomLevel:function(a){return null!=a&&a>=0&&a<this.getNumZoomLevels()},isValidLonLat:function(a){var b=!1;return null!=a&&(b=this.getMaxExtent(),b=b.containsLonLat(a,{worldBounds:this.baseLayer.wrapDateLine&&b})),b},getProjection:function(){var a=this.getProjectionObject();return a?a.getCode():null},getProjectionObject:function(){var a=null;return null!=this.baseLayer&&(a=this.baseLayer.projection),a},getMaxResolution:function(){var a=null;return null!=this.baseLayer&&(a=this.baseLayer.maxResolution),a},getMaxExtent:function(a){var b=null;return a&&a.restricted&&this.restrictedExtent?b=this.restrictedExtent:null!=this.baseLayer&&(b=this.baseLayer.maxExtent),b},getNumZoomLevels:function(){var a=null;return null!=this.baseLayer&&(a=this.baseLayer.numZoomLevels),a},getExtent:function(){var a=null;return null!=this.baseLayer&&(a=this.baseLayer.getExtent()),a},getResolution:function(){var a=null;return null!=this.baseLayer?a=this.baseLayer.getResolution():!0===this.allOverlays&&0<this.layers.length&&(a=this.layers[0].getResolution()),a},getUnits:function(){var a=null;return null!=this.baseLayer&&(a=this.baseLayer.units),a},getScale:function(){var a=null;return null!=this.baseLayer&&(a=this.getResolution(),a=OpenLayers.Util.getScaleFromResolution(a,this.baseLayer.units)),a},getZoomForExtent:function(a,b){var c=null;return null!=this.baseLayer&&(c=this.baseLayer.getZoomForExtent(a,b)),c},getResolutionForZoom:function(a){var b=null;return this.baseLayer&&(b=this.baseLayer.getResolutionForZoom(a)),b},getZoomForResolution:function(a,b){var c=null;return null!=this.baseLayer&&(c=this.baseLayer.getZoomForResolution(a,b)),c},zoomTo:function(a){this.isValidZoomLevel(a)&&this.setCenter(null,a)},zoomIn:function(){this.zoomTo(this.getZoom()+1)},zoomOut:function(){this.zoomTo(this.getZoom()-1)},zoomToExtent:function(a,b){a instanceof OpenLayers.Bounds||(a=new OpenLayers.Bounds(a));var c=a.getCenterLonLat();if(this.baseLayer.wrapDateLine){for(c=this.getMaxExtent(),a=a.clone();a.right<a.left;)a.right+=c.getWidth();c=a.getCenterLonLat().wrapDateLine(c)}this.setCenter(c,this.getZoomForExtent(a,b))},zoomToMaxExtent:function(a){this.zoomToExtent(this.getMaxExtent({restricted:a?a.restricted:!0}))},zoomToScale:function(a,b){var c=OpenLayers.Util.getResolutionFromScale(a,this.baseLayer.units),d=this.size.w*c/2,c=this.size.h*c/2,e=this.getCachedCenter();this.zoomToExtent(new OpenLayers.Bounds(e.lon-d,e.lat-c,e.lon+d,e.lat+c),b)},getLonLatFromViewPortPx:function(a){var b=null;return null!=this.baseLayer&&(b=this.baseLayer.getLonLatFromViewPortPx(a)),b},getViewPortPxFromLonLat:function(a){var b=null;return null!=this.baseLayer&&(b=this.baseLayer.getViewPortPxFromLonLat(a)),b},getLonLatFromPixel:function(a){return this.getLonLatFromViewPortPx(a)},getPixelFromLonLat:function(a){return a=this.getViewPortPxFromLonLat(a),a.x=Math.round(a.x),a.y=Math.round(a.y),a},getGeodesicPixelSize:function(a){var b=a?this.getLonLatFromPixel(a):this.getCachedCenter()||new OpenLayers.LonLat(0,0),c=this.getResolution(),a=b.add(-c/2,0),d=b.add(c/2,0),e=b.add(0,-c/2),b=b.add(0,c/2),c=new OpenLayers.Projection("EPSG:4326"),f=this.getProjectionObject()||c;return f.equals(c)||(a.transform(f,c),d.transform(f,c),e.transform(f,c),b.transform(f,c)),new OpenLayers.Size(OpenLayers.Util.distVincenty(a,d),OpenLayers.Util.distVincenty(e,b))},getViewPortPxFromLayerPx:function(a){var b=null;if(null!=a)var b=parseInt(this.layerContainerDiv.style.left),c=parseInt(this.layerContainerDiv.style.top),b=a.add(b,c);return b},getLayerPxFromViewPortPx:function(a){var b=null;if(null!=a){var b=-parseInt(this.layerContainerDiv.style.left),c=-parseInt(this.layerContainerDiv.style.top),b=a.add(b,c);(isNaN(b.x)||isNaN(b.y))&&(b=null)}return b},getLonLatFromLayerPx:function(a){return a=this.getViewPortPxFromLayerPx(a),this.getLonLatFromViewPortPx(a)},getLayerPxFromLonLat:function(a){return this.getLayerPxFromViewPortPx(this.getPixelFromLonLat(a))},CLASS_NAME:"OpenLayers.Map"}),OpenLayers.Map.TILE_WIDTH=256,OpenLayers.Map.TILE_HEIGHT=256,OpenLayers.Layer=OpenLayers.Class({id:null,name:null,div:null,opacity:1,alwaysInRange:null,RESOLUTION_PROPERTIES:"scales resolutions maxScale minScale maxResolution minResolution numZoomLevels maxZoomLevel".split(" "),events:null,map:null,isBaseLayer:!1,alpha:!1,displayInLayerSwitcher:!0,visibility:!0,attribution:null,inRange:!1,imageSize:null,options:null,eventListeners:null,gutter:0,projection:null,units:null,scales:null,resolutions:null,maxExtent:null,minExtent:null,maxResolution:null,minResolution:null,numZoomLevels:null,minScale:null,maxScale:null,displayOutsideMaxExtent:!1,wrapDateLine:!1,metadata:null,initialize:function(a,b){this.metadata={},this.addOptions(b),this.name=a,null==this.id&&(this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_"),this.div=OpenLayers.Util.createDiv(this.id),this.div.style.width="100%",this.div.style.height="100%",this.div.dir="ltr",this.events=new OpenLayers.Events(this,this.div),this.eventListeners instanceof Object)&&this.events.on(this.eventListeners)},destroy:function(a){null==a&&(a=!0),null!=this.map&&this.map.removeLayer(this,a),this.options=this.div=this.name=this.map=this.projection=null,this.events&&(this.eventListeners&&this.events.un(this.eventListeners),this.events.destroy()),this.events=this.eventListeners=null},clone:function(a){return null==a&&(a=new OpenLayers.Layer(this.name,this.getOptions())),OpenLayers.Util.applyDefaults(a,this),a.map=null,a},getOptions:function(){var a,b={};for(a in this.options)b[a]=this[a];return b},setName:function(a){a!=this.name&&(this.name=a,null!=this.map&&this.map.events.triggerEvent("changelayer",{layer:this,property:"name"}))},addOptions:function(a,b){if(null==this.options&&(this.options={}),!a||("string"==typeof a.projection&&(a.projection=new OpenLayers.Projection(a.projection)),a.projection&&OpenLayers.Util.applyDefaults(a,OpenLayers.Projection.defaults[a.projection.getCode()]),a.maxExtent&&!(a.maxExtent instanceof OpenLayers.Bounds)&&(a.maxExtent=new OpenLayers.Bounds(a.maxExtent)),!a.minExtent||a.minExtent instanceof OpenLayers.Bounds)||(a.minExtent=new OpenLayers.Bounds(a.minExtent)),OpenLayers.Util.extend(this.options,a),OpenLayers.Util.extend(this,a),this.projection&&this.projection.getUnits()&&(this.units=this.projection.getUnits()),this.map){var c,d=this.map.getResolution(),e=this.RESOLUTION_PROPERTIES.concat(["projection","units","minExtent","maxExtent"]);for(c in a)if(a.hasOwnProperty(c)&&0<=OpenLayers.Util.indexOf(e,c)){this.initResolutions(),b&&this.map.baseLayer===this&&(this.map.setCenter(this.map.getCenter(),this.map.getZoomForResolution(d),!1,!0),this.map.events.triggerEvent("changebaselayer",{layer:this}));break}}},onMapResize:function(){},redraw:function(){var a=!1;if(this.map){this.inRange=this.calculateInRange();var b=this.getExtent();b&&this.inRange&&this.visibility&&(this.moveTo(b,!0,!1),this.events.triggerEvent("moveend",{zoomChanged:!0}),a=!0)}return a},moveTo:function(){var a=this.visibility;this.isBaseLayer||(a=a&&this.inRange),this.display(a)},moveByPx:function(){},setMap:function(a){null==this.map&&(this.map=a,this.maxExtent=this.maxExtent||this.map.maxExtent,this.minExtent=this.minExtent||this.map.minExtent,this.projection=this.projection||this.map.projection,"string"==typeof this.projection&&(this.projection=new OpenLayers.Projection(this.projection)),this.units=this.projection.getUnits()||this.units||this.map.units,this.initResolutions(),this.isBaseLayer||(this.inRange=this.calculateInRange(),this.div.style.display=this.visibility&&this.inRange?"":"none"),this.setTileSize())},afterAdd:function(){},removeMap:function(){},getImageSize:function(){return this.imageSize||this.tileSize},setTileSize:function(a){this.tileSize=a=a?a:this.tileSize?this.tileSize:this.map.getTileSize(),this.gutter&&(this.imageSize=new OpenLayers.Size(a.w+2*this.gutter,a.h+2*this.gutter))},getVisibility:function(){return this.visibility},setVisibility:function(a){a!=this.visibility&&(this.visibility=a,this.display(a),this.redraw(),null!=this.map&&this.map.events.triggerEvent("changelayer",{layer:this,property:"visibility"}),this.events.triggerEvent("visibilitychanged"))},display:function(a){a!=("none"!=this.div.style.display)&&(this.div.style.display=a&&this.calculateInRange()?"block":"none")},calculateInRange:function(){var a=!1;return this.alwaysInRange?a=!0:this.map&&(a=this.map.getResolution(),a=a>=this.minResolution&&a<=this.maxResolution),a},setIsBaseLayer:function(a){a!=this.isBaseLayer&&(this.isBaseLayer=a,null!=this.map&&this.map.events.triggerEvent("changebaselayer",{layer:this}))},initResolutions:function(){var a,b,c,d={},e=!0;for(a=0,b=this.RESOLUTION_PROPERTIES.length;b>a;a++)c=this.RESOLUTION_PROPERTIES[a],d[c]=this.options[c],e&&this.options[c]&&(e=!1);if(null==this.alwaysInRange&&(this.alwaysInRange=e),null==d.resolutions&&(d.resolutions=this.resolutionsFromScales(d.scales)),null==d.resolutions&&(d.resolutions=this.calculateResolutions(d)),null==d.resolutions){for(a=0,b=this.RESOLUTION_PROPERTIES.length;b>a;a++)c=this.RESOLUTION_PROPERTIES[a],d[c]=null!=this.options[c]?this.options[c]:this.map[c];null==d.resolutions&&(d.resolutions=this.resolutionsFromScales(d.scales)),null==d.resolutions&&(d.resolutions=this.calculateResolutions(d))}var f;this.options.maxResolution&&"auto"!==this.options.maxResolution&&(f=this.options.maxResolution),this.options.minScale&&(f=OpenLayers.Util.getResolutionFromScale(this.options.minScale,this.units));var g;if(this.options.minResolution&&"auto"!==this.options.minResolution&&(g=this.options.minResolution),this.options.maxScale&&(g=OpenLayers.Util.getResolutionFromScale(this.options.maxScale,this.units)),d.resolutions&&(d.resolutions.sort(function(a,b){return b-a}),f||(f=d.resolutions[0]),g||(g=d.resolutions[d.resolutions.length-1])),this.resolutions=d.resolutions){for(b=this.resolutions.length,this.scales=Array(b),a=0;b>a;a++)this.scales[a]=OpenLayers.Util.getScaleFromResolution(this.resolutions[a],this.units);this.numZoomLevels=b}(this.minResolution=g)&&(this.maxScale=OpenLayers.Util.getScaleFromResolution(g,this.units)),(this.maxResolution=f)&&(this.minScale=OpenLayers.Util.getScaleFromResolution(f,this.units))},resolutionsFromScales:function(a){if(null!=a){var b,c,d;for(d=a.length,b=Array(d),c=0;d>c;c++)b[c]=OpenLayers.Util.getResolutionFromScale(a[c],this.units);return b}},calculateResolutions:function(a){var b,c,d=a.maxResolution;if(null!=a.minScale?d=OpenLayers.Util.getResolutionFromScale(a.minScale,this.units):"auto"==d&&null!=this.maxExtent&&(b=this.map.getSize(),c=this.maxExtent.getWidth()/b.w,b=this.maxExtent.getHeight()/b.h,d=Math.max(c,b)),c=a.minResolution,null!=a.maxScale?c=OpenLayers.Util.getResolutionFromScale(a.maxScale,this.units):"auto"==a.minResolution&&null!=this.minExtent&&(b=this.map.getSize(),c=this.minExtent.getWidth()/b.w,b=this.minExtent.getHeight()/b.h,c=Math.max(c,b)),"number"!=typeof d&&"number"!=typeof c&&null!=this.maxExtent&&(d=this.map.getTileSize(),d=Math.max(this.maxExtent.getWidth()/d.w,this.maxExtent.getHeight()/d.h)),b=a.maxZoomLevel,a=a.numZoomLevels,"number"==typeof c&&"number"==typeof d&&void 0===a?a=Math.floor(Math.log(d/c)/Math.log(2))+1:void 0===a&&null!=b&&(a=b+1),!("number"!=typeof a||0>=a||"number"!=typeof d&&"number"!=typeof c)){b=Array(a);var e=2;"number"==typeof c&&"number"==typeof d&&(e=Math.pow(d/c,1/(a-1)));var f;if("number"==typeof d)for(f=0;a>f;f++)b[f]=d/Math.pow(e,f);else for(f=0;a>f;f++)b[a-1-f]=c*Math.pow(e,f);return b}},getResolution:function(){return this.getResolutionForZoom(this.map.getZoom())},getExtent:function(){return this.map.calculateBounds()},getZoomForExtent:function(a,b){var c=this.map.getSize();return this.getZoomForResolution(Math.max(a.getWidth()/c.w,a.getHeight()/c.h),b)},getDataExtent:function(){},getResolutionForZoom:function(a){if(a=Math.max(0,Math.min(a,this.resolutions.length-1)),this.map.fractionalZoom)var b=Math.floor(a),c=Math.ceil(a),a=this.resolutions[b]-(a-b)*(this.resolutions[b]-this.resolutions[c]);else a=this.resolutions[Math.round(a)];return a},getZoomForResolution:function(a,b){var c,d;if(this.map.fractionalZoom){var e,f=0,g=this.resolutions[f],h=this.resolutions[this.resolutions.length-1];for(c=0,d=this.resolutions.length;d>c;++c)if(e=this.resolutions[c],e>=a&&(g=e,f=c),a>=e){h=e;break}c=g-h,c=c>0?f+(g-a)/c:f}else{for(g=Number.POSITIVE_INFINITY,c=0,d=this.resolutions.length;d>c;c++)if(b){if(f=Math.abs(this.resolutions[c]-a),f>g)break;g=f}else if(this.resolutions[c]<a)break;c=Math.max(0,c-1)}return c},getLonLatFromViewPortPx:function(a){var b=null,c=this.map;if(null!=a&&c.minPx){var b=c.getResolution(),d=c.getMaxExtent({restricted:!0}),b=new OpenLayers.LonLat((a.x-c.minPx.x)*b+d.left,(c.minPx.y-a.y)*b+d.top);this.wrapDateLine&&(b=b.wrapDateLine(this.maxExtent))}return b},getViewPortPxFromLonLat:function(a,b){var c=null;return null!=a&&(b=b||this.map.getResolution(),c=this.map.calculateBounds(null,b),c=new OpenLayers.Pixel(1/b*(a.lon-c.left),1/b*(c.top-a.lat))),c},setOpacity:function(a){if(a!=this.opacity){this.opacity=a;for(var b=this.div.childNodes,c=0,d=b.length;d>c;++c){var e=b[c].firstChild||b[c],f=b[c].lastChild;f&&"iframe"===f.nodeName.toLowerCase()&&(e=f.parentNode),OpenLayers.Util.modifyDOMElement(e,null,null,null,null,null,null,a)}null!=this.map&&this.map.events.triggerEvent("changelayer",{layer:this,property:"opacity"})}},getZIndex:function(){return this.div.style.zIndex},setZIndex:function(a){this.div.style.zIndex=a},adjustBounds:function(a){if(this.gutter)var b=this.gutter*this.map.getResolution(),a=new OpenLayers.Bounds(a.left-b,a.bottom-b,a.right+b,a.top+b);return this.wrapDateLine&&(b={rightTolerance:this.getResolution(),leftTolerance:this.getResolution()},a=a.wrapDateLine(this.maxExtent,b)),a},CLASS_NAME:"OpenLayers.Layer"}),OpenLayers.Layer.SphericalMercator={getExtent:function(){var a=null;return a=this.sphericalMercator?this.map.calculateBounds():OpenLayers.Layer.FixedZoomLevels.prototype.getExtent.apply(this)},getLonLatFromViewPortPx:function(){return OpenLayers.Layer.prototype.getLonLatFromViewPortPx.apply(this,arguments)},getViewPortPxFromLonLat:function(){return OpenLayers.Layer.prototype.getViewPortPxFromLonLat.apply(this,arguments)},initMercatorParameters:function(){this.RESOLUTIONS=[];for(var a=0;a<=this.MAX_ZOOM_LEVEL;++a)this.RESOLUTIONS[a]=156543.03390625/Math.pow(2,a);this.units="m",this.projection=this.projection||"EPSG:900913"},forwardMercator:function(){var a=new OpenLayers.Projection("EPSG:4326"),b=new OpenLayers.Projection("EPSG:900913");return function(c,d){var e=OpenLayers.Projection.transform({x:c,y:d},a,b);return new OpenLayers.LonLat(e.x,e.y)}}(),inverseMercator:function(){var a=new OpenLayers.Projection("EPSG:4326"),b=new OpenLayers.Projection("EPSG:900913");return function(c,d){var e=OpenLayers.Projection.transform({x:c,y:d},b,a);return new OpenLayers.LonLat(e.x,e.y)}}()},OpenLayers.Layer.EventPane=OpenLayers.Class(OpenLayers.Layer,{smoothDragPan:!0,isBaseLayer:!0,isFixed:!0,pane:null,mapObject:null,initialize:function(){OpenLayers.Layer.prototype.initialize.apply(this,arguments),null==this.pane&&(this.pane=OpenLayers.Util.createDiv(this.div.id+"_EventPane"))},destroy:function(){this.pane=this.mapObject=null,OpenLayers.Layer.prototype.destroy.apply(this,arguments)},setMap:function(){OpenLayers.Layer.prototype.setMap.apply(this,arguments),this.pane.style.zIndex=parseInt(this.div.style.zIndex)+1,this.pane.style.display=this.div.style.display,this.pane.style.width="100%",this.pane.style.height="100%","msie"==OpenLayers.BROWSER_NAME&&(this.pane.style.background="url("+OpenLayers.Util.getImageLocation("blank.gif")+")"),this.isFixed?this.map.viewPortDiv.appendChild(this.pane):this.map.layerContainerDiv.appendChild(this.pane),this.loadMapObject(),null==this.mapObject&&this.loadWarningMessage()},removeMap:function(){this.pane&&this.pane.parentNode&&this.pane.parentNode.removeChild(this.pane),OpenLayers.Layer.prototype.removeMap.apply(this,arguments)},loadWarningMessage:function(){this.div.style.backgroundColor="darkblue";var a=this.map.getSize(),b=Math.min(a.w,300),c=Math.min(a.h,200),b=new OpenLayers.Size(b,c),a=new OpenLayers.Pixel(a.w/2,a.h/2).add(-b.w/2,-b.h/2),a=OpenLayers.Util.createDiv(this.name+"_warning",a,b,null,null,null,"auto");a.style.padding="7px",a.style.backgroundColor="yellow",a.innerHTML=this.getWarningHTML(),this.div.appendChild(a)},getWarningHTML:function(){return""},display:function(){OpenLayers.Layer.prototype.display.apply(this,arguments),this.pane.style.display=this.div.style.display},setZIndex:function(){OpenLayers.Layer.prototype.setZIndex.apply(this,arguments),this.pane.style.zIndex=parseInt(this.div.style.zIndex)+1},moveByPx:function(a,b){OpenLayers.Layer.prototype.moveByPx.apply(this,arguments),this.dragPanMapObject?this.dragPanMapObject(a,-b):this.moveTo(this.map.getCachedCenter())},moveTo:function(a,b,c){if(OpenLayers.Layer.prototype.moveTo.apply(this,arguments),null!=this.mapObject){var d=this.map.getCenter(),e=this.map.getZoom();if(null!=d){var f=this.getOLLonLatFromMapObjectLonLat(this.getMapObjectCenter()),g=this.getOLZoomFromMapObjectZoom(this.getMapObjectZoom());d.equals(f)&&e==g||(!b&&f&&this.dragPanMapObject&&this.smoothDragPan?(e=this.map.getViewPortPxFromLonLat(f),d=this.map.getViewPortPxFromLonLat(d),this.dragPanMapObject(d.x-e.x,e.y-d.y)):(d=this.getMapObjectLonLatFromOLLonLat(d),e=this.getMapObjectZoomFromOLZoom(e),this.setMapObjectCenter(d,e,c)))
}}},getLonLatFromViewPortPx:function(a){var b=null;return null!=this.mapObject&&null!=this.getMapObjectCenter()&&(b=this.getOLLonLatFromMapObjectLonLat(this.getMapObjectLonLatFromMapObjectPixel(this.getMapObjectPixelFromOLPixel(a)))),b},getViewPortPxFromLonLat:function(a){var b=null;return null!=this.mapObject&&null!=this.getMapObjectCenter()&&(b=this.getOLPixelFromMapObjectPixel(this.getMapObjectPixelFromMapObjectLonLat(this.getMapObjectLonLatFromOLLonLat(a)))),b},getOLLonLatFromMapObjectLonLat:function(a){var b=null;return null!=a&&(b=this.getLongitudeFromMapObjectLonLat(a),a=this.getLatitudeFromMapObjectLonLat(a),b=new OpenLayers.LonLat(b,a)),b},getMapObjectLonLatFromOLLonLat:function(a){var b=null;return null!=a&&(b=this.getMapObjectLonLatFromLonLat(a.lon,a.lat)),b},getOLPixelFromMapObjectPixel:function(a){var b=null;return null!=a&&(b=this.getXFromMapObjectPixel(a),a=this.getYFromMapObjectPixel(a),b=new OpenLayers.Pixel(b,a)),b},getMapObjectPixelFromOLPixel:function(a){var b=null;return null!=a&&(b=this.getMapObjectPixelFromXY(a.x,a.y)),b},CLASS_NAME:"OpenLayers.Layer.EventPane"}),OpenLayers.Layer.FixedZoomLevels=OpenLayers.Class({initialize:function(){},initResolutions:function(){for(var a=["minZoomLevel","maxZoomLevel","numZoomLevels"],b=0,c=a.length;c>b;b++){var d=a[b];this[d]=null!=this.options[d]?this.options[d]:this.map[d]}if((null==this.minZoomLevel||this.minZoomLevel<this.MIN_ZOOM_LEVEL)&&(this.minZoomLevel=this.MIN_ZOOM_LEVEL),a=this.MAX_ZOOM_LEVEL-this.minZoomLevel+1,b=null==this.options.numZoomLevels&&null!=this.options.maxZoomLevel||null==this.numZoomLevels&&null!=this.maxZoomLevel?this.maxZoomLevel-this.minZoomLevel+1:this.numZoomLevels,this.numZoomLevels=null!=b?Math.min(b,a):a,this.maxZoomLevel=this.minZoomLevel+this.numZoomLevels-1,null!=this.RESOLUTIONS){for(a=0,this.resolutions=[],b=this.minZoomLevel;b<=this.maxZoomLevel;b++)this.resolutions[a++]=this.RESOLUTIONS[b];this.maxResolution=this.resolutions[0],this.minResolution=this.resolutions[this.resolutions.length-1]}},getResolution:function(){if(null!=this.resolutions)return OpenLayers.Layer.prototype.getResolution.apply(this,arguments);var a=null,b=this.map.getSize(),c=this.getExtent();return null!=b&&null!=c&&(a=Math.max(c.getWidth()/b.w,c.getHeight()/b.h)),a},getExtent:function(){var a=this.map.getSize(),b=this.getLonLatFromViewPortPx({x:0,y:0}),a=this.getLonLatFromViewPortPx({x:a.w,y:a.h});return null!=b&&null!=a?new OpenLayers.Bounds(b.lon,a.lat,a.lon,b.lat):null},getZoomForResolution:function(){return null!=this.resolutions?OpenLayers.Layer.prototype.getZoomForResolution.apply(this,arguments):this.getZoomForExtent(OpenLayers.Layer.prototype.getExtent.apply(this,[]))},getOLZoomFromMapObjectZoom:function(a){var b=null;return null!=a&&(b=a-this.minZoomLevel,this.map.baseLayer!==this&&(b=this.map.baseLayer.getZoomForResolution(this.getResolutionForZoom(b)))),b},getMapObjectZoomFromOLZoom:function(a){var b=null;return null!=a&&(b=a+this.minZoomLevel,this.map.baseLayer!==this&&(b=this.getZoomForResolution(this.map.baseLayer.getResolutionForZoom(b)))),b},CLASS_NAME:"OpenLayers.Layer.FixedZoomLevels"}),OpenLayers.Layer.Google=OpenLayers.Class(OpenLayers.Layer.EventPane,OpenLayers.Layer.FixedZoomLevels,{MIN_ZOOM_LEVEL:0,MAX_ZOOM_LEVEL:21,RESOLUTIONS:[1.40625,.703125,.3515625,.17578125,.087890625,.0439453125,.02197265625,.010986328125,.0054931640625,.00274658203125,.001373291015625,.0006866455078125,.00034332275390625,.000171661376953125,858306884765625e-19,4291534423828125e-20,2145767211914062e-20,1072883605957031e-20,536441802978515e-20,268220901489257e-20,1341104507446289e-21,6.705522537231445e-7],type:null,wrapDateLine:!0,sphericalMercator:!1,version:null,initialize:function(a,b){b=b||{},b.version||(b.version="function"==typeof GMap2?"2":"3");var c=OpenLayers.Layer.Google["v"+b.version.replace(/\./g,"_")];if(!c)throw"Unsupported Google Maps API version: "+b.version;OpenLayers.Util.applyDefaults(b,c),OpenLayers.Util.applyDefaults(b,c.DEFAULTS),b.maxExtent&&(b.maxExtent=b.maxExtent.clone()),OpenLayers.Layer.EventPane.prototype.initialize.apply(this,[a,b]),OpenLayers.Layer.FixedZoomLevels.prototype.initialize.apply(this,[a,b]),this.sphericalMercator&&(OpenLayers.Util.extend(this,OpenLayers.Layer.SphericalMercator),this.initMercatorParameters())},clone:function(){return new OpenLayers.Layer.Google(this.name,this.getOptions())},setVisibility:function(){var a=null==this.opacity?1:this.opacity;OpenLayers.Layer.EventPane.prototype.setVisibility.apply(this,arguments),this.setOpacity(a)},display:function(a){this._dragging||this.setGMapVisibility(a),OpenLayers.Layer.EventPane.prototype.display.apply(this,arguments)},moveTo:function(a,b,c){this._dragging=c,OpenLayers.Layer.EventPane.prototype.moveTo.apply(this,arguments),delete this._dragging},setOpacity:function(a){if(a!==this.opacity&&(null!=this.map&&this.map.events.triggerEvent("changelayer",{layer:this,property:"opacity"}),this.opacity=a),this.getVisibility()){var b=this.getMapContainer();OpenLayers.Util.modifyDOMElement(b,null,null,null,null,null,null,a)}},destroy:function(){if(this.map){this.setGMapVisibility(!1);var a=OpenLayers.Layer.Google.cache[this.map.id];a&&1>=a.count&&this.removeGMapElements()}OpenLayers.Layer.EventPane.prototype.destroy.apply(this,arguments)},removeGMapElements:function(){var a=OpenLayers.Layer.Google.cache[this.map.id];if(a){var b=this.mapObject&&this.getMapContainer();b&&b.parentNode&&b.parentNode.removeChild(b),(b=a.termsOfUse)&&b.parentNode&&b.parentNode.removeChild(b),(a=a.poweredBy)&&a.parentNode&&a.parentNode.removeChild(a)}},removeMap:function(a){this.visibility&&this.mapObject&&this.setGMapVisibility(!1);var b=OpenLayers.Layer.Google.cache[a.id];b&&(1>=b.count?(this.removeGMapElements(),delete OpenLayers.Layer.Google.cache[a.id]):--b.count),delete this.termsOfUse,delete this.poweredBy,delete this.mapObject,delete this.dragObject,OpenLayers.Layer.EventPane.prototype.removeMap.apply(this,arguments)},getOLBoundsFromMapObjectBounds:function(a){var b=null;return null!=a&&(b=a.getSouthWest(),a=a.getNorthEast(),this.sphericalMercator?(b=this.forwardMercator(b.lng(),b.lat()),a=this.forwardMercator(a.lng(),a.lat())):(b=new OpenLayers.LonLat(b.lng(),b.lat()),a=new OpenLayers.LonLat(a.lng(),a.lat())),b=new OpenLayers.Bounds(b.lon,b.lat,a.lon,a.lat)),b},getWarningHTML:function(){return OpenLayers.i18n("googleWarning")},getMapObjectCenter:function(){return this.mapObject.getCenter()},getMapObjectZoom:function(){return this.mapObject.getZoom()},getLongitudeFromMapObjectLonLat:function(a){return this.sphericalMercator?this.forwardMercator(a.lng(),a.lat()).lon:a.lng()},getLatitudeFromMapObjectLonLat:function(a){return this.sphericalMercator?this.forwardMercator(a.lng(),a.lat()).lat:a.lat()},getXFromMapObjectPixel:function(a){return a.x},getYFromMapObjectPixel:function(a){return a.y},CLASS_NAME:"OpenLayers.Layer.Google"}),OpenLayers.Layer.Google.cache={},OpenLayers.Layer.Google.v2={termsOfUse:null,poweredBy:null,dragObject:null,loadMapObject:function(){this.type||(this.type=G_NORMAL_MAP);var a,b,c,d=OpenLayers.Layer.Google.cache[this.map.id];if(d)a=d.mapObject,b=d.termsOfUse,c=d.poweredBy,++d.count;else{var d=this.map.viewPortDiv,e=document.createElement("div");e.id=this.map.id+"_GMap2Container",e.style.position="absolute",e.style.width="100%",e.style.height="100%",d.appendChild(e);try{a=new GMap2(e),b=e.lastChild,d.appendChild(b),b.style.zIndex="1100",b.style.right="",b.style.bottom="",b.className="olLayerGoogleCopyright",c=e.lastChild,d.appendChild(c),c.style.zIndex="1100",c.style.right="",c.style.bottom="",c.className="olLayerGooglePoweredBy gmnoprint"}catch(f){throw f}OpenLayers.Layer.Google.cache[this.map.id]={mapObject:a,termsOfUse:b,poweredBy:c,count:1}}this.mapObject=a,this.termsOfUse=b,this.poweredBy=c,-1===OpenLayers.Util.indexOf(this.mapObject.getMapTypes(),this.type)&&this.mapObject.addMapType(this.type),"function"==typeof a.getDragObject?this.dragObject=a.getDragObject():this.dragPanMapObject=null,!1===this.isBaseLayer&&this.setGMapVisibility("none"!==this.div.style.display)},onMapResize:function(){if(this.visibility&&this.mapObject.isLoaded())this.mapObject.checkResize();else{if(!this._resized)var a=this,b=GEvent.addListener(this.mapObject,"load",function(){GEvent.removeListener(b),delete a._resized,a.mapObject.checkResize(),a.moveTo(a.map.getCenter(),a.map.getZoom())});this._resized=!0}},setGMapVisibility:function(a){var b=OpenLayers.Layer.Google.cache[this.map.id];if(b){var c=this.mapObject.getContainer();!0===a?(this.mapObject.setMapType(this.type),c.style.display="",this.termsOfUse.style.left="",this.termsOfUse.style.display="",this.poweredBy.style.display="",b.displayed=this.id):(b.displayed===this.id&&delete b.displayed,b.displayed||(c.style.display="none",this.termsOfUse.style.display="none",this.termsOfUse.style.left="-9999px",this.poweredBy.style.display="none"))}},getMapContainer:function(){return this.mapObject.getContainer()},getMapObjectBoundsFromOLBounds:function(a){var b=null;return null!=a&&(b=this.sphericalMercator?this.inverseMercator(a.bottom,a.left):new OpenLayers.LonLat(a.bottom,a.left),a=this.sphericalMercator?this.inverseMercator(a.top,a.right):new OpenLayers.LonLat(a.top,a.right),b=new GLatLngBounds(new GLatLng(b.lat,b.lon),new GLatLng(a.lat,a.lon))),b},setMapObjectCenter:function(a,b){this.mapObject.setCenter(a,b)},dragPanMapObject:function(a,b){this.dragObject.moveBy(new GSize(-a,b))},getMapObjectLonLatFromMapObjectPixel:function(a){return this.mapObject.fromContainerPixelToLatLng(a)},getMapObjectPixelFromMapObjectLonLat:function(a){return this.mapObject.fromLatLngToContainerPixel(a)},getMapObjectZoomFromMapObjectBounds:function(a){return this.mapObject.getBoundsZoomLevel(a)},getMapObjectLonLatFromLonLat:function(a,b){var c;return this.sphericalMercator?(c=this.inverseMercator(a,b),c=new GLatLng(c.lat,c.lon)):c=new GLatLng(b,a),c},getMapObjectPixelFromXY:function(a,b){return new GPoint(a,b)}},OpenLayers.Format.XML=OpenLayers.Class(OpenLayers.Format,{namespaces:null,namespaceAlias:null,defaultPrefix:null,readers:{},writers:{},xmldom:null,initialize:function(a){window.ActiveXObject&&(this.xmldom=new ActiveXObject("Microsoft.XMLDOM")),OpenLayers.Format.prototype.initialize.apply(this,[a]),this.namespaces=OpenLayers.Util.extend({},this.namespaces),this.namespaceAlias={};for(var b in this.namespaces)this.namespaceAlias[this.namespaces[b]]=b},destroy:function(){this.xmldom=null,OpenLayers.Format.prototype.destroy.apply(this,arguments)},setNamespace:function(a,b){this.namespaces[a]=b,this.namespaceAlias[b]=a},read:function(a){var b=a.indexOf("<");return b>0&&(a=a.substring(b)),b=OpenLayers.Util.Try(OpenLayers.Function.bind(function(){var b;return b=window.ActiveXObject&&!this.xmldom?new ActiveXObject("Microsoft.XMLDOM"):this.xmldom,b.loadXML(a),b},this),function(){return(new DOMParser).parseFromString(a,"text/xml")},function(){var b=new XMLHttpRequest;return b.open("GET","data:text/xml;charset=utf-8,"+encodeURIComponent(a),!1),b.overrideMimeType&&b.overrideMimeType("text/xml"),b.send(null),b.responseXML}),this.keepData&&(this.data=b),b},write:function(a){if(this.xmldom)a=a.xml;else{var b=new XMLSerializer;if(1==a.nodeType){var c=document.implementation.createDocument("","",null);c.importNode&&(a=c.importNode(a,!0)),c.appendChild(a),a=b.serializeToString(c)}else a=b.serializeToString(a)}return a},createElementNS:function(a,b){return this.xmldom?"string"==typeof a?this.xmldom.createNode(1,b,a):this.xmldom.createNode(1,b,""):document.createElementNS(a,b)},createTextNode:function(a){return"string"!=typeof a&&(a=""+a),this.xmldom?this.xmldom.createTextNode(a):document.createTextNode(a)},getElementsByTagNameNS:function(a,b,c){var d=[];if(a.getElementsByTagNameNS)d=a.getElementsByTagNameNS(b,c);else for(var e,f,a=a.getElementsByTagName("*"),g=0,h=a.length;h>g;++g)e=a[g],f=e.prefix?e.prefix+":"+c:c,("*"==c||f==e.nodeName)&&("*"==b||b==e.namespaceURI)&&d.push(e);return d},getAttributeNodeNS:function(a,b,c){var d=null;if(a.getAttributeNodeNS)d=a.getAttributeNodeNS(b,c);else for(var e,f,a=a.attributes,g=0,h=a.length;h>g;++g)if(e=a[g],e.namespaceURI==b&&(f=e.prefix?e.prefix+":"+c:c,f==e.nodeName)){d=e;break}return d},getAttributeNS:function(a,b,c){var d="";return a.getAttributeNS?d=a.getAttributeNS(b,c)||"":(a=this.getAttributeNodeNS(a,b,c))&&(d=a.nodeValue),d},getChildValue:function(a,b){var c=b||"";if(a)for(var d=a.firstChild;d;d=d.nextSibling)switch(d.nodeType){case 3:case 4:c+=d.nodeValue}return c},isSimpleContent:function(a){for(var b=!0,a=a.firstChild;a;a=a.nextSibling)if(1===a.nodeType){b=!1;break}return b},contentType:function(a){for(var b=!1,c=!1,d=OpenLayers.Format.XML.CONTENT_TYPE.EMPTY,a=a.firstChild;a;a=a.nextSibling){switch(a.nodeType){case 1:c=!0;break;case 8:break;default:b=!0}if(c&&b)break}if(c&&b)d=OpenLayers.Format.XML.CONTENT_TYPE.MIXED;else{if(c)return OpenLayers.Format.XML.CONTENT_TYPE.COMPLEX;if(b)return OpenLayers.Format.XML.CONTENT_TYPE.SIMPLE}return d},hasAttributeNS:function(a,b,c){var d=!1;return d=a.hasAttributeNS?a.hasAttributeNS(b,c):!!this.getAttributeNodeNS(a,b,c)},setAttributeNS:function(a,b,c,d){if(a.setAttributeNS)a.setAttributeNS(b,c,d);else{if(!this.xmldom)throw"setAttributeNS not implemented";b?(b=a.ownerDocument.createNode(2,c,b),b.nodeValue=d,a.setAttributeNode(b)):a.setAttribute(c,d)}},createElementNSPlus:function(a,b){var b=b||{},c=b.uri||this.namespaces[b.prefix];c||(c=a.indexOf(":"),c=this.namespaces[a.substring(0,c)]),c||(c=this.namespaces[this.defaultPrefix]),c=this.createElementNS(c,a),b.attributes&&this.setAttributes(c,b.attributes);var d=b.value;return null!=d&&c.appendChild(this.createTextNode(d)),c},setAttributes:function(a,b){var c,d,e;for(e in b)null!=b[e]&&b[e].toString&&(c=b[e].toString(),d=this.namespaces[e.substring(0,e.indexOf(":"))]||null,this.setAttributeNS(a,d,e,c))},readNode:function(a,b){b||(b={});var c=this.readers[a.namespaceURI?this.namespaceAlias[a.namespaceURI]:this.defaultPrefix];if(c){var d=a.localName||a.nodeName.split(":").pop();(c=c[d]||c["*"])&&c.apply(this,[a,b])}return b},readChildNodes:function(a,b){b||(b={});for(var c,d=a.childNodes,e=0,f=d.length;f>e;++e)c=d[e],1==c.nodeType&&this.readNode(c,b);return b},writeNode:function(a,b,c){var d,e=a.indexOf(":");return e>0?(d=a.substring(0,e),a=a.substring(e+1)):d=c?this.namespaceAlias[c.namespaceURI]:this.defaultPrefix,b=this.writers[d][a].apply(this,[b]),c&&c.appendChild(b),b},getChildEl:function(a,b,c){return a&&this.getThisOrNextEl(a.firstChild,b,c)},getNextEl:function(a,b,c){return a&&this.getThisOrNextEl(a.nextSibling,b,c)},getThisOrNextEl:function(a,b,c){a:for(;a;a=a.nextSibling)switch(a.nodeType){case 1:if(!(b&&b!==(a.localName||a.nodeName.split(":").pop())||c&&c!==a.namespaceURI))break a;a=null;break a;case 3:if(/^\s*$/.test(a.nodeValue))break;case 4:case 6:case 12:case 10:case 11:a=null;break a}return a||null},lookupNamespaceURI:function(a,b){var c=null;if(a)if(a.lookupNamespaceURI)c=a.lookupNamespaceURI(b);else a:switch(a.nodeType){case 1:if(null!==a.namespaceURI&&a.prefix===b){c=a.namespaceURI;break a}if(c=a.attributes.length)for(var d,e=0;c>e;++e){if(d=a.attributes[e],"xmlns"===d.prefix&&d.name==="xmlns:"+b){c=d.value||null;break a}if("xmlns"===d.name&&null===b){c=d.value||null;break a}}c=this.lookupNamespaceURI(a.parentNode,b);break a;case 2:c=this.lookupNamespaceURI(a.ownerElement,b);break a;case 9:c=this.lookupNamespaceURI(a.documentElement,b);break a;case 6:case 12:case 10:case 11:break a;default:c=this.lookupNamespaceURI(a.parentNode,b)}return c},getXMLDoc:function(){return!OpenLayers.Format.XML.document&&!this.xmldom&&(document.implementation&&document.implementation.createDocument?OpenLayers.Format.XML.document=document.implementation.createDocument("","",null):!this.xmldom&&window.ActiveXObject&&(this.xmldom=new ActiveXObject("Microsoft.XMLDOM"))),OpenLayers.Format.XML.document||this.xmldom},CLASS_NAME:"OpenLayers.Format.XML"}),OpenLayers.Format.XML.CONTENT_TYPE={EMPTY:0,SIMPLE:1,COMPLEX:2,MIXED:3},OpenLayers.Format.XML.lookupNamespaceURI=OpenLayers.Function.bind(OpenLayers.Format.XML.prototype.lookupNamespaceURI,OpenLayers.Format.XML.prototype),OpenLayers.Format.XML.document=null,OpenLayers.Format.WFST=function(a){var a=OpenLayers.Util.applyDefaults(a,OpenLayers.Format.WFST.DEFAULTS),b=OpenLayers.Format.WFST["v"+a.version.replace(/\./g,"_")];if(!b)throw"Unsupported WFST version: "+a.version;return new b(a)},OpenLayers.Format.WFST.DEFAULTS={version:"1.0.0"},OpenLayers.Format.WFST.v1=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance",wfs:"http://www.opengis.net/wfs",gml:"http://www.opengis.net/gml",ogc:"http://www.opengis.net/ogc",ows:"http://www.opengis.net/ows"},defaultPrefix:"wfs",version:null,schemaLocations:null,srsName:null,extractAttributes:!0,xy:!0,stateName:null,initialize:function(a){this.stateName={},this.stateName[OpenLayers.State.INSERT]="wfs:Insert",this.stateName[OpenLayers.State.UPDATE]="wfs:Update",this.stateName[OpenLayers.State.DELETE]="wfs:Delete",OpenLayers.Format.XML.prototype.initialize.apply(this,[a])},getSrsName:function(a,b){var c=b&&b.srsName;return c||(c=a&&a.layer?a.layer.projection.getCode():this.srsName),c},read:function(a,b){b=b||{},OpenLayers.Util.applyDefaults(b,{output:"features"}),"string"==typeof a&&(a=OpenLayers.Format.XML.prototype.read.apply(this,[a])),a&&9==a.nodeType&&(a=a.documentElement);var c={};return a&&this.readNode(a,c,!0),c.features&&"features"===b.output&&(c=c.features),c},readers:{wfs:{FeatureCollection:function(a,b){b.features=[],this.readChildNodes(a,b)}}},write:function(a,b){var c=this.writeNode("wfs:Transaction",{features:a,options:b}),d=this.schemaLocationAttr();return d&&this.setAttributeNS(c,this.namespaces.xsi,"xsi:schemaLocation",d),OpenLayers.Format.XML.prototype.write.apply(this,[c])},writers:{wfs:{GetFeature:function(a){var b=this.createElementNSPlus("wfs:GetFeature",{attributes:{service:"WFS",version:this.version,handle:a&&a.handle,outputFormat:a&&a.outputFormat,maxFeatures:a&&a.maxFeatures,"xsi:schemaLocation":this.schemaLocationAttr(a)}});if("string"==typeof this.featureType)this.writeNode("Query",a,b);else for(var c=0,d=this.featureType.length;d>c;c++)a.featureType=this.featureType[c],this.writeNode("Query",a,b);return b},Transaction:function(a){var b,a=a||{},c=a.options||{},d=this.createElementNSPlus("wfs:Transaction",{attributes:{service:"WFS",version:this.version,handle:c.handle}}),e=a.features;if(e){!0===c.multi&&OpenLayers.Util.extend(this.geometryTypes,{"OpenLayers.Geometry.Point":"MultiPoint","OpenLayers.Geometry.LineString":!0===this.multiCurve?"MultiCurve":"MultiLineString","OpenLayers.Geometry.Polygon":!0===this.multiSurface?"MultiSurface":"MultiPolygon"});var f,g,a=0;for(b=e.length;b>a;++a)g=e[a],(f=this.stateName[g.state])&&this.writeNode(f,{feature:g,options:c},d);!0===c.multi&&this.setGeometryTypes()}if(c.nativeElements)for(a=0,b=c.nativeElements.length;b>a;++a)this.writeNode("wfs:Native",c.nativeElements[a],d);return d},Native:function(a){return this.createElementNSPlus("wfs:Native",{attributes:{vendorId:a.vendorId,safeToIgnore:a.safeToIgnore},value:a.value})},Insert:function(a){var b=a.feature,a=a.options,a=this.createElementNSPlus("wfs:Insert",{attributes:{handle:a&&a.handle}});return this.srsName=this.getSrsName(b),this.writeNode("feature:_typeName",b,a),a},Update:function(a){var b=a.feature,a=a.options,a=this.createElementNSPlus("wfs:Update",{attributes:{handle:a&&a.handle,typeName:(this.featureNS?this.featurePrefix+":":"")+this.featureType}});this.featureNS&&a.setAttribute("xmlns:"+this.featurePrefix,this.featureNS);var c=b.modified;null===this.geometryName||c&&void 0===c.geometry||(this.srsName=this.getSrsName(b),this.writeNode("Property",{name:this.geometryName,value:b.geometry},a));for(var d in b.attributes)void 0!==b.attributes[d]&&(!c||!c.attributes||c.attributes&&void 0!==c.attributes[d])&&this.writeNode("Property",{name:d,value:b.attributes[d]},a);return this.writeNode("ogc:Filter",new OpenLayers.Filter.FeatureId({fids:[b.fid]}),a),a},Property:function(a){var b=this.createElementNSPlus("wfs:Property");return this.writeNode("Name",a.name,b),null!==a.value&&this.writeNode("Value",a.value,b),b},Name:function(a){return this.createElementNSPlus("wfs:Name",{value:a})},Value:function(a){var b;return a instanceof OpenLayers.Geometry?(b=this.createElementNSPlus("wfs:Value"),a=this.writeNode("feature:_geometry",a).firstChild,b.appendChild(a)):b=this.createElementNSPlus("wfs:Value",{value:a}),b},Delete:function(a){var b=a.feature,a=a.options,a=this.createElementNSPlus("wfs:Delete",{attributes:{handle:a&&a.handle,typeName:(this.featureNS?this.featurePrefix+":":"")+this.featureType}});return this.featureNS&&a.setAttribute("xmlns:"+this.featurePrefix,this.featureNS),this.writeNode("ogc:Filter",new OpenLayers.Filter.FeatureId({fids:[b.fid]}),a),a}}},schemaLocationAttr:function(a){var a=OpenLayers.Util.extend({featurePrefix:this.featurePrefix,schema:this.schema},a),b=OpenLayers.Util.extend({},this.schemaLocations);a.schema&&(b[a.featurePrefix]=a.schema);var c,d,a=[];for(d in b)(c=this.namespaces[d])&&a.push(c+" "+b[d]);return a.join(" ")||void 0},setFilterProperty:function(a){if(a.filters)for(var b=0,c=a.filters.length;c>b;++b)OpenLayers.Format.WFST.v1.prototype.setFilterProperty.call(this,a.filters[b]);else a instanceof OpenLayers.Filter.Spatial&&!a.property&&(a.property=this.geometryName)},CLASS_NAME:"OpenLayers.Format.WFST.v1"}),OpenLayers.Format.OGCExceptionReport=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{ogc:"http://www.opengis.net/ogc"},regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},defaultPrefix:"ogc",read:function(a){"string"==typeof a&&(a=OpenLayers.Format.XML.prototype.read.apply(this,[a]));var b={exceptionReport:null};return a.documentElement&&(this.readChildNodes(a,b),null===b.exceptionReport&&(b=(new OpenLayers.Format.OWSCommon).read(a))),b},readers:{ogc:{ServiceExceptionReport:function(a,b){b.exceptionReport={exceptions:[]},this.readChildNodes(a,b.exceptionReport)},ServiceException:function(a,b){var c={code:a.getAttribute("code"),locator:a.getAttribute("locator"),text:this.getChildValue(a)};b.exceptions.push(c)}}},CLASS_NAME:"OpenLayers.Format.OGCExceptionReport"}),OpenLayers.Format.XML.VersionedOGC=OpenLayers.Class(OpenLayers.Format.XML,{defaultVersion:null,version:null,profile:null,errorProperty:null,name:null,stringifyOutput:!1,parser:null,initialize:function(a){OpenLayers.Format.XML.prototype.initialize.apply(this,[a]),a=this.CLASS_NAME,this.name=a.substring(a.lastIndexOf(".")+1)},getVersion:function(a,b){var c;return a?(c=this.version,c||(c=a.getAttribute("version"),c||(c=this.defaultVersion))):c=b&&b.version||this.version||this.defaultVersion,c},getParser:function(a){var a=a||this.defaultVersion,b=this.profile?"_"+this.profile:"";if(!this.parser||this.parser.VERSION!=a){var c=OpenLayers.Format[this.name]["v"+a.replace(/\./g,"_")+b];if(!c)throw"Can't find a "+this.name+" parser for version "+a+b;this.parser=new c(this.options)}return this.parser},write:function(a,b){this.parser=this.getParser(this.getVersion(null,b));var c=this.parser.write(a,b);return!1===this.stringifyOutput?c:OpenLayers.Format.XML.prototype.write.apply(this,[c])},read:function(a,b){"string"==typeof a&&(a=OpenLayers.Format.XML.prototype.read.apply(this,[a]));var c=this.getVersion(a.documentElement);this.parser=this.getParser(c);var d=this.parser.read(a,b);if(null!==this.errorProperty&&void 0===d[this.errorProperty]){var e=new OpenLayers.Format.OGCExceptionReport;d.error=e.read(a)}return d.version=c,d},CLASS_NAME:"OpenLayers.Format.XML.VersionedOGC"}),OpenLayers.Feature=OpenLayers.Class({layer:null,id:null,lonlat:null,data:null,marker:null,popupClass:null,popup:null,initialize:function(a,b,c){this.layer=a,this.lonlat=b,this.data=null!=c?c:{},this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},destroy:function(){null!=this.layer&&null!=this.layer.map&&null!=this.popup&&this.layer.map.removePopup(this.popup),null!=this.layer&&null!=this.marker&&this.layer.removeMarker(this.marker),this.data=this.lonlat=this.id=this.layer=null,null!=this.marker&&(this.destroyMarker(this.marker),this.marker=null),null!=this.popup&&(this.destroyPopup(this.popup),this.popup=null)},onScreen:function(){var a=!1;return null!=this.layer&&null!=this.layer.map&&(a=this.layer.map.getExtent().containsLonLat(this.lonlat)),a},createMarker:function(){return null!=this.lonlat&&(this.marker=new OpenLayers.Marker(this.lonlat,this.data.icon)),this.marker},destroyMarker:function(){this.marker.destroy()},createPopup:function(a){return null!=this.lonlat&&(this.popup||(this.popup=new(this.popupClass?this.popupClass:OpenLayers.Popup.Anchored)(this.id+"_popup",this.lonlat,this.data.popupSize,this.data.popupContentHTML,this.marker?this.marker.icon:null,a)),null!=this.data.overflow&&(this.popup.contentDiv.style.overflow=this.data.overflow),this.popup.feature=this),this.popup},destroyPopup:function(){this.popup&&(this.popup.feature=null,this.popup.destroy(),this.popup=null)},CLASS_NAME:"OpenLayers.Feature"}),OpenLayers.State={UNKNOWN:"Unknown",INSERT:"Insert",UPDATE:"Update",DELETE:"Delete"},OpenLayers.Feature.Vector=OpenLayers.Class(OpenLayers.Feature,{fid:null,geometry:null,attributes:null,bounds:null,state:null,style:null,url:null,renderIntent:"default",modified:null,initialize:function(a,b,c){OpenLayers.Feature.prototype.initialize.apply(this,[null,null,b]),this.lonlat=null,this.geometry=a?a:null,this.state=null,this.attributes={},b&&(this.attributes=OpenLayers.Util.extend(this.attributes,b)),this.style=c?c:null},destroy:function(){this.layer&&(this.layer.removeFeatures(this),this.layer=null),this.modified=this.geometry=null,OpenLayers.Feature.prototype.destroy.apply(this,arguments)},clone:function(){return new OpenLayers.Feature.Vector(this.geometry?this.geometry.clone():null,this.attributes,this.style)},onScreen:function(a){var b=!1;return this.layer&&this.layer.map&&(b=this.layer.map.getExtent(),a?(a=this.geometry.getBounds(),b=b.intersectsBounds(a)):b=b.toGeometry().intersects(this.geometry)),b},getVisibility:function(){return!(this.style&&"none"==this.style.display||!this.layer||this.layer&&this.layer.styleMap&&"none"==this.layer.styleMap.createSymbolizer(this,this.renderIntent).display||this.layer&&!this.layer.getVisibility())},createMarker:function(){return null},destroyMarker:function(){},createPopup:function(){return null},atPoint:function(a,b,c){var d=!1;return this.geometry&&(d=this.geometry.atPoint(a,b,c)),d},destroyPopup:function(){},move:function(a){if(this.layer&&this.geometry.move){var a="OpenLayers.LonLat"==a.CLASS_NAME?this.layer.getViewPortPxFromLonLat(a):a,b=this.layer.getViewPortPxFromLonLat(this.geometry.getBounds().getCenterLonLat()),c=this.layer.map.getResolution();return this.geometry.move(c*(a.x-b.x),c*(b.y-a.y)),this.layer.drawFeature(this),b}},toState:function(a){if(a==OpenLayers.State.UPDATE)switch(this.state){case OpenLayers.State.UNKNOWN:case OpenLayers.State.DELETE:this.state=a}else if(a==OpenLayers.State.INSERT)switch(this.state){case OpenLayers.State.UNKNOWN:break;default:this.state=a}else if(a==OpenLayers.State.DELETE)switch(this.state){case OpenLayers.State.UNKNOWN:case OpenLayers.State.UPDATE:this.state=a}else a==OpenLayers.State.UNKNOWN&&(this.state=a)},CLASS_NAME:"OpenLayers.Feature.Vector"}),OpenLayers.Feature.Vector.style={"default":{fillColor:"#ee9900",fillOpacity:.4,hoverFillColor:"white",hoverFillOpacity:.8,strokeColor:"#ee9900",strokeOpacity:1,strokeWidth:1,strokeLinecap:"round",strokeDashstyle:"solid",hoverStrokeColor:"red",hoverStrokeOpacity:1,hoverStrokeWidth:.2,pointRadius:6,hoverPointRadius:1,hoverPointUnit:"%",pointerEvents:"visiblePainted",cursor:"inherit",fontColor:"#000000",labelAlign:"cm",labelOutlineColor:"white",labelOutlineWidth:3},select:{fillColor:"blue",fillOpacity:.4,hoverFillColor:"white",hoverFillOpacity:.8,strokeColor:"blue",strokeOpacity:1,strokeWidth:2,strokeLinecap:"round",strokeDashstyle:"solid",hoverStrokeColor:"red",hoverStrokeOpacity:1,hoverStrokeWidth:.2,pointRadius:6,hoverPointRadius:1,hoverPointUnit:"%",pointerEvents:"visiblePainted",cursor:"pointer",fontColor:"#000000",labelAlign:"cm",labelOutlineColor:"white",labelOutlineWidth:3},temporary:{fillColor:"#66cccc",fillOpacity:.2,hoverFillColor:"white",hoverFillOpacity:.8,strokeColor:"#66cccc",strokeOpacity:1,strokeLinecap:"round",strokeWidth:2,strokeDashstyle:"solid",hoverStrokeColor:"red",hoverStrokeOpacity:1,hoverStrokeWidth:.2,pointRadius:6,hoverPointRadius:1,hoverPointUnit:"%",pointerEvents:"visiblePainted",cursor:"inherit",fontColor:"#000000",labelAlign:"cm",labelOutlineColor:"white",labelOutlineWidth:3},"delete":{display:"none"}},OpenLayers.Style=OpenLayers.Class({id:null,name:null,title:null,description:null,layerName:null,isDefault:!1,rules:null,context:null,defaultStyle:null,defaultsPerSymbolizer:!1,propertyStyles:null,initialize:function(a,b){OpenLayers.Util.extend(this,b),this.rules=[],b&&b.rules&&this.addRules(b.rules),this.setDefaultStyle(a||OpenLayers.Feature.Vector.style["default"]),this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},destroy:function(){for(var a=0,b=this.rules.length;b>a;a++)this.rules[a].destroy(),this.rules[a]=null;this.defaultStyle=this.rules=null},createSymbolizer:function(a){for(var b,c=this.defaultsPerSymbolizer?{}:this.createLiterals(OpenLayers.Util.extend({},this.defaultStyle),a),d=this.rules,e=[],f=!1,g=0,h=d.length;h>g;g++)b=d[g],b.evaluate(a)&&(b instanceof OpenLayers.Rule&&b.elseFilter?e.push(b):(f=!0,this.applySymbolizer(b,c,a)));if(0==f&&0<e.length)for(f=!0,g=0,h=e.length;h>g;g++)this.applySymbolizer(e[g],c,a);return 0<d.length&&0==f&&(c.display="none"),null!=c.label&&"string"!=typeof c.label&&(c.label=""+c.label),c},applySymbolizer:function(a,b,c){var d=c.geometry?this.getSymbolizerPrefix(c.geometry):OpenLayers.Style.SYMBOLIZER_PREFIXES[0],a=a.symbolizer[d]||a.symbolizer;return!0===this.defaultsPerSymbolizer&&(d=this.defaultStyle,OpenLayers.Util.applyDefaults(a,{pointRadius:d.pointRadius}),(!0===a.stroke||!0===a.graphic)&&OpenLayers.Util.applyDefaults(a,{strokeWidth:d.strokeWidth,strokeColor:d.strokeColor,strokeOpacity:d.strokeOpacity,strokeDashstyle:d.strokeDashstyle,strokeLinecap:d.strokeLinecap}),(!0===a.fill||!0===a.graphic)&&OpenLayers.Util.applyDefaults(a,{fillColor:d.fillColor,fillOpacity:d.fillOpacity}),!0===a.graphic&&OpenLayers.Util.applyDefaults(a,{pointRadius:this.defaultStyle.pointRadius,externalGraphic:this.defaultStyle.externalGraphic,graphicName:this.defaultStyle.graphicName,graphicOpacity:this.defaultStyle.graphicOpacity,graphicWidth:this.defaultStyle.graphicWidth,graphicHeight:this.defaultStyle.graphicHeight,graphicXOffset:this.defaultStyle.graphicXOffset,graphicYOffset:this.defaultStyle.graphicYOffset})),this.createLiterals(OpenLayers.Util.extend(b,a),c)},createLiterals:function(a,b){var c=OpenLayers.Util.extend({},b.attributes||b.data);OpenLayers.Util.extend(c,this.context);for(var d in this.propertyStyles)a[d]=OpenLayers.Style.createLiteral(a[d],c,b,d);return a},findPropertyStyles:function(){var a={};this.addPropertyStyles(a,this.defaultStyle);for(var b,c,d=this.rules,e=0,f=d.length;f>e;e++){b=d[e].symbolizer;for(var g in b){if(c=b[g],"object"!=typeof c){this.addPropertyStyles(a,b);break}this.addPropertyStyles(a,c)}}return a},addPropertyStyles:function(a,b){var c,d;for(d in b)c=b[d],"string"==typeof c&&c.match(/\$\{\w+\}/)&&(a[d]=!0);return a},addRules:function(a){Array.prototype.push.apply(this.rules,a),this.propertyStyles=this.findPropertyStyles()},setDefaultStyle:function(a){this.defaultStyle=a,this.propertyStyles=this.findPropertyStyles()},getSymbolizerPrefix:function(a){for(var b=OpenLayers.Style.SYMBOLIZER_PREFIXES,c=0,d=b.length;d>c;c++)if(-1!=a.CLASS_NAME.indexOf(b[c]))return b[c]},clone:function(){var a=OpenLayers.Util.extend({},this);if(this.rules){a.rules=[];for(var b=0,c=this.rules.length;c>b;++b)a.rules.push(this.rules[b].clone())
}return a.context=this.context&&OpenLayers.Util.extend({},this.context),b=OpenLayers.Util.extend({},this.defaultStyle),new OpenLayers.Style(b,a)},CLASS_NAME:"OpenLayers.Style"}),OpenLayers.Style.createLiteral=function(a,b,c,d){return"string"==typeof a&&-1!=a.indexOf("${")&&(a=OpenLayers.String.format(a,b,[c,d]),a=isNaN(a)||!a?a:parseFloat(a)),a},OpenLayers.Style.SYMBOLIZER_PREFIXES=["Point","Line","Polygon","Text","Raster"],OpenLayers.Filter=OpenLayers.Class({initialize:function(a){OpenLayers.Util.extend(this,a)},destroy:function(){},evaluate:function(){return!0},clone:function(){return null},toString:function(){return OpenLayers.Format&&OpenLayers.Format.CQL?OpenLayers.Format.CQL.prototype.write(this):Object.prototype.toString.call(this)},CLASS_NAME:"OpenLayers.Filter"}),OpenLayers.Filter.FeatureId=OpenLayers.Class(OpenLayers.Filter,{fids:null,type:"FID",initialize:function(a){this.fids=[],OpenLayers.Filter.prototype.initialize.apply(this,[a])},evaluate:function(a){for(var b=0,c=this.fids.length;c>b;b++)if((a.fid||a.id)==this.fids[b])return!0;return!1},clone:function(){var a=new OpenLayers.Filter.FeatureId;return OpenLayers.Util.extend(a,this),a.fids=this.fids.slice(),a},CLASS_NAME:"OpenLayers.Filter.FeatureId"}),OpenLayers.Filter.Logical=OpenLayers.Class(OpenLayers.Filter,{filters:null,type:null,initialize:function(a){this.filters=[],OpenLayers.Filter.prototype.initialize.apply(this,[a])},destroy:function(){this.filters=null,OpenLayers.Filter.prototype.destroy.apply(this)},evaluate:function(a){var b,c;switch(this.type){case OpenLayers.Filter.Logical.AND:for(b=0,c=this.filters.length;c>b;b++)if(0==this.filters[b].evaluate(a))return!1;return!0;case OpenLayers.Filter.Logical.OR:for(b=0,c=this.filters.length;c>b;b++)if(1==this.filters[b].evaluate(a))return!0;return!1;case OpenLayers.Filter.Logical.NOT:return!this.filters[0].evaluate(a)}},clone:function(){for(var a=[],b=0,c=this.filters.length;c>b;++b)a.push(this.filters[b].clone());return new OpenLayers.Filter.Logical({type:this.type,filters:a})},CLASS_NAME:"OpenLayers.Filter.Logical"}),OpenLayers.Filter.Logical.AND="&&",OpenLayers.Filter.Logical.OR="||",OpenLayers.Filter.Logical.NOT="!",OpenLayers.Filter.Comparison=OpenLayers.Class(OpenLayers.Filter,{type:null,property:null,value:null,matchCase:!0,lowerBoundary:null,upperBoundary:null,initialize:function(a){OpenLayers.Filter.prototype.initialize.apply(this,[a]),this.type===OpenLayers.Filter.Comparison.LIKE&&void 0===a.matchCase&&(this.matchCase=null)},evaluate:function(a){a instanceof OpenLayers.Feature.Vector&&(a=a.attributes);var b=!1,a=a[this.property];switch(this.type){case OpenLayers.Filter.Comparison.EQUAL_TO:b=this.value,b=this.matchCase||"string"!=typeof a||"string"!=typeof b?a==b:a.toUpperCase()==b.toUpperCase();break;case OpenLayers.Filter.Comparison.NOT_EQUAL_TO:b=this.value,b=this.matchCase||"string"!=typeof a||"string"!=typeof b?a!=b:a.toUpperCase()!=b.toUpperCase();break;case OpenLayers.Filter.Comparison.LESS_THAN:b=a<this.value;break;case OpenLayers.Filter.Comparison.GREATER_THAN:b=a>this.value;break;case OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO:b=a<=this.value;break;case OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO:b=a>=this.value;break;case OpenLayers.Filter.Comparison.BETWEEN:b=a>=this.lowerBoundary&&a<=this.upperBoundary;break;case OpenLayers.Filter.Comparison.LIKE:b=RegExp(this.value,"gi").test(a)}return b},value2regex:function(a,b,c){if("."==a)throw Error("'.' is an unsupported wildCard character for OpenLayers.Filter.Comparison");return a=a?a:"*",b=b?b:".",this.value=this.value.replace(RegExp("\\"+(c?c:"!")+"(.|$)","g"),"\\$1"),this.value=this.value.replace(RegExp("\\"+b,"g"),"."),this.value=this.value.replace(RegExp("\\"+a,"g"),".*"),this.value=this.value.replace(RegExp("\\\\.\\*","g"),"\\"+a),this.value=this.value.replace(RegExp("\\\\\\.","g"),"\\"+b)},regex2value:function(){var a=this.value,a=a.replace(/!/g,"!!"),a=a.replace(/(\\)?\\\./g,function(a,b){return b?a:"!."}),a=a.replace(/(\\)?\\\*/g,function(a,b){return b?a:"!*"}),a=a.replace(/\\\\/g,"\\");return a=a.replace(/\.\*/g,"*")},clone:function(){return OpenLayers.Util.extend(new OpenLayers.Filter.Comparison,this)},CLASS_NAME:"OpenLayers.Filter.Comparison"}),OpenLayers.Filter.Comparison.EQUAL_TO="==",OpenLayers.Filter.Comparison.NOT_EQUAL_TO="!=",OpenLayers.Filter.Comparison.LESS_THAN="<",OpenLayers.Filter.Comparison.GREATER_THAN=">",OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO="<=",OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO=">=",OpenLayers.Filter.Comparison.BETWEEN="..",OpenLayers.Filter.Comparison.LIKE="~",OpenLayers.Format.Filter=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.0.0",CLASS_NAME:"OpenLayers.Format.Filter"}),OpenLayers.Filter.Function=OpenLayers.Class(OpenLayers.Filter,{name:null,params:null,CLASS_NAME:"OpenLayers.Filter.Function"}),OpenLayers.Format.Filter.v1=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{ogc:"http://www.opengis.net/ogc",gml:"http://www.opengis.net/gml",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},defaultPrefix:"ogc",schemaLocation:null,initialize:function(a){OpenLayers.Format.XML.prototype.initialize.apply(this,[a])},read:function(a){var b={};return this.readers.ogc.Filter.apply(this,[a,b]),b.filter},readers:{ogc:{_expression:function(a){for(var b="",c=a.firstChild;c;c=c.nextSibling)switch(c.nodeType){case 1:a=this.readNode(c),a.property?b+="${"+a.property+"}":void 0!==a.value&&(b+=a.value);break;case 3:case 4:b+=c.nodeValue}return b},Filter:function(a,b){var c={fids:[],filters:[]};this.readChildNodes(a,c),0<c.fids.length?b.filter=new OpenLayers.Filter.FeatureId({fids:c.fids}):0<c.filters.length&&(b.filter=c.filters[0])},FeatureId:function(a,b){var c=a.getAttribute("fid");c&&b.fids.push(c)},And:function(a,b){var c=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.AND});this.readChildNodes(a,c),b.filters.push(c)},Or:function(a,b){var c=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.OR});this.readChildNodes(a,c),b.filters.push(c)},Not:function(a,b){var c=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.NOT});this.readChildNodes(a,c),b.filters.push(c)},PropertyIsLessThan:function(a,b){var c=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LESS_THAN});this.readChildNodes(a,c),b.filters.push(c)},PropertyIsGreaterThan:function(a,b){var c=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.GREATER_THAN});this.readChildNodes(a,c),b.filters.push(c)},PropertyIsLessThanOrEqualTo:function(a,b){var c=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO});this.readChildNodes(a,c),b.filters.push(c)},PropertyIsGreaterThanOrEqualTo:function(a,b){var c=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO});this.readChildNodes(a,c),b.filters.push(c)},PropertyIsBetween:function(a,b){var c=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.BETWEEN});this.readChildNodes(a,c),b.filters.push(c)},Literal:function(a,b){b.value=OpenLayers.String.numericIf(this.getChildValue(a))},PropertyName:function(a,b){b.property=this.getChildValue(a)},LowerBoundary:function(a,b){b.lowerBoundary=OpenLayers.String.numericIf(this.readers.ogc._expression.call(this,a))},UpperBoundary:function(a,b){b.upperBoundary=OpenLayers.String.numericIf(this.readers.ogc._expression.call(this,a))},Intersects:function(a,b){this.readSpatial(a,b,OpenLayers.Filter.Spatial.INTERSECTS)},Within:function(a,b){this.readSpatial(a,b,OpenLayers.Filter.Spatial.WITHIN)},Contains:function(a,b){this.readSpatial(a,b,OpenLayers.Filter.Spatial.CONTAINS)},DWithin:function(a,b){this.readSpatial(a,b,OpenLayers.Filter.Spatial.DWITHIN)},Distance:function(a,b){b.distance=parseInt(this.getChildValue(a)),b.distanceUnits=a.getAttribute("units")},Function:function(){}}},readSpatial:function(a,b,c){c=new OpenLayers.Filter.Spatial({type:c}),this.readChildNodes(a,c),c.value=c.components[0],delete c.components,b.filters.push(c)},writeOgcExpression:function(a,b){if(a instanceof OpenLayers.Filter.Function){var c=this.writeNode("Function",a,b);b.appendChild(c)}else this.writeNode("Literal",a,b);return b},write:function(a){return this.writers.ogc.Filter.apply(this,[a])},writeFeatureIdNodes:function(a,b){for(var c=0,d=a.fids.length;d>c;++c)this.writeNode("FeatureId",a.fids[c],b)},writers:{ogc:{Filter:function(a){var b=this.createElementNSPlus("ogc:Filter");return"FID"===a.type?OpenLayers.Format.Filter.v1.prototype.writeFeatureIdNodes.call(this,a,b):this.writeNode(this.getFilterType(a),a,b),b},FeatureId:function(a){return this.createElementNSPlus("ogc:FeatureId",{attributes:{fid:a}})},And:function(a){for(var b,c=this.createElementNSPlus("ogc:And"),d=0,e=a.filters.length;e>d;++d)b=a.filters[d],"FID"===b.type?OpenLayers.Format.Filter.v1.prototype.writeFeatureIdNodes.call(this,b,c):this.writeNode(this.getFilterType(b),b,c);return c},Or:function(a){for(var b,c=this.createElementNSPlus("ogc:Or"),d=0,e=a.filters.length;e>d;++d)b=a.filters[d],"FID"===b.type?OpenLayers.Format.Filter.v1.prototype.writeFeatureIdNodes.call(this,b,c):this.writeNode(this.getFilterType(b),b,c);return c},Not:function(a){var b=this.createElementNSPlus("ogc:Not"),a=a.filters[0];return"FID"===a.type?OpenLayers.Format.Filter.v1.prototype.writeFeatureIdNodes.call(this,a,b):this.writeNode(this.getFilterType(a),a,b),b},PropertyIsLessThan:function(a){var b=this.createElementNSPlus("ogc:PropertyIsLessThan");return this.writeNode("PropertyName",a,b),this.writeOgcExpression(a.value,b),b},PropertyIsGreaterThan:function(a){var b=this.createElementNSPlus("ogc:PropertyIsGreaterThan");return this.writeNode("PropertyName",a,b),this.writeOgcExpression(a.value,b),b},PropertyIsLessThanOrEqualTo:function(a){var b=this.createElementNSPlus("ogc:PropertyIsLessThanOrEqualTo");return this.writeNode("PropertyName",a,b),this.writeOgcExpression(a.value,b),b},PropertyIsGreaterThanOrEqualTo:function(a){var b=this.createElementNSPlus("ogc:PropertyIsGreaterThanOrEqualTo");return this.writeNode("PropertyName",a,b),this.writeOgcExpression(a.value,b),b},PropertyIsBetween:function(a){var b=this.createElementNSPlus("ogc:PropertyIsBetween");return this.writeNode("PropertyName",a,b),this.writeNode("LowerBoundary",a,b),this.writeNode("UpperBoundary",a,b),b},PropertyName:function(a){return this.createElementNSPlus("ogc:PropertyName",{value:a.property})},Literal:function(a){return this.createElementNSPlus("ogc:Literal",{value:a})},LowerBoundary:function(a){var b=this.createElementNSPlus("ogc:LowerBoundary");return this.writeOgcExpression(a.lowerBoundary,b),b},UpperBoundary:function(a){var b=this.createElementNSPlus("ogc:UpperBoundary");return this.writeNode("Literal",a.upperBoundary,b),b},INTERSECTS:function(a){return this.writeSpatial(a,"Intersects")},WITHIN:function(a){return this.writeSpatial(a,"Within")},CONTAINS:function(a){return this.writeSpatial(a,"Contains")},DWITHIN:function(a){var b=this.writeSpatial(a,"DWithin");return this.writeNode("Distance",a,b),b},Distance:function(a){return this.createElementNSPlus("ogc:Distance",{attributes:{units:a.distanceUnits},value:a.distance})},Function:function(a){for(var b=this.createElementNSPlus("ogc:Function",{attributes:{name:a.name}}),a=a.params,c=0,d=a.length;d>c;c++)this.writeOgcExpression(a[c],b);return b}}},getFilterType:function(a){var b=this.filterMap[a.type];if(!b)throw"Filter writing not supported for rule type: "+a.type;return b},filterMap:{"&&":"And","||":"Or","!":"Not","==":"PropertyIsEqualTo","!=":"PropertyIsNotEqualTo","<":"PropertyIsLessThan",">":"PropertyIsGreaterThan","<=":"PropertyIsLessThanOrEqualTo",">=":"PropertyIsGreaterThanOrEqualTo","..":"PropertyIsBetween","~":"PropertyIsLike",BBOX:"BBOX",DWITHIN:"DWITHIN",WITHIN:"WITHIN",CONTAINS:"CONTAINS",INTERSECTS:"INTERSECTS",FID:"FeatureId"},CLASS_NAME:"OpenLayers.Format.Filter.v1"}),OpenLayers.Geometry=OpenLayers.Class({id:null,parent:null,bounds:null,initialize:function(){this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},destroy:function(){this.bounds=this.id=null},clone:function(){return new OpenLayers.Geometry},setBounds:function(a){a&&(this.bounds=a.clone())},clearBounds:function(){this.bounds=null,this.parent&&this.parent.clearBounds()},extendBounds:function(a){this.getBounds()?this.bounds.extend(a):this.setBounds(a)},getBounds:function(){return null==this.bounds&&this.calculateBounds(),this.bounds},calculateBounds:function(){},distanceTo:function(){},getVertices:function(){},atPoint:function(a,b,c){var d=!1;return null!=this.getBounds()&&null!=a&&(b=null!=b?b:0,c=null!=c?c:0,d=new OpenLayers.Bounds(this.bounds.left-b,this.bounds.bottom-c,this.bounds.right+b,this.bounds.top+c).containsLonLat(a)),d},getLength:function(){return 0},getArea:function(){return 0},getCentroid:function(){return null},toString:function(){return OpenLayers.Format&&OpenLayers.Format.WKT?OpenLayers.Format.WKT.prototype.write(new OpenLayers.Feature.Vector(this)):Object.prototype.toString.call(this)},CLASS_NAME:"OpenLayers.Geometry"}),OpenLayers.Geometry.fromWKT=function(a){var b;if(OpenLayers.Format&&OpenLayers.Format.WKT){var c=OpenLayers.Geometry.fromWKT.format;if(c||(c=new OpenLayers.Format.WKT,OpenLayers.Geometry.fromWKT.format=c),a=c.read(a),a instanceof OpenLayers.Feature.Vector)b=a.geometry;else if(OpenLayers.Util.isArray(a)){b=a.length;for(var c=Array(b),d=0;b>d;++d)c[d]=a[d].geometry;b=new OpenLayers.Geometry.Collection(c)}}return b},OpenLayers.Geometry.segmentsIntersect=function(a,b,c){var d=c&&c.point,c=c&&c.tolerance,e=!1,f=a.x1-b.x1,g=a.y1-b.y1,h=a.x2-a.x1,i=a.y2-a.y1,j=b.y2-b.y1,k=b.x2-b.x1,l=j*h-k*i,j=k*g-j*f,g=h*g-i*f;if(0==l?0==j&&0==g&&(e=!0):(f=j/l,l=g/l,f>=0&&1>=f&&l>=0&&1>=l&&(d?(h=a.x1+f*h,l=a.y1+f*i,e=new OpenLayers.Geometry.Point(h,l)):e=!0)),c)if(e){if(d){a=[a,b],b=0;a:for(;2>b;++b)for(f=a[b],i=1;3>i;++i)if(h=f["x"+i],l=f["y"+i],d=Math.sqrt(Math.pow(h-e.x,2)+Math.pow(l-e.y,2)),c>d){e.x=h,e.y=l;break a}}}else{a=[a,b],b=0;a:for(;2>b;++b)for(h=a[b],l=a[(b+1)%2],i=1;3>i;++i)if(f={x:h["x"+i],y:h["y"+i]},g=OpenLayers.Geometry.distanceToSegment(f,l),g.distance<c){e=d?new OpenLayers.Geometry.Point(f.x,f.y):!0;break a}}return e},OpenLayers.Geometry.distanceToSegment=function(a,b){var c=a.x,d=a.y,e=b.x1,f=b.y1,g=b.x2,h=b.y2,i=g-e,j=h-f,k=(i*(c-e)+j*(d-f))/(Math.pow(i,2)+Math.pow(j,2));return 0>=k||(k>=1?(e=g,f=h):(e+=k*i,f+=k*j)),{distance:Math.sqrt(Math.pow(e-c,2)+Math.pow(f-d,2)),x:e,y:f}},OpenLayers.Geometry.Point=OpenLayers.Class(OpenLayers.Geometry,{x:null,y:null,initialize:function(a,b){OpenLayers.Geometry.prototype.initialize.apply(this,arguments),this.x=parseFloat(a),this.y=parseFloat(b)},clone:function(a){return null==a&&(a=new OpenLayers.Geometry.Point(this.x,this.y)),OpenLayers.Util.applyDefaults(a,this),a},calculateBounds:function(){this.bounds=new OpenLayers.Bounds(this.x,this.y,this.x,this.y)},distanceTo:function(a,b){var c,d,e,f,g,h=!(b&&!1===b.edge)&&b&&b.details;return a instanceof OpenLayers.Geometry.Point?(d=this.x,e=this.y,f=a.x,g=a.y,c=Math.sqrt(Math.pow(d-f,2)+Math.pow(e-g,2)),c=h?{x0:d,y0:e,x1:f,y1:g,distance:c}:c):(c=a.distanceTo(this,b),h&&(c={x0:c.x1,y0:c.y1,x1:c.x0,y1:c.y0,distance:c.distance})),c},equals:function(a){var b=!1;return null!=a&&(b=this.x==a.x&&this.y==a.y||isNaN(this.x)&&isNaN(this.y)&&isNaN(a.x)&&isNaN(a.y)),b},toShortString:function(){return this.x+", "+this.y},move:function(a,b){this.x+=a,this.y+=b,this.clearBounds()},rotate:function(a,b){var a=a*(Math.PI/180),c=this.distanceTo(b),d=a+Math.atan2(this.y-b.y,this.x-b.x);this.x=b.x+c*Math.cos(d),this.y=b.y+c*Math.sin(d),this.clearBounds()},getCentroid:function(){return new OpenLayers.Geometry.Point(this.x,this.y)},resize:function(a,b,c){return this.x=b.x+a*(void 0==c?1:c)*(this.x-b.x),this.y=b.y+a*(this.y-b.y),this.clearBounds(),this},intersects:function(a){var b=!1;return b="OpenLayers.Geometry.Point"==a.CLASS_NAME?this.equals(a):a.intersects(this)},transform:function(a,b){return a&&b&&(OpenLayers.Projection.transform(this,a,b),this.bounds=null),this},getVertices:function(){return[this]},CLASS_NAME:"OpenLayers.Geometry.Point"}),OpenLayers.Geometry.Collection=OpenLayers.Class(OpenLayers.Geometry,{components:null,componentTypes:null,initialize:function(a){OpenLayers.Geometry.prototype.initialize.apply(this,arguments),this.components=[],null!=a&&this.addComponents(a)},destroy:function(){this.components.length=0,this.components=null,OpenLayers.Geometry.prototype.destroy.apply(this,arguments)},clone:function(){for(var a=eval("new "+this.CLASS_NAME+"()"),b=0,c=this.components.length;c>b;b++)a.addComponent(this.components[b].clone());return OpenLayers.Util.applyDefaults(a,this),a},getComponentsString:function(){for(var a=[],b=0,c=this.components.length;c>b;b++)a.push(this.components[b].toShortString());return a.join(",")},calculateBounds:function(){this.bounds=null;var a=new OpenLayers.Bounds,b=this.components;if(b)for(var c=0,d=b.length;d>c;c++)a.extend(b[c].getBounds());null!=a.left&&null!=a.bottom&&null!=a.right&&null!=a.top&&this.setBounds(a)},addComponents:function(a){OpenLayers.Util.isArray(a)||(a=[a]);for(var b=0,c=a.length;c>b;b++)this.addComponent(a[b])},addComponent:function(a,b){var c=!1;if(a&&(null==this.componentTypes||-1<OpenLayers.Util.indexOf(this.componentTypes,a.CLASS_NAME))){if(null!=b&&b<this.components.length){var c=this.components.slice(0,b),d=this.components.slice(b,this.components.length);c.push(a),this.components=c.concat(d)}else this.components.push(a);a.parent=this,this.clearBounds(),c=!0}return c},removeComponents:function(a){var b=!1;OpenLayers.Util.isArray(a)||(a=[a]);for(var c=a.length-1;c>=0;--c)b=this.removeComponent(a[c])||b;return b},removeComponent:function(a){return OpenLayers.Util.removeItem(this.components,a),this.clearBounds(),!0},getLength:function(){for(var a=0,b=0,c=this.components.length;c>b;b++)a+=this.components[b].getLength();return a},getArea:function(){for(var a=0,b=0,c=this.components.length;c>b;b++)a+=this.components[b].getArea();return a},getGeodesicArea:function(a){for(var b=0,c=0,d=this.components.length;d>c;c++)b+=this.components[c].getGeodesicArea(a);return b},getCentroid:function(a){if(!a)return this.components.length&&this.components[0].getCentroid();if(a=this.components.length,!a)return!1;for(var b,c=[],d=[],e=0,f=Number.MAX_VALUE,g=0;a>g;++g){b=this.components[g];var h=b.getArea();b=b.getCentroid(!0),!isNaN(h)&&!isNaN(b.x)&&!isNaN(b.y)&&(c.push(h),e+=h,f=f>h&&h>0?h:f,d.push(b))}if(a=c.length,0===e){for(g=0;a>g;++g)c[g]=1;e=c.length}else{for(g=0;a>g;++g)c[g]/=f;e/=f}for(var i=f=0,g=0;a>g;++g)b=d[g],h=c[g],f+=b.x*h,i+=b.y*h;return new OpenLayers.Geometry.Point(f/e,i/e)},getGeodesicLength:function(a){for(var b=0,c=0,d=this.components.length;d>c;c++)b+=this.components[c].getGeodesicLength(a);return b},move:function(a,b){for(var c=0,d=this.components.length;d>c;c++)this.components[c].move(a,b)},rotate:function(a,b){for(var c=0,d=this.components.length;d>c;++c)this.components[c].rotate(a,b)},resize:function(a,b,c){for(var d=0;d<this.components.length;++d)this.components[d].resize(a,b,c);return this},distanceTo:function(a,b){for(var c,d,e,f=!(b&&!1===b.edge)&&b&&b.details,g=Number.POSITIVE_INFINITY,h=0,i=this.components.length;i>h&&(c=this.components[h].distanceTo(a,b),e=f?c.distance:c,!(g>e&&(g=e,d=c,0==g)));++h);return d},equals:function(a){var b=!0;if(a&&a.CLASS_NAME&&this.CLASS_NAME==a.CLASS_NAME)if(OpenLayers.Util.isArray(a.components)&&a.components.length==this.components.length){for(var c=0,d=this.components.length;d>c;++c)if(!this.components[c].equals(a.components[c])){b=!1;break}}else b=!1;else b=!1;return b},transform:function(a,b){if(a&&b){for(var c=0,d=this.components.length;d>c;c++)this.components[c].transform(a,b);this.bounds=null}return this},intersects:function(a){for(var b=!1,c=0,d=this.components.length;d>c&&!(b=a.intersects(this.components[c]));++c);return b},getVertices:function(a){for(var b=[],c=0,d=this.components.length;d>c;++c)Array.prototype.push.apply(b,this.components[c].getVertices(a));return b},CLASS_NAME:"OpenLayers.Geometry.Collection"}),OpenLayers.Geometry.MultiPoint=OpenLayers.Class(OpenLayers.Geometry.Collection,{componentTypes:["OpenLayers.Geometry.Point"],addPoint:function(a,b){this.addComponent(a,b)},removePoint:function(a){this.removeComponent(a)},CLASS_NAME:"OpenLayers.Geometry.MultiPoint"}),OpenLayers.Geometry.Curve=OpenLayers.Class(OpenLayers.Geometry.MultiPoint,{componentTypes:["OpenLayers.Geometry.Point"],getLength:function(){var a=0;if(this.components&&1<this.components.length)for(var b=1,c=this.components.length;c>b;b++)a+=this.components[b-1].distanceTo(this.components[b]);return a},getGeodesicLength:function(a){var b=this;if(a){var c=new OpenLayers.Projection("EPSG:4326");c.equals(a)||(b=this.clone().transform(a,c))}if(a=0,b.components&&1<b.components.length)for(var d,e=1,f=b.components.length;f>e;e++)c=b.components[e-1],d=b.components[e],a+=OpenLayers.Util.distVincenty({lon:c.x,lat:c.y},{lon:d.x,lat:d.y});return 1e3*a},CLASS_NAME:"OpenLayers.Geometry.Curve"}),OpenLayers.Geometry.LineString=OpenLayers.Class(OpenLayers.Geometry.Curve,{removeComponent:function(){var a=this.components&&2<this.components.length;return a&&OpenLayers.Geometry.Collection.prototype.removeComponent.apply(this,arguments),a},intersects:function(a){var b=!1,c=a.CLASS_NAME;if("OpenLayers.Geometry.LineString"==c||"OpenLayers.Geometry.LinearRing"==c||"OpenLayers.Geometry.Point"==c){var d,e,f,g,h,i,j,k=this.getSortedSegments(),a="OpenLayers.Geometry.Point"==c?[{x1:a.x,y1:a.y,x2:a.x,y2:a.y}]:a.getSortedSegments(),l=0,m=k.length;a:for(;m>l;++l){c=k[l],d=c.x1,e=c.x2,f=c.y1,g=c.y2;for(var n=0,o=a.length;o>n&&(h=a[n],!(h.x1>e));++n)if(!(h.x2<d||(i=h.y1,j=h.y2,Math.min(i,j)>Math.max(f,g)||Math.max(i,j)<Math.min(f,g)||!OpenLayers.Geometry.segmentsIntersect(c,h)))){b=!0;break a}}}else b=a.intersects(this);return b},getSortedSegments:function(){for(var a,b,c=this.components.length-1,d=Array(c),e=0;c>e;++e)a=this.components[e],b=this.components[e+1],d[e]=a.x<b.x?{x1:a.x,y1:a.y,x2:b.x,y2:b.y}:{x1:b.x,y1:b.y,x2:a.x,y2:a.y};return d.sort(function(a,b){return a.x1-b.x1})},splitWithSegment:function(a,b){for(var c,d,e,f=!(b&&!1===b.edge),g=b&&b.tolerance,h=[],i=this.getVertices(),j=[],k=[],l=!1,m={point:!0,tolerance:g},n=null,o=0,p=i.length-2;p>=o;++o)g=i[o],j.push(g.clone()),c=i[o+1],d={x1:g.x,y1:g.y,x2:c.x,y2:c.y},d=OpenLayers.Geometry.segmentsIntersect(a,d,m),d instanceof OpenLayers.Geometry.Point&&((e=d.x===a.x1&&d.y===a.y1||d.x===a.x2&&d.y===a.y2||d.equals(g)||d.equals(c)?!0:!1)||f)&&(d.equals(k[k.length-1])||k.push(d.clone()),!(0===o&&d.equals(g))&&!d.equals(c)&&(l=!0,d.equals(g)||j.push(d),h.push(new OpenLayers.Geometry.LineString(j)),j=[d.clone()]));if(l&&(j.push(c.clone()),h.push(new OpenLayers.Geometry.LineString(j))),0<k.length)var q=a.x1<a.x2?1:-1,r=a.y1<a.y2?1:-1,n={lines:h,points:k.sort(function(a,b){return q*a.x-q*b.x||r*a.y-r*b.y})};return n},split:function(a,b){var c,d,e,f,g=null,h=b&&b.mutual;if(a instanceof OpenLayers.Geometry.LineString){var i,j,k,l,m,n=this.getVertices(),o=[];e=[];for(var p=0,q=n.length-2;q>=p;++p){i=n[p],j=n[p+1],k={x1:i.x,y1:i.y,x2:j.x,y2:j.y},f=f||[a],h&&o.push(i.clone());for(var r=0;r<f.length;++r)if((l=f[r].splitWithSegment(k,b))&&(m=l.lines,0<m.length&&(m.unshift(r,1),Array.prototype.splice.apply(f,m),r+=m.length-2),h))for(var s=0,t=l.points.length;t>s;++s)m=l.points[s],m.equals(i)||(o.push(m),e.push(new OpenLayers.Geometry.LineString(o)),o=m.equals(j)?[]:[m.clone()])}h&&0<e.length&&0<o.length&&(o.push(j.clone()),e.push(new OpenLayers.Geometry.LineString(o)))}else g=a.splitWith(this,b);return f&&1<f.length?d=!0:f=[],e&&1<e.length?c=!0:e=[],(d||c)&&(g=h?[e,f]:f),g},splitWith:function(a,b){return a.split(this,b)},getVertices:function(a){return!0===a?[this.components[0],this.components[this.components.length-1]]:!1===a?this.components.slice(1,this.components.length-1):this.components.slice()},distanceTo:function(a,b){var c,d=!(b&&!1===b.edge)&&b&&b.details,e={},f=Number.POSITIVE_INFINITY;if(a instanceof OpenLayers.Geometry.Point){for(var g,h=this.getSortedSegments(),i=a.x,j=a.y,k=0,l=h.length;l>k;++k)if(g=h[k],c=OpenLayers.Geometry.distanceToSegment(a,g),c.distance<f){if(f=c.distance,e=c,0===f)break}else if(g.x2>i&&(j>g.y1&&j<g.y2||j<g.y1&&j>g.y2))break;e=d?{distance:e.distance,x0:e.x,y0:e.y,x1:i,y1:j}:e.distance}else if(a instanceof OpenLayers.Geometry.LineString){var m,n,h=this.getSortedSegments(),i=a.getSortedSegments(),o=i.length,p={point:!0},k=0,l=h.length;a:for(;l>k;++k){j=h[k],g=j.x1,n=j.y1;for(var q=0;o>q;++q){if(c=i[q],m=OpenLayers.Geometry.segmentsIntersect(j,c,p)){f=0,e={distance:0,x0:m.x,y0:m.y,x1:m.x,y1:m.y};break a}c=OpenLayers.Geometry.distanceToSegment({x:g,y:n},c),c.distance<f&&(f=c.distance,e={distance:f,x0:g,y0:n,x1:c.x,y1:c.y})}}d||(e=e.distance),0!==f&&j&&(c=a.distanceTo(new OpenLayers.Geometry.Point(j.x2,j.y2),b),k=d?c.distance:c,f>k&&(e=d?{distance:f,x0:c.x1,y0:c.y1,x1:c.x0,y1:c.y0}:k))}else e=a.distanceTo(this,b),d&&(e={distance:e.distance,x0:e.x1,y0:e.y1,x1:e.x0,y1:e.y0});return e},simplify:function(a){if(this&&null!==this){var b=this.getVertices();if(3>b.length)return this;var c=function(a,b,d,f){for(var g,h=0,i=0,j=b;d>j;j++){g=a[b];var k=a[d],l=a[j],l=Math.abs(.5*(g.x*k.y+k.x*l.y+l.x*g.y-k.x*g.y-l.x*k.y-g.x*l.y));g=Math.sqrt(Math.pow(g.x-k.x,2)+Math.pow(g.y-k.y,2)),g=2*(l/g),g>h&&(h=g,i=j)}h>f&&i!=b&&(e.push(i),c(a,b,i,f),c(a,i,d,f))},d=b.length-1,e=[];for(e.push(0),e.push(d);b[0].equals(b[d]);)d--,e.push(d);for(c(b,0,d,a),a=[],e.sort(function(a,b){return a-b}),d=0;d<e.length;d++)a.push(b[e[d]]);return new OpenLayers.Geometry.LineString(a)}return this},CLASS_NAME:"OpenLayers.Geometry.LineString"}),OpenLayers.Geometry.MultiLineString=OpenLayers.Class(OpenLayers.Geometry.Collection,{componentTypes:["OpenLayers.Geometry.LineString"],split:function(a,b){for(var c,d,e,f,g=null,h=b&&b.mutual,i=[],j=[a],k=0,l=this.components.length;l>k;++k){d=this.components[k],e=!1;for(var m=0;m<j.length;++m)if(c=d.split(j[m],b)){if(h){e=c[0];for(var n=0,o=e.length;o>n;++n)0===n&&i.length?i[i.length-1].addComponent(e[n]):i.push(new OpenLayers.Geometry.MultiLineString([e[n]]));e=!0,c=c[1]}if(c.length){c.unshift(m,1),Array.prototype.splice.apply(j,c);break}}e||(i.length?i[i.length-1].addComponent(d.clone()):i=[new OpenLayers.Geometry.MultiLineString(d.clone())])}return i&&1<i.length?e=!0:i=[],j&&1<j.length?f=!0:j=[],(e||f)&&(g=h?[i,j]:j),g},splitWith:function(a,b){var c,d,e,f,g,h,i=null,j=b&&b.mutual;if(a instanceof OpenLayers.Geometry.LineString){h=[],g=[a];for(var k=0,l=this.components.length;l>k;++k){e=!1,d=this.components[k];for(var m=0;m<g.length;++m)if(c=g[m].split(d,b)){j&&(e=c[0],e.length&&(e.unshift(m,1),Array.prototype.splice.apply(g,e),m+=e.length-2),c=c[1],0===c.length&&(c=[d.clone()])),e=0;for(var n=c.length;n>e;++e)0===e&&h.length?h[h.length-1].addComponent(c[e]):h.push(new OpenLayers.Geometry.MultiLineString([c[e]]));e=!0}e||(h.length?h[h.length-1].addComponent(d.clone()):h=[new OpenLayers.Geometry.MultiLineString([d.clone()])])}}else i=a.split(this);return g&&1<g.length?f=!0:g=[],h&&1<h.length?e=!0:h=[],(f||e)&&(i=j?[g,h]:h),i},CLASS_NAME:"OpenLayers.Geometry.MultiLineString"}),OpenLayers.Geometry.LinearRing=OpenLayers.Class(OpenLayers.Geometry.LineString,{componentTypes:["OpenLayers.Geometry.Point"],addComponent:function(a,b){var c=!1,d=this.components.pop();return null==b&&a.equals(d)||(c=OpenLayers.Geometry.Collection.prototype.addComponent.apply(this,arguments)),OpenLayers.Geometry.Collection.prototype.addComponent.apply(this,[this.components[0]]),c},removeComponent:function(){var a=this.components&&3<this.components.length;return a&&(this.components.pop(),OpenLayers.Geometry.Collection.prototype.removeComponent.apply(this,arguments),OpenLayers.Geometry.Collection.prototype.addComponent.apply(this,[this.components[0]])),a},move:function(a,b){for(var c=0,d=this.components.length;d-1>c;c++)this.components[c].move(a,b)},rotate:function(a,b){for(var c=0,d=this.components.length;d-1>c;++c)this.components[c].rotate(a,b)},resize:function(a,b,c){for(var d=0,e=this.components.length;e-1>d;++d)this.components[d].resize(a,b,c);return this},transform:function(a,b){if(a&&b){for(var c=0,d=this.components.length;d-1>c;c++)this.components[c].transform(a,b);this.bounds=null}return this},getCentroid:function(){if(this.components&&2<this.components.length){for(var a=0,b=0,c=0;c<this.components.length-1;c++)var d=this.components[c],e=this.components[c+1],a=a+(d.x+e.x)*(d.x*e.y-e.x*d.y),b=b+(d.y+e.y)*(d.x*e.y-e.x*d.y);return c=-1*this.getArea(),new OpenLayers.Geometry.Point(a/(6*c),b/(6*c))}return null},getArea:function(){var a=0;if(this.components&&2<this.components.length){for(var b=a=0,c=this.components.length;c-1>b;b++)var d=this.components[b],e=this.components[b+1],a=a+(d.x+e.x)*(e.y-d.y);a=-a/2}return a},getGeodesicArea:function(a){var b=this;if(a){var c=new OpenLayers.Projection("EPSG:4326");c.equals(a)||(b=this.clone().transform(a,c))}if(a=0,c=b.components&&b.components.length,c>2){for(var d,e,f=0;c-1>f;f++)d=b.components[f],e=b.components[f+1],a+=OpenLayers.Util.rad(e.x-d.x)*(2+Math.sin(OpenLayers.Util.rad(d.y))+Math.sin(OpenLayers.Util.rad(e.y)));a=40680631590769*a/2}return a},containsPoint:function(a){for(var b,c,d,e,f,g=OpenLayers.Number.limitSigDigs,h=g(a.x,14),a=g(a.y,14),i=this.components.length-1,j=0,k=0;i>k;++k)if(b=this.components[k],d=g(b.x,14),b=g(b.y,14),c=this.components[k+1],e=g(c.x,14),c=g(c.y,14),b==c){if(a==b&&(e>=d&&h>=d&&e>=h||d>=e&&d>=h&&h>=e)){j=-1;break}}else{if(f=g((a-c)*((e-d)/(c-b))+e,14),f==h&&(c>b&&a>=b&&c>=a||b>c&&b>=a&&a>=c)){j=-1;break}h>=f||d!=e&&(f<Math.min(d,e)||f>Math.max(d,e))||(c>b&&a>=b&&c>a||b>c&&b>a&&a>=c)&&++j}return-1==j?1:!!(1&j)},intersects:function(a){var b=!1;if("OpenLayers.Geometry.Point"==a.CLASS_NAME)b=this.containsPoint(a);else if("OpenLayers.Geometry.LineString"==a.CLASS_NAME)b=a.intersects(this);else if("OpenLayers.Geometry.LinearRing"==a.CLASS_NAME)b=OpenLayers.Geometry.LineString.prototype.intersects.apply(this,[a]);else for(var c=0,d=a.components.length;d>c&&!(b=a.components[c].intersects(this));++c);return b},getVertices:function(a){return!0===a?[]:this.components.slice(0,this.components.length-1)},CLASS_NAME:"OpenLayers.Geometry.LinearRing"}),OpenLayers.Geometry.Polygon=OpenLayers.Class(OpenLayers.Geometry.Collection,{componentTypes:["OpenLayers.Geometry.LinearRing"],getArea:function(){var a=0;if(this.components&&0<this.components.length)for(var a=a+Math.abs(this.components[0].getArea()),b=1,c=this.components.length;c>b;b++)a-=Math.abs(this.components[b].getArea());return a},getGeodesicArea:function(a){var b=0;if(this.components&&0<this.components.length)for(var b=b+Math.abs(this.components[0].getGeodesicArea(a)),c=1,d=this.components.length;d>c;c++)b-=Math.abs(this.components[c].getGeodesicArea(a));return b},containsPoint:function(a){var b=this.components.length,c=!1;if(b>0&&(c=this.components[0].containsPoint(a),1!==c&&c&&b>1))for(var d,e=1;b>e;++e)if(d=this.components[e].containsPoint(a)){c=1===d?1:!1;break}return c},intersects:function(a){var b,c,d=!1;if("OpenLayers.Geometry.Point"==a.CLASS_NAME)d=this.containsPoint(a);else if("OpenLayers.Geometry.LineString"==a.CLASS_NAME||"OpenLayers.Geometry.LinearRing"==a.CLASS_NAME){for(b=0,c=this.components.length;c>b&&!(d=a.intersects(this.components[b]));++b);if(!d)for(b=0,c=a.components.length;c>b&&!(d=this.containsPoint(a.components[b]));++b);}else for(b=0,c=a.components.length;c>b&&!(d=this.intersects(a.components[b]));++b);if(!d&&"OpenLayers.Geometry.Polygon"==a.CLASS_NAME){var e=this.components[0];for(b=0,c=e.components.length;c>b&&!(d=a.containsPoint(e.components[b]));++b);}return d},distanceTo:function(a,b){return b&&!1===b.edge&&this.intersects(a)?0:OpenLayers.Geometry.Collection.prototype.distanceTo.apply(this,[a,b])},CLASS_NAME:"OpenLayers.Geometry.Polygon"}),OpenLayers.Geometry.Polygon.createRegularPolygon=function(a,b,c,d){var e=Math.PI*(1/c-.5);d&&(e+=d/180*Math.PI);
for(var f,g=[],h=0;c>h;++h)f=e+2*h*Math.PI/c,d=a.x+b*Math.cos(f),f=a.y+b*Math.sin(f),g.push(new OpenLayers.Geometry.Point(d,f));return a=new OpenLayers.Geometry.LinearRing(g),new OpenLayers.Geometry.Polygon([a])},OpenLayers.Geometry.MultiPolygon=OpenLayers.Class(OpenLayers.Geometry.Collection,{componentTypes:["OpenLayers.Geometry.Polygon"],CLASS_NAME:"OpenLayers.Geometry.MultiPolygon"}),OpenLayers.Format.GML=OpenLayers.Class(OpenLayers.Format.XML,{featureNS:"http://mapserver.gis.umn.edu/mapserver",featurePrefix:"feature",featureName:"featureMember",layerName:"features",geometryName:"geometry",collectionName:"FeatureCollection",gmlns:"http://www.opengis.net/gml",extractAttributes:!0,xy:!0,initialize:function(a){this.regExes={trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},OpenLayers.Format.XML.prototype.initialize.apply(this,[a])},read:function(a){"string"==typeof a&&(a=OpenLayers.Format.XML.prototype.read.apply(this,[a]));for(var a=this.getElementsByTagNameNS(a.documentElement,this.gmlns,this.featureName),b=[],c=0;c<a.length;c++){var d=this.parseFeature(a[c]);d&&b.push(d)}return b},parseFeature:function(a){for(var b,c,d,e="MultiPolygon Polygon MultiLineString LineString MultiPoint Point Envelope".split(" "),f=0;f<e.length;++f)if(b=e[f],c=this.getElementsByTagNameNS(a,this.gmlns,b),0<c.length){if(!(d=this.parseGeometry[b.toLowerCase()]))throw new TypeError("Unsupported geometry type: "+b);d=d.apply(this,[c[0]]),this.internalProjection&&this.externalProjection&&d.transform(this.externalProjection,this.internalProjection);break}var g;for(b=this.getElementsByTagNameNS(a,this.gmlns,"Box"),f=0;f<b.length;++f)e=b[f],c=this.parseGeometry.box.apply(this,[e]),e=e.parentNode,"boundedBy"===(e.localName||e.nodeName.split(":").pop())?g=c:d=c.toGeometry();var h;this.extractAttributes&&(h=this.parseAttributes(a)),h=new OpenLayers.Feature.Vector(d,h),h.bounds=g,h.gml={featureType:a.firstChild.nodeName.split(":")[1],featureNS:a.firstChild.namespaceURI,featureNSPrefix:a.firstChild.prefix};for(var i,a=a.firstChild;a&&(1!=a.nodeType||!(i=a.getAttribute("fid")||a.getAttribute("id")));)a=a.nextSibling;return h.fid=i,h},parseGeometry:{point:function(a){var b,c;return c=[],b=this.getElementsByTagNameNS(a,this.gmlns,"pos"),0<b.length&&(c=b[0].firstChild.nodeValue,c=c.replace(this.regExes.trimSpace,""),c=c.split(this.regExes.splitSpace)),0==c.length&&(b=this.getElementsByTagNameNS(a,this.gmlns,"coordinates"),0<b.length&&(c=b[0].firstChild.nodeValue,c=c.replace(this.regExes.removeSpace,""),c=c.split(","))),0==c.length&&(b=this.getElementsByTagNameNS(a,this.gmlns,"coord"),0<b.length&&(a=this.getElementsByTagNameNS(b[0],this.gmlns,"X"),b=this.getElementsByTagNameNS(b[0],this.gmlns,"Y"),0<a.length&&0<b.length&&(c=[a[0].firstChild.nodeValue,b[0].firstChild.nodeValue]))),2==c.length&&(c[2]=null),this.xy?new OpenLayers.Geometry.Point(c[0],c[1],c[2]):new OpenLayers.Geometry.Point(c[1],c[0],c[2])},multipoint:function(a){var a=this.getElementsByTagNameNS(a,this.gmlns,"Point"),b=[];if(0<a.length)for(var c,d=0;d<a.length;++d)(c=this.parseGeometry.point.apply(this,[a[d]]))&&b.push(c);return new OpenLayers.Geometry.MultiPoint(b)},linestring:function(a,b){var c,d;d=[];var e=[];if(c=this.getElementsByTagNameNS(a,this.gmlns,"posList"),0<c.length){d=this.getChildValue(c[0]),d=d.replace(this.regExes.trimSpace,""),d=d.split(this.regExes.splitSpace);var f,g,h,i=parseInt(c[0].getAttribute("dimension"));for(c=0;c<d.length/i;++c)f=c*i,g=d[f],h=d[f+1],f=2==i?null:d[f+2],e.push(this.xy?new OpenLayers.Geometry.Point(g,h,f):new OpenLayers.Geometry.Point(h,g,f))}if(0==d.length&&(c=this.getElementsByTagNameNS(a,this.gmlns,"coordinates"),0<c.length))for(d=this.getChildValue(c[0]),d=d.replace(this.regExes.trimSpace,""),d=d.replace(this.regExes.trimComma,","),i=d.split(this.regExes.splitSpace),c=0;c<i.length;++c)d=i[c].split(","),2==d.length&&(d[2]=null),e.push(this.xy?new OpenLayers.Geometry.Point(d[0],d[1],d[2]):new OpenLayers.Geometry.Point(d[1],d[0],d[2]));return d=null,0!=e.length&&(d=b?new OpenLayers.Geometry.LinearRing(e):new OpenLayers.Geometry.LineString(e)),d},multilinestring:function(a){var a=this.getElementsByTagNameNS(a,this.gmlns,"LineString"),b=[];if(0<a.length)for(var c,d=0;d<a.length;++d)(c=this.parseGeometry.linestring.apply(this,[a[d]]))&&b.push(c);return new OpenLayers.Geometry.MultiLineString(b)},polygon:function(a){var a=this.getElementsByTagNameNS(a,this.gmlns,"LinearRing"),b=[];if(0<a.length)for(var c,d=0;d<a.length;++d)(c=this.parseGeometry.linestring.apply(this,[a[d],!0]))&&b.push(c);return new OpenLayers.Geometry.Polygon(b)},multipolygon:function(a){var a=this.getElementsByTagNameNS(a,this.gmlns,"Polygon"),b=[];if(0<a.length)for(var c,d=0;d<a.length;++d)(c=this.parseGeometry.polygon.apply(this,[a[d]]))&&b.push(c);return new OpenLayers.Geometry.MultiPolygon(b)},envelope:function(a){var b,c,d=[],e=this.getElementsByTagNameNS(a,this.gmlns,"lowerCorner");if(0<e.length){b=[],0<e.length&&(b=e[0].firstChild.nodeValue,b=b.replace(this.regExes.trimSpace,""),b=b.split(this.regExes.splitSpace)),2==b.length&&(b[2]=null);var f=this.xy?new OpenLayers.Geometry.Point(b[0],b[1],b[2]):new OpenLayers.Geometry.Point(b[1],b[0],b[2])}if(a=this.getElementsByTagNameNS(a,this.gmlns,"upperCorner"),0<a.length){b=[],0<a.length&&(b=a[0].firstChild.nodeValue,b=b.replace(this.regExes.trimSpace,""),b=b.split(this.regExes.splitSpace)),2==b.length&&(b[2]=null);var g=this.xy?new OpenLayers.Geometry.Point(b[0],b[1],b[2]):new OpenLayers.Geometry.Point(b[1],b[0],b[2])}return f&&g&&(d.push(new OpenLayers.Geometry.Point(f.x,f.y)),d.push(new OpenLayers.Geometry.Point(g.x,f.y)),d.push(new OpenLayers.Geometry.Point(g.x,g.y)),d.push(new OpenLayers.Geometry.Point(f.x,g.y)),d.push(new OpenLayers.Geometry.Point(f.x,f.y)),d=new OpenLayers.Geometry.LinearRing(d),c=new OpenLayers.Geometry.Polygon([d])),c},box:function(a){var b=this.getElementsByTagNameNS(a,this.gmlns,"coordinates"),c=a=null;return 0<b.length&&(b=b[0].firstChild.nodeValue,b=b.split(" "),2==b.length&&(a=b[0].split(","),c=b[1].split(","))),null!==a&&null!==c?new OpenLayers.Bounds(parseFloat(a[0]),parseFloat(a[1]),parseFloat(c[0]),parseFloat(c[1])):void 0}},parseAttributes:function(a){for(var b,c,d,e={},a=a.firstChild;a;){if(1==a.nodeType){for(a=a.childNodes,b=0;b<a.length;++b)c=a[b],1==c.nodeType&&(d=c.childNodes,1==d.length?(d=d[0],(3==d.nodeType||4==d.nodeType)&&(c=c.prefix?c.nodeName.split(":")[1]:c.nodeName,d=d.nodeValue.replace(this.regExes.trimSpace,""),e[c]=d)):e[c.nodeName.split(":").pop()]=null);break}a=a.nextSibling}return e},write:function(a){OpenLayers.Util.isArray(a)||(a=[a]);for(var b=this.createElementNS("http://www.opengis.net/wfs","wfs:"+this.collectionName),c=0;c<a.length;c++)b.appendChild(this.createFeatureXML(a[c]));return OpenLayers.Format.XML.prototype.write.apply(this,[b])},createFeatureXML:function(a){var b=this.buildGeometryNode(a.geometry),c=this.createElementNS(this.featureNS,this.featurePrefix+":"+this.geometryName);c.appendChild(b);var b=this.createElementNS(this.gmlns,"gml:"+this.featureName),d=this.createElementNS(this.featureNS,this.featurePrefix+":"+this.layerName);d.setAttribute("fid",a.fid||a.id),d.appendChild(c);for(var e in a.attributes){var c=this.createTextNode(a.attributes[e]),f=this.createElementNS(this.featureNS,this.featurePrefix+":"+e.substring(e.lastIndexOf(":")+1));f.appendChild(c),d.appendChild(f)}return b.appendChild(d),b},buildGeometryNode:function(a){this.externalProjection&&this.internalProjection&&(a=a.clone(),a.transform(this.internalProjection,this.externalProjection));var b=a.CLASS_NAME;return this.buildGeometry[b.substring(b.lastIndexOf(".")+1).toLowerCase()].apply(this,[a])},buildGeometry:{point:function(a){var b=this.createElementNS(this.gmlns,"gml:Point");return b.appendChild(this.buildCoordinatesNode(a)),b},multipoint:function(a){for(var b,c,d=this.createElementNS(this.gmlns,"gml:MultiPoint"),a=a.components,e=0;e<a.length;e++)b=this.createElementNS(this.gmlns,"gml:pointMember"),c=this.buildGeometry.point.apply(this,[a[e]]),b.appendChild(c),d.appendChild(b);return d},linestring:function(a){var b=this.createElementNS(this.gmlns,"gml:LineString");return b.appendChild(this.buildCoordinatesNode(a)),b},multilinestring:function(a){for(var b,c,d=this.createElementNS(this.gmlns,"gml:MultiLineString"),a=a.components,e=0;e<a.length;++e)b=this.createElementNS(this.gmlns,"gml:lineStringMember"),c=this.buildGeometry.linestring.apply(this,[a[e]]),b.appendChild(c),d.appendChild(b);return d},linearring:function(a){var b=this.createElementNS(this.gmlns,"gml:LinearRing");return b.appendChild(this.buildCoordinatesNode(a)),b},polygon:function(a){for(var b,c,d=this.createElementNS(this.gmlns,"gml:Polygon"),a=a.components,e=0;e<a.length;++e)b=0==e?"outerBoundaryIs":"innerBoundaryIs",b=this.createElementNS(this.gmlns,"gml:"+b),c=this.buildGeometry.linearring.apply(this,[a[e]]),b.appendChild(c),d.appendChild(b);return d},multipolygon:function(a){for(var b,c,d=this.createElementNS(this.gmlns,"gml:MultiPolygon"),a=a.components,e=0;e<a.length;++e)b=this.createElementNS(this.gmlns,"gml:polygonMember"),c=this.buildGeometry.polygon.apply(this,[a[e]]),b.appendChild(c),d.appendChild(b);return d},bounds:function(a){var b=this.createElementNS(this.gmlns,"gml:Box");return b.appendChild(this.buildCoordinatesNode(a)),b}},buildCoordinatesNode:function(a){var b=this.createElementNS(this.gmlns,"gml:coordinates");b.setAttribute("decimal","."),b.setAttribute("cs",","),b.setAttribute("ts"," ");var c=[];if(a instanceof OpenLayers.Bounds)c.push(a.left+","+a.bottom),c.push(a.right+","+a.top);else for(var a=a.components?a.components:[a],d=0;d<a.length;d++)c.push(a[d].x+","+a[d].y);return c=this.createTextNode(c.join(" ")),b.appendChild(c),b},CLASS_NAME:"OpenLayers.Format.GML"}),OpenLayers.Format.GML||(OpenLayers.Format.GML={}),OpenLayers.Format.GML.Base=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{gml:"http://www.opengis.net/gml",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance",wfs:"http://www.opengis.net/wfs"},defaultPrefix:"gml",schemaLocation:null,featureType:null,featureNS:null,geometryName:"geometry",extractAttributes:!0,srsName:null,xy:!0,geometryTypes:null,singleFeatureType:null,regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g,featureMember:/^(.*:)?featureMembers?$/},initialize:function(a){OpenLayers.Format.XML.prototype.initialize.apply(this,[a]),this.setGeometryTypes(),a&&a.featureNS&&this.setNamespace("feature",a.featureNS),this.singleFeatureType=!a||"string"==typeof a.featureType},read:function(a){"string"==typeof a&&(a=OpenLayers.Format.XML.prototype.read.apply(this,[a])),a&&9==a.nodeType&&(a=a.documentElement);var b=[];if(this.readNode(a,{features:b},!0),0==b.length){var c=this.getElementsByTagNameNS(a,this.namespaces.gml,"featureMember");if(c.length)for(var a=0,d=c.length;d>a;++a)this.readNode(c[a],{features:b},!0);else c=this.getElementsByTagNameNS(a,this.namespaces.gml,"featureMembers"),c.length&&this.readNode(c[0],{features:b},!0)}return b},readNode:function(a,b,c){return c===!0&&this.autoConfig===!0&&(this.featureType=null,delete this.namespaceAlias[this.featureNS],delete this.namespaces.feature,this.featureNS=null),this.featureNS||a.prefix in this.namespaces||a.parentNode.namespaceURI!=this.namespaces.gml||!this.regExes.featureMember.test(a.parentNode.nodeName)||(this.featureType=a.nodeName.split(":").pop(),this.setNamespace("feature",a.namespaceURI),this.featureNS=a.namespaceURI,this.autoConfig=!0),OpenLayers.Format.XML.prototype.readNode.apply(this,[a,b])},readers:{gml:{featureMember:function(a,b){this.readChildNodes(a,b)},featureMembers:function(a,b){this.readChildNodes(a,b)},name:function(a,b){b.name=this.getChildValue(a)},boundedBy:function(a,b){var c={};this.readChildNodes(a,c),c.components&&c.components.length>0&&(b.bounds=c.components[0])},Point:function(a,b){var c={points:[]};this.readChildNodes(a,c),b.components||(b.components=[]),b.components.push(c.points[0])},coordinates:function(a,b){for(var c,d=this.getChildValue(a).replace(this.regExes.trimSpace,""),d=d.replace(this.regExes.trimComma,","),d=d.split(this.regExes.splitSpace),e=d.length,f=Array(e),g=0;e>g;++g)c=d[g].split(","),f[g]=this.xy?new OpenLayers.Geometry.Point(c[0],c[1],c[2]):new OpenLayers.Geometry.Point(c[1],c[0],c[2]);b.points=f},coord:function(a,b){var c={};this.readChildNodes(a,c),b.points||(b.points=[]),b.points.push(new OpenLayers.Geometry.Point(c.x,c.y,c.z))},X:function(a,b){b.x=this.getChildValue(a)},Y:function(a,b){b.y=this.getChildValue(a)},Z:function(a,b){b.z=this.getChildValue(a)},MultiPoint:function(a,b){var c={components:[]};this.readChildNodes(a,c),b.components=[new OpenLayers.Geometry.MultiPoint(c.components)]},pointMember:function(a,b){this.readChildNodes(a,b)},LineString:function(a,b){var c={};this.readChildNodes(a,c),b.components||(b.components=[]),b.components.push(new OpenLayers.Geometry.LineString(c.points))},MultiLineString:function(a,b){var c={components:[]};this.readChildNodes(a,c),b.components=[new OpenLayers.Geometry.MultiLineString(c.components)]},lineStringMember:function(a,b){this.readChildNodes(a,b)},Polygon:function(a,b){var c={outer:null,inner:[]};this.readChildNodes(a,c),c.inner.unshift(c.outer),b.components||(b.components=[]),b.components.push(new OpenLayers.Geometry.Polygon(c.inner))},LinearRing:function(a,b){var c={};this.readChildNodes(a,c),b.components=[new OpenLayers.Geometry.LinearRing(c.points)]},MultiPolygon:function(a,b){var c={components:[]};this.readChildNodes(a,c),b.components=[new OpenLayers.Geometry.MultiPolygon(c.components)]},polygonMember:function(a,b){this.readChildNodes(a,b)},GeometryCollection:function(a,b){var c={components:[]};this.readChildNodes(a,c),b.components=[new OpenLayers.Geometry.Collection(c.components)]},geometryMember:function(a,b){this.readChildNodes(a,b)}},feature:{"*":function(a,b){var c,d=a.localName||a.nodeName.split(":").pop();b.features?this.singleFeatureType||-1===OpenLayers.Util.indexOf(this.featureType,d)?d===this.featureType&&(c="_typeName"):c="_typeName":0==a.childNodes.length||1==a.childNodes.length&&3==a.firstChild.nodeType?this.extractAttributes&&(c="_attribute"):c="_geometry",c&&this.readers.feature[c].apply(this,[a,b])},_typeName:function(a,b){var c={components:[],attributes:{}};this.readChildNodes(a,c),c.name&&(c.attributes.name=c.name);var d=new OpenLayers.Feature.Vector(c.components[0],c.attributes);this.singleFeatureType||(d.type=a.nodeName.split(":").pop(),d.namespace=a.namespaceURI);var e=a.getAttribute("fid")||this.getAttributeNS(a,this.namespaces.gml,"id");e&&(d.fid=e),this.internalProjection&&this.externalProjection&&d.geometry&&d.geometry.transform(this.externalProjection,this.internalProjection),c.bounds&&(d.bounds=c.bounds),b.features.push(d)},_geometry:function(a,b){this.geometryName||(this.geometryName=a.nodeName.split(":").pop()),this.readChildNodes(a,b)},_attribute:function(a,b){var c=a.localName||a.nodeName.split(":").pop(),d=this.getChildValue(a);b.attributes[c]=d}},wfs:{FeatureCollection:function(a,b){this.readChildNodes(a,b)}}},write:function(a){return a=this.writeNode("gml:"+(OpenLayers.Util.isArray(a)?"featureMembers":"featureMember"),a),this.setAttributeNS(a,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation),OpenLayers.Format.XML.prototype.write.apply(this,[a])},writers:{gml:{featureMember:function(a){var b=this.createElementNSPlus("gml:featureMember");return this.writeNode("feature:_typeName",a,b),b},MultiPoint:function(a){for(var b=this.createElementNSPlus("gml:MultiPoint"),a=a.components||[a],c=0,d=a.length;d>c;++c)this.writeNode("pointMember",a[c],b);return b},pointMember:function(a){var b=this.createElementNSPlus("gml:pointMember");return this.writeNode("Point",a,b),b},MultiLineString:function(a){for(var b=this.createElementNSPlus("gml:MultiLineString"),a=a.components||[a],c=0,d=a.length;d>c;++c)this.writeNode("lineStringMember",a[c],b);return b},lineStringMember:function(a){var b=this.createElementNSPlus("gml:lineStringMember");return this.writeNode("LineString",a,b),b},MultiPolygon:function(a){for(var b=this.createElementNSPlus("gml:MultiPolygon"),a=a.components||[a],c=0,d=a.length;d>c;++c)this.writeNode("polygonMember",a[c],b);return b},polygonMember:function(a){var b=this.createElementNSPlus("gml:polygonMember");return this.writeNode("Polygon",a,b),b},GeometryCollection:function(a){for(var b=this.createElementNSPlus("gml:GeometryCollection"),c=0,d=a.components.length;d>c;++c)this.writeNode("geometryMember",a.components[c],b);return b},geometryMember:function(a){var b=this.createElementNSPlus("gml:geometryMember"),a=this.writeNode("feature:_geometry",a);return b.appendChild(a.firstChild),b}},feature:{_typeName:function(a){var b=this.createElementNSPlus("feature:"+this.featureType,{attributes:{fid:a.fid}});a.geometry&&this.writeNode("feature:_geometry",a.geometry,b);for(var c in a.attributes){var d=a.attributes[c];null!=d&&this.writeNode("feature:_attribute",{name:c,value:d},b)}return b},_geometry:function(a){this.externalProjection&&this.internalProjection&&(a=a.clone().transform(this.internalProjection,this.externalProjection));var b=this.createElementNSPlus("feature:"+this.geometryName),a=this.writeNode("gml:"+this.geometryTypes[a.CLASS_NAME],a,b);return this.srsName&&a.setAttribute("srsName",this.srsName),b},_attribute:function(a){return this.createElementNSPlus("feature:"+a.name,{value:a.value})}},wfs:{FeatureCollection:function(a){for(var b=this.createElementNSPlus("wfs:FeatureCollection"),c=0,d=a.length;d>c;++c)this.writeNode("gml:featureMember",a[c],b);return b}}},setGeometryTypes:function(){this.geometryTypes={"OpenLayers.Geometry.Point":"Point","OpenLayers.Geometry.MultiPoint":"MultiPoint","OpenLayers.Geometry.LineString":"LineString","OpenLayers.Geometry.MultiLineString":"MultiLineString","OpenLayers.Geometry.Polygon":"Polygon","OpenLayers.Geometry.MultiPolygon":"MultiPolygon","OpenLayers.Geometry.Collection":"GeometryCollection"}},CLASS_NAME:"OpenLayers.Format.GML.Base"}),OpenLayers.Format.GML.v3=OpenLayers.Class(OpenLayers.Format.GML.Base,{schemaLocation:"http://www.opengis.net/gml http://schemas.opengis.net/gml/3.1.1/profiles/gmlsfProfile/1.0.0/gmlsf.xsd",curve:!1,multiCurve:!0,surface:!1,multiSurface:!0,initialize:function(a){OpenLayers.Format.GML.Base.prototype.initialize.apply(this,[a])},readers:{gml:OpenLayers.Util.applyDefaults({featureMembers:function(a,b){this.readChildNodes(a,b)},Curve:function(a,b){var c={points:[]};this.readChildNodes(a,c),b.components||(b.components=[]),b.components.push(new OpenLayers.Geometry.LineString(c.points))},segments:function(a,b){this.readChildNodes(a,b)},LineStringSegment:function(a,b){var c={};this.readChildNodes(a,c),c.points&&Array.prototype.push.apply(b.points,c.points)},pos:function(a,b){var c=this.getChildValue(a).replace(this.regExes.trimSpace,"").split(this.regExes.splitSpace),c=this.xy?new OpenLayers.Geometry.Point(c[0],c[1],c[2]):new OpenLayers.Geometry.Point(c[1],c[0],c[2]);b.points=[c]},posList:function(a,b){for(var c,d,e,f=this.getChildValue(a).replace(this.regExes.trimSpace,"").split(this.regExes.splitSpace),g=parseInt(a.getAttribute("dimension"))||2,h=Array(f.length/g),i=0,j=f.length;j>i;i+=g)c=f[i],d=f[i+1],e=2==g?void 0:f[i+2],h[i/g]=this.xy?new OpenLayers.Geometry.Point(c,d,e):new OpenLayers.Geometry.Point(d,c,e);b.points=h},Surface:function(a,b){this.readChildNodes(a,b)},patches:function(a,b){this.readChildNodes(a,b)},PolygonPatch:function(a,b){this.readers.gml.Polygon.apply(this,[a,b])},exterior:function(a,b){var c={};this.readChildNodes(a,c),b.outer=c.components[0]},interior:function(a,b){var c={};this.readChildNodes(a,c),b.inner.push(c.components[0])},MultiCurve:function(a,b){var c={components:[]};this.readChildNodes(a,c),0<c.components.length&&(b.components=[new OpenLayers.Geometry.MultiLineString(c.components)])},curveMember:function(a,b){this.readChildNodes(a,b)},MultiSurface:function(a,b){var c={components:[]};this.readChildNodes(a,c),0<c.components.length&&(b.components=[new OpenLayers.Geometry.MultiPolygon(c.components)])},surfaceMember:function(a,b){this.readChildNodes(a,b)},surfaceMembers:function(a,b){this.readChildNodes(a,b)},pointMembers:function(a,b){this.readChildNodes(a,b)},lineStringMembers:function(a,b){this.readChildNodes(a,b)},polygonMembers:function(a,b){this.readChildNodes(a,b)},geometryMembers:function(a,b){this.readChildNodes(a,b)},Envelope:function(a,b){var c={points:Array(2)};this.readChildNodes(a,c),b.components||(b.components=[]);var d=c.points[0],c=c.points[1];b.components.push(new OpenLayers.Bounds(d.x,d.y,c.x,c.y))},lowerCorner:function(a,b){var c={};this.readers.gml.pos.apply(this,[a,c]),b.points[0]=c.points[0]},upperCorner:function(a,b){var c={};this.readers.gml.pos.apply(this,[a,c]),b.points[1]=c.points[0]}},OpenLayers.Format.GML.Base.prototype.readers.gml),feature:OpenLayers.Format.GML.Base.prototype.readers.feature,wfs:OpenLayers.Format.GML.Base.prototype.readers.wfs},write:function(a){return a=this.writeNode("gml:"+(OpenLayers.Util.isArray(a)?"featureMembers":"featureMember"),a),this.setAttributeNS(a,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation),OpenLayers.Format.XML.prototype.write.apply(this,[a])},writers:{gml:OpenLayers.Util.applyDefaults({featureMembers:function(a){for(var b=this.createElementNSPlus("gml:featureMembers"),c=0,d=a.length;d>c;++c)this.writeNode("feature:_typeName",a[c],b);return b},Point:function(a){var b=this.createElementNSPlus("gml:Point");return this.writeNode("pos",a,b),b},pos:function(a){return this.createElementNSPlus("gml:pos",{value:this.xy?a.x+" "+a.y:a.y+" "+a.x})},LineString:function(a){var b=this.createElementNSPlus("gml:LineString");return this.writeNode("posList",a.components,b),b},Curve:function(a){var b=this.createElementNSPlus("gml:Curve");return this.writeNode("segments",a,b),b},segments:function(a){var b=this.createElementNSPlus("gml:segments");return this.writeNode("LineStringSegment",a,b),b},LineStringSegment:function(a){var b=this.createElementNSPlus("gml:LineStringSegment");return this.writeNode("posList",a.components,b),b},posList:function(a){for(var b,c=a.length,d=Array(c),e=0;c>e;++e)b=a[e],d[e]=this.xy?b.x+" "+b.y:b.y+" "+b.x;return this.createElementNSPlus("gml:posList",{value:d.join(" ")})},Surface:function(a){var b=this.createElementNSPlus("gml:Surface");return this.writeNode("patches",a,b),b},patches:function(a){var b=this.createElementNSPlus("gml:patches");return this.writeNode("PolygonPatch",a,b),b},PolygonPatch:function(a){var b=this.createElementNSPlus("gml:PolygonPatch",{attributes:{interpolation:"planar"}});this.writeNode("exterior",a.components[0],b);for(var c=1,d=a.components.length;d>c;++c)this.writeNode("interior",a.components[c],b);return b},Polygon:function(a){var b=this.createElementNSPlus("gml:Polygon");this.writeNode("exterior",a.components[0],b);for(var c=1,d=a.components.length;d>c;++c)this.writeNode("interior",a.components[c],b);return b},exterior:function(a){var b=this.createElementNSPlus("gml:exterior");return this.writeNode("LinearRing",a,b),b},interior:function(a){var b=this.createElementNSPlus("gml:interior");return this.writeNode("LinearRing",a,b),b},LinearRing:function(a){var b=this.createElementNSPlus("gml:LinearRing");return this.writeNode("posList",a.components,b),b},MultiCurve:function(a){for(var b=this.createElementNSPlus("gml:MultiCurve"),a=a.components||[a],c=0,d=a.length;d>c;++c)this.writeNode("curveMember",a[c],b);return b},curveMember:function(a){var b=this.createElementNSPlus("gml:curveMember");return this.curve?this.writeNode("Curve",a,b):this.writeNode("LineString",a,b),b},MultiSurface:function(a){for(var b=this.createElementNSPlus("gml:MultiSurface"),a=a.components||[a],c=0,d=a.length;d>c;++c)this.writeNode("surfaceMember",a[c],b);return b},surfaceMember:function(a){var b=this.createElementNSPlus("gml:surfaceMember");return this.surface?this.writeNode("Surface",a,b):this.writeNode("Polygon",a,b),b},Envelope:function(a){var b=this.createElementNSPlus("gml:Envelope");return this.writeNode("lowerCorner",a,b),this.writeNode("upperCorner",a,b),this.srsName&&b.setAttribute("srsName",this.srsName),b},lowerCorner:function(a){return this.createElementNSPlus("gml:lowerCorner",{value:this.xy?a.left+" "+a.bottom:a.bottom+" "+a.left})},upperCorner:function(a){return this.createElementNSPlus("gml:upperCorner",{value:this.xy?a.right+" "+a.top:a.top+" "+a.right})}},OpenLayers.Format.GML.Base.prototype.writers.gml),feature:OpenLayers.Format.GML.Base.prototype.writers.feature,wfs:OpenLayers.Format.GML.Base.prototype.writers.wfs},setGeometryTypes:function(){this.geometryTypes={"OpenLayers.Geometry.Point":"Point","OpenLayers.Geometry.MultiPoint":"MultiPoint","OpenLayers.Geometry.LineString":!0===this.curve?"Curve":"LineString","OpenLayers.Geometry.MultiLineString":!1===this.multiCurve?"MultiLineString":"MultiCurve","OpenLayers.Geometry.Polygon":!0===this.surface?"Surface":"Polygon","OpenLayers.Geometry.MultiPolygon":!1===this.multiSurface?"MultiPolygon":"MultiSurface","OpenLayers.Geometry.Collection":"GeometryCollection"}},CLASS_NAME:"OpenLayers.Format.GML.v3"}),OpenLayers.Format.Filter.v1_1_0=OpenLayers.Class(OpenLayers.Format.GML.v3,OpenLayers.Format.Filter.v1,{VERSION:"1.1.0",schemaLocation:"http://www.opengis.net/ogc/filter/1.1.0/filter.xsd",initialize:function(a){OpenLayers.Format.GML.v3.prototype.initialize.apply(this,[a])},readers:{ogc:OpenLayers.Util.applyDefaults({PropertyIsEqualTo:function(a,b){var c=a.getAttribute("matchCase"),c=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO,matchCase:!("false"===c||"0"===c)});this.readChildNodes(a,c),b.filters.push(c)},PropertyIsNotEqualTo:function(a,b){var c=a.getAttribute("matchCase"),c=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.NOT_EQUAL_TO,matchCase:!("false"===c||"0"===c)});this.readChildNodes(a,c),b.filters.push(c)},PropertyIsLike:function(a,b){var c=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LIKE});this.readChildNodes(a,c);var d=a.getAttribute("wildCard"),e=a.getAttribute("singleChar"),f=a.getAttribute("escapeChar");c.value2regex(d,e,f),b.filters.push(c)}},OpenLayers.Format.Filter.v1.prototype.readers.ogc),gml:OpenLayers.Format.GML.v3.prototype.readers.gml,feature:OpenLayers.Format.GML.v3.prototype.readers.feature},writers:{ogc:OpenLayers.Util.applyDefaults({PropertyIsEqualTo:function(a){var b=this.createElementNSPlus("ogc:PropertyIsEqualTo",{attributes:{matchCase:a.matchCase}});return this.writeNode("PropertyName",a,b),this.writeOgcExpression(a.value,b),b},PropertyIsNotEqualTo:function(a){var b=this.createElementNSPlus("ogc:PropertyIsNotEqualTo",{attributes:{matchCase:a.matchCase}});return this.writeNode("PropertyName",a,b),this.writeOgcExpression(a.value,b),b},PropertyIsLike:function(a){var b=this.createElementNSPlus("ogc:PropertyIsLike",{attributes:{matchCase:a.matchCase,wildCard:"*",singleChar:".",escapeChar:"!"}});return this.writeNode("PropertyName",a,b),this.writeNode("Literal",a.regex2value(),b),b},BBOX:function(a){var b=this.createElementNSPlus("ogc:BBOX");a.property&&this.writeNode("PropertyName",a,b);var c=this.writeNode("gml:Envelope",a.value);return a.projection&&c.setAttribute("srsName",a.projection),b.appendChild(c),b},SortBy:function(a){for(var b=this.createElementNSPlus("ogc:SortBy"),c=0,d=a.length;d>c;c++)this.writeNode("ogc:SortProperty",a[c],b);return b},SortProperty:function(a){var b=this.createElementNSPlus("ogc:SortProperty");return this.writeNode("ogc:PropertyName",a,b),this.writeNode("ogc:SortOrder","DESC"==a.order?"DESC":"ASC",b),b},SortOrder:function(a){return this.createElementNSPlus("ogc:SortOrder",{value:a})}},OpenLayers.Format.Filter.v1.prototype.writers.ogc),gml:OpenLayers.Format.GML.v3.prototype.writers.gml,feature:OpenLayers.Format.GML.v3.prototype.writers.feature},writeSpatial:function(a,b){var c=this.createElementNSPlus("ogc:"+b);if(this.writeNode("PropertyName",a,c),a.value instanceof OpenLayers.Filter.Function)this.writeNode("Function",a.value,c);else{var d;d=a.value instanceof OpenLayers.Geometry?this.writeNode("feature:_geometry",a.value).firstChild:this.writeNode("gml:Envelope",a.value),a.projection&&d.setAttribute("srsName",a.projection),c.appendChild(d)}return c},CLASS_NAME:"OpenLayers.Format.Filter.v1_1_0"}),OpenLayers.Format.OWSCommon=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.0.0",getVersion:function(a){var b=this.version;return b||((a=a.getAttribute("xmlns:ows"))&&"1.1"===a.substring(a.lastIndexOf("/")+1)&&(b="1.1.0"),b||(b=this.defaultVersion)),b},CLASS_NAME:"OpenLayers.Format.OWSCommon"}),OpenLayers.Format.OWSCommon.v1=OpenLayers.Class(OpenLayers.Format.XML,{regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},read:function(a,b){OpenLayers.Util.applyDefaults(b,this.options);var c={};return this.readChildNodes(a,c),c},readers:{ows:{Exception:function(a,b){var c={code:a.getAttribute("exceptionCode"),locator:a.getAttribute("locator"),texts:[]};b.exceptions.push(c),this.readChildNodes(a,c)},ExceptionText:function(a,b){var c=this.getChildValue(a);b.texts.push(c)},ServiceIdentification:function(a,b){b.serviceIdentification={},this.readChildNodes(a,b.serviceIdentification)},Title:function(a,b){b.title=this.getChildValue(a)},Abstract:function(a,b){b["abstract"]=this.getChildValue(a)},Keywords:function(a,b){b.keywords={},this.readChildNodes(a,b.keywords)},Keyword:function(a,b){b[this.getChildValue(a)]=!0},ServiceType:function(a,b){b.serviceType={codeSpace:a.getAttribute("codeSpace"),value:this.getChildValue(a)}},ServiceTypeVersion:function(a,b){b.serviceTypeVersion=this.getChildValue(a)},Fees:function(a,b){b.fees=this.getChildValue(a)},AccessConstraints:function(a,b){b.accessConstraints=this.getChildValue(a)},ServiceProvider:function(a,b){b.serviceProvider={},this.readChildNodes(a,b.serviceProvider)},ProviderName:function(a,b){b.providerName=this.getChildValue(a)},ProviderSite:function(a,b){b.providerSite=this.getAttributeNS(a,this.namespaces.xlink,"href")},ServiceContact:function(a,b){b.serviceContact={},this.readChildNodes(a,b.serviceContact)},IndividualName:function(a,b){b.individualName=this.getChildValue(a)},PositionName:function(a,b){b.positionName=this.getChildValue(a)},ContactInfo:function(a,b){b.contactInfo={},this.readChildNodes(a,b.contactInfo)},Phone:function(a,b){b.phone={},this.readChildNodes(a,b.phone)},Voice:function(a,b){b.voice=this.getChildValue(a)},Address:function(a,b){b.address={},this.readChildNodes(a,b.address)},DeliveryPoint:function(a,b){b.deliveryPoint=this.getChildValue(a)},City:function(a,b){b.city=this.getChildValue(a)},AdministrativeArea:function(a,b){b.administrativeArea=this.getChildValue(a)},PostalCode:function(a,b){b.postalCode=this.getChildValue(a)},Country:function(a,b){b.country=this.getChildValue(a)},ElectronicMailAddress:function(a,b){b.electronicMailAddress=this.getChildValue(a)},Role:function(a,b){b.role=this.getChildValue(a)},OperationsMetadata:function(a,b){b.operationsMetadata={},this.readChildNodes(a,b.operationsMetadata)},Operation:function(a,b){var c=a.getAttribute("name");b[c]={},this.readChildNodes(a,b[c])},DCP:function(a,b){b.dcp={},this.readChildNodes(a,b.dcp)},HTTP:function(a,b){b.http={},this.readChildNodes(a,b.http)},Get:function(a,b){b.get||(b.get=[]);var c={url:this.getAttributeNS(a,this.namespaces.xlink,"href")};this.readChildNodes(a,c),b.get.push(c)},Post:function(a,b){b.post||(b.post=[]);var c={url:this.getAttributeNS(a,this.namespaces.xlink,"href")};this.readChildNodes(a,c),b.post.push(c)},Parameter:function(a,b){b.parameters||(b.parameters={});var c=a.getAttribute("name");b.parameters[c]={},this.readChildNodes(a,b.parameters[c])},Constraint:function(a,b){b.constraints||(b.constraints={});var c=a.getAttribute("name");b.constraints[c]={},this.readChildNodes(a,b.constraints[c])},Value:function(a,b){b[this.getChildValue(a)]=!0},OutputFormat:function(a,b){b.formats.push({value:this.getChildValue(a)}),this.readChildNodes(a,b)
},WGS84BoundingBox:function(a,b){var c={};c.crs=a.getAttribute("crs"),b.BoundingBox?b.BoundingBox.push(c):(b.projection=c.crs,c=b),this.readChildNodes(a,c)},BoundingBox:function(a,b){this.readers.ows.WGS84BoundingBox.apply(this,[a,b])},LowerCorner:function(a,b){var c=this.getChildValue(a).replace(this.regExes.trimSpace,""),c=c.replace(this.regExes.trimComma,","),c=c.split(this.regExes.splitSpace);b.left=c[0],b.bottom=c[1]},UpperCorner:function(a,b){var c=this.getChildValue(a).replace(this.regExes.trimSpace,""),c=c.replace(this.regExes.trimComma,","),c=c.split(this.regExes.splitSpace);b.right=c[0],b.top=c[1],b.bounds=new OpenLayers.Bounds(b.left,b.bottom,b.right,b.top),delete b.left,delete b.bottom,delete b.right,delete b.top},Language:function(a,b){b.language=this.getChildValue(a)}}},writers:{ows:{BoundingBox:function(a){var b=this.createElementNSPlus("ows:BoundingBox",{attributes:{crs:a.projection}});return this.writeNode("ows:LowerCorner",a,b),this.writeNode("ows:UpperCorner",a,b),b},LowerCorner:function(a){return this.createElementNSPlus("ows:LowerCorner",{value:a.bounds.left+" "+a.bounds.bottom})},UpperCorner:function(a){return this.createElementNSPlus("ows:UpperCorner",{value:a.bounds.right+" "+a.bounds.top})},Identifier:function(a){return this.createElementNSPlus("ows:Identifier",{value:a})},Title:function(a){return this.createElementNSPlus("ows:Title",{value:a})},Abstract:function(a){return this.createElementNSPlus("ows:Abstract",{value:a})},OutputFormat:function(a){return this.createElementNSPlus("ows:OutputFormat",{value:a})}}},CLASS_NAME:"OpenLayers.Format.OWSCommon.v1"}),OpenLayers.Format.OWSCommon.v1_0_0=OpenLayers.Class(OpenLayers.Format.OWSCommon.v1,{namespaces:{ows:"http://www.opengis.net/ows",xlink:"http://www.w3.org/1999/xlink"},readers:{ows:OpenLayers.Util.applyDefaults({ExceptionReport:function(a,b){b.success=!1,b.exceptionReport={version:a.getAttribute("version"),language:a.getAttribute("language"),exceptions:[]},this.readChildNodes(a,b.exceptionReport)}},OpenLayers.Format.OWSCommon.v1.prototype.readers.ows)},writers:{ows:OpenLayers.Format.OWSCommon.v1.prototype.writers.ows},CLASS_NAME:"OpenLayers.Format.OWSCommon.v1_0_0"}),OpenLayers.Format.WFST.v1_1_0=OpenLayers.Class(OpenLayers.Format.Filter.v1_1_0,OpenLayers.Format.WFST.v1,{version:"1.1.0",schemaLocations:{wfs:"http://schemas.opengis.net/wfs/1.1.0/wfs.xsd"},initialize:function(a){OpenLayers.Format.Filter.v1_1_0.prototype.initialize.apply(this,[a]),OpenLayers.Format.WFST.v1.prototype.initialize.apply(this,[a])},readNode:function(a,b){return OpenLayers.Format.GML.v3.prototype.readNode.apply(this,[a,b])},readers:{wfs:OpenLayers.Util.applyDefaults({FeatureCollection:function(a,b){b.numberOfFeatures=parseInt(a.getAttribute("numberOfFeatures")),OpenLayers.Format.WFST.v1.prototype.readers.wfs.FeatureCollection.apply(this,arguments)},TransactionResponse:function(a,b){b.insertIds=[],b.success=!1,this.readChildNodes(a,b)},TransactionSummary:function(a,b){b.success=!0},InsertResults:function(a,b){this.readChildNodes(a,b)},Feature:function(a,b){var c={fids:[]};this.readChildNodes(a,c),b.insertIds.push(c.fids[0])}},OpenLayers.Format.WFST.v1.prototype.readers.wfs),gml:OpenLayers.Format.GML.v3.prototype.readers.gml,feature:OpenLayers.Format.GML.v3.prototype.readers.feature,ogc:OpenLayers.Format.Filter.v1_1_0.prototype.readers.ogc,ows:OpenLayers.Format.OWSCommon.v1_0_0.prototype.readers.ows},writers:{wfs:OpenLayers.Util.applyDefaults({GetFeature:function(a){var b=OpenLayers.Format.WFST.v1.prototype.writers.wfs.GetFeature.apply(this,arguments);return a&&this.setAttributes(b,{resultType:a.resultType,startIndex:a.startIndex,count:a.count}),b},Query:function(a){var a=OpenLayers.Util.extend({featureNS:this.featureNS,featurePrefix:this.featurePrefix,featureType:this.featureType,srsName:this.srsName},a),b=a.featurePrefix,c=this.createElementNSPlus("wfs:Query",{attributes:{typeName:(b?b+":":"")+a.featureType,srsName:a.srsName}});if(a.featureNS&&c.setAttribute("xmlns:"+b,a.featureNS),a.propertyNames)for(var b=0,d=a.propertyNames.length;d>b;b++)this.writeNode("wfs:PropertyName",{property:a.propertyNames[b]},c);return a.filter&&(OpenLayers.Format.WFST.v1_1_0.prototype.setFilterProperty.call(this,a.filter),this.writeNode("ogc:Filter",a.filter,c)),c},PropertyName:function(a){return this.createElementNSPlus("wfs:PropertyName",{value:a.property})}},OpenLayers.Format.WFST.v1.prototype.writers.wfs),gml:OpenLayers.Format.GML.v3.prototype.writers.gml,feature:OpenLayers.Format.GML.v3.prototype.writers.feature,ogc:OpenLayers.Format.Filter.v1_1_0.prototype.writers.ogc},CLASS_NAME:"OpenLayers.Format.WFST.v1_1_0"}),OpenLayers.Protocol=OpenLayers.Class({format:null,options:null,autoDestroy:!0,defaultFilter:null,initialize:function(a){a=a||{},OpenLayers.Util.extend(this,a),this.options=a},mergeWithDefaultFilter:function(a){return a&&this.defaultFilter?new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.AND,filters:[this.defaultFilter,a]}):a||this.defaultFilter||void 0},destroy:function(){this.format=this.options=null},read:function(a){a=a||{},a.filter=this.mergeWithDefaultFilter(a.filter)},create:function(){},update:function(){},"delete":function(){},commit:function(){},abort:function(){},createCallback:function(a,b,c){return OpenLayers.Function.bind(function(){a.apply(this,[b,c])},this)},CLASS_NAME:"OpenLayers.Protocol"}),OpenLayers.Protocol.Response=OpenLayers.Class({code:null,requestType:null,last:!0,features:null,data:null,reqFeatures:null,priv:null,error:null,initialize:function(a){OpenLayers.Util.extend(this,a)},success:function(){return 0<this.code},CLASS_NAME:"OpenLayers.Protocol.Response"}),OpenLayers.Protocol.Response.SUCCESS=1,OpenLayers.Protocol.Response.FAILURE=0,OpenLayers.Format.JSON=OpenLayers.Class(OpenLayers.Format,{indent:"    ",space:" ",newline:"\n",level:0,pretty:!1,nativeJSON:function(){return!(!window.JSON||"function"!=typeof JSON.parse||"function"!=typeof JSON.stringify)}(),read:function(a,b){var c;if(this.nativeJSON)c=JSON.parse(a,b);else try{if(/^[\],:{}\s]*$/.test(a.replace(/\\["\\\/bfnrtu]/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))&&(c=eval("("+a+")"),"function"==typeof b)){var d=function(a,c){if(c&&"object"==typeof c)for(var e in c)c.hasOwnProperty(e)&&(c[e]=d(e,c[e]));return b(a,c)};c=d("",c)}}catch(e){}return this.keepData&&(this.data=c),c},write:function(a,b){this.pretty=!!b;var c=null,d=typeof a;if(this.serialize[d])try{c=!this.pretty&&this.nativeJSON?JSON.stringify(a):this.serialize[d].apply(this,[a])}catch(e){OpenLayers.Console.error("Trouble serializing: "+e)}return c},writeIndent:function(){var a=[];if(this.pretty)for(var b=0;b<this.level;++b)a.push(this.indent);return a.join("")},writeNewline:function(){return this.pretty?this.newline:""},writeSpace:function(){return this.pretty?this.space:""},serialize:{object:function(a){if(null==a)return"null";if(a.constructor==Date)return this.serialize.date.apply(this,[a]);if(a.constructor==Array)return this.serialize.array.apply(this,[a]);var b=["{"];this.level+=1;var c,d,e,f=!1;for(c in a)a.hasOwnProperty(c)&&(d=OpenLayers.Format.JSON.prototype.write.apply(this,[c,this.pretty]),e=OpenLayers.Format.JSON.prototype.write.apply(this,[a[c],this.pretty]),null!=d&&null!=e&&(f&&b.push(","),b.push(this.writeNewline(),this.writeIndent(),d,":",this.writeSpace(),e),f=!0));return this.level-=1,b.push(this.writeNewline(),this.writeIndent(),"}"),b.join("")},array:function(a){var b,c=["["];this.level+=1;for(var d=0,e=a.length;e>d;++d)b=OpenLayers.Format.JSON.prototype.write.apply(this,[a[d],this.pretty]),null!=b&&(d>0&&c.push(","),c.push(this.writeNewline(),this.writeIndent(),b));return this.level-=1,c.push(this.writeNewline(),this.writeIndent(),"]"),c.join("")},string:function(a){var b={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};return/["\\\x00-\x1f]/.test(a)?'"'+a.replace(/([\x00-\x1f\\"])/g,function(a,c){var d=b[c];return d?d:(d=c.charCodeAt(),"\\u00"+Math.floor(d/16).toString(16)+(d%16).toString(16))})+'"':'"'+a+'"'},number:function(a){return isFinite(a)?""+a:"null"},"boolean":function(a){return""+a},date:function(a){function b(a){return 10>a?"0"+a:a}return'"'+a.getFullYear()+"-"+b(a.getMonth()+1)+"-"+b(a.getDate())+"T"+b(a.getHours())+":"+b(a.getMinutes())+":"+b(a.getSeconds())+'"'}},CLASS_NAME:"OpenLayers.Format.JSON"}),OpenLayers.Format.GeoJSON=OpenLayers.Class(OpenLayers.Format.JSON,{ignoreExtraDims:!1,read:function(a,b,c){var b=b?b:"FeatureCollection",d=null,e=null;if(e="string"==typeof a?OpenLayers.Format.JSON.prototype.read.apply(this,[a,c]):a){if("string"!=typeof e.type)OpenLayers.Console.error("Bad GeoJSON - no type: "+a);else if(this.isValidType(e,b))switch(b){case"Geometry":try{d=this.parseGeometry(e)}catch(f){OpenLayers.Console.error(f)}break;case"Feature":try{d=this.parseFeature(e),d.type="Feature"}catch(g){OpenLayers.Console.error(g)}break;case"FeatureCollection":switch(d=[],e.type){case"Feature":try{d.push(this.parseFeature(e))}catch(h){d=null,OpenLayers.Console.error(h)}break;case"FeatureCollection":for(a=0,b=e.features.length;b>a;++a)try{d.push(this.parseFeature(e.features[a]))}catch(i){d=null,OpenLayers.Console.error(i)}break;default:try{var j=this.parseGeometry(e);d.push(new OpenLayers.Feature.Vector(j))}catch(k){d=null,OpenLayers.Console.error(k)}}}}else OpenLayers.Console.error("Bad JSON: "+a);return d},isValidType:function(a,b){var c=!1;switch(b){case"Geometry":-1==OpenLayers.Util.indexOf("Point MultiPoint LineString MultiLineString Polygon MultiPolygon Box GeometryCollection".split(" "),a.type)?OpenLayers.Console.error("Unsupported geometry type: "+a.type):c=!0;break;case"FeatureCollection":c=!0;break;default:a.type==b?c=!0:OpenLayers.Console.error("Cannot convert types from "+a.type+" to "+b)}return c},parseFeature:function(a){var b,c,d;c=a.properties?a.properties:{},d=a.geometry&&a.geometry.bbox||a.bbox;try{b=this.parseGeometry(a.geometry)}catch(e){throw e}return b=new OpenLayers.Feature.Vector(b,c),d&&(b.bounds=OpenLayers.Bounds.fromArray(d)),a.id&&(b.fid=a.id),b},parseGeometry:function(a){if(null==a)return null;var b,c=!1;if("GeometryCollection"==a.type){if(!OpenLayers.Util.isArray(a.geometries))throw"GeometryCollection must have geometries array: "+a;b=a.geometries.length;for(var c=Array(b),d=0;b>d;++d)c[d]=this.parseGeometry.apply(this,[a.geometries[d]]);b=new OpenLayers.Geometry.Collection(c),c=!0}else{if(!OpenLayers.Util.isArray(a.coordinates))throw"Geometry must have coordinates array: "+a;if(!this.parseCoords[a.type.toLowerCase()])throw"Unsupported geometry type: "+a.type;try{b=this.parseCoords[a.type.toLowerCase()].apply(this,[a.coordinates])}catch(e){throw e}}return this.internalProjection&&this.externalProjection&&!c&&b.transform(this.externalProjection,this.internalProjection),b},parseCoords:{point:function(a){if(0==this.ignoreExtraDims&&2!=a.length)throw"Only 2D points are supported: "+a;return new OpenLayers.Geometry.Point(a[0],a[1])},multipoint:function(a){for(var b=[],c=null,d=0,e=a.length;e>d;++d){try{c=this.parseCoords.point.apply(this,[a[d]])}catch(f){throw f}b.push(c)}return new OpenLayers.Geometry.MultiPoint(b)},linestring:function(a){for(var b=[],c=null,d=0,e=a.length;e>d;++d){try{c=this.parseCoords.point.apply(this,[a[d]])}catch(f){throw f}b.push(c)}return new OpenLayers.Geometry.LineString(b)},multilinestring:function(a){for(var b=[],c=null,d=0,e=a.length;e>d;++d){try{c=this.parseCoords.linestring.apply(this,[a[d]])}catch(f){throw f}b.push(c)}return new OpenLayers.Geometry.MultiLineString(b)},polygon:function(a){for(var b,c,d=[],e=0,f=a.length;f>e;++e){try{c=this.parseCoords.linestring.apply(this,[a[e]])}catch(g){throw g}b=new OpenLayers.Geometry.LinearRing(c.components),d.push(b)}return new OpenLayers.Geometry.Polygon(d)},multipolygon:function(a){for(var b=[],c=null,d=0,e=a.length;e>d;++d){try{c=this.parseCoords.polygon.apply(this,[a[d]])}catch(f){throw f}b.push(c)}return new OpenLayers.Geometry.MultiPolygon(b)},box:function(a){if(2!=a.length)throw"GeoJSON box coordinates must have 2 elements";return new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing([new OpenLayers.Geometry.Point(a[0][0],a[0][1]),new OpenLayers.Geometry.Point(a[1][0],a[0][1]),new OpenLayers.Geometry.Point(a[1][0],a[1][1]),new OpenLayers.Geometry.Point(a[0][0],a[1][1]),new OpenLayers.Geometry.Point(a[0][0],a[0][1])])])}},write:function(a,b){var c={type:null};if(OpenLayers.Util.isArray(a)){c.type="FeatureCollection";var d=a.length;c.features=Array(d);for(var e=0;d>e;++e){var f=a[e];if(!f instanceof OpenLayers.Feature.Vector)throw"FeatureCollection only supports collections of features: "+f;c.features[e]=this.extract.feature.apply(this,[f])}}else 0==a.CLASS_NAME.indexOf("OpenLayers.Geometry")?c=this.extract.geometry.apply(this,[a]):a instanceof OpenLayers.Feature.Vector&&(c=this.extract.feature.apply(this,[a]),a.layer&&a.layer.projection&&(c.crs=this.createCRSObject(a)));return OpenLayers.Format.JSON.prototype.write.apply(this,[c,b])},createCRSObject:function(a){var a=a.layer.projection.toString(),b={};return a.match(/epsg:/i)&&(a=parseInt(a.substring(a.indexOf(":")+1)),b=4326==a?{type:"name",properties:{name:"urn:ogc:def:crs:OGC:1.3:CRS84"}}:{type:"name",properties:{name:"EPSG:"+a}}),b},extract:{feature:function(a){var b=this.extract.geometry.apply(this,[a.geometry]),b={type:"Feature",properties:a.attributes,geometry:b};return null!=a.fid&&(b.id=a.fid),b},geometry:function(a){if(null==a)return null;this.internalProjection&&this.externalProjection&&(a=a.clone(),a.transform(this.internalProjection,this.externalProjection));var b=a.CLASS_NAME.split(".")[2],a=this.extract[b.toLowerCase()].apply(this,[a]);return"Collection"==b?{type:"GeometryCollection",geometries:a}:{type:b,coordinates:a}},point:function(a){return[a.x,a.y]},multipoint:function(a){for(var b=[],c=0,d=a.components.length;d>c;++c)b.push(this.extract.point.apply(this,[a.components[c]]));return b},linestring:function(a){for(var b=[],c=0,d=a.components.length;d>c;++c)b.push(this.extract.point.apply(this,[a.components[c]]));return b},multilinestring:function(a){for(var b=[],c=0,d=a.components.length;d>c;++c)b.push(this.extract.linestring.apply(this,[a.components[c]]));return b},polygon:function(a){for(var b=[],c=0,d=a.components.length;d>c;++c)b.push(this.extract.linestring.apply(this,[a.components[c]]));return b},multipolygon:function(a){for(var b=[],c=0,d=a.components.length;d>c;++c)b.push(this.extract.polygon.apply(this,[a.components[c]]));return b},collection:function(a){for(var b=a.components.length,c=Array(b),d=0;b>d;++d)c[d]=this.extract.geometry.apply(this,[a.components[d]]);return c}},CLASS_NAME:"OpenLayers.Format.GeoJSON"}),OpenLayers.Protocol.Script=OpenLayers.Class(OpenLayers.Protocol,{url:null,params:null,callback:null,callbackTemplate:"OpenLayers.Protocol.Script.registry.${id}",callbackKey:"callback",callbackPrefix:"",scope:null,format:null,pendingRequests:null,srsInBBOX:!1,initialize:function(a){if(a=a||{},this.params={},this.pendingRequests={},OpenLayers.Protocol.prototype.initialize.apply(this,arguments),this.format||(this.format=new OpenLayers.Format.GeoJSON),!this.filterToParams&&OpenLayers.Format.QueryStringFilter){var b=new OpenLayers.Format.QueryStringFilter({srsInBBOX:this.srsInBBOX});this.filterToParams=function(a,c){return b.write(a,c)}}},read:function(a){OpenLayers.Protocol.prototype.read.apply(this,arguments),a=OpenLayers.Util.applyDefaults(a,this.options),a.params=OpenLayers.Util.applyDefaults(a.params,this.options.params),a.filter&&this.filterToParams&&(a.params=this.filterToParams(a.filter,a.params));var b=new OpenLayers.Protocol.Response({requestType:"read"}),c=this.createRequest(a.url,a.params,OpenLayers.Function.bind(function(c){b.data=c,this.handleRead(b,a)},this));return b.priv=c,b},createRequest:function(a,b,c){var c=OpenLayers.Protocol.Script.register(c),d=OpenLayers.String.format(this.callbackTemplate,{id:c}),b=OpenLayers.Util.extend({},b);return b[this.callbackKey]=this.callbackPrefix+d,a=OpenLayers.Util.urlAppend(a,OpenLayers.Util.getParameterString(b)),b=document.createElement("script"),b.type="text/javascript",b.src=a,b.id="OpenLayers_Protocol_Script_"+c,this.pendingRequests[b.id]=b,document.getElementsByTagName("head")[0].appendChild(b),b},destroyRequest:function(a){OpenLayers.Protocol.Script.unregister(a.id.split("_").pop()),delete this.pendingRequests[a.id],a.parentNode&&a.parentNode.removeChild(a)},handleRead:function(a,b){this.handleResponse(a,b)},handleResponse:function(a,b){b.callback&&(a.data?(a.features=this.parseFeatures(a.data),a.code=OpenLayers.Protocol.Response.SUCCESS):a.code=OpenLayers.Protocol.Response.FAILURE,this.destroyRequest(a.priv),b.callback.call(b.scope,a))},parseFeatures:function(a){return this.format.read(a)},abort:function(a){if(a)this.destroyRequest(a.priv);else for(var b in this.pendingRequests)this.destroyRequest(this.pendingRequests[b])},destroy:function(){this.abort(),delete this.params,delete this.format,OpenLayers.Protocol.prototype.destroy.apply(this)},CLASS_NAME:"OpenLayers.Protocol.Script"}),function(){var a=OpenLayers.Protocol.Script,b=0;a.registry={},a.register=function(c){var d="c"+ ++b;return a.registry[d]=function(){c.apply(this,arguments)},d},a.unregister=function(b){delete a.registry[b]}}(),OpenLayers.Control.Panel=OpenLayers.Class(OpenLayers.Control,{controls:null,autoActivate:!0,defaultControl:null,saveState:!1,allowDepress:!1,activeState:null,initialize:function(a){OpenLayers.Control.prototype.initialize.apply(this,[a]),this.controls=[],this.activeState={}},destroy:function(){this.map&&this.map.events.unregister("buttonclick",this,this.onButtonClick),OpenLayers.Control.prototype.destroy.apply(this,arguments);for(var a,b=this.controls.length-1;b>=0;b--)a=this.controls[b],a.events&&a.events.un({activate:this.iconOn,deactivate:this.iconOff}),a.panel_div=null;this.activeState=null},activate:function(){if(OpenLayers.Control.prototype.activate.apply(this,arguments)){for(var a,b=0,c=this.controls.length;c>b;b++)a=this.controls[b],(a===this.defaultControl||this.saveState&&this.activeState[a.id])&&a.activate();return!0===this.saveState&&(this.defaultControl=null),this.redraw(),!0}return!1},deactivate:function(){if(OpenLayers.Control.prototype.deactivate.apply(this,arguments)){for(var a,b=0,c=this.controls.length;c>b;b++)a=this.controls[b],this.activeState[a.id]=a.deactivate();return this.redraw(),!0}return!1},draw:function(){return OpenLayers.Control.prototype.draw.apply(this,arguments),this.outsideViewport?(this.events.attachToElement(this.div),this.events.register("buttonclick",this,this.onButtonClick)):this.map.events.register("buttonclick",this,this.onButtonClick),this.addControlsToMap(this.controls),this.div},redraw:function(){for(var a=this.div.childNodes.length-1;a>=0;a--)this.div.removeChild(this.div.childNodes[a]);if(this.div.innerHTML="",this.active)for(var a=0,b=this.controls.length;b>a;a++)this.div.appendChild(this.controls[a].panel_div)},activateControl:function(a){if(!this.active)return!1;if(a.type==OpenLayers.Control.TYPE_BUTTON)a.trigger();else if(a.type==OpenLayers.Control.TYPE_TOGGLE)a.active?a.deactivate():a.activate();else if(this.allowDepress&&a.active)a.deactivate();else{for(var b,c=0,d=this.controls.length;d>c;c++)b=this.controls[c],b!=a&&(b.type===OpenLayers.Control.TYPE_TOOL||null==b.type)&&b.deactivate();a.activate()}},addControls:function(a){OpenLayers.Util.isArray(a)||(a=[a]),this.controls=this.controls.concat(a);for(var b=0,c=a.length;c>b;b++){var d=a[b],e=this.createControlMarkup(d);OpenLayers.Element.addClass(e,d.displayClass+"ItemInactive"),OpenLayers.Element.addClass(e,"olButton"),""!=d.title&&!e.title&&(e.title=d.title),d.panel_div=e}this.map&&(this.addControlsToMap(a),this.redraw())},createControlMarkup:function(){return document.createElement("div")},addControlsToMap:function(a){for(var b,c=0,d=a.length;d>c;c++)b=a[c],!0===b.autoActivate?(b.autoActivate=!1,this.map.addControl(b),b.autoActivate=!0):(this.map.addControl(b),b.deactivate()),b.events.on({activate:this.iconOn,deactivate:this.iconOff})},iconOn:function(){var a=this.panel_div;a.className=a.className.replace(RegExp("\\b("+this.displayClass+"Item)Inactive\\b"),"$1Active")},iconOff:function(){var a=this.panel_div;a.className=a.className.replace(RegExp("\\b("+this.displayClass+"Item)Active\\b"),"$1Inactive")},onButtonClick:function(a){for(var b=this.controls,a=a.buttonElement,c=b.length-1;c>=0;--c)if(b[c].panel_div===a){this.activateControl(b[c]);break}},getControlsBy:function(a,b){var c="function"==typeof b.test;return OpenLayers.Array.filter(this.controls,function(d){return d[a]==b||c&&b.test(d[a])})},getControlsByName:function(a){return this.getControlsBy("name",a)},getControlsByClass:function(a){return this.getControlsBy("CLASS_NAME",a)},CLASS_NAME:"OpenLayers.Control.Panel"}),OpenLayers.Control.ZoomIn=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_BUTTON,trigger:function(){this.map.zoomIn()},CLASS_NAME:"OpenLayers.Control.ZoomIn"}),OpenLayers.Control.ZoomOut=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_BUTTON,trigger:function(){this.map.zoomOut()},CLASS_NAME:"OpenLayers.Control.ZoomOut"}),OpenLayers.Control.ZoomToMaxExtent=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_BUTTON,trigger:function(){this.map&&this.map.zoomToMaxExtent()},CLASS_NAME:"OpenLayers.Control.ZoomToMaxExtent"}),OpenLayers.Control.ZoomPanel=OpenLayers.Class(OpenLayers.Control.Panel,{initialize:function(a){OpenLayers.Control.Panel.prototype.initialize.apply(this,[a]),this.addControls([new OpenLayers.Control.ZoomIn,new OpenLayers.Control.ZoomToMaxExtent,new OpenLayers.Control.ZoomOut])},CLASS_NAME:"OpenLayers.Control.ZoomPanel"}),OpenLayers.Layer.HTTPRequest=OpenLayers.Class(OpenLayers.Layer,{URL_HASH_FACTOR:(Math.sqrt(5)-1)/2,url:null,params:null,reproject:!1,initialize:function(a,b,c,d){OpenLayers.Layer.prototype.initialize.apply(this,[a,d]),this.url=b,this.params||(this.params=OpenLayers.Util.extend({},c))},destroy:function(){this.params=this.url=null,OpenLayers.Layer.prototype.destroy.apply(this,arguments)},clone:function(a){return null==a&&(a=new OpenLayers.Layer.HTTPRequest(this.name,this.url,this.params,this.getOptions())),a=OpenLayers.Layer.prototype.clone.apply(this,[a])},setUrl:function(a){this.url=a},mergeNewParams:function(a){return this.params=OpenLayers.Util.extend(this.params,a),a=this.redraw(),null!=this.map&&this.map.events.triggerEvent("changelayer",{layer:this,property:"params"}),a},redraw:function(a){return a?this.mergeNewParams({_olSalt:Math.random()}):OpenLayers.Layer.prototype.redraw.apply(this,[])},selectUrl:function(a,b){for(var c=1,d=0,e=a.length;e>d;d++)c*=a.charCodeAt(d)*this.URL_HASH_FACTOR,c-=Math.floor(c);return b[Math.floor(c*b.length)]},getFullRequestString:function(a,b){var c=b||this.url,d=OpenLayers.Util.extend({},this.params),d=OpenLayers.Util.extend(d,a),e=OpenLayers.Util.getParameterString(d);OpenLayers.Util.isArray(c)&&(c=this.selectUrl(e,c));var f,e=OpenLayers.Util.upperCaseObject(OpenLayers.Util.getParameters(c));for(f in d)f.toUpperCase()in e&&delete d[f];return e=OpenLayers.Util.getParameterString(d),OpenLayers.Util.urlAppend(c,e)},CLASS_NAME:"OpenLayers.Layer.HTTPRequest"}),OpenLayers.Tile=OpenLayers.Class({events:null,eventListeners:null,id:null,layer:null,url:null,bounds:null,size:null,position:null,isLoading:!1,initialize:function(a,b,c,d,e,f){this.layer=a,this.position=b.clone(),this.setBounds(c),this.url=d,e&&(this.size=e.clone()),this.id=OpenLayers.Util.createUniqueID("Tile_"),OpenLayers.Util.extend(this,f),this.events=new OpenLayers.Events(this),this.eventListeners instanceof Object&&this.events.on(this.eventListeners)},unload:function(){this.isLoading&&(this.isLoading=!1,this.events.triggerEvent("unload"))},destroy:function(){this.position=this.size=this.bounds=this.layer=null,this.eventListeners&&this.events.un(this.eventListeners),this.events.destroy(),this.events=this.eventListeners=null},draw:function(a){a||this.clear();var b=this.shouldDraw();return b&&!a&&(b=!1!==this.events.triggerEvent("beforedraw")),b},shouldDraw:function(){var a=!1,b=this.layer.maxExtent;if(b){var c=this.layer.map,c=c.baseLayer.wrapDateLine&&c.getMaxExtent();this.bounds.intersectsBounds(b,{inclusive:!1,worldBounds:c})&&(a=!0)}return a||this.layer.displayOutsideMaxExtent},setBounds:function(a){if(a=a.clone(),this.layer.map.baseLayer.wrapDateLine)var b=this.layer.map.getMaxExtent(),c=this.layer.map.getResolution(),a=a.wrapDateLine(b,{leftTolerance:c,rightTolerance:c});this.bounds=a},moveTo:function(a,b,c){null==c&&(c=!0),this.setBounds(a),this.position=b.clone(),c&&this.draw()},clear:function(){},CLASS_NAME:"OpenLayers.Tile"}),OpenLayers.Tile.Image=OpenLayers.Class(OpenLayers.Tile,{url:null,imgDiv:null,frame:null,imageReloadAttempts:null,layerAlphaHack:null,asyncRequestId:null,blankImageUrl:"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAQAIBRAA7",maxGetUrlLength:null,canvasContext:null,crossOriginKeyword:null,initialize:function(a,b,c,d){OpenLayers.Tile.prototype.initialize.apply(this,arguments),this.url=d,this.layerAlphaHack=this.layer.alpha&&OpenLayers.Util.alphaHack(),(null!=this.maxGetUrlLength||this.layer.gutter||this.layerAlphaHack)&&(this.frame=document.createElement("div"),this.frame.style.position="absolute",this.frame.style.overflow="hidden"),null!=this.maxGetUrlLength&&OpenLayers.Util.extend(this,OpenLayers.Tile.Image.IFrame)},destroy:function(){this.imgDiv&&(this.clear(),this.frame=this.imgDiv=null),this.asyncRequestId=null,OpenLayers.Tile.prototype.destroy.apply(this,arguments)},draw:function(){var a=OpenLayers.Tile.prototype.draw.apply(this,arguments);return a?(this.layer!=this.layer.map.baseLayer&&this.layer.reproject&&(this.bounds=this.getBoundsFromBaseLayer(this.position)),this.isLoading?this._loadEvent="reload":(this.isLoading=!0,this._loadEvent="loadstart"),this.positionTile(),this.renderTile()):this.unload(),a},renderTile:function(){if(this.layer.div.appendChild(this.getTile()),this.layer.async){var a=this.asyncRequestId=(this.asyncRequestId||0)+1;this.layer.getURLasync(this.bounds,function(b){a==this.asyncRequestId&&(this.url=b,this.initImage())},this)}else this.url=this.layer.getURL(this.bounds),this.initImage()},positionTile:function(){var a=this.getTile().style,b=this.frame?this.size:this.layer.getImageSize(this.bounds);a.left=this.position.x+"%",a.top=this.position.y+"%",a.width=b.w+"%",a.height=b.h+"%"},clear:function(){OpenLayers.Tile.prototype.clear.apply(this,arguments);var a=this.imgDiv;if(a){OpenLayers.Event.stopObservingElement(a);var b=this.getTile();b.parentNode===this.layer.div&&this.layer.div.removeChild(b),this.setImgSrc(),!0===this.layerAlphaHack&&(a.style.filter=""),OpenLayers.Element.removeClass(a,"olImageLoadError")}this.canvasContext=null},getImage:function(){if(!this.imgDiv){this.imgDiv=document.createElement("img"),this.imgDiv.className="olTileImage",this.imgDiv.galleryImg="no";var a=this.imgDiv.style;if(this.frame){var b=0,c=0;this.layer.gutter&&(b=100*(this.layer.gutter/this.layer.tileSize.w),c=100*(this.layer.gutter/this.layer.tileSize.h)),a.left=-b+"%",a.top=-c+"%",a.width=2*b+100+"%",a.height=2*c+100+"%"}a.visibility="hidden",a.opacity=0,1>this.layer.opacity&&(a.filter="alpha(opacity="+100*this.layer.opacity+")"),a.position="absolute",this.layerAlphaHack&&(a.paddingTop=a.height,a.height="0",a.width="100%"),this.frame&&this.frame.appendChild(this.imgDiv)}return this.imgDiv},initImage:function(){this.events.triggerEvent(this._loadEvent);var a=this.getImage();if(this.url&&a.getAttribute("src")==this.url)this.onImageLoad();else{var b=OpenLayers.Function.bind(function(){OpenLayers.Event.stopObservingElement(a),OpenLayers.Event.observe(a,"load",OpenLayers.Function.bind(this.onImageLoad,this)),OpenLayers.Event.observe(a,"error",OpenLayers.Function.bind(this.onImageError,this)),this.imageReloadAttempts=0,this.setImgSrc(this.url)},this);a.getAttribute("src")==this.blankImageUrl?b():(OpenLayers.Event.observe(a,"load",b),OpenLayers.Event.observe(a,"error",b),this.crossOriginKeyword&&a.removeAttribute("crossorigin"),a.src=this.blankImageUrl)}},setImgSrc:function(a){var b=this.imgDiv;b.style.visibility="hidden",b.style.opacity=0,a&&(this.crossOriginKeyword&&("data:"!==a.substr(0,5)?b.setAttribute("crossorigin",this.crossOriginKeyword):b.removeAttribute("crossorigin")),b.src=a)},getTile:function(){return this.frame?this.frame:this.getImage()},createBackBuffer:function(){if(this.imgDiv&&!this.isLoading){var a;return this.frame?(a=this.frame.cloneNode(!1),a.appendChild(this.imgDiv)):a=this.imgDiv,this.imgDiv=null,a}},onImageLoad:function(){var a=this.imgDiv;if(OpenLayers.Event.stopObservingElement(a),a.style.visibility="inherit",a.style.opacity=this.layer.opacity,this.isLoading=!1,this.canvasContext=null,this.events.triggerEvent("loadend"),7>parseFloat(navigator.appVersion.split("MSIE")[1])&&this.layer&&this.layer.div){var b=document.createElement("span");b.style.display="none";var c=this.layer.div;c.appendChild(b),window.setTimeout(function(){b.parentNode===c&&b.parentNode.removeChild(b)},0)}!0===this.layerAlphaHack&&(a.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+a.src+"', sizingMethod='scale')")},onImageError:function(){var a=this.imgDiv;null!=a.src&&(this.imageReloadAttempts++,this.imageReloadAttempts<=OpenLayers.IMAGE_RELOAD_ATTEMPTS?this.setImgSrc(this.layer.getURL(this.bounds)):(OpenLayers.Element.addClass(a,"olImageLoadError"),this.events.triggerEvent("loaderror"),this.onImageLoad()))},getCanvasContext:function(){if(OpenLayers.CANVAS_SUPPORTED&&this.imgDiv&&!this.isLoading){if(!this.canvasContext){var a=document.createElement("canvas");a.width=this.size.w,a.height=this.size.h,this.canvasContext=a.getContext("2d"),this.canvasContext.drawImage(this.imgDiv,0,0)}return this.canvasContext}},CLASS_NAME:"OpenLayers.Tile.Image"}),OpenLayers.Layer.Grid=OpenLayers.Class(OpenLayers.Layer.HTTPRequest,{tileSize:null,tileOriginCorner:"bl",tileOrigin:null,tileOptions:null,tileClass:OpenLayers.Tile.Image,grid:null,singleTile:!1,ratio:1.5,buffer:0,transitionEffect:null,numLoadingTiles:0,tileLoadingDelay:85,serverResolutions:null,moveTimerId:null,deferMoveGriddedTiles:null,tileQueueId:null,tileQueue:null,loading:!1,backBuffer:null,gridResolution:null,backBufferResolution:null,backBufferLonLat:null,backBufferTimerId:null,removeBackBufferDelay:null,className:null,initialize:function(){OpenLayers.Layer.HTTPRequest.prototype.initialize.apply(this,arguments),this.grid=[],this.tileQueue=[],null===this.removeBackBufferDelay&&(this.removeBackBufferDelay=this.singleTile?0:2500),null===this.className&&(this.className=this.singleTile?"olLayerGridSingleTile":"olLayerGrid"),OpenLayers.Animation.isNative||(this.deferMoveGriddedTiles=OpenLayers.Function.bind(function(){this.moveGriddedTiles(!0),this.moveTimerId=null},this))},setMap:function(a){OpenLayers.Layer.HTTPRequest.prototype.setMap.call(this,a),OpenLayers.Element.addClass(this.div,this.className)},removeMap:function(){null!==this.moveTimerId&&(window.clearTimeout(this.moveTimerId),this.moveTimerId=null),this.clearTileQueue(),null!==this.backBufferTimerId&&(window.clearTimeout(this.backBufferTimerId),this.backBufferTimerId=null)},destroy:function(){this.removeBackBuffer(),this.clearGrid(),this.tileSize=this.grid=null,OpenLayers.Layer.HTTPRequest.prototype.destroy.apply(this,arguments)},clearGrid:function(){if(this.clearTileQueue(),this.grid){for(var a=0,b=this.grid.length;b>a;a++)for(var c=this.grid[a],d=0,e=c.length;e>d;d++)this.destroyTile(c[d]);this.grid=[],this.gridResolution=null}},clone:function(a){return null==a&&(a=new OpenLayers.Layer.Grid(this.name,this.url,this.params,this.getOptions())),a=OpenLayers.Layer.HTTPRequest.prototype.clone.apply(this,[a]),null!=this.tileSize&&(a.tileSize=this.tileSize.clone()),a.grid=[],a.gridResolution=null,a.backBuffer=null,a.backBufferTimerId=null,a.tileQueue=[],a.tileQueueId=null,a.loading=!1,a.moveTimerId=null,a
},moveTo:function(a,b,c){if(OpenLayers.Layer.HTTPRequest.prototype.moveTo.apply(this,arguments),a=a||this.map.getExtent(),null!=a){var d=!this.grid.length||b,e=this.getTilesBounds(),f=this.map.getResolution(),g=this.getServerResolution(f);this.singleTile?(d||!c&&!e.containsBounds(a))&&(b&&"resize"!==this.transitionEffect&&this.removeBackBuffer(),(!b||"resize"===this.transitionEffect)&&this.applyBackBuffer(g),this.initSingleTile(a)):(d=d||!e.intersectsBounds(a,{worldBounds:this.map.baseLayer.wrapDateLine&&this.map.getMaxExtent()}),f!==g?(a=this.map.calculateBounds(null,g),d&&this.transformDiv(g/f)):(this.div.style.width="100%",this.div.style.height="100%",this.div.style.left="0%",this.div.style.top="0%"),d?(b&&"resize"===this.transitionEffect&&this.applyBackBuffer(g),this.initGriddedTiles(a)):this.moveGriddedTiles())}},getTileData:function(a){var b=null,c=a.lon,d=a.lat,e=this.grid.length;if(this.map&&e){var f=this.map.getResolution(),a=this.tileSize.w,g=this.tileSize.h,h=this.grid[0][0].bounds,i=h.left,h=h.top;if(i>c&&this.map.baseLayer.wrapDateLine)var j=this.map.getMaxExtent().getWidth(),k=Math.ceil((i-c)/j),c=c+j*k;c=(c-i)/(f*a),d=(h-d)/(f*g),f=Math.floor(c),i=Math.floor(d),i>=0&&e>i&&(e=this.grid[i][f])&&(b={tile:e,i:Math.floor((c-f)*a),j:Math.floor((d-i)*g)})}return b},queueTileDraw:function(a){return a=a.object,~OpenLayers.Util.indexOf(this.tileQueue,a)||this.tileQueue.push(a),this.tileQueueId||(this.tileQueueId=OpenLayers.Animation.start(OpenLayers.Function.bind(this.drawTileFromQueue,this),null,this.div)),!1},drawTileFromQueue:function(){0===this.tileQueue.length?this.clearTileQueue():this.tileQueue.shift().draw(!0)},clearTileQueue:function(){OpenLayers.Animation.stop(this.tileQueueId),this.tileQueueId=null,this.tileQueue=[]},destroyTile:function(a){this.removeTileMonitoringHooks(a),a.destroy()},getServerResolution:function(a){if(a=a||this.map.getResolution(),this.serverResolutions&&-1===OpenLayers.Util.indexOf(this.serverResolutions,a)){var b,c;for(b=this.serverResolutions.length-1;b>=0;b--)if(c=this.serverResolutions[b],c>a){a=c;break}if(-1===b)throw"no appropriate resolution in serverResolutions"}return a},getServerZoom:function(){var a=this.getServerResolution();return this.serverResolutions?OpenLayers.Util.indexOf(this.serverResolutions,a):this.map.getZoomForResolution(a)+(this.zoomOffset||0)},transformDiv:function(a){this.div.style.width=100*a+"%",this.div.style.height=100*a+"%";var b=this.map.getSize(),c=parseInt(this.map.layerContainerDiv.style.left,10),d=(parseInt(this.map.layerContainerDiv.style.top,10)-b.h/2)*(a-1);this.div.style.left=(c-b.w/2)*(a-1)+"%",this.div.style.top=d+"%"},getResolutionScale:function(){return parseInt(this.div.style.width,10)/100},applyBackBuffer:function(a){null!==this.backBufferTimerId&&this.removeBackBuffer();var b=this.backBuffer;if(!b){if(b=this.createBackBuffer(),!b)return;this.div.insertBefore(b,this.div.firstChild),this.backBuffer=b;var c=this.grid[0][0].bounds;this.backBufferLonLat={lon:c.left,lat:c.top},this.backBufferResolution=this.gridResolution}var c=b.style,d=this.backBufferResolution/a;c.width=100*d+"%",c.height=100*d+"%",a=this.getViewPortPxFromLonLat(this.backBufferLonLat,a),c=parseInt(this.map.layerContainerDiv.style.left,10),d=parseInt(this.map.layerContainerDiv.style.top,10),b.style.left=Math.round(a.x-c)+"%",b.style.top=Math.round(a.y-d)+"%"},createBackBuffer:function(){var a;if(0<this.grid.length){a=document.createElement("div"),a.id=this.div.id+"_bb",a.className="olBackBuffer",a.style.position="absolute",a.style.width="100%",a.style.height="100%";for(var b=0,c=this.grid.length;c>b;b++)for(var d=0,e=this.grid[b].length;e>d;d++){var f=this.grid[b][d].createBackBuffer();f&&(f.style.top=b*this.tileSize.h+"%",f.style.left=d*this.tileSize.w+"%",a.appendChild(f))}}return a},removeBackBuffer:function(){this.backBuffer&&(this.div.removeChild(this.backBuffer),this.backBufferResolution=this.backBuffer=null,null!==this.backBufferTimerId&&(window.clearTimeout(this.backBufferTimerId),this.backBufferTimerId=null))},moveByPx:function(){this.singleTile||this.moveGriddedTiles()},setTileSize:function(a){this.singleTile&&(a=this.map.getSize(),a.h=parseInt(a.h*this.ratio),a.w=parseInt(a.w*this.ratio)),OpenLayers.Layer.HTTPRequest.prototype.setTileSize.apply(this,[a])},getTilesBounds:function(){var a=null,b=this.grid.length;if(b)var a=this.grid[b-1][0].bounds,b=this.grid[0].length*a.getWidth(),c=this.grid.length*a.getHeight(),a=new OpenLayers.Bounds(a.left,a.bottom,a.left+b,a.bottom+c);return a},initSingleTile:function(a){this.clearTileQueue();var b=a.getCenterLonLat(),c=a.getWidth()*this.ratio,a=a.getHeight()*this.ratio,b=new OpenLayers.Bounds(b.lon-c/2,b.lat-a/2,b.lon+c/2,b.lat+a/2),c=this.map.getLayerPxFromLonLat({lon:b.left,lat:b.top});this.grid.length||(this.grid[0]=[]),(a=this.grid[0][0])?a.moveTo(b,c):(a=this.addTile(b,c),this.addTileMonitoringHooks(a),a.draw(),this.grid[0][0]=a),this.removeExcessTiles(1,1),this.gridResolution=this.getServerResolution()},calculateGridLayout:function(a,b,c){var d=c*this.tileSize.w,c=c*this.tileSize.h,e=a.left-b.lon,f=Math.floor(e/d)-this.buffer,e=-(e/d-f)*this.tileSize.w,f=b.lon+f*d,a=a.top-(b.lat+c),g=Math.ceil(a/c)+this.buffer;return{tilelon:d,tilelat:c,tileoffsetlon:f,tileoffsetlat:b.lat+g*c,tileoffsetx:e,tileoffsety:-(g-a/c)*this.tileSize.h}},getTileOrigin:function(){var a=this.tileOrigin;if(!a)var a=this.getMaxExtent(),b={tl:["left","top"],tr:["right","top"],bl:["left","bottom"],br:["right","bottom"]}[this.tileOriginCorner],a=new OpenLayers.LonLat(a[b[0]],a[b[1]]);return a},initGriddedTiles:function(a){this.clearTileQueue();var b=this.map.getSize(),c=Math.ceil(b.h/this.tileSize.h)+Math.max(1,2*this.buffer),b=Math.ceil(b.w/this.tileSize.w)+Math.max(1,2*this.buffer),d=this.getTileOrigin(),e=this.getServerResolution(),d=this.calculateGridLayout(a,d,e),e=Math.round(d.tileoffsetx),f=Math.round(d.tileoffsety),g=d.tileoffsetlon,h=d.tileoffsetlat,i=d.tilelon,j=d.tilelat,k=e,l=g,m=0,n=parseInt(this.map.layerContainerDiv.style.left),o=parseInt(this.map.layerContainerDiv.style.top),d=[],p=this.map.getCenter();do{var q=this.grid[m++];q||(q=[],this.grid.push(q));var g=l,e=k,r=0;do{var s=new OpenLayers.Bounds(g,h,g+i,h+j),t=e,t=t-n,u=f,u=u-o,u=new OpenLayers.Pixel(t,u);(t=q[r++])?t.moveTo(s,u,!1):(t=this.addTile(s,u),this.addTileMonitoringHooks(t),q.push(t)),s=s.getCenterLonLat(),d.push({tile:t,distance:Math.pow(s.lon-p.lon,2)+Math.pow(s.lat-p.lat,2)}),g+=i,e+=this.tileSize.w}while(g<=a.right+i*this.buffer||b>r);h-=j,f+=this.tileSize.h}while(h>=a.bottom-j*this.buffer||c>m);for(this.removeExcessTiles(m,r),this.gridResolution=this.getServerResolution(),d.sort(function(a,b){return a.distance-b.distance}),a=0,c=d.length;c>a;++a)d[a].tile.draw()},getMaxExtent:function(){return this.maxExtent},addTile:function(a,b){var c=new this.tileClass(this,b,a,null,this.tileSize,this.tileOptions);return c.events.register("beforedraw",this,this.queueTileDraw),c},addTileMonitoringHooks:function(a){a.onLoadStart=function(){!1===this.loading&&(this.loading=!0,this.events.triggerEvent("loadstart")),this.events.triggerEvent("tileloadstart",{tile:a}),this.numLoadingTiles++},a.onLoadEnd=function(){this.numLoadingTiles--,this.events.triggerEvent("tileloaded",{tile:a}),0===this.tileQueue.length&&0===this.numLoadingTiles&&(this.loading=!1,this.events.triggerEvent("loadend"),this.backBuffer&&(this.backBufferTimerId=window.setTimeout(OpenLayers.Function.bind(this.removeBackBuffer,this),this.removeBackBufferDelay)))},a.onLoadError=function(){this.events.triggerEvent("tileerror",{tile:a})},a.events.on({loadstart:a.onLoadStart,loadend:a.onLoadEnd,unload:a.onLoadEnd,loaderror:a.onLoadError,scope:this})},removeTileMonitoringHooks:function(a){a.unload(),a.events.un({loadstart:a.onLoadStart,loadend:a.onLoadEnd,unload:a.onLoadEnd,loaderror:a.onLoadError,scope:this})},moveGriddedTiles:function(a){if(a||OpenLayers.Animation.isNative)for(var a=this.buffer||1,b=this.getResolutionScale();;){var c=this.grid[0][0].position.x*b+parseInt(this.div.style.left,10)+parseInt(this.map.layerContainerDiv.style.left),d=this.grid[0][0].position.y*b+parseInt(this.div.style.top,10)+parseInt(this.map.layerContainerDiv.style.top),e=this.tileSize.w*b,f=this.tileSize.h*b;if(c>-e*(a-1))this.shiftColumn(!0);else if(-e*a>c)this.shiftColumn(!1);else if(d>-f*(a-1))this.shiftRow(!0);else{if(!(-f*a>d))break;this.shiftRow(!1)}}else null!=this.moveTimerId&&window.clearTimeout(this.moveTimerId),this.moveTimerId=window.setTimeout(this.deferMoveGriddedTiles,this.tileLoadingDelay)},shiftRow:function(a){for(var b=this.grid,c=b[a?0:this.grid.length-1],d=this.getServerResolution(),e=a?-this.tileSize.h:this.tileSize.h,d=d*-e,f=a?b.pop():b.shift(),g=0,h=c.length;h>g;g++){var i=c[g],j=i.bounds.clone(),i=i.position.clone();j.bottom+=d,j.top+=d,i.y+=e,f[g].moveTo(j,i)}a?b.unshift(f):b.push(f)},shiftColumn:function(a){for(var b=a?-this.tileSize.w:this.tileSize.w,c=this.getServerResolution()*b,d=0,e=this.grid.length;e>d;d++){var f=this.grid[d],g=f[a?0:f.length-1],h=g.bounds.clone(),g=g.position.clone();h.left+=c,h.right+=c,g.x+=b;var i=a?this.grid[d].pop():this.grid[d].shift();i.moveTo(h,g),a?f.unshift(i):f.push(i)}},removeExcessTiles:function(a,b){for(var c,d;this.grid.length>a;){var e=this.grid.pop();for(c=0,d=e.length;d>c;c++){var f=e[c];this.destroyTile(f)}}for(c=0,d=this.grid.length;d>c;c++)for(;this.grid[c].length>b;)e=this.grid[c],f=e.pop(),this.destroyTile(f)},onMapResize:function(){this.singleTile&&(this.clearGrid(),this.setTileSize())},getTileBounds:function(a){var b=this.maxExtent,c=this.getResolution(),d=c*this.tileSize.w,c=c*this.tileSize.h,e=this.getLonLatFromViewPortPx(a),a=b.left+d*Math.floor((e.lon-b.left)/d),b=b.bottom+c*Math.floor((e.lat-b.bottom)/c);return new OpenLayers.Bounds(a,b,a+d,b+c)},CLASS_NAME:"OpenLayers.Layer.Grid"}),OpenLayers.Format.ArcXML=OpenLayers.Class(OpenLayers.Format.XML,{fontStyleKeys:"antialiasing blockout font fontcolor fontsize fontstyle glowing interval outline printmode shadow transparency".split(" "),request:null,response:null,initialize:function(a){if(this.request=new OpenLayers.Format.ArcXML.Request,this.response=new OpenLayers.Format.ArcXML.Response,a)if("feature"==a.requesttype){this.request.get_image=null;var b=this.request.get_feature.query;this.addCoordSys(b.featurecoordsys,a.featureCoordSys),this.addCoordSys(b.filtercoordsys,a.filterCoordSys),a.polygon?(b.isspatial=!0,b.spatialfilter.polygon=a.polygon):a.envelope&&(b.isspatial=!0,b.spatialfilter.envelope={minx:0,miny:0,maxx:0,maxy:0},this.parseEnvelope(b.spatialfilter.envelope,a.envelope))}else"image"==a.requesttype?(this.request.get_feature=null,b=this.request.get_image.properties,this.parseEnvelope(b.envelope,a.envelope),this.addLayers(b.layerlist,a.layers),this.addImageSize(b.imagesize,a.tileSize),this.addCoordSys(b.featurecoordsys,a.featureCoordSys),this.addCoordSys(b.filtercoordsys,a.filterCoordSys)):this.request=null;OpenLayers.Format.XML.prototype.initialize.apply(this,[a])},parseEnvelope:function(a,b){b&&4==b.length&&(a.minx=b[0],a.miny=b[1],a.maxx=b[2],a.maxy=b[3])},addLayers:function(a,b){for(var c=0,d=b.length;d>c;c++)a.push(b[c])},addImageSize:function(a,b){null!==b&&(a.width=b.w,a.height=b.h,a.printwidth=b.w,a.printheight=b.h)},addCoordSys:function(a,b){"string"==typeof b?(a.id=parseInt(b),a.string=b):"object"==typeof b&&null!==b.proj&&(a.id=b.proj.srsProjNumber,a.string=b.proj.srsCode)},iserror:function(a){var b=null;return a?(a=OpenLayers.Format.XML.prototype.read.apply(this,[a]),a=a.documentElement.getElementsByTagName("ERROR"),b=null!==a&&0<a.length):b=""!==this.response.error,b},read:function(a){"string"==typeof a&&(a=OpenLayers.Format.XML.prototype.read.apply(this,[a]));var b=null;if(a&&a.documentElement&&(b="ARCXML"==a.documentElement.nodeName?a.documentElement:a.documentElement.getElementsByTagName("ARCXML")[0]),!b||"parsererror"===b.firstChild.nodeName){var c,d;try{c=a.firstChild.nodeValue,d=a.firstChild.childNodes[1].firstChild.nodeValue}catch(e){}throw{message:"Error parsing the ArcXML request",error:c,source:d}}return this.parseResponse(b)},write:function(a){a||(a=this.request);var b=this.createElementNS("","ARCXML");b.setAttribute("version","1.1");var c=this.createElementNS("","REQUEST");if(null!=a.get_image){var d=this.createElementNS("","GET_IMAGE");c.appendChild(d);var e=this.createElementNS("","PROPERTIES");if(d.appendChild(e),a=a.get_image.properties,null!=a.featurecoordsys&&(d=this.createElementNS("","FEATURECOORDSYS"),e.appendChild(d),0===a.featurecoordsys.id?d.setAttribute("string",a.featurecoordsys.string):d.setAttribute("id",a.featurecoordsys.id)),null!=a.filtercoordsys&&(d=this.createElementNS("","FILTERCOORDSYS"),e.appendChild(d),0===a.filtercoordsys.id?d.setAttribute("string",a.filtercoordsys.string):d.setAttribute("id",a.filtercoordsys.id)),null!=a.envelope&&(d=this.createElementNS("","ENVELOPE"),e.appendChild(d),d.setAttribute("minx",a.envelope.minx),d.setAttribute("miny",a.envelope.miny),d.setAttribute("maxx",a.envelope.maxx),d.setAttribute("maxy",a.envelope.maxy)),d=this.createElementNS("","IMAGESIZE"),e.appendChild(d),d.setAttribute("height",a.imagesize.height),d.setAttribute("width",a.imagesize.width),(a.imagesize.height!=a.imagesize.printheight||a.imagesize.width!=a.imagesize.printwidth)&&(d.setAttribute("printheight",a.imagesize.printheight),d.setArrtibute("printwidth",a.imagesize.printwidth)),null!=a.background&&(d=this.createElementNS("","BACKGROUND"),e.appendChild(d),d.setAttribute("color",a.background.color.r+","+a.background.color.g+","+a.background.color.b),null!==a.background.transcolor&&d.setAttribute("transcolor",a.background.transcolor.r+","+a.background.transcolor.g+","+a.background.transcolor.b)),null!=a.layerlist&&0<a.layerlist.length)for(d=this.createElementNS("","LAYERLIST"),e.appendChild(d),e=0;e<a.layerlist.length;e++){var f=this.createElementNS("","LAYERDEF");if(d.appendChild(f),f.setAttribute("id",a.layerlist[e].id),f.setAttribute("visible",a.layerlist[e].visible),"object"==typeof a.layerlist[e].query){var g=a.layerlist[e].query;if(0>g.where.length)continue;var h=null,h="boolean"==typeof g.spatialfilter&&g.spatialfilter?this.createElementNS("","SPATIALQUERY"):this.createElementNS("","QUERY");h.setAttribute("where",g.where),"number"==typeof g.accuracy&&0<g.accuracy&&h.setAttribute("accuracy",g.accuracy),"number"==typeof g.featurelimit&&2e3>g.featurelimit&&h.setAttribute("featurelimit",g.featurelimit),"string"==typeof g.subfields&&"#ALL#"!=g.subfields&&h.setAttribute("subfields",g.subfields),"string"==typeof g.joinexpression&&0<g.joinexpression.length&&h.setAttribute("joinexpression",g.joinexpression),"string"==typeof g.jointables&&0<g.jointables.length&&h.setAttribute("jointables",g.jointables),f.appendChild(h)}"object"==typeof a.layerlist[e].renderer&&this.addRenderer(f,a.layerlist[e].renderer)}}else null!=a.get_feature&&(d=this.createElementNS("","GET_FEATURES"),d.setAttribute("outputmode","newxml"),d.setAttribute("checkesc","true"),a.get_feature.geometry?d.setAttribute("geometry",a.get_feature.geometry):d.setAttribute("geometry","false"),a.get_feature.compact&&d.setAttribute("compact",a.get_feature.compact),"number"==a.get_feature.featurelimit&&d.setAttribute("featurelimit",a.get_feature.featurelimit),d.setAttribute("globalenvelope","true"),c.appendChild(d),null!=a.get_feature.layer&&0<a.get_feature.layer.length&&(e=this.createElementNS("","LAYER"),e.setAttribute("id",a.get_feature.layer),d.appendChild(e)),a=a.get_feature.query,null!=a)&&(e=null,e=a.isspatial?this.createElementNS("","SPATIALQUERY"):this.createElementNS("","QUERY"),d.appendChild(e),"number"==typeof a.accuracy&&e.setAttribute("accuracy",a.accuracy),null!=a.featurecoordsys&&(d=this.createElementNS("","FEATURECOORDSYS"),0==a.featurecoordsys.id?d.setAttribute("string",a.featurecoordsys.string):d.setAttribute("id",a.featurecoordsys.id),e.appendChild(d)),null!=a.filtercoordsys&&(d=this.createElementNS("","FILTERCOORDSYS"),0===a.filtercoordsys.id?d.setAttribute("string",a.filtercoordsys.string):d.setAttribute("id",a.filtercoordsys.id),e.appendChild(d)),0<a.buffer&&(d=this.createElementNS("","BUFFER"),d.setAttribute("distance",a.buffer),e.appendChild(d)),a.isspatial&&(d=this.createElementNS("","SPATIALFILTER"),d.setAttribute("relation",a.spatialfilter.relation),e.appendChild(d),a.spatialfilter.envelope?(f=this.createElementNS("","ENVELOPE"),f.setAttribute("minx",a.spatialfilter.envelope.minx),f.setAttribute("miny",a.spatialfilter.envelope.miny),f.setAttribute("maxx",a.spatialfilter.envelope.maxx),f.setAttribute("maxy",a.spatialfilter.envelope.maxy),d.appendChild(f)):"object"==typeof a.spatialfilter.polygon&&d.appendChild(this.writePolygonGeometry(a.spatialfilter.polygon))),null!=a.where&&0<a.where.length&&e.setAttribute("where",a.where));return b.appendChild(c),OpenLayers.Format.XML.prototype.write.apply(this,[b])},addGroupRenderer:function(a,b){var c=this.createElementNS("","GROUPRENDERER");a.appendChild(c);for(var d=0;d<b.length;d++)this.addRenderer(c,b[d])},addRenderer:function(a,b){if(OpenLayers.Util.isArray(b))this.addGroupRenderer(a,b);else{var c=this.createElementNS("",b.type.toUpperCase()+"RENDERER");a.appendChild(c),"VALUEMAPRENDERER"==c.tagName?this.addValueMapRenderer(c,b):"VALUEMAPLABELRENDERER"==c.tagName?this.addValueMapLabelRenderer(c,b):"SIMPLELABELRENDERER"==c.tagName?this.addSimpleLabelRenderer(c,b):"SCALEDEPENDENTRENDERER"==c.tagName&&this.addScaleDependentRenderer(c,b)}},addScaleDependentRenderer:function(a,b){("string"==typeof b.lower||"number"==typeof b.lower)&&a.setAttribute("lower",b.lower),("string"==typeof b.upper||"number"==typeof b.upper)&&a.setAttribute("upper",b.upper),this.addRenderer(a,b.renderer)},addValueMapLabelRenderer:function(a,b){if(a.setAttribute("lookupfield",b.lookupfield),a.setAttribute("labelfield",b.labelfield),"object"==typeof b.exacts)for(var c=0,d=b.exacts.length;d>c;c++){var e=b.exacts[c],f=this.createElementNS("","EXACT");if("string"==typeof e.value&&f.setAttribute("value",e.value),"string"==typeof e.label&&f.setAttribute("label",e.label),"string"==typeof e.method&&f.setAttribute("method",e.method),a.appendChild(f),"object"==typeof e.symbol){var g=null;if("text"==e.symbol.type&&(g=this.createElementNS("","TEXTSYMBOL")),null!=g){for(var h=this.fontStyleKeys,i=0,j=h.length;j>i;i++){var k=h[i];e.symbol[k]&&g.setAttribute(k,e.symbol[k])}f.appendChild(g)}}}},addValueMapRenderer:function(a,b){if(a.setAttribute("lookupfield",b.lookupfield),"object"==typeof b.ranges)for(var c=0,d=b.ranges.length;d>c;c++){var e=b.ranges[c],f=this.createElementNS("","RANGE");if(f.setAttribute("lower",e.lower),f.setAttribute("upper",e.upper),a.appendChild(f),"object"==typeof e.symbol){var g=null;"simplepolygon"==e.symbol.type&&(g=this.createElementNS("","SIMPLEPOLYGONSYMBOL")),null!=g&&("string"==typeof e.symbol.boundarycolor&&g.setAttribute("boundarycolor",e.symbol.boundarycolor),"string"==typeof e.symbol.fillcolor&&g.setAttribute("fillcolor",e.symbol.fillcolor),"number"==typeof e.symbol.filltransparency&&g.setAttribute("filltransparency",e.symbol.filltransparency),f.appendChild(g))}}else if("object"==typeof b.exacts)for(c=0,d=b.exacts.length;d>c;c++)e=b.exacts[c],f=this.createElementNS("","EXACT"),"string"==typeof e.value&&f.setAttribute("value",e.value),"string"==typeof e.label&&f.setAttribute("label",e.label),"string"==typeof e.method&&f.setAttribute("method",e.method),a.appendChild(f),"object"==typeof e.symbol&&(g=null,"simplemarker"==e.symbol.type&&(g=this.createElementNS("","SIMPLEMARKERSYMBOL")),null!=g&&("string"==typeof e.symbol.antialiasing&&g.setAttribute("antialiasing",e.symbol.antialiasing),"string"==typeof e.symbol.color&&g.setAttribute("color",e.symbol.color),"string"==typeof e.symbol.outline&&g.setAttribute("outline",e.symbol.outline),"string"==typeof e.symbol.overlap&&g.setAttribute("overlap",e.symbol.overlap),"string"==typeof e.symbol.shadow&&g.setAttribute("shadow",e.symbol.shadow),"number"==typeof e.symbol.transparency&&g.setAttribute("transparency",e.symbol.transparency),"string"==typeof e.symbol.usecentroid&&g.setAttribute("usecentroid",e.symbol.usecentroid),"number"==typeof e.symbol.width&&g.setAttribute("width",e.symbol.width),f.appendChild(g)))},addSimpleLabelRenderer:function(a,b){a.setAttribute("field",b.field);for(var c="featureweight howmanylabels labelbufferratio labelpriorities labelweight linelabelposition rotationalangles".split(" "),d=0,e=c.length;e>d;d++){var f=c[d];b[f]&&a.setAttribute(f,b[f])}if("text"==b.symbol.type){var g=b.symbol,h=this.createElementNS("","TEXTSYMBOL");for(a.appendChild(h),c=this.fontStyleKeys,d=0,e=c.length;e>d;d++)f=c[d],g[f]&&h.setAttribute(f,b[f])}},writePolygonGeometry:function(a){if(!(a instanceof OpenLayers.Geometry.Polygon))throw{message:"Cannot write polygon geometry to ArcXML with an "+a.CLASS_NAME+" object.",geometry:a};for(var b=this.createElementNS("","POLYGON"),c=0,d=a.components.length;d>c;c++){for(var e=a.components[c],f=this.createElementNS("","RING"),g=0,h=e.components.length;h>g;g++){var i=e.components[g],j=this.createElementNS("","POINT");j.setAttribute("x",i.x),j.setAttribute("y",i.y),f.appendChild(j)}b.appendChild(f)}return b},parseResponse:function(a){"string"==typeof a&&(a=(new OpenLayers.Format.XML).read(a));var b=new OpenLayers.Format.ArcXML.Response,c=a.getElementsByTagName("ERROR");if(null!=c&&0<c.length)b.error=this.getChildValue(c,"Unknown error.");else{if(c=a.getElementsByTagName("RESPONSE"),null==c||0==c.length)return b.error="No RESPONSE tag found in ArcXML response.",b;var d=c[0].firstChild.nodeName;if("#text"==d&&(d=c[0].firstChild.nextSibling.nodeName),"IMAGE"==d)c=a.getElementsByTagName("ENVELOPE"),a=a.getElementsByTagName("OUTPUT"),null==c||0==c.length?b.error="No ENVELOPE tag found in ArcXML response.":null==a||0==a.length?b.error="No OUTPUT tag found in ArcXML response.":(c=this.parseAttributes(c[0]),d=this.parseAttributes(a[0]),b.image="string"==typeof d.type?{envelope:c,output:{type:d.type,data:this.getChildValue(a[0])}}:{envelope:c,output:d});else if("FEATURES"==d){if(a=c[0].getElementsByTagName("FEATURES"),c=a[0].getElementsByTagName("FEATURECOUNT"),b.features.featurecount=c[0].getAttribute("count"),0<b.features.featurecount)for(c=a[0].getElementsByTagName("ENVELOPE"),b.features.envelope=this.parseAttributes(c[0],"number"),a=a[0].getElementsByTagName("FEATURE"),c=0;c<a.length;c++){for(var d=new OpenLayers.Feature.Vector,e=a[c].getElementsByTagName("FIELD"),f=0;f<e.length;f++){var g=e[f].getAttribute("name"),h=e[f].getAttribute("value");d.attributes[g]=h}if(e=a[c].getElementsByTagName("POLYGON"),0<e.length){for(e=e[0].getElementsByTagName("RING"),f=[],g=0;g<e.length;g++){h=[],h.push(this.parsePointGeometry(e[g]));for(var i=e[g].getElementsByTagName("HOLE"),j=0;j<i.length;j++)h.push(this.parsePointGeometry(i[j]));f.push(new OpenLayers.Geometry.Polygon(h))}d.geometry=1==f.length?f[0]:new OpenLayers.Geometry.MultiPolygon(f)}b.features.feature.push(d)}}else b.error="Unidentified response type."}return b},parseAttributes:function(a,b){for(var c={},d=0;d<a.attributes.length;d++)c[a.attributes[d].nodeName]="number"==b?parseFloat(a.attributes[d].nodeValue):a.attributes[d].nodeValue;return c},parsePointGeometry:function(a){var b=[],c=a.getElementsByTagName("COORDS");if(0<c.length)for(a=this.getChildValue(c[0]),a=a.split(/;/),c=0;c<a.length;c++){var d=a[c].split(/ /);b.push(new OpenLayers.Geometry.Point(d[0],d[1]))}else if(a=a.getElementsByTagName("POINT"),0<a.length)for(c=0;c<a.length;c++)b.push(new OpenLayers.Geometry.Point(parseFloat(a[c].getAttribute("x")),parseFloat(a[c].getAttribute("y"))));return new OpenLayers.Geometry.LinearRing(b)},CLASS_NAME:"OpenLayers.Format.ArcXML"}),OpenLayers.Format.ArcXML.Request=OpenLayers.Class({initialize:function(){return OpenLayers.Util.extend(this,{get_image:{properties:{background:null,draw:!0,envelope:{minx:0,miny:0,maxx:0,maxy:0},featurecoordsys:{id:0,string:"",datumtransformid:0,datumtransformstring:""},filtercoordsys:{id:0,string:"",datumtransformid:0,datumtransformstring:""},imagesize:{height:0,width:0,dpi:96,printheight:0,printwidth:0,scalesymbols:!1},layerlist:[],output:{baseurl:"",legendbaseurl:"",legendname:"",legendpath:"",legendurl:"",name:"",path:"",type:"jpg",url:""}}},get_feature:{layer:"",query:{isspatial:!1,featurecoordsys:{id:0,string:"",datumtransformid:0,datumtransformstring:""},filtercoordsys:{id:0,string:"",datumtransformid:0,datumtransformstring:""},buffer:0,where:"",spatialfilter:{relation:"envelope_intersection",envelope:null}}},environment:{separators:{cs:" ",ts:";"}},layer:[],workspaces:[]})},CLASS_NAME:"OpenLayers.Format.ArcXML.Request"}),OpenLayers.Format.ArcXML.Response=OpenLayers.Class({initialize:function(){return OpenLayers.Util.extend(this,{image:{envelope:null,output:""},features:{featurecount:0,envelope:null,feature:[]},error:""})},CLASS_NAME:"OpenLayers.Format.ArcXML.Response"}),OpenLayers.ProxyHost="",OpenLayers.Request={DEFAULT_CONFIG:{method:"GET",url:window.location.href,async:!0,user:void 0,password:void 0,params:null,proxy:OpenLayers.ProxyHost,headers:{},data:null,callback:function(){},success:null,failure:null,scope:null},URL_SPLIT_REGEX:/([^:]*:)\/\/([^:]*:?[^@]*@)?([^:\/\?]*):?([^\/\?]*)/,events:new OpenLayers.Events(this),makeSameOrigin:function(a,b){var c=0!==a.indexOf("http"),d=!c&&a.match(this.URL_SPLIT_REGEX);if(d){var e=window.location,c=d[1]==e.protocol&&d[3]==e.hostname,d=d[4],e=e.port;(80!=d&&""!=d||"80"!=e&&""!=e)&&(c=c&&d==e)}return c||(b?a="function"==typeof b?b(a):b+encodeURIComponent(a):OpenLayers.Console.warn(OpenLayers.i18n("proxyNeeded"),{url:a})),a},issue:function(a){var b,c=OpenLayers.Util.extend(this.DEFAULT_CONFIG,{proxy:OpenLayers.ProxyHost}),a=OpenLayers.Util.applyDefaults(a,c),c=!1;for(b in a.headers)a.headers.hasOwnProperty(b)&&"x-requested-with"===b.toLowerCase()&&(c=!0);!1===c&&(a.headers["X-Requested-With"]="XMLHttpRequest");var d=new OpenLayers.Request.XMLHttpRequest,e=OpenLayers.Util.urlAppend(a.url,OpenLayers.Util.getParameterString(a.params||{})),e=OpenLayers.Request.makeSameOrigin(e,a.proxy);d.open(a.method,e,a.async,a.user,a.password);for(var f in a.headers)d.setRequestHeader(f,a.headers[f]);var g=this.events,h=this;return d.onreadystatechange=function(){d.readyState==OpenLayers.Request.XMLHttpRequest.DONE&&!1!==g.triggerEvent("complete",{request:d,config:a,requestUrl:e})&&h.runCallbacks({request:d,config:a,requestUrl:e})},!1===a.async?d.send(a.data):window.setTimeout(function(){0!==d.readyState&&d.send(a.data)},0),d},runCallbacks:function(a){var b,c=a.request,d=a.config,e=d.scope?OpenLayers.Function.bind(d.callback,d.scope):d.callback;d.success&&(b=d.scope?OpenLayers.Function.bind(d.success,d.scope):d.success);var f;d.failure&&(f=d.scope?OpenLayers.Function.bind(d.failure,d.scope):d.failure),"file:"==OpenLayers.Util.createUrlObject(d.url).protocol&&c.responseText&&(c.status=200),e(c),(!c.status||200<=c.status&&300>c.status)&&(this.events.triggerEvent("success",a),b&&b(c)),c.status&&(200>c.status||300<=c.status)&&(this.events.triggerEvent("failure",a),f&&f(c))},GET:function(a){return a=OpenLayers.Util.extend(a,{method:"GET"}),OpenLayers.Request.issue(a)},POST:function(a){return a=OpenLayers.Util.extend(a,{method:"POST"}),a.headers=a.headers?a.headers:{},"CONTENT-TYPE"in OpenLayers.Util.upperCaseObject(a.headers)||(a.headers["Content-Type"]="application/xml"),OpenLayers.Request.issue(a)},PUT:function(a){return a=OpenLayers.Util.extend(a,{method:"PUT"}),a.headers=a.headers?a.headers:{},"CONTENT-TYPE"in OpenLayers.Util.upperCaseObject(a.headers)||(a.headers["Content-Type"]="application/xml"),OpenLayers.Request.issue(a)},DELETE:function(a){return a=OpenLayers.Util.extend(a,{method:"DELETE"}),OpenLayers.Request.issue(a)},HEAD:function(a){return a=OpenLayers.Util.extend(a,{method:"HEAD"}),OpenLayers.Request.issue(a)},OPTIONS:function(a){return a=OpenLayers.Util.extend(a,{method:"OPTIONS"}),OpenLayers.Request.issue(a)}},OpenLayers.Layer.ArcIMS=OpenLayers.Class(OpenLayers.Layer.Grid,{DEFAULT_PARAMS:{ClientVersion:"9.2",ServiceName:""},featureCoordSys:"4326",filterCoordSys:"4326",layers:null,async:!0,name:"ArcIMS",isBaseLayer:!0,DEFAULT_OPTIONS:{tileSize:new OpenLayers.Size(512,512),featureCoordSys:"4326",filterCoordSys:"4326",layers:null,isBaseLayer:!0,async:!0,name:"ArcIMS"},initialize:function(a,b,c){this.tileSize=new OpenLayers.Size(512,512),this.params=OpenLayers.Util.applyDefaults({ServiceName:c.serviceName},this.DEFAULT_PARAMS),this.options=OpenLayers.Util.applyDefaults(c,this.DEFAULT_OPTIONS),OpenLayers.Layer.Grid.prototype.initialize.apply(this,[a,b,this.params,c]),this.transparent&&(this.isBaseLayer||(this.isBaseLayer=!1),"image/jpeg"==this.format)&&(this.format=OpenLayers.Util.alphaHack()?"image/gif":"image/png"),null===this.options.layers&&(this.options.layers=[])},getURL:function(a){var b="",a=this.adjustBounds(a),a=new OpenLayers.Format.ArcXML(OpenLayers.Util.extend(this.options,{requesttype:"image",envelope:a.toArray(),tileSize:this.tileSize})),a=new OpenLayers.Request.POST({url:this.getFullRequestString(),data:a.write(),async:!1});return null!=a&&(b=a.responseXML,b&&b.documentElement||(b=a.responseText),b=this.getUrlOrImage((new OpenLayers.Format.ArcXML).read(b).image.output)),b},getURLasync:function(a,b,c){a=this.adjustBounds(a),a=new OpenLayers.Format.ArcXML(OpenLayers.Util.extend(this.options,{requesttype:"image",envelope:a.toArray(),tileSize:this.tileSize})),OpenLayers.Request.POST({url:this.getFullRequestString(),async:!0,data:a.write(),callback:function(a){var d=a.responseXML;d&&d.documentElement||(d=a.responseText),a=(new OpenLayers.Format.ArcXML).read(d),b.call(c,this.getUrlOrImage(a.image.output))},scope:this})},getUrlOrImage:function(a){var b="";return a.url?b=a.url:a.data&&(b="data:image/"+a.type+";base64,"+a.data),b},setLayerQuery:function(a,b){for(var c=0;c<this.options.layers.length;c++)if(a==this.options.layers[c].id)return void(this.options.layers[c].query=b);this.options.layers.push({id:a,visible:!0,query:b})},getFeatureInfo:function(a,b,c){var d=c.buffer||1,e=c.callback||function(){},f=c.scope||window,g={};OpenLayers.Util.extend(g,this.options),g.requesttype="feature",a instanceof OpenLayers.LonLat?(g.polygon=null,g.envelope=[a.lon-d,a.lat-d,a.lon+d,a.lat+d]):a instanceof OpenLayers.Geometry.Polygon&&(g.envelope=null,g.polygon=a);var h=new OpenLayers.Format.ArcXML(g);OpenLayers.Util.extend(h.request.get_feature,c),h.request.get_feature.layer=b.id,"number"==typeof b.query.accuracy?h.request.get_feature.query.accuracy=b.query.accuracy:(a=this.map.getCenter(),c=this.map.getViewPortPxFromLonLat(a),c.x++,c=this.map.getLonLatFromPixel(c),h.request.get_feature.query.accuracy=c.lon-a.lon),h.request.get_feature.query.where=b.query.where,h.request.get_feature.query.spatialfilter.relation="area_intersection",OpenLayers.Request.POST({url:this.getFullRequestString({CustomService:"Query"}),data:h.write(),callback:function(a){a=h.parseResponse(a.responseText),h.iserror()?e.call(f,null):e.call(f,a.features)}})},clone:function(a){return null==a&&(a=new OpenLayers.Layer.ArcIMS(this.name,this.url,this.getOptions())),a=OpenLayers.Layer.Grid.prototype.clone.apply(this,[a])},CLASS_NAME:"OpenLayers.Layer.ArcIMS"}),OpenLayers.Format.OWSCommon.v1_1_0=OpenLayers.Class(OpenLayers.Format.OWSCommon.v1,{namespaces:{ows:"http://www.opengis.net/ows/1.1",xlink:"http://www.w3.org/1999/xlink"},readers:{ows:OpenLayers.Util.applyDefaults({ExceptionReport:function(a,b){b.exceptionReport={version:a.getAttribute("version"),language:a.getAttribute("xml:lang"),exceptions:[]},this.readChildNodes(a,b.exceptionReport)},AllowedValues:function(a,b){b.allowedValues={},this.readChildNodes(a,b.allowedValues)},AnyValue:function(a,b){b.anyValue=!0},DataType:function(a,b){b.dataType=this.getChildValue(a)},Range:function(a,b){b.range={},this.readChildNodes(a,b.range)},MinimumValue:function(a,b){b.minValue=this.getChildValue(a)},MaximumValue:function(a,b){b.maxValue=this.getChildValue(a)},Identifier:function(a,b){b.identifier=this.getChildValue(a)},SupportedCRS:function(a,b){b.supportedCRS=this.getChildValue(a)
}},OpenLayers.Format.OWSCommon.v1.prototype.readers.ows)},writers:{ows:OpenLayers.Util.applyDefaults({Range:function(a){var b=this.createElementNSPlus("ows:Range",{attributes:{"ows:rangeClosure":a.closure}});return this.writeNode("ows:MinimumValue",a.minValue,b),this.writeNode("ows:MaximumValue",a.maxValue,b),b},MinimumValue:function(a){return this.createElementNSPlus("ows:MinimumValue",{value:a})},MaximumValue:function(a){return this.createElementNSPlus("ows:MaximumValue",{value:a})},Value:function(a){return this.createElementNSPlus("ows:Value",{value:a})}},OpenLayers.Format.OWSCommon.v1.prototype.writers.ows)},CLASS_NAME:"OpenLayers.Format.OWSCommon.v1_1_0"}),OpenLayers.Format.WCSGetCoverage=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{ows:"http://www.opengis.net/ows/1.1",wcs:"http://www.opengis.net/wcs/1.1",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},VERSION:"1.1.2",schemaLocation:"http://www.opengis.net/wcs/1.1 http://schemas.opengis.net/wcs/1.1/wcsGetCoverage.xsd",write:function(a){return a=this.writeNode("wcs:GetCoverage",a),this.setAttributeNS(a,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation),OpenLayers.Format.XML.prototype.write.apply(this,[a])},writers:{wcs:{GetCoverage:function(a){var b=this.createElementNSPlus("wcs:GetCoverage",{attributes:{version:a.version||this.VERSION,service:"WCS"}});return this.writeNode("ows:Identifier",a.identifier,b),this.writeNode("wcs:DomainSubset",a.domainSubset,b),this.writeNode("wcs:Output",a.output,b),b},DomainSubset:function(a){var b=this.createElementNSPlus("wcs:DomainSubset",{});return this.writeNode("ows:BoundingBox",a.boundingBox,b),a.temporalSubset&&this.writeNode("wcs:TemporalSubset",a.temporalSubset,b),b},TemporalSubset:function(a){for(var b=this.createElementNSPlus("wcs:TemporalSubset",{}),c=0,d=a.timePeriods.length;d>c;++c)this.writeNode("wcs:TimePeriod",a.timePeriods[c],b);return b},TimePeriod:function(a){var b=this.createElementNSPlus("wcs:TimePeriod",{});return this.writeNode("wcs:BeginPosition",a.begin,b),this.writeNode("wcs:EndPosition",a.end,b),a.resolution&&this.writeNode("wcs:TimeResolution",a.resolution,b),b},BeginPosition:function(a){return this.createElementNSPlus("wcs:BeginPosition",{value:a})},EndPosition:function(a){return this.createElementNSPlus("wcs:EndPosition",{value:a})},TimeResolution:function(a){return this.createElementNSPlus("wcs:TimeResolution",{value:a})},Output:function(a){var b=this.createElementNSPlus("wcs:Output",{attributes:{format:a.format,store:a.store}});return a.gridCRS&&this.writeNode("wcs:GridCRS",a.gridCRS,b),b},GridCRS:function(a){var b=this.createElementNSPlus("wcs:GridCRS",{});return this.writeNode("wcs:GridBaseCRS",a.baseCRS,b),a.type&&this.writeNode("wcs:GridType",a.type,b),a.origin&&this.writeNode("wcs:GridOrigin",a.origin,b),this.writeNode("wcs:GridOffsets",a.offsets,b),a.CS&&this.writeNode("wcs:GridCS",a.CS,b),b},GridBaseCRS:function(a){return this.createElementNSPlus("wcs:GridBaseCRS",{value:a})},GridOrigin:function(a){return this.createElementNSPlus("wcs:GridOrigin",{value:a})},GridType:function(a){return this.createElementNSPlus("wcs:GridType",{value:a})},GridOffsets:function(a){return this.createElementNSPlus("wcs:GridOffsets",{value:a})},GridCS:function(a){return this.createElementNSPlus("wcs:GridCS",{value:a})}},ows:OpenLayers.Format.OWSCommon.v1_1_0.prototype.writers.ows},CLASS_NAME:"OpenLayers.Format.WCSGetCoverage"}),OpenLayers.Format.WPSExecute=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{ows:"http://www.opengis.net/ows/1.1",gml:"http://www.opengis.net/gml",wps:"http://www.opengis.net/wps/1.0.0",wfs:"http://www.opengis.net/wfs",ogc:"http://www.opengis.net/ogc",wcs:"http://www.opengis.net/wcs",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},VERSION:"1.0.0",schemaLocation:"http://www.opengis.net/wps/1.0.0 http://schemas.opengis.net/wps/1.0.0/wpsAll.xsd",schemaLocationAttr:function(){},write:function(a){var b;return window.ActiveXObject?this.xmldom=b=new ActiveXObject("Microsoft.XMLDOM"):b=document.implementation.createDocument("","",null),a=this.writeNode("wps:Execute",a,b),this.setAttributeNS(a,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation),OpenLayers.Format.XML.prototype.write.apply(this,[a])},writers:{wps:{Execute:function(a){var b=this.createElementNSPlus("wps:Execute",{attributes:{version:this.VERSION,service:"WPS"}});return this.writeNode("ows:Identifier",a.identifier,b),this.writeNode("wps:DataInputs",a.dataInputs,b),this.writeNode("wps:ResponseForm",a.responseForm,b),b},ResponseForm:function(a){var b=this.createElementNSPlus("wps:ResponseForm",{});return a.rawDataOutput&&this.writeNode("wps:RawDataOutput",a.rawDataOutput,b),a.responseDocument&&this.writeNode("wps:ResponseDocument",a.responseDocument,b),b},ResponseDocument:function(a){var b=this.createElementNSPlus("wps:ResponseDocument",{attributes:{storeExecuteResponse:a.storeExecuteResponse,lineage:a.lineage,status:a.status}});return a.output&&this.writeNode("wps:Output",a.output,b),b},Output:function(a){var b=this.createElementNSPlus("wps:Output",{attributes:{asReference:a.asReference}});return this.writeNode("ows:Identifier",a.identifier,b),this.writeNode("ows:Title",a.title,b),this.writeNode("ows:Abstract",a["abstract"],b),b},RawDataOutput:function(a){var b=this.createElementNSPlus("wps:RawDataOutput",{attributes:{mimeType:a.mimeType}});return this.writeNode("ows:Identifier",a.identifier,b),b},DataInputs:function(a){for(var b=this.createElementNSPlus("wps:DataInputs",{}),c=0,d=a.length;d>c;++c)this.writeNode("wps:Input",a[c],b);return b},Input:function(a){var b=this.createElementNSPlus("wps:Input",{});return this.writeNode("ows:Identifier",a.identifier,b),a.title&&this.writeNode("ows:Title",a.title,b),a.data&&this.writeNode("wps:Data",a.data,b),a.reference&&this.writeNode("wps:Reference",a.reference,b),b},Data:function(a){var b=this.createElementNSPlus("wps:Data",{});return a.literalData?this.writeNode("wps:LiteralData",a.literalData,b):a.complexData&&this.writeNode("wps:ComplexData",a.complexData,b),b},LiteralData:function(a){return this.createElementNSPlus("wps:LiteralData",{attributes:{uom:a.uom},value:a.value})},ComplexData:function(a){var b=this.createElementNSPlus("wps:ComplexData",{attributes:{mimeType:a.mimeType,encoding:a.encoding,schema:a.schema}}),c=a.value;return b.appendChild("string"==typeof c?this.getXMLDoc().createCDATASection(a.value):c),b},Reference:function(a){var b=this.createElementNSPlus("wps:Reference",{attributes:{mimeType:a.mimeType,"xlink:href":a.href,method:a.method,encoding:a.encoding,schema:a.schema}});return a.body&&this.writeNode("wps:Body",a.body,b),b},Body:function(a){var b=this.createElementNSPlus("wps:Body",{});return a.wcs?this.writeNode("wcs:GetCoverage",a.wcs,b):a.wfs?(this.featureType=a.wfs.featureType,this.version=a.wfs.version,this.writeNode("wfs:GetFeature",a.wfs,b)):this.writeNode("wps:Execute",a,b),b}},wcs:OpenLayers.Format.WCSGetCoverage.prototype.writers.wcs,wfs:OpenLayers.Format.WFST.v1_1_0.prototype.writers.wfs,ogc:OpenLayers.Format.Filter.v1_1_0.prototype.writers.ogc,ows:OpenLayers.Format.OWSCommon.v1_1_0.prototype.writers.ows},CLASS_NAME:"OpenLayers.Format.WPSExecute"}),OpenLayers.Control.PanZoom=OpenLayers.Class(OpenLayers.Control,{slideFactor:50,slideRatio:null,buttons:null,position:null,initialize:function(){this.position=new OpenLayers.Pixel(OpenLayers.Control.PanZoom.X,OpenLayers.Control.PanZoom.Y),OpenLayers.Control.prototype.initialize.apply(this,arguments)},destroy:function(){this.map&&this.map.events.unregister("buttonclick",this,this.onButtonClick),this.removeButtons(),this.position=this.buttons=null,OpenLayers.Control.prototype.destroy.apply(this,arguments)},setMap:function(){OpenLayers.Control.prototype.setMap.apply(this,arguments),this.map.events.register("buttonclick",this,this.onButtonClick)},draw:function(a){OpenLayers.Control.prototype.draw.apply(this,arguments),a=this.position,this.buttons=[];var b={w:18,h:18},c=new OpenLayers.Pixel(a.x+b.w/2,a.y);return this._addButton("panup","north-mini.png",c,b),a.y=c.y+b.h,this._addButton("panleft","west-mini.png",a,b),this._addButton("panright","east-mini.png",a.add(b.w,0),b),this._addButton("pandown","south-mini.png",c.add(0,2*b.h),b),this._addButton("zoomin","zoom-plus-mini.png",c.add(0,3*b.h+5),b),this._addButton("zoomworld","zoom-world-mini.png",c.add(0,4*b.h+5),b),this._addButton("zoomout","zoom-minus-mini.png",c.add(0,5*b.h+5),b),this.div},_addButton:function(a,b,c,d){return b=OpenLayers.Util.getImageLocation(b),c=OpenLayers.Util.createAlphaImageDiv(this.id+"_"+a,c,d,b,"absolute"),c.style.cursor="pointer",this.div.appendChild(c),c.action=a,c.className="olButton",this.buttons.push(c),c},_removeButton:function(a){this.div.removeChild(a),OpenLayers.Util.removeItem(this.buttons,a)},removeButtons:function(){for(var a=this.buttons.length-1;a>=0;--a)this._removeButton(this.buttons[a])},onButtonClick:function(a){switch(a.buttonElement.action){case"panup":this.map.pan(0,-this.getSlideFactor("h"));break;case"pandown":this.map.pan(0,this.getSlideFactor("h"));break;case"panleft":this.map.pan(-this.getSlideFactor("w"),0);break;case"panright":this.map.pan(this.getSlideFactor("w"),0);break;case"zoomin":this.map.zoomIn();break;case"zoomout":this.map.zoomOut();break;case"zoomworld":this.map.zoomToMaxExtent()}},getSlideFactor:function(a){return this.slideRatio?this.map.getSize()[a]*this.slideRatio:this.slideFactor},CLASS_NAME:"OpenLayers.Control.PanZoom"}),OpenLayers.Control.PanZoom.X=4,OpenLayers.Control.PanZoom.Y=4,OpenLayers.Control.PanZoomBar=OpenLayers.Class(OpenLayers.Control.PanZoom,{zoomStopWidth:18,zoomStopHeight:11,slider:null,sliderEvents:null,zoombarDiv:null,zoomWorldIcon:!1,panIcons:!0,forceFixedZoomLevel:!1,mouseDragStart:null,deltaY:null,zoomStart:null,destroy:function(){this._removeZoomBar(),this.map.events.un({changebaselayer:this.redraw,scope:this}),OpenLayers.Control.PanZoom.prototype.destroy.apply(this,arguments),delete this.mouseDragStart,delete this.zoomStart},setMap:function(){OpenLayers.Control.PanZoom.prototype.setMap.apply(this,arguments),this.map.events.register("changebaselayer",this,this.redraw)},redraw:function(){null!=this.div&&(this.removeButtons(),this._removeZoomBar()),this.draw()},draw:function(a){OpenLayers.Control.prototype.draw.apply(this,arguments),a=this.position.clone(),this.buttons=[];var b={w:18,h:18};if(this.panIcons){var c=new OpenLayers.Pixel(a.x+b.w/2,a.y),d=b.w;this.zoomWorldIcon&&(c=new OpenLayers.Pixel(a.x+b.w,a.y)),this._addButton("panup","north-mini.png",c,b),a.y=c.y+b.h,this._addButton("panleft","west-mini.png",a,b),this.zoomWorldIcon&&(this._addButton("zoomworld","zoom-world-mini.png",a.add(b.w,0),b),d*=2),this._addButton("panright","east-mini.png",a.add(d,0),b),this._addButton("pandown","south-mini.png",c.add(0,2*b.h),b),this._addButton("zoomin","zoom-plus-mini.png",c.add(0,3*b.h+5),b),c=this._addZoomBar(c.add(0,4*b.h+5)),this._addButton("zoomout","zoom-minus-mini.png",c,b)}else this._addButton("zoomin","zoom-plus-mini.png",a,b),c=this._addZoomBar(a.add(0,b.h)),this._addButton("zoomout","zoom-minus-mini.png",c,b),this.zoomWorldIcon&&(c=c.add(0,b.h+3),this._addButton("zoomworld","zoom-world-mini.png",c,b));return this.div},_addZoomBar:function(a){var b=OpenLayers.Util.getImageLocation("slider.png"),c=this.id+"_"+this.map.id,d=this.map.getNumZoomLevels()-1-this.map.getZoom(),d=OpenLayers.Util.createAlphaImageDiv(c,a.add(-1,d*this.zoomStopHeight),{w:20,h:9},b,"absolute");d.style.cursor="move",this.slider=d,this.sliderEvents=new OpenLayers.Events(this,d,null,!0,{includeXY:!0}),this.sliderEvents.on({touchstart:this.zoomBarDown,touchmove:this.zoomBarDrag,touchend:this.zoomBarUp,mousedown:this.zoomBarDown,mousemove:this.zoomBarDrag,mouseup:this.zoomBarUp});var e={w:this.zoomStopWidth,h:this.zoomStopHeight*this.map.getNumZoomLevels()},b=OpenLayers.Util.getImageLocation("zoombar.png"),c=null;return OpenLayers.Util.alphaHack()?(c=this.id+"_"+this.map.id,c=OpenLayers.Util.createAlphaImageDiv(c,a,{w:e.w,h:this.zoomStopHeight},b,"absolute",null,"crop"),c.style.height=e.h+"px"):c=OpenLayers.Util.createDiv("OpenLayers_Control_PanZoomBar_Zoombar"+this.map.id,a,e,b),c.style.cursor="pointer",c.className="olButton",this.zoombarDiv=c,this.div.appendChild(c),this.startTop=parseInt(c.style.top),this.div.appendChild(d),this.map.events.register("zoomend",this,this.moveZoomBar),a=a.add(0,this.zoomStopHeight*this.map.getNumZoomLevels())},_removeZoomBar:function(){this.sliderEvents.un({touchstart:this.zoomBarDown,touchmove:this.zoomBarDrag,touchend:this.zoomBarUp,mousedown:this.zoomBarDown,mousemove:this.zoomBarDrag,mouseup:this.zoomBarUp}),this.sliderEvents.destroy(),this.div.removeChild(this.zoombarDiv),this.zoombarDiv=null,this.div.removeChild(this.slider),this.slider=null,this.map.events.unregister("zoomend",this,this.moveZoomBar)},onButtonClick:function(a){if(OpenLayers.Control.PanZoom.prototype.onButtonClick.apply(this,arguments),a.buttonElement===this.zoombarDiv){var b=a.buttonXY.y/this.zoomStopHeight;(this.forceFixedZoomLevel||!this.map.fractionalZoom)&&(b=Math.floor(b)),b=this.map.getNumZoomLevels()-1-b,b=Math.min(Math.max(b,0),this.map.getNumZoomLevels()-1),this.map.zoomTo(b)}},passEventToSlider:function(a){this.sliderEvents.handleBrowserEvent(a)},zoomBarDown:function(a){(OpenLayers.Event.isLeftClick(a)||OpenLayers.Event.isSingleTouch(a))&&(this.map.events.on({touchmove:this.passEventToSlider,mousemove:this.passEventToSlider,mouseup:this.passEventToSlider,scope:this}),this.mouseDragStart=a.xy.clone(),this.zoomStart=a.xy.clone(),this.div.style.cursor="move",this.zoombarDiv.offsets=null,OpenLayers.Event.stop(a))},zoomBarDrag:function(a){if(null!=this.mouseDragStart){var b=this.mouseDragStart.y-a.xy.y,c=OpenLayers.Util.pagePosition(this.zoombarDiv);0<a.clientY-c[1]&&a.clientY-c[1]<parseInt(this.zoombarDiv.style.height)-2&&(this.slider.style.top=parseInt(this.slider.style.top)-b+"px",this.mouseDragStart=a.xy.clone()),this.deltaY=this.zoomStart.y-a.xy.y,OpenLayers.Event.stop(a)}},zoomBarUp:function(a){if((OpenLayers.Event.isLeftClick(a)||"touchend"===a.type)&&this.mouseDragStart){this.div.style.cursor="",this.map.events.un({touchmove:this.passEventToSlider,mouseup:this.passEventToSlider,mousemove:this.passEventToSlider,scope:this});var b=this.map.zoom;!this.forceFixedZoomLevel&&this.map.fractionalZoom?(b+=this.deltaY/this.zoomStopHeight,b=Math.min(Math.max(b,0),this.map.getNumZoomLevels()-1)):(b+=this.deltaY/this.zoomStopHeight,b=Math.max(Math.round(b),0)),this.map.zoomTo(b),this.zoomStart=this.mouseDragStart=null,this.deltaY=0,OpenLayers.Event.stop(a)}},moveZoomBar:function(){this.slider.style.top=(this.map.getNumZoomLevels()-1-this.map.getZoom())*this.zoomStopHeight+this.startTop+1+"px"},CLASS_NAME:"OpenLayers.Control.PanZoomBar"}),OpenLayers.Format.WFSCapabilities=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.1.0",errorProperty:"service",CLASS_NAME:"OpenLayers.Format.WFSCapabilities"}),OpenLayers.Format.WFSCapabilities.v1=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{wfs:"http://www.opengis.net/wfs",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance",ows:"http://www.opengis.net/ows"},defaultPrefix:"wfs",read:function(a){"string"==typeof a&&(a=OpenLayers.Format.XML.prototype.read.apply(this,[a])),a&&9==a.nodeType&&(a=a.documentElement);var b={};return this.readNode(a,b),b},readers:{wfs:{WFS_Capabilities:function(a,b){this.readChildNodes(a,b)},FeatureTypeList:function(a,b){b.featureTypeList={featureTypes:[]},this.readChildNodes(a,b.featureTypeList)},FeatureType:function(a,b){var c={};this.readChildNodes(a,c),b.featureTypes.push(c)},Name:function(a,b){var c=this.getChildValue(a);c&&(c=c.split(":"),b.name=c.pop(),0<c.length&&(b.featureNS=this.lookupNamespaceURI(a,c[0])))},Title:function(a,b){var c=this.getChildValue(a);c&&(b.title=c)},Abstract:function(a,b){var c=this.getChildValue(a);c&&(b["abstract"]=c)}}},CLASS_NAME:"OpenLayers.Format.WFSCapabilities.v1"}),OpenLayers.Format.WFSCapabilities.v1_1_0=OpenLayers.Class(OpenLayers.Format.WFSCapabilities.v1,{regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},readers:{wfs:OpenLayers.Util.applyDefaults({DefaultSRS:function(a,b){var c=this.getChildValue(a);c&&(b.srs=c)}},OpenLayers.Format.WFSCapabilities.v1.prototype.readers.wfs),ows:OpenLayers.Format.OWSCommon.v1.prototype.readers.ows},CLASS_NAME:"OpenLayers.Format.WFSCapabilities.v1_1_0"}),OpenLayers.Layer.Image=OpenLayers.Class(OpenLayers.Layer,{isBaseLayer:!0,url:null,extent:null,size:null,tile:null,aspectRatio:null,initialize:function(a,b,c,d,e){this.url=b,this.maxExtent=this.extent=c,this.size=d,OpenLayers.Layer.prototype.initialize.apply(this,[a,e]),this.aspectRatio=this.extent.getHeight()/this.size.h/(this.extent.getWidth()/this.size.w)},destroy:function(){this.tile&&(this.removeTileMonitoringHooks(this.tile),this.tile.destroy(),this.tile=null),OpenLayers.Layer.prototype.destroy.apply(this,arguments)},clone:function(a){return null==a&&(a=new OpenLayers.Layer.Image(this.name,this.url,this.extent,this.size,this.getOptions())),a=OpenLayers.Layer.prototype.clone.apply(this,[a])},setMap:function(){null==this.options.maxResolution&&(this.options.maxResolution=this.aspectRatio*this.extent.getWidth()/this.size.w),OpenLayers.Layer.prototype.setMap.apply(this,arguments)},moveTo:function(a,b){OpenLayers.Layer.prototype.moveTo.apply(this,arguments);var c=null==this.tile;if(b||c){this.setTileSize();var d=this.map.getLayerPxFromLonLat({lon:this.extent.left,lat:this.extent.top});c?(this.tile=new OpenLayers.Tile.Image(this,d,this.extent,null,this.tileSize),this.addTileMonitoringHooks(this.tile)):(this.tile.size=this.tileSize.clone(),this.tile.position=d.clone()),this.tile.draw()}},setTileSize:function(){var a=this.extent.getWidth()/this.map.getResolution(),b=this.extent.getHeight()/this.map.getResolution();this.tileSize=new OpenLayers.Size(a,b)},addTileMonitoringHooks:function(a){a.onLoadStart=function(){this.events.triggerEvent("loadstart")},a.events.register("loadstart",this,a.onLoadStart),a.onLoadEnd=function(){this.events.triggerEvent("loadend")},a.events.register("loadend",this,a.onLoadEnd),a.events.register("unload",this,a.onLoadEnd)},removeTileMonitoringHooks:function(a){a.unload(),a.events.un({loadstart:a.onLoadStart,loadend:a.onLoadEnd,unload:a.onLoadEnd,scope:this})},setUrl:function(a){this.url=a,this.tile.draw()},getURL:function(){return this.url},CLASS_NAME:"OpenLayers.Layer.Image"}),OpenLayers.Strategy=OpenLayers.Class({layer:null,options:null,active:null,autoActivate:!0,autoDestroy:!0,initialize:function(a){OpenLayers.Util.extend(this,a),this.options=a,this.active=!1},destroy:function(){this.deactivate(),this.options=this.layer=null},setLayer:function(a){this.layer=a},activate:function(){return this.active?!1:this.active=!0},deactivate:function(){return this.active?(this.active=!1,!0):!1},CLASS_NAME:"OpenLayers.Strategy"}),OpenLayers.Strategy.Save=OpenLayers.Class(OpenLayers.Strategy,{events:null,auto:!1,timer:null,initialize:function(a){OpenLayers.Strategy.prototype.initialize.apply(this,[a]),this.events=new OpenLayers.Events(this)},activate:function(){var a=OpenLayers.Strategy.prototype.activate.call(this);return a&&this.auto&&("number"==typeof this.auto?this.timer=window.setInterval(OpenLayers.Function.bind(this.save,this),1e3*this.auto):this.layer.events.on({featureadded:this.triggerSave,afterfeaturemodified:this.triggerSave,scope:this})),a},deactivate:function(){var a=OpenLayers.Strategy.prototype.deactivate.call(this);return a&&this.auto&&("number"==typeof this.auto?window.clearInterval(this.timer):this.layer.events.un({featureadded:this.triggerSave,afterfeaturemodified:this.triggerSave,scope:this})),a},triggerSave:function(a){var b=a.feature;(b.state===OpenLayers.State.INSERT||b.state===OpenLayers.State.UPDATE||b.state===OpenLayers.State.DELETE)&&this.save([a.feature])},save:function(a){a||(a=this.layer.features),this.events.triggerEvent("start",{features:a});var b=this.layer.projection,c=this.layer.map.getProjectionObject();if(!c.equals(b)){for(var d,e,f=a.length,g=Array(f),h=0;f>h;++h)d=a[h],e=d.clone(),e.fid=d.fid,e.state=d.state,d.url&&(e.url=d.url),e._original=d,e.geometry.transform(c,b),g[h]=e;a=g}this.layer.protocol.commit(a,{callback:this.onCommit,scope:this})},onCommit:function(a){var b={response:a};if(a.success()){for(var c,d=a.reqFeatures,e=[],f=a.insertIds||[],g=0,h=0,i=d.length;i>h;++h)c=d[h],c=c._original||c,(a=c.state)&&(a==OpenLayers.State.DELETE?e.push(c):a==OpenLayers.State.INSERT&&(c.fid=f[g],++g),c.state=null);0<e.length&&this.layer.destroyFeatures(e),this.events.triggerEvent("success",b)}else this.events.triggerEvent("fail",b)},CLASS_NAME:"OpenLayers.Strategy.Save"}),OpenLayers.Format.GPX=OpenLayers.Class(OpenLayers.Format.XML,{defaultDesc:"No description available",extractWaypoints:!0,extractTracks:!0,extractRoutes:!0,extractAttributes:!0,namespaces:{gpx:"http://www.topografix.com/GPX/1/1",xsi:"http://www.w3.org/2001/XMLSchema-instance"},schemaLocation:"http://www.topografix.com/GPX/1/1 http://www.topografix.com/GPX/1/1/gpx.xsd",creator:"OpenLayers",initialize:function(a){this.externalProjection=new OpenLayers.Projection("EPSG:4326"),OpenLayers.Format.XML.prototype.initialize.apply(this,[a])},read:function(a){"string"==typeof a&&(a=OpenLayers.Format.XML.prototype.read.apply(this,[a]));var b=[];if(this.extractTracks)for(var c=a.getElementsByTagName("trk"),d=0,e=c.length;e>d;d++){var f={};this.extractAttributes&&(f=this.parseAttributes(c[d]));for(var g=this.getElementsByTagNameNS(c[d],c[d].namespaceURI,"trkseg"),h=0,i=g.length;i>h;h++){var j=this.extractSegment(g[h],"trkpt");b.push(new OpenLayers.Feature.Vector(j,f))}}if(this.extractRoutes)for(e=a.getElementsByTagName("rte"),c=0,d=e.length;d>c;c++)f={},this.extractAttributes&&(f=this.parseAttributes(e[c])),g=this.extractSegment(e[c],"rtept"),b.push(new OpenLayers.Feature.Vector(g,f));if(this.extractWaypoints)for(a=a.getElementsByTagName("wpt"),c=0,e=a.length;e>c;c++)f={},this.extractAttributes&&(f=this.parseAttributes(a[c])),d=new OpenLayers.Geometry.Point(a[c].getAttribute("lon"),a[c].getAttribute("lat")),b.push(new OpenLayers.Feature.Vector(d,f));if(this.internalProjection&&this.externalProjection)for(f=0,a=b.length;a>f;f++)b[f].geometry.transform(this.externalProjection,this.internalProjection);return b},extractSegment:function(a,b){for(var c=this.getElementsByTagNameNS(a,a.namespaceURI,b),d=[],e=0,f=c.length;f>e;e++)d.push(new OpenLayers.Geometry.Point(c[e].getAttribute("lon"),c[e].getAttribute("lat")));return new OpenLayers.Geometry.LineString(d)},parseAttributes:function(a){for(var b,c,d={},a=a.firstChild;a;)1==a.nodeType&&a.firstChild&&(b=a.firstChild,3==b.nodeType||4==b.nodeType)&&(c=a.prefix?a.nodeName.split(":")[1]:a.nodeName,"trkseg"!=c&&"rtept"!=c&&(d[c]=b.nodeValue)),a=a.nextSibling;return d},write:function(a,b){var a=OpenLayers.Util.isArray(a)?a:[a],c=this.createElementNS(this.namespaces.gpx,"gpx");c.setAttribute("version","1.1"),c.setAttribute("creator",this.creator),this.setAttributes(c,{"xsi:schemaLocation":this.schemaLocation}),b&&"object"==typeof b&&c.appendChild(this.buildMetadataNode(b));for(var d=0,e=a.length;e>d;d++)c.appendChild(this.buildFeatureNode(a[d]));return OpenLayers.Format.XML.prototype.write.apply(this,[c])},buildMetadataNode:function(a){for(var b=["name","desc","author"],c=this.createElementNSPlus("gpx:metadata"),d=0;d<b.length;d++){var e=b[d];if(a[e]){var f=this.createElementNSPlus("gpx:"+e);f.appendChild(this.createTextNode(a[e])),c.appendChild(f)}}return c},buildFeatureNode:function(a){var b=a.geometry,b=b.clone();if(this.internalProjection&&this.externalProjection&&b.transform(this.internalProjection,this.externalProjection),"OpenLayers.Geometry.Point"==b.CLASS_NAME){var c=this.buildWptNode(b);return this.appendAttributesNode(c,a),c}c=this.createElementNSPlus("gpx:trk"),this.appendAttributesNode(c,a);for(var a=this.buildTrkSegNode(b),a=OpenLayers.Util.isArray(a)?a:[a],b=0,d=a.length;d>b;b++)c.appendChild(a[b]);return c},buildTrkSegNode:function(a){var b,c,d,e;if("OpenLayers.Geometry.LineString"==a.CLASS_NAME||"OpenLayers.Geometry.LinearRing"==a.CLASS_NAME){for(b=this.createElementNSPlus("gpx:trkseg"),c=0,d=a.components.length;d>c;c++)e=a.components[c],b.appendChild(this.buildTrkPtNode(e));return b}for(b=[],c=0,d=a.components.length;d>c;c++)b.push(this.buildTrkSegNode(a.components[c]));return b},buildTrkPtNode:function(a){var b=this.createElementNSPlus("gpx:trkpt");return b.setAttribute("lon",a.x),b.setAttribute("lat",a.y),b},buildWptNode:function(a){var b=this.createElementNSPlus("gpx:wpt");return b.setAttribute("lon",a.x),b.setAttribute("lat",a.y),b},appendAttributesNode:function(a,b){var c=this.createElementNSPlus("gpx:name");c.appendChild(this.createTextNode(b.attributes.name||b.id)),a.appendChild(c),c=this.createElementNSPlus("gpx:desc"),c.appendChild(this.createTextNode(b.attributes.description||this.defaultDesc)),a.appendChild(c)},CLASS_NAME:"OpenLayers.Format.GPX"}),OpenLayers.Format.WMSDescribeLayer=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.1.1",getVersion:function(){var a=OpenLayers.Format.XML.VersionedOGC.prototype.getVersion.apply(this,arguments);return("1.1.1"==a||"1.1.0"==a)&&(a="1.1"),a},CLASS_NAME:"OpenLayers.Format.WMSDescribeLayer"}),OpenLayers.Format.WMSDescribeLayer.v1_1=OpenLayers.Class(OpenLayers.Format.WMSDescribeLayer,{initialize:function(a){OpenLayers.Format.WMSDescribeLayer.prototype.initialize.apply(this,[a])},read:function(a){"string"==typeof a&&(a=OpenLayers.Format.XML.prototype.read.apply(this,[a]));for(var b,c,a=a.documentElement.childNodes,d=[],e=0;e<a.length;++e)if(b=a[e],c=b.nodeName,"LayerDescription"==c){c=b.getAttribute("name");var f="",g="",h="";b.getAttribute("owsType")?(f=b.getAttribute("owsType"),g=b.getAttribute("owsURL")):""!=b.getAttribute("wfs")?(f="WFS",g=b.getAttribute("wfs")):""!=b.getAttribute("wcs")&&(f="WCS",g=b.getAttribute("wcs")),b=b.getElementsByTagName("Query"),0<b.length&&((h=b[0].getAttribute("typeName"))||(h=b[0].getAttribute("typename"))),d.push({layerName:c,owsType:f,owsURL:g,typeName:h})}return d},CLASS_NAME:"OpenLayers.Format.WMSDescribeLayer.v1_1"}),OpenLayers.Layer.XYZ=OpenLayers.Class(OpenLayers.Layer.Grid,{isBaseLayer:!0,sphericalMercator:!1,zoomOffset:0,serverResolutions:null,initialize:function(a,b,c){(c&&c.sphericalMercator||this.sphericalMercator)&&(c=OpenLayers.Util.extend({projection:"EPSG:900913",numZoomLevels:19},c)),OpenLayers.Layer.Grid.prototype.initialize.apply(this,[a||this.name,b||this.url,{},c])},clone:function(a){return null==a&&(a=new OpenLayers.Layer.XYZ(this.name,this.url,this.getOptions())),a=OpenLayers.Layer.Grid.prototype.clone.apply(this,[a])},getURL:function(a){var a=this.getXYZ(a),b=this.url;return OpenLayers.Util.isArray(b)&&(b=this.selectUrl(""+a.x+a.y+a.z,b)),OpenLayers.String.format(b,a)},getXYZ:function(a){var b=this.getServerResolution(),c=Math.round((a.left-this.maxExtent.left)/(b*this.tileSize.w)),a=Math.round((this.maxExtent.top-a.top)/(b*this.tileSize.h)),b=this.getServerZoom();if(this.wrapDateLine)var d=Math.pow(2,b),c=(c%d+d)%d;return{x:c,y:a,z:b}},setMap:function(){OpenLayers.Layer.Grid.prototype.setMap.apply(this,arguments),this.tileOrigin||(this.tileOrigin=new OpenLayers.LonLat(this.maxExtent.left,this.maxExtent.bottom))},CLASS_NAME:"OpenLayers.Layer.XYZ"}),OpenLayers.Layer.OSM=OpenLayers.Class(OpenLayers.Layer.XYZ,{name:"OpenStreetMap",url:["//a.tile.openstreetmap.org/${z}/${x}/${y}.png","//b.tile.openstreetmap.org/${z}/${x}/${y}.png","//c.tile.openstreetmap.org/${z}/${x}/${y}.png"],attribution:"Data CC-By-SA by <a href='http://openstreetmap.org/'>OpenStreetMap</a>",sphericalMercator:!0,wrapDateLine:!0,tileOptions:null,initialize:function(){OpenLayers.Layer.XYZ.prototype.initialize.apply(this,arguments),this.tileOptions=OpenLayers.Util.extend({crossOriginKeyword:"anonymous"},this.options&&this.options.tileOptions)},clone:function(a){return null==a&&(a=new OpenLayers.Layer.OSM(this.name,this.url,this.getOptions())),a=OpenLayers.Layer.XYZ.prototype.clone.apply(this,[a])},CLASS_NAME:"OpenLayers.Layer.OSM"}),OpenLayers.Renderer=OpenLayers.Class({container:null,root:null,extent:null,locked:!1,size:null,resolution:null,map:null,featureDx:0,initialize:function(a,b){this.container=OpenLayers.Util.getElement(a),OpenLayers.Util.extend(this,b)},destroy:function(){this.map=this.resolution=this.size=this.extent=this.container=null},supported:function(){return!1},setExtent:function(a,b){if(this.extent=a.clone(),this.map.baseLayer&&this.map.baseLayer.wrapDateLine){var c=a.getWidth()/this.map.getExtent().getWidth(),a=a.scale(1/c);this.extent=a.wrapDateLine(this.map.getMaxExtent()).scale(c)}return b&&(this.resolution=null),!0},setSize:function(a){this.size=a.clone(),this.resolution=null},getResolution:function(){return this.resolution=this.resolution||this.map.getResolution()},drawFeature:function(a,b){if(null==b&&(b=a.style),a.geometry){var c=a.geometry.getBounds();if(c){var d;if(this.map.baseLayer&&this.map.baseLayer.wrapDateLine&&(d=this.map.getMaxExtent()),c.intersectsBounds(this.extent,{worldBounds:d})?this.calculateFeatureDx(c,d):b={display:"none"},c=this.drawGeometry(a.geometry,b,a.id),"none"!=b.display&&b.label&&!1!==c){if(d=a.geometry.getCentroid(),b.labelXOffset||b.labelYOffset){var e=isNaN(b.labelXOffset)?0:b.labelXOffset,f=isNaN(b.labelYOffset)?0:b.labelYOffset,g=this.getResolution();d.move(e*g,f*g)}this.drawText(a.id,b,d)}else this.removeText(a.id);return c}}},calculateFeatureDx:function(a,b){if(this.featureDx=0,b){var c=b.getWidth();this.featureDx=Math.round(((a.left+a.right)/2-(this.extent.left+this.extent.right)/2)/c)*c}},drawGeometry:function(){},drawText:function(){},removeText:function(){},clear:function(){},getFeatureIdFromEvent:function(){},eraseFeatures:function(a){OpenLayers.Util.isArray(a)||(a=[a]);for(var b=0,c=a.length;c>b;++b){var d=a[b];this.eraseGeometry(d.geometry,d.id),this.removeText(d.id)}},eraseGeometry:function(){},moveRoot:function(){},getRenderLayerId:function(){return this.container.id},applyDefaultSymbolizer:function(a){var b=OpenLayers.Util.extend({},OpenLayers.Renderer.defaultSymbolizer);return!1===a.stroke&&(delete b.strokeWidth,delete b.strokeColor),!1===a.fill&&delete b.fillColor,OpenLayers.Util.extend(b,a),b},CLASS_NAME:"OpenLayers.Renderer"}),OpenLayers.Renderer.defaultSymbolizer={fillColor:"#000000",strokeColor:"#000000",strokeWidth:2,fillOpacity:1,strokeOpacity:1,pointRadius:0,labelAlign:"cm"},OpenLayers.Renderer.symbol={star:[350,75,379,161,469,161,397,215,423,301,350,250,277,301,303,215,231,161,321,161,350,75],cross:[4,0,6,0,6,4,10,4,10,6,6,6,6,10,4,10,4,6,0,6,0,4,4,4,4,0],x:[0,0,25,0,50,35,75,0,100,0,65,50,100,100,75,100,50,65,25,100,0,100,35,50,0,0],square:[0,0,0,1,1,1,1,0,0,0],triangle:[0,10,10,10,5,0,0,10]},OpenLayers.Renderer.Canvas=OpenLayers.Class(OpenLayers.Renderer,{hitDetection:!0,hitOverflow:0,canvas:null,features:null,pendingRedraw:!1,cachedSymbolBounds:{},initialize:function(){OpenLayers.Renderer.prototype.initialize.apply(this,arguments),this.root=document.createElement("canvas"),this.container.appendChild(this.root),this.canvas=this.root.getContext("2d"),this.features={},this.hitDetection&&(this.hitCanvas=document.createElement("canvas"),this.hitContext=this.hitCanvas.getContext("2d"))},setExtent:function(){return OpenLayers.Renderer.prototype.setExtent.apply(this,arguments),!1},eraseGeometry:function(a,b){this.eraseFeatures(this.features[b][0])},supported:function(){return OpenLayers.CANVAS_SUPPORTED},setSize:function(a){this.size=a.clone();var b=this.root;b.style.width=a.w+"px",b.style.height=a.h+"px",b.width=a.w,b.height=a.h,this.resolution=null,this.hitDetection&&(b=this.hitCanvas,b.style.width=a.w+"px",b.style.height=a.h+"px",b.width=a.w,b.height=a.h)
},drawFeature:function(a,b){var c;if(a.geometry){b=this.applyDefaultSymbolizer(b||a.style),c=a.geometry.getBounds();var d;this.map.baseLayer&&this.map.baseLayer.wrapDateLine&&(d=this.map.getMaxExtent()),d=c&&c.intersectsBounds(this.extent,{worldBounds:d}),(c="none"!==b.display&&!!c&&d)?this.features[a.id]=[a,b]:delete this.features[a.id],this.pendingRedraw=!0}return this.pendingRedraw&&!this.locked&&(this.redraw(),this.pendingRedraw=!1),c},drawGeometry:function(a,b,c){var d=a.CLASS_NAME;if("OpenLayers.Geometry.Collection"==d||"OpenLayers.Geometry.MultiPoint"==d||"OpenLayers.Geometry.MultiLineString"==d||"OpenLayers.Geometry.MultiPolygon"==d)for(d=0;d<a.components.length;d++)this.drawGeometry(a.components[d],b,c);else switch(a.CLASS_NAME){case"OpenLayers.Geometry.Point":this.drawPoint(a,b,c);break;case"OpenLayers.Geometry.LineString":this.drawLineString(a,b,c);break;case"OpenLayers.Geometry.LinearRing":this.drawLinearRing(a,b,c);break;case"OpenLayers.Geometry.Polygon":this.drawPolygon(a,b,c)}},drawExternalGraphic:function(a,b,c){var d=new Image;b.graphicTitle&&(d.title=b.graphicTitle);var e=b.graphicWidth||b.graphicHeight,f=b.graphicHeight||b.graphicWidth,e=e?e:2*b.pointRadius,f=f?f:2*b.pointRadius,g=void 0!=b.graphicXOffset?b.graphicXOffset:-(.5*e),h=void 0!=b.graphicYOffset?b.graphicYOffset:-(.5*f),i=b.graphicOpacity||b.fillOpacity;d.onload=OpenLayers.Function.bind(function(){if(this.features[c]){var b=this.getLocalXY(a),j=b[0],b=b[1];if(!isNaN(j)&&!isNaN(b)){var j=j+g|0,b=b+h|0,k=this.canvas;k.globalAlpha=i;var l=OpenLayers.Renderer.Canvas.drawImageScaleFactor||(OpenLayers.Renderer.Canvas.drawImageScaleFactor=/android 2.1/.test(navigator.userAgent.toLowerCase())?320/window.screen.width:1);k.drawImage(d,j*l,b*l,e*l,f*l),this.hitDetection&&(this.setHitContextStyle("fill",c),this.hitContext.fillRect(j,b,e,f))}}},this),d.src=b.externalGraphic},drawNamedSymbol:function(a,b,c){var d,e,f,g;f=Math.PI/180;var h=OpenLayers.Renderer.symbol[b.graphicName];if(!h)throw Error(b.graphicName+" is not a valid symbol name");if(!(!h.length||2>h.length||(a=this.getLocalXY(a),e=a[0],g=a[1],isNaN(e)||isNaN(g)))){if(this.canvas.lineCap="round",this.canvas.lineJoin="round",this.hitDetection&&(this.hitContext.lineCap="round",this.hitContext.lineJoin="round"),b.graphicName in this.cachedSymbolBounds)d=this.cachedSymbolBounds[b.graphicName];else{for(d=new OpenLayers.Bounds,a=0;a<h.length;a+=2)d.extend(new OpenLayers.LonLat(h[a],h[a+1]));this.cachedSymbolBounds[b.graphicName]=d}if(this.canvas.save(),this.hitDetection&&this.hitContext.save(),this.canvas.translate(e,g),this.hitDetection&&this.hitContext.translate(e,g),a=f*b.rotation,isNaN(a)||(this.canvas.rotate(a),this.hitDetection&&this.hitContext.rotate(a)),f=2*b.pointRadius/Math.max(d.getWidth(),d.getHeight()),this.canvas.scale(f,f),this.hitDetection&&this.hitContext.scale(f,f),a=d.getCenterLonLat().lon,d=d.getCenterLonLat().lat,this.canvas.translate(-a,-d),this.hitDetection&&this.hitContext.translate(-a,-d),g=b.strokeWidth,b.strokeWidth=g/f,!1!==b.fill){for(this.setCanvasStyle("fill",b),this.canvas.beginPath(),a=0;a<h.length;a+=2)d=h[a],e=h[a+1],0==a&&this.canvas.moveTo(d,e),this.canvas.lineTo(d,e);if(this.canvas.closePath(),this.canvas.fill(),this.hitDetection){for(this.setHitContextStyle("fill",c,b),this.hitContext.beginPath(),a=0;a<h.length;a+=2)d=h[a],e=h[a+1],0==a&&this.canvas.moveTo(d,e),this.hitContext.lineTo(d,e);this.hitContext.closePath(),this.hitContext.fill()}}if(!1!==b.stroke){for(this.setCanvasStyle("stroke",b),this.canvas.beginPath(),a=0;a<h.length;a+=2)d=h[a],e=h[a+1],0==a&&this.canvas.moveTo(d,e),this.canvas.lineTo(d,e);if(this.canvas.closePath(),this.canvas.stroke(),this.hitDetection){for(this.setHitContextStyle("stroke",c,b,f),this.hitContext.beginPath(),a=0;a<h.length;a+=2)d=h[a],e=h[a+1],0==a&&this.hitContext.moveTo(d,e),this.hitContext.lineTo(d,e);this.hitContext.closePath(),this.hitContext.stroke()}}b.strokeWidth=g,this.canvas.restore(),this.hitDetection&&this.hitContext.restore(),this.setCanvasStyle("reset")}},setCanvasStyle:function(a,b){"fill"===a?(this.canvas.globalAlpha=b.fillOpacity,this.canvas.fillStyle=b.fillColor):"stroke"===a?(this.canvas.globalAlpha=b.strokeOpacity,this.canvas.strokeStyle=b.strokeColor,this.canvas.lineWidth=b.strokeWidth):(this.canvas.globalAlpha=0,this.canvas.lineWidth=1)},featureIdToHex:function(a){a=Number(a.split("_").pop())+1,a>=16777216&&(this.hitOverflow=a-16777215,a=a%16777216+1);var a="000000"+a.toString(16),b=a.length;return a="#"+a.substring(b-6,b)},setHitContextStyle:function(a,b,c,d){b=this.featureIdToHex(b),"fill"==a?(this.hitContext.globalAlpha=1,this.hitContext.fillStyle=b):"stroke"==a?(this.hitContext.globalAlpha=1,this.hitContext.strokeStyle=b,"undefined"==typeof d?this.hitContext.lineWidth=c.strokeWidth+2:isNaN(d)||(this.hitContext.lineWidth=c.strokeWidth+2/d)):(this.hitContext.globalAlpha=0,this.hitContext.lineWidth=1)},drawPoint:function(a,b,c){if(!1!==b.graphic)if(b.externalGraphic)this.drawExternalGraphic(a,b,c);else if(b.graphicName&&"circle"!=b.graphicName)this.drawNamedSymbol(a,b,c);else{var d=this.getLocalXY(a),a=d[0],d=d[1];if(!isNaN(a)&&!isNaN(d)){var e=2*Math.PI,f=b.pointRadius;!1!==b.fill&&(this.setCanvasStyle("fill",b),this.canvas.beginPath(),this.canvas.arc(a,d,f,0,e,!0),this.canvas.fill(),this.hitDetection&&(this.setHitContextStyle("fill",c,b),this.hitContext.beginPath(),this.hitContext.arc(a,d,f,0,e,!0),this.hitContext.fill())),!1!==b.stroke&&(this.setCanvasStyle("stroke",b),this.canvas.beginPath(),this.canvas.arc(a,d,f,0,e,!0),this.canvas.stroke(),this.hitDetection&&(this.setHitContextStyle("stroke",c,b),this.hitContext.beginPath(),this.hitContext.arc(a,d,f,0,e,!0),this.hitContext.stroke()),this.setCanvasStyle("reset"))}}},drawLineString:function(a,b,c){b=OpenLayers.Util.applyDefaults({fill:!1},b),this.drawLinearRing(a,b,c)},drawLinearRing:function(a,b,c){!1!==b.fill&&(this.setCanvasStyle("fill",b),this.renderPath(this.canvas,a,b,c,"fill"),this.hitDetection&&(this.setHitContextStyle("fill",c,b),this.renderPath(this.hitContext,a,b,c,"fill"))),!1!==b.stroke&&(this.setCanvasStyle("stroke",b),this.renderPath(this.canvas,a,b,c,"stroke"),this.hitDetection&&(this.setHitContextStyle("stroke",c,b),this.renderPath(this.hitContext,a,b,c,"stroke"))),this.setCanvasStyle("reset")},renderPath:function(a,b,c,d,e){b=b.components,c=b.length,a.beginPath();var d=this.getLocalXY(b[0]),f=d[1];if(!isNaN(d[0])&&!isNaN(f)){for(a.moveTo(d[0],d[1]),d=1;c>d;++d)f=this.getLocalXY(b[d]),a.lineTo(f[0],f[1]);"fill"===e?a.fill():a.stroke()}},drawPolygon:function(a,b,c){var a=a.components,d=a.length;this.drawLinearRing(a[0],b,c);for(var e=1;d>e;++e)this.canvas.globalCompositeOperation="destination-out",this.hitDetection&&(this.hitContext.globalCompositeOperation="destination-out"),this.drawLinearRing(a[e],OpenLayers.Util.applyDefaults({stroke:!1,fillOpacity:1},b),c),this.canvas.globalCompositeOperation="source-over",this.hitDetection&&(this.hitContext.globalCompositeOperation="source-over"),this.drawLinearRing(a[e],OpenLayers.Util.applyDefaults({fill:!1},b),c)},drawText:function(a,b){var c=this.getLocalXY(a);this.setCanvasStyle("reset"),this.canvas.fillStyle=b.fontColor,this.canvas.globalAlpha=b.fontOpacity||1;var d=[b.fontStyle?b.fontStyle:"normal","normal",b.fontWeight?b.fontWeight:"normal",b.fontSize?b.fontSize:"1em",b.fontFamily?b.fontFamily:"sans-serif"].join(" "),e=b.label.split("\n"),f=e.length;if(this.canvas.fillText){this.canvas.font=d,this.canvas.textAlign=OpenLayers.Renderer.Canvas.LABEL_ALIGN[b.labelAlign[0]]||"center",this.canvas.textBaseline=OpenLayers.Renderer.Canvas.LABEL_ALIGN[b.labelAlign[1]]||"middle";var g=OpenLayers.Renderer.Canvas.LABEL_FACTOR[b.labelAlign[1]];for(null==g&&(g=-.5),d=this.canvas.measureText("Mg").height||this.canvas.measureText("xx").width,c[1]+=d*g*(f-1),g=0;f>g;g++)b.labelOutlineWidth&&(this.canvas.save(),this.canvas.strokeStyle=b.labelOutlineColor,this.canvas.lineWidth=b.labelOutlineWidth,this.canvas.strokeText(e[g],c[0],c[1]+d*g+1),this.canvas.restore()),this.canvas.fillText(e[g],c[0],c[1]+d*g)}else if(this.canvas.mozDrawText){this.canvas.mozTextStyle=d;var h=OpenLayers.Renderer.Canvas.LABEL_FACTOR[b.labelAlign[0]];for(null==h&&(h=-.5),g=OpenLayers.Renderer.Canvas.LABEL_FACTOR[b.labelAlign[1]],null==g&&(g=-.5),d=this.canvas.mozMeasureText("xx"),c[1]+=d*(1+g*f),g=0;f>g;g++){var i=c[0]+h*this.canvas.mozMeasureText(e[g]),j=c[1]+g*d;this.canvas.translate(i,j),this.canvas.mozDrawText(e[g]),this.canvas.translate(-i,-j)}}this.setCanvasStyle("reset")},getLocalXY:function(a){var b=this.getResolution(),c=this.extent;return[(a.x-this.featureDx)/b+-c.left/b,c.top/b-a.y/b]},clear:function(){var a=this.root.height,b=this.root.width;this.canvas.clearRect(0,0,b,a),this.features={},this.hitDetection&&this.hitContext.clearRect(0,0,b,a)},getFeatureIdFromEvent:function(a){var b;if(this.hitDetection&&"none"!==this.root.style.display&&!this.map.dragging&&(a=a.xy,a=this.hitContext.getImageData(0|a.x,0|a.y,1,1).data,255===a[3]&&(a=a[2]+256*(a[1]+256*a[0])))){a="OpenLayers.Feature.Vector_"+(a-1+this.hitOverflow);try{b=this.features[a][0]}catch(c){}}return b},eraseFeatures:function(a){OpenLayers.Util.isArray(a)||(a=[a]);for(var b=0;b<a.length;++b)delete this.features[a[b].id];this.redraw()},redraw:function(){if(!this.locked){var a=this.root.height,b=this.root.width;this.canvas.clearRect(0,0,b,a),this.hitDetection&&this.hitContext.clearRect(0,0,b,a);var c,d,e,a=[],f=this.map.baseLayer&&this.map.baseLayer.wrapDateLine&&this.map.getMaxExtent();for(e in this.features)this.features.hasOwnProperty(e)&&(b=this.features[e][0],c=b.geometry,this.calculateFeatureDx(c.getBounds(),f),d=this.features[e][1],this.drawGeometry(c,d,b.id),d.label&&a.push([b,d]));for(b=0,c=a.length;c>b;++b)e=a[b],this.drawText(e[0].geometry.getCentroid(),e[1])}},CLASS_NAME:"OpenLayers.Renderer.Canvas"}),OpenLayers.Renderer.Canvas.LABEL_ALIGN={l:"left",r:"right",t:"top",b:"bottom"},OpenLayers.Renderer.Canvas.LABEL_FACTOR={l:0,r:-1,t:0,b:-1},OpenLayers.Renderer.Canvas.drawImageScaleFactor=null,OpenLayers.Format.OSM=OpenLayers.Class(OpenLayers.Format.XML,{checkTags:!1,interestingTagsExclude:null,areaTags:null,initialize:function(a){for(var b={interestingTagsExclude:"source source_ref source:ref history attribution created_by".split(" "),areaTags:"area building leisure tourism ruins historic landuse military natural sport".split(" ")},b=OpenLayers.Util.extend(b,a),c={},a=0;a<b.interestingTagsExclude.length;a++)c[b.interestingTagsExclude[a]]=!0;for(b.interestingTagsExclude=c,c={},a=0;a<b.areaTags.length;a++)c[b.areaTags[a]]=!0;b.areaTags=c,this.externalProjection=new OpenLayers.Projection("EPSG:4326"),OpenLayers.Format.XML.prototype.initialize.apply(this,[b])},read:function(a){"string"==typeof a&&(a=OpenLayers.Format.XML.prototype.read.apply(this,[a]));for(var b=this.getNodes(a),c=this.getWays(a),a=Array(c.length),d=0;d<c.length;d++){for(var e=Array(c[d].nodes.length),f=this.isWayArea(c[d])?1:0,g=0;g<c[d].nodes.length;g++){var h=b[c[d].nodes[g]],i=new OpenLayers.Geometry.Point(h.lon,h.lat);i.osm_id=parseInt(c[d].nodes[g]),e[g]=i,h.used=!0}h=null,h=f?new OpenLayers.Geometry.Polygon(new OpenLayers.Geometry.LinearRing(e)):new OpenLayers.Geometry.LineString(e),this.internalProjection&&this.externalProjection&&h.transform(this.externalProjection,this.internalProjection),e=new OpenLayers.Feature.Vector(h,c[d].tags),e.osm_id=parseInt(c[d].id),e.fid="way."+e.osm_id,a[d]=e}for(var j in b){if(h=b[j],!h.used||this.checkTags){if(c=null,this.checkTags){if(c=this.getTags(h.node,!0),h.used&&!c[1])continue;c=c[0]}else c=this.getTags(h.node);e=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(h.lon,h.lat),c),this.internalProjection&&this.externalProjection&&e.geometry.transform(this.externalProjection,this.internalProjection),e.osm_id=parseInt(j),e.fid="node."+e.osm_id,a.push(e)}h.node=null}return a},getNodes:function(a){for(var a=a.getElementsByTagName("node"),b={},c=0;c<a.length;c++){var d=a[c],e=d.getAttribute("id");b[e]={lat:d.getAttribute("lat"),lon:d.getAttribute("lon"),node:d}}return b},getWays:function(a){for(var a=a.getElementsByTagName("way"),b=[],c=0;c<a.length;c++){var d=a[c],e={id:d.getAttribute("id")};e.tags=this.getTags(d),d=d.getElementsByTagName("nd"),e.nodes=Array(d.length);for(var f=0;f<d.length;f++)e.nodes[f]=d[f].getAttribute("ref");b.push(e)}return b},getTags:function(a,b){for(var c=a.getElementsByTagName("tag"),d={},e=!1,f=0;f<c.length;f++){var g=c[f].getAttribute("k");d[g]=c[f].getAttribute("v"),b&&(this.interestingTagsExclude[g]||(e=!0))}return b?[d,e]:d},isWayArea:function(a){var b=!1,c=!1;if(a.nodes[0]==a.nodes[a.nodes.length-1]&&(b=!0),this.checkTags)for(var d in a.tags)if(this.areaTags[d]){c=!0;break}return b&&(this.checkTags?c:!0)},write:function(a){OpenLayers.Util.isArray(a)||(a=[a]),this.osm_id=1,this.created_nodes={};var b=this.createElementNS(null,"osm");b.setAttribute("version","0.5"),b.setAttribute("generator","OpenLayers "+OpenLayers.VERSION_NUMBER);for(var c=a.length-1;c>=0;c--)for(var d=this.createFeatureNodes(a[c]),e=0;e<d.length;e++)b.appendChild(d[e]);return OpenLayers.Format.XML.prototype.write.apply(this,[b])},createFeatureNodes:function(a){var b=[],c=a.geometry.CLASS_NAME,c=c.substring(c.lastIndexOf(".")+1),c=c.toLowerCase();return(c=this.createXML[c])&&(b=c.apply(this,[a])),b},createXML:{point:function(a){var b=null,c=a.geometry?a.geometry:a;this.internalProjection&&this.externalProjection&&(c=c.clone(),c.transform(this.internalProjection,this.externalProjection));var d=!1;a.osm_id?(b=a.osm_id,this.created_nodes[b]&&(d=!0)):(b=-this.osm_id,this.osm_id++);var e=d?this.created_nodes[b]:this.createElementNS(null,"node");return this.created_nodes[b]=e,e.setAttribute("id",b),e.setAttribute("lon",c.x),e.setAttribute("lat",c.y),a.attributes&&this.serializeTags(a,e),this.setState(a,e),d?[]:[e]},linestring:function(a){var b,c=[],d=a.geometry;a.osm_id?b=a.osm_id:(b=-this.osm_id,this.osm_id++);var e=this.createElementNS(null,"way");for(e.setAttribute("id",b),b=0;b<d.components.length;b++){var f=this.createXML.point.apply(this,[d.components[b]]);if(f.length){var f=f[0],g=f.getAttribute("id");c.push(f)}else g=d.components[b].osm_id,f=this.created_nodes[g];this.setState(a,f),f=this.createElementNS(null,"nd"),f.setAttribute("ref",g),e.appendChild(f)}return this.serializeTags(a,e),c.push(e),c},polygon:function(a){var b=OpenLayers.Util.extend({area:"yes"},a.attributes),b=new OpenLayers.Feature.Vector(a.geometry.components[0],b);return b.osm_id=a.osm_id,this.createXML.linestring.apply(this,[b])}},serializeTags:function(a,b){for(var c in a.attributes){var d=this.createElementNS(null,"tag");d.setAttribute("k",c),d.setAttribute("v",a.attributes[c]),b.appendChild(d)}},setState:function(a,b){if(a.state){var c=null;switch(a.state){case OpenLayers.State.UPDATE:case OpenLayers.State.DELETE:c="delete"}c&&b.setAttribute("action",c)}},CLASS_NAME:"OpenLayers.Format.OSM"}),OpenLayers.Handler=OpenLayers.Class({id:null,control:null,map:null,keyMask:null,active:!1,evt:null,initialize:function(a,b,c){OpenLayers.Util.extend(this,c),this.control=a,this.callbacks=b,(a=this.map||a.map)&&this.setMap(a),this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},setMap:function(a){this.map=a},checkModifiers:function(a){return null==this.keyMask?!0:((a.shiftKey?OpenLayers.Handler.MOD_SHIFT:0)|(a.ctrlKey?OpenLayers.Handler.MOD_CTRL:0)|(a.altKey?OpenLayers.Handler.MOD_ALT:0))==this.keyMask},activate:function(){if(this.active)return!1;for(var a=OpenLayers.Events.prototype.BROWSER_EVENTS,b=0,c=a.length;c>b;b++)this[a[b]]&&this.register(a[b],this[a[b]]);return this.active=!0},deactivate:function(){if(!this.active)return!1;for(var a=OpenLayers.Events.prototype.BROWSER_EVENTS,b=0,c=a.length;c>b;b++)this[a[b]]&&this.unregister(a[b],this[a[b]]);return this.active=!1,!0},callback:function(a,b){a&&this.callbacks[a]&&this.callbacks[a].apply(this.control,b)},register:function(a,b){this.map.events.registerPriority(a,this,b),this.map.events.registerPriority(a,this,this.setEvent)},unregister:function(a,b){this.map.events.unregister(a,this,b),this.map.events.unregister(a,this,this.setEvent)},setEvent:function(a){return this.evt=a,!0},destroy:function(){this.deactivate(),this.control=this.map=null},CLASS_NAME:"OpenLayers.Handler"}),OpenLayers.Handler.MOD_NONE=0,OpenLayers.Handler.MOD_SHIFT=1,OpenLayers.Handler.MOD_CTRL=2,OpenLayers.Handler.MOD_ALT=4,OpenLayers.Handler.Drag=OpenLayers.Class(OpenLayers.Handler,{started:!1,stopDown:!0,dragging:!1,touch:!1,last:null,start:null,lastMoveEvt:null,oldOnselectstart:null,interval:0,timeoutId:null,documentDrag:!1,documentEvents:null,initialize:function(){if(OpenLayers.Handler.prototype.initialize.apply(this,arguments),!0===this.documentDrag){var a=this;this._docMove=function(b){a.mousemove({xy:{x:b.clientX,y:b.clientY},element:document})},this._docUp=function(b){a.mouseup({xy:{x:b.clientX,y:b.clientY}})}}},dragstart:function(a){var b=!0;return this.dragging=!1,this.checkModifiers(a)&&(OpenLayers.Event.isLeftClick(a)||OpenLayers.Event.isSingleTouch(a))?(this.started=!0,this.last=this.start=a.xy,OpenLayers.Element.addClass(this.map.viewPortDiv,"olDragDown"),this.down(a),this.callback("down",[a.xy]),OpenLayers.Event.stop(a),this.oldOnselectstart||(this.oldOnselectstart=document.onselectstart?document.onselectstart:OpenLayers.Function.True),document.onselectstart=OpenLayers.Function.False,b=!this.stopDown):(this.started=!1,this.last=this.start=null),b},dragmove:function(a){return this.lastMoveEvt=a,!this.started||this.timeoutId||a.xy.x==this.last.x&&a.xy.y==this.last.y||(!0===this.documentDrag&&this.documentEvents&&(a.element===document?(this.adjustXY(a),this.setEvent(a)):this.removeDocumentEvents()),0<this.interval&&(this.timeoutId=setTimeout(OpenLayers.Function.bind(this.removeTimeout,this),this.interval)),this.dragging=!0,this.move(a),this.callback("move",[a.xy]),this.oldOnselectstart||(this.oldOnselectstart=document.onselectstart,document.onselectstart=OpenLayers.Function.False),this.last=a.xy),!0},dragend:function(a){if(this.started){!0===this.documentDrag&&this.documentEvents&&(this.adjustXY(a),this.removeDocumentEvents());var b=this.start!=this.last;this.dragging=this.started=!1,OpenLayers.Element.removeClass(this.map.viewPortDiv,"olDragDown"),this.up(a),this.callback("up",[a.xy]),b&&this.callback("done",[a.xy]),document.onselectstart=this.oldOnselectstart}return!0},down:function(){},move:function(){},up:function(){},out:function(){},mousedown:function(a){return this.dragstart(a)},touchstart:function(a){return this.touch||(this.touch=!0,this.map.events.un({mousedown:this.mousedown,mouseup:this.mouseup,mousemove:this.mousemove,click:this.click,scope:this})),this.dragstart(a)},mousemove:function(a){return this.dragmove(a)},touchmove:function(a){return this.dragmove(a)},removeTimeout:function(){this.timeoutId=null,this.dragging&&this.mousemove(this.lastMoveEvt)},mouseup:function(a){return this.dragend(a)},touchend:function(a){return a.xy=this.last,this.dragend(a)},mouseout:function(a){if(this.started&&OpenLayers.Util.mouseLeft(a,this.map.viewPortDiv))if(!0===this.documentDrag)this.addDocumentEvents();else{var b=this.start!=this.last;this.dragging=this.started=!1,OpenLayers.Element.removeClass(this.map.viewPortDiv,"olDragDown"),this.out(a),this.callback("out",[]),b&&this.callback("done",[a.xy]),document.onselectstart&&(document.onselectstart=this.oldOnselectstart)}return!0},click:function(){return this.start==this.last},activate:function(){var a=!1;return OpenLayers.Handler.prototype.activate.apply(this,arguments)&&(this.dragging=!1,a=!0),a},deactivate:function(){var a=!1;return OpenLayers.Handler.prototype.deactivate.apply(this,arguments)&&(this.dragging=this.started=this.touch=!1,this.last=this.start=null,a=!0,OpenLayers.Element.removeClass(this.map.viewPortDiv,"olDragDown")),a},adjustXY:function(a){var b=OpenLayers.Util.pagePosition(this.map.viewPortDiv);a.xy.x-=b[0],a.xy.y-=b[1]},addDocumentEvents:function(){OpenLayers.Element.addClass(document.body,"olDragDown"),this.documentEvents=!0,OpenLayers.Event.observe(document,"mousemove",this._docMove),OpenLayers.Event.observe(document,"mouseup",this._docUp)},removeDocumentEvents:function(){OpenLayers.Element.removeClass(document.body,"olDragDown"),this.documentEvents=!1,OpenLayers.Event.stopObserving(document,"mousemove",this._docMove),OpenLayers.Event.stopObserving(document,"mouseup",this._docUp)},CLASS_NAME:"OpenLayers.Handler.Drag"}),OpenLayers.Handler.Feature=OpenLayers.Class(OpenLayers.Handler,{EVENTMAP:{click:{"in":"click",out:"clickout"},mousemove:{"in":"over",out:"out"},dblclick:{"in":"dblclick",out:null},mousedown:{"in":null,out:null},mouseup:{"in":null,out:null},touchstart:{"in":"click",out:"clickout"}},feature:null,lastFeature:null,down:null,up:null,touch:!1,clickTolerance:4,geometryTypes:null,stopClick:!0,stopDown:!0,stopUp:!1,initialize:function(a,b,c,d){OpenLayers.Handler.prototype.initialize.apply(this,[a,c,d]),this.layer=b},touchstart:function(a){return this.touch||(this.touch=!0,this.map.events.un({mousedown:this.mousedown,mouseup:this.mouseup,mousemove:this.mousemove,click:this.click,dblclick:this.dblclick,scope:this})),OpenLayers.Event.isMultiTouch(a)?!0:this.mousedown(a)},touchmove:function(a){OpenLayers.Event.stop(a)},mousedown:function(a){return(OpenLayers.Event.isLeftClick(a)||OpenLayers.Event.isSingleTouch(a))&&(this.down=a.xy),this.handle(a)?!this.stopDown:!0},mouseup:function(a){return this.up=a.xy,this.handle(a)?!this.stopUp:!0},click:function(a){return this.handle(a)?!this.stopClick:!0},mousemove:function(a){return this.callbacks.over||this.callbacks.out?(this.handle(a),!0):!0},dblclick:function(a){return!this.handle(a)},geometryTypeMatches:function(a){return null==this.geometryTypes||-1<OpenLayers.Util.indexOf(this.geometryTypes,a.geometry.CLASS_NAME)},handle:function(a){this.feature&&!this.feature.layer&&(this.feature=null);var b=a.type,c=!1,d=!!this.feature,e="click"==b||"dblclick"==b||"touchstart"==b;return(this.feature=this.layer.getFeatureFromEvent(a))&&!this.feature.layer&&(this.feature=null),this.lastFeature&&!this.lastFeature.layer&&(this.lastFeature=null),this.feature?("touchstart"===b&&OpenLayers.Event.stop(a),a=this.feature!=this.lastFeature,this.geometryTypeMatches(this.feature)?(d&&a?(this.lastFeature&&this.triggerCallback(b,"out",[this.lastFeature]),this.triggerCallback(b,"in",[this.feature])):(!d||e)&&this.triggerCallback(b,"in",[this.feature]),this.lastFeature=this.feature,c=!0):(this.lastFeature&&(d&&a||e)&&this.triggerCallback(b,"out",[this.lastFeature]),this.feature=null)):this.lastFeature&&(d||e)&&this.triggerCallback(b,"out",[this.lastFeature]),c},triggerCallback:function(a,b,c){(b=this.EVENTMAP[a][b])&&("click"==a&&this.up&&this.down?Math.sqrt(Math.pow(this.up.x-this.down.x,2)+Math.pow(this.up.y-this.down.y,2))<=this.clickTolerance&&this.callback(b,c):this.callback(b,c))},activate:function(){var a=!1;return OpenLayers.Handler.prototype.activate.apply(this,arguments)&&(this.moveLayerToTop(),this.map.events.on({removelayer:this.handleMapEvents,changelayer:this.handleMapEvents,scope:this}),a=!0),a},deactivate:function(){var a=!1;return OpenLayers.Handler.prototype.deactivate.apply(this,arguments)&&(this.moveLayerBack(),this.up=this.down=this.lastFeature=this.feature=null,this.touch=!1,this.map.events.un({removelayer:this.handleMapEvents,changelayer:this.handleMapEvents,scope:this}),a=!0),a},handleMapEvents:function(a){("removelayer"==a.type||"order"==a.property)&&this.moveLayerToTop()},moveLayerToTop:function(){this.layer.setZIndex(Math.max(this.map.Z_INDEX_BASE.Feature-1,this.layer.getZIndex())+1)},moveLayerBack:function(){var a=this.layer.getZIndex()-1;a>=this.map.Z_INDEX_BASE.Feature?this.layer.setZIndex(a):this.map.setLayerZIndex(this.layer,this.map.getLayerIndex(this.layer))},CLASS_NAME:"OpenLayers.Handler.Feature"}),OpenLayers.Control.DragFeature=OpenLayers.Class(OpenLayers.Control,{geometryTypes:null,onStart:function(){},onDrag:function(){},onComplete:function(){},onEnter:function(){},onLeave:function(){},documentDrag:!1,layer:null,feature:null,dragCallbacks:{},featureCallbacks:{},lastPixel:null,initialize:function(a,b){OpenLayers.Control.prototype.initialize.apply(this,[b]),this.layer=a,this.handlers={drag:new OpenLayers.Handler.Drag(this,OpenLayers.Util.extend({down:this.downFeature,move:this.moveFeature,up:this.upFeature,out:this.cancel,done:this.doneDragging},this.dragCallbacks),{documentDrag:this.documentDrag}),feature:new OpenLayers.Handler.Feature(this,this.layer,OpenLayers.Util.extend({click:this.clickFeature,clickout:this.clickoutFeature,over:this.overFeature,out:this.outFeature},this.featureCallbacks),{geometryTypes:this.geometryTypes})}},clickFeature:function(a){this.handlers.feature.touch&&!this.over&&this.overFeature(a)&&(this.handlers.drag.dragstart(this.handlers.feature.evt),this.handlers.drag.stopDown=!1)},clickoutFeature:function(a){this.handlers.feature.touch&&this.over&&(this.outFeature(a),this.handlers.drag.stopDown=!0)},destroy:function(){this.layer=null,OpenLayers.Control.prototype.destroy.apply(this,[])},activate:function(){return this.handlers.feature.activate()&&OpenLayers.Control.prototype.activate.apply(this,arguments)},deactivate:function(){return this.handlers.drag.deactivate(),this.handlers.feature.deactivate(),this.feature=null,this.dragging=!1,this.lastPixel=null,OpenLayers.Element.removeClass(this.map.viewPortDiv,this.displayClass+"Over"),OpenLayers.Control.prototype.deactivate.apply(this,arguments)},overFeature:function(a){var b=!1;return this.handlers.drag.dragging?this.over=this.feature.id==a.id?!0:!1:(this.feature=a,this.handlers.drag.activate(),this.over=b=!0,OpenLayers.Element.addClass(this.map.viewPortDiv,this.displayClass+"Over"),this.onEnter(a)),b},downFeature:function(a){this.lastPixel=a,this.onStart(this.feature,a)},moveFeature:function(a){var b=this.map.getResolution();this.feature.geometry.move(b*(a.x-this.lastPixel.x),b*(this.lastPixel.y-a.y)),this.layer.drawFeature(this.feature),this.lastPixel=a,this.onDrag(this.feature,a)},upFeature:function(){this.over||this.handlers.drag.deactivate()},doneDragging:function(a){this.onComplete(this.feature,a)},outFeature:function(a){this.handlers.drag.dragging?this.feature.id==a.id&&(this.over=!1):(this.over=!1,this.handlers.drag.deactivate(),OpenLayers.Element.removeClass(this.map.viewPortDiv,this.displayClass+"Over"),this.onLeave(a),this.feature=null)},cancel:function(){this.handlers.drag.deactivate(),this.over=!1},setMap:function(a){this.handlers.drag.setMap(a),this.handlers.feature.setMap(a),OpenLayers.Control.prototype.setMap.apply(this,arguments)},CLASS_NAME:"OpenLayers.Control.DragFeature"}),OpenLayers.StyleMap=OpenLayers.Class({styles:null,extendDefault:!0,initialize:function(a,b){if(this.styles={"default":new OpenLayers.Style(OpenLayers.Feature.Vector.style["default"]),select:new OpenLayers.Style(OpenLayers.Feature.Vector.style.select),temporary:new OpenLayers.Style(OpenLayers.Feature.Vector.style.temporary),"delete":new OpenLayers.Style(OpenLayers.Feature.Vector.style["delete"])},a instanceof OpenLayers.Style)this.styles["default"]=a,this.styles.select=a,this.styles.temporary=a,this.styles["delete"]=a;else if("object"==typeof a)for(var c in a)if(a[c]instanceof OpenLayers.Style)this.styles[c]=a[c];else{if("object"!=typeof a[c]){this.styles["default"]=new OpenLayers.Style(a),this.styles.select=new OpenLayers.Style(a),this.styles.temporary=new OpenLayers.Style(a),this.styles["delete"]=new OpenLayers.Style(a);break}this.styles[c]=new OpenLayers.Style(a[c])}OpenLayers.Util.extend(this,b)},destroy:function(){for(var a in this.styles)this.styles[a].destroy();this.styles=null},createSymbolizer:function(a,b){a||(a=new OpenLayers.Feature.Vector),this.styles[b]||(b="default"),a.renderIntent=b;var c={};return this.extendDefault&&"default"!=b&&(c=this.styles["default"].createSymbolizer(a)),OpenLayers.Util.extend(c,this.styles[b].createSymbolizer(a))},addUniqueValueRules:function(a,b,c,d){var e,f=[];for(e in c)f.push(new OpenLayers.Rule({symbolizer:c[e],context:d,filter:new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO,property:b,value:e})}));this.styles[a].addRules(f)},CLASS_NAME:"OpenLayers.StyleMap"}),OpenLayers.Layer.Vector=OpenLayers.Class(OpenLayers.Layer,{isBaseLayer:!1,isFixed:!1,features:null,filter:null,selectedFeatures:null,unrenderedFeatures:null,reportError:!0,style:null,styleMap:null,strategies:null,protocol:null,renderers:["SVG","VML","Canvas"],renderer:null,rendererOptions:null,geometryType:null,drawn:!1,ratio:1,initialize:function(){if(OpenLayers.Layer.prototype.initialize.apply(this,arguments),(!this.renderer||!this.renderer.supported())&&this.assignRenderer(),this.renderer&&this.renderer.supported()||(this.renderer=null,this.displayError()),this.styleMap||(this.styleMap=new OpenLayers.StyleMap),this.features=[],this.selectedFeatures=[],this.unrenderedFeatures={},this.strategies)for(var a=0,b=this.strategies.length;b>a;a++)this.strategies[a].setLayer(this)},destroy:function(){if(this.strategies){var a,b,c;for(b=0,c=this.strategies.length;c>b;b++)a=this.strategies[b],a.autoDestroy&&a.destroy();this.strategies=null}this.protocol&&(this.protocol.autoDestroy&&this.protocol.destroy(),this.protocol=null),this.destroyFeatures(),this.unrenderedFeatures=this.selectedFeatures=this.features=null,this.renderer&&this.renderer.destroy(),this.drawn=this.geometryType=this.renderer=null,OpenLayers.Layer.prototype.destroy.apply(this,arguments)},clone:function(a){null==a&&(a=new OpenLayers.Layer.Vector(this.name,this.getOptions()));for(var a=OpenLayers.Layer.prototype.clone.apply(this,[a]),b=this.features,c=b.length,d=Array(c),e=0;c>e;++e)d[e]=b[e].clone();return a.features=d,a},refresh:function(a){this.calculateInRange()&&this.visibility&&this.events.triggerEvent("refresh",a)},assignRenderer:function(){for(var a=0,b=this.renderers.length;b>a;a++){var c=this.renderers[a];if((c="function"==typeof c?c:OpenLayers.Renderer[c])&&c.prototype.supported()){this.renderer=new c(this.div,this.rendererOptions);break}}},displayError:function(){this.reportError&&OpenLayers.Console.userError(OpenLayers.i18n("browserNotSupported",{renderers:this.renderers.join("\n")}))},setMap:function(){if(OpenLayers.Layer.prototype.setMap.apply(this,arguments),this.renderer){this.renderer.map=this.map;var a=this.map.getSize();a.w*=this.ratio,a.h*=this.ratio,this.renderer.setSize(a)}else this.map.removeLayer(this)},afterAdd:function(){if(this.strategies){var a,b,c;for(b=0,c=this.strategies.length;c>b;b++)a=this.strategies[b],a.autoActivate&&a.activate()}},removeMap:function(){if(this.drawn=!1,this.strategies){var a,b,c;for(b=0,c=this.strategies.length;c>b;b++)a=this.strategies[b],a.autoActivate&&a.deactivate()}},onMapResize:function(){OpenLayers.Layer.prototype.onMapResize.apply(this,arguments);var a=this.map.getSize();a.w*=this.ratio,a.h*=this.ratio,this.renderer.setSize(a)},moveTo:function(a,b,c){OpenLayers.Layer.prototype.moveTo.apply(this,arguments);var d=!0;if(!c){this.renderer.root.style.visibility="hidden";var d=this.map.getSize(),e=d.w,d=d.h,e=e/2*this.ratio-e/2,d=d/2*this.ratio-d/2,e=e+parseInt(this.map.layerContainerDiv.style.left,10),e=-Math.round(e),d=d+parseInt(this.map.layerContainerDiv.style.top,10),d=-Math.round(d);if(this.div.style.left=e+"px",this.div.style.top=d+"px",d=this.renderer.setExtent(this.map.getExtent().scale(this.ratio),b),this.renderer.root.style.visibility="visible",!0===OpenLayers.IS_GECKO&&(this.div.scrollLeft=this.div.scrollLeft),!b&&d)for(var f in this.unrenderedFeatures)e=this.unrenderedFeatures[f],this.drawFeature(e)}if(!this.drawn||b||!d)for(this.drawn=!0,f=0,d=this.features.length;d>f;f++)this.renderer.locked=f!==d-1,e=this.features[f],this.drawFeature(e)},display:function(){OpenLayers.Layer.prototype.display.apply(this,arguments);var a=this.div.style.display;a!=this.renderer.root.style.display&&(this.renderer.root.style.display=a)},addFeatures:function(a,b){OpenLayers.Util.isArray(a)||(a=[a]);
var c=!b||!b.silent;if(c){var d={features:a};if(!1===this.events.triggerEvent("beforefeaturesadded",d))return;a=d.features}for(var d=[],e=0,f=a.length;f>e;e++){this.renderer.locked=e!=a.length-1?!0:!1;var g=a[e];if(this.geometryType&&!(g.geometry instanceof this.geometryType))throw new TypeError("addFeatures: component should be an "+this.geometryType.prototype.CLASS_NAME);if(g.layer=this,!g.style&&this.style&&(g.style=OpenLayers.Util.extend({},this.style)),c){if(!1===this.events.triggerEvent("beforefeatureadded",{feature:g}))continue;this.preFeatureInsert(g)}d.push(g),this.features.push(g),this.drawFeature(g),c&&(this.events.triggerEvent("featureadded",{feature:g}),this.onFeatureInsert(g))}c&&this.events.triggerEvent("featuresadded",{features:d})},removeFeatures:function(a,b){if(a&&0!==a.length){if(a===this.features)return this.removeAllFeatures(b);OpenLayers.Util.isArray(a)||(a=[a]),a===this.selectedFeatures&&(a=a.slice());var c=!b||!b.silent;c&&this.events.triggerEvent("beforefeaturesremoved",{features:a});for(var d=a.length-1;d>=0;d--){this.renderer.locked=0!=d&&a[d-1].geometry?!0:!1;var e=a[d];delete this.unrenderedFeatures[e.id],c&&this.events.triggerEvent("beforefeatureremoved",{feature:e}),this.features=OpenLayers.Util.removeItem(this.features,e),e.layer=null,e.geometry&&this.renderer.eraseFeatures(e),-1!=OpenLayers.Util.indexOf(this.selectedFeatures,e)&&OpenLayers.Util.removeItem(this.selectedFeatures,e),c&&this.events.triggerEvent("featureremoved",{feature:e})}c&&this.events.triggerEvent("featuresremoved",{features:a})}},removeAllFeatures:function(a){var a=!a||!a.silent,b=this.features;a&&this.events.triggerEvent("beforefeaturesremoved",{features:b});for(var c,d=b.length-1;d>=0;d--)c=b[d],a&&this.events.triggerEvent("beforefeatureremoved",{feature:c}),c.layer=null,a&&this.events.triggerEvent("featureremoved",{feature:c});this.renderer.clear(),this.features=[],this.unrenderedFeatures={},this.selectedFeatures=[],a&&this.events.triggerEvent("featuresremoved",{features:b})},destroyFeatures:function(a,b){if(void 0==a&&(a=this.features),a){this.removeFeatures(a,b);for(var c=a.length-1;c>=0;c--)a[c].destroy()}},drawFeature:function(a,b){if(this.drawn){if("object"!=typeof b){!b&&a.state===OpenLayers.State.DELETE&&(b="delete");var c=b||a.renderIntent;(b=a.style||this.style)||(b=this.styleMap.createSymbolizer(a,c))}c=this.renderer.drawFeature(a,b),!1===c||null===c?this.unrenderedFeatures[a.id]=a:delete this.unrenderedFeatures[a.id]}},eraseFeatures:function(a){this.renderer.eraseFeatures(a)},getFeatureFromEvent:function(a){if(!this.renderer)throw Error("getFeatureFromEvent called on layer with no renderer. This usually means you destroyed a layer, but not some handler which is associated with it.");var b=null;return(a=this.renderer.getFeatureIdFromEvent(a))&&(b="string"==typeof a?this.getFeatureById(a):a),b},getFeatureBy:function(a,b){for(var c=null,d=0,e=this.features.length;e>d;++d)if(this.features[d][a]==b){c=this.features[d];break}return c},getFeatureById:function(a){return this.getFeatureBy("id",a)},getFeatureByFid:function(a){return this.getFeatureBy("fid",a)},getFeaturesByAttribute:function(a,b){var c,d,e=this.features.length,f=[];for(c=0;e>c;c++)(d=this.features[c])&&d.attributes&&d.attributes[a]===b&&f.push(d);return f},onFeatureInsert:function(){},preFeatureInsert:function(){},getDataExtent:function(){var a=null,b=this.features;if(b&&0<b.length)for(var c=null,d=0,e=b.length;e>d;d++)(c=b[d].geometry)&&(null===a&&(a=new OpenLayers.Bounds),a.extend(c.getBounds()));return a},CLASS_NAME:"OpenLayers.Layer.Vector"}),OpenLayers.Layer.Vector.RootContainer=OpenLayers.Class(OpenLayers.Layer.Vector,{displayInLayerSwitcher:!1,layers:null,display:function(){},getFeatureFromEvent:function(a){for(var b,c=this.layers,d=0;d<c.length;d++)if(b=c[d].getFeatureFromEvent(a))return b},setMap:function(a){OpenLayers.Layer.Vector.prototype.setMap.apply(this,arguments),this.collectRoots(),a.events.register("changelayer",this,this.handleChangeLayer)},removeMap:function(a){a.events.unregister("changelayer",this,this.handleChangeLayer),this.resetRoots(),OpenLayers.Layer.Vector.prototype.removeMap.apply(this,arguments)},collectRoots:function(){for(var a,b=0;b<this.map.layers.length;++b)a=this.map.layers[b],-1!=OpenLayers.Util.indexOf(this.layers,a)&&a.renderer.moveRoot(this.renderer)},resetRoots:function(){for(var a,b=0;b<this.layers.length;++b)a=this.layers[b],this.renderer&&a.renderer.getRenderLayerId()==this.id&&this.renderer.moveRoot(a.renderer)},handleChangeLayer:function(a){var b=a.layer;"order"==a.property&&-1!=OpenLayers.Util.indexOf(this.layers,b)&&(this.resetRoots(),this.collectRoots())},CLASS_NAME:"OpenLayers.Layer.Vector.RootContainer"}),OpenLayers.Control.SelectFeature=OpenLayers.Class(OpenLayers.Control,{multipleKey:null,toggleKey:null,multiple:!1,clickout:!0,toggle:!1,hover:!1,highlightOnly:!1,box:!1,onBeforeSelect:function(){},onSelect:function(){},onUnselect:function(){},scope:null,geometryTypes:null,layer:null,layers:null,callbacks:null,selectStyle:null,renderIntent:"select",handlers:null,initialize:function(a,b){OpenLayers.Control.prototype.initialize.apply(this,[b]),null===this.scope&&(this.scope=this),this.initLayer(a);var c={click:this.clickFeature,clickout:this.clickoutFeature};this.hover&&(c.over=this.overFeature,c.out=this.outFeature),this.callbacks=OpenLayers.Util.extend(c,this.callbacks),this.handlers={feature:new OpenLayers.Handler.Feature(this,this.layer,this.callbacks,{geometryTypes:this.geometryTypes})},this.box&&(this.handlers.box=new OpenLayers.Handler.Box(this,{done:this.selectBox},{boxDivClassName:"olHandlerBoxSelectFeature"}))},initLayer:function(a){OpenLayers.Util.isArray(a)?(this.layers=a,this.layer=new OpenLayers.Layer.Vector.RootContainer(this.id+"_container",{layers:a})):this.layer=a},destroy:function(){this.active&&this.layers&&this.map.removeLayer(this.layer),OpenLayers.Control.prototype.destroy.apply(this,arguments),this.layers&&this.layer.destroy()},activate:function(){return this.active||(this.layers&&this.map.addLayer(this.layer),this.handlers.feature.activate(),this.box&&this.handlers.box&&this.handlers.box.activate()),OpenLayers.Control.prototype.activate.apply(this,arguments)},deactivate:function(){return this.active&&(this.handlers.feature.deactivate(),this.handlers.box&&this.handlers.box.deactivate(),this.layers&&this.map.removeLayer(this.layer)),OpenLayers.Control.prototype.deactivate.apply(this,arguments)},unselectAll:function(a){for(var b,c,d=this.layers||[this.layer],e=0;e<d.length;++e){b=d[e];for(var f=b.selectedFeatures.length-1;f>=0;--f)c=b.selectedFeatures[f],(!a||a.except!=c)&&this.unselect(c)}},clickFeature:function(a){this.hover||(-1<OpenLayers.Util.indexOf(a.layer.selectedFeatures,a)?this.toggleSelect()?this.unselect(a):this.multipleSelect()||this.unselectAll({except:a}):(this.multipleSelect()||this.unselectAll({except:a}),this.select(a)))},multipleSelect:function(){return this.multiple||this.handlers.feature.evt&&this.handlers.feature.evt[this.multipleKey]},toggleSelect:function(){return this.toggle||this.handlers.feature.evt&&this.handlers.feature.evt[this.toggleKey]},clickoutFeature:function(){!this.hover&&this.clickout&&this.unselectAll()},overFeature:function(a){var b=a.layer;this.hover&&(this.highlightOnly?this.highlight(a):-1==OpenLayers.Util.indexOf(b.selectedFeatures,a)&&this.select(a))},outFeature:function(a){if(this.hover)if(this.highlightOnly){if(a._lastHighlighter==this.id)if(a._prevHighlighter&&a._prevHighlighter!=this.id){delete a._lastHighlighter;var b=this.map.getControl(a._prevHighlighter);b&&b.highlight(a)}else this.unhighlight(a)}else this.unselect(a)},highlight:function(a){var b=a.layer;!1!==this.events.triggerEvent("beforefeaturehighlighted",{feature:a})&&(a._prevHighlighter=a._lastHighlighter,a._lastHighlighter=this.id,b.drawFeature(a,this.selectStyle||this.renderIntent),this.events.triggerEvent("featurehighlighted",{feature:a}))},unhighlight:function(a){var b=a.layer;void 0==a._prevHighlighter?delete a._lastHighlighter:(a._prevHighlighter!=this.id&&(a._lastHighlighter=a._prevHighlighter),delete a._prevHighlighter),b.drawFeature(a,a.style||a.layer.style||"default"),this.events.triggerEvent("featureunhighlighted",{feature:a})},select:function(a){var b=this.onBeforeSelect.call(this.scope,a),c=a.layer;!1!==b&&(b=c.events.triggerEvent("beforefeatureselected",{feature:a}),!1!==b&&(c.selectedFeatures.push(a),this.highlight(a),this.handlers.feature.lastFeature||(this.handlers.feature.lastFeature=c.selectedFeatures[0]),c.events.triggerEvent("featureselected",{feature:a}),this.onSelect.call(this.scope,a)))},unselect:function(a){var b=a.layer;this.unhighlight(a),OpenLayers.Util.removeItem(b.selectedFeatures,a),b.events.triggerEvent("featureunselected",{feature:a}),this.onUnselect.call(this.scope,a)},selectBox:function(a){if(a instanceof OpenLayers.Bounds){var b=this.map.getLonLatFromPixel({x:a.left,y:a.bottom}),a=this.map.getLonLatFromPixel({x:a.right,y:a.top}),b=new OpenLayers.Bounds(b.lon,b.lat,a.lon,a.lat);this.multipleSelect()||this.unselectAll(),a=this.multiple,this.multiple=!0;var c=this.layers||[this.layer];this.events.triggerEvent("boxselectionstart",{layers:c});for(var d,e=0;e<c.length;++e){d=c[e];for(var f=0,g=d.features.length;g>f;++f){var h=d.features[f];h.getVisibility()&&(null==this.geometryTypes||-1<OpenLayers.Util.indexOf(this.geometryTypes,h.geometry.CLASS_NAME))&&b.toGeometry().intersects(h.geometry)&&-1==OpenLayers.Util.indexOf(d.selectedFeatures,h)&&this.select(h)}}this.multiple=a,this.events.triggerEvent("boxselectionend",{layers:c})}},setMap:function(a){this.handlers.feature.setMap(a),this.box&&this.handlers.box.setMap(a),OpenLayers.Control.prototype.setMap.apply(this,arguments)},setLayer:function(a){var b=this.active;this.unselectAll(),this.deactivate(),this.layers&&(this.layer.destroy(),this.layers=null),this.initLayer(a),this.handlers.feature.layer=this.layer,b&&this.activate()},CLASS_NAME:"OpenLayers.Control.SelectFeature"}),OpenLayers.Handler.Keyboard=OpenLayers.Class(OpenLayers.Handler,{KEY_EVENTS:["keydown","keyup"],eventListener:null,observeElement:null,initialize:function(){OpenLayers.Handler.prototype.initialize.apply(this,arguments),this.eventListener=OpenLayers.Function.bindAsEventListener(this.handleKeyEvent,this)},destroy:function(){this.deactivate(),this.eventListener=null,OpenLayers.Handler.prototype.destroy.apply(this,arguments)},activate:function(){if(OpenLayers.Handler.prototype.activate.apply(this,arguments)){this.observeElement=this.observeElement||document;for(var a=0,b=this.KEY_EVENTS.length;b>a;a++)OpenLayers.Event.observe(this.observeElement,this.KEY_EVENTS[a],this.eventListener);return!0}return!1},deactivate:function(){var a=!1;if(OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){for(var a=0,b=this.KEY_EVENTS.length;b>a;a++)OpenLayers.Event.stopObserving(this.observeElement,this.KEY_EVENTS[a],this.eventListener);a=!0}return a},handleKeyEvent:function(a){this.checkModifiers(a)&&this.callback(a.type,[a])},CLASS_NAME:"OpenLayers.Handler.Keyboard"}),OpenLayers.Control.ModifyFeature=OpenLayers.Class(OpenLayers.Control,{geometryTypes:null,clickout:!0,toggle:!0,standalone:!1,layer:null,feature:null,vertices:null,virtualVertices:null,selectControl:null,dragControl:null,handlers:null,deleteCodes:null,virtualStyle:null,vertexRenderIntent:null,mode:null,createVertices:!0,modified:!1,radiusHandle:null,dragHandle:null,onModificationStart:function(){},onModification:function(){},onModificationEnd:function(){},initialize:function(a,b){b=b||{},this.layer=a,this.vertices=[],this.virtualVertices=[],this.virtualStyle=OpenLayers.Util.extend({},this.layer.style||this.layer.styleMap.createSymbolizer(null,b.vertexRenderIntent)),this.virtualStyle.fillOpacity=.3,this.virtualStyle.strokeOpacity=.3,this.deleteCodes=[46,68],this.mode=OpenLayers.Control.ModifyFeature.RESHAPE,OpenLayers.Control.prototype.initialize.apply(this,[b]),OpenLayers.Util.isArray(this.deleteCodes)||(this.deleteCodes=[this.deleteCodes]);var c=this,d={geometryTypes:this.geometryTypes,clickout:this.clickout,toggle:this.toggle,onBeforeSelect:this.beforeSelectFeature,onSelect:this.selectFeature,onUnselect:this.unselectFeature,scope:this};!1===this.standalone&&(this.selectControl=new OpenLayers.Control.SelectFeature(a,d)),this.dragControl=new OpenLayers.Control.DragFeature(a,{geometryTypes:["OpenLayers.Geometry.Point"],onStart:function(a,b){c.dragStart.apply(c,[a,b])},onDrag:function(a,b){c.dragVertex.apply(c,[a,b])},onComplete:function(a){c.dragComplete.apply(c,[a])},featureCallbacks:{over:function(a){(c.standalone!==!0||a._sketch||c.feature===a)&&c.dragControl.overFeature.apply(c.dragControl,[a])}}}),this.handlers={keyboard:new OpenLayers.Handler.Keyboard(this,{keydown:this.handleKeypress})}},destroy:function(){this.layer=null,this.standalone||this.selectControl.destroy(),this.dragControl.destroy(),OpenLayers.Control.prototype.destroy.apply(this,[])},activate:function(){return(this.standalone||this.selectControl.activate())&&this.handlers.keyboard.activate()&&OpenLayers.Control.prototype.activate.apply(this,arguments)},deactivate:function(){var a=!1;if(OpenLayers.Control.prototype.deactivate.apply(this,arguments)){this.layer.removeFeatures(this.vertices,{silent:!0}),this.layer.removeFeatures(this.virtualVertices,{silent:!0}),this.vertices=[],this.dragControl.deactivate();var b=(a=this.feature)&&a.geometry&&a.layer;!1===this.standalone?(b&&this.selectControl.unselect.apply(this.selectControl,[a]),this.selectControl.deactivate()):b&&this.unselectFeature(a),this.handlers.keyboard.deactivate(),a=!0}return a},beforeSelectFeature:function(a){return this.layer.events.triggerEvent("beforefeaturemodified",{feature:a})},selectFeature:function(a){this.standalone&&!1===this.beforeSelectFeature(a)||(this.feature=a,this.modified=!1,this.resetVertices(),this.dragControl.activate(),this.onModificationStart(this.feature));var b=a.modified;!a.geometry||b&&b.geometry||(this._originalGeometry=a.geometry.clone())},unselectFeature:function(a){this.layer.removeFeatures(this.vertices,{silent:!0}),this.vertices=[],this.layer.destroyFeatures(this.virtualVertices,{silent:!0}),this.virtualVertices=[],this.dragHandle&&(this.layer.destroyFeatures([this.dragHandle],{silent:!0}),delete this.dragHandle),this.radiusHandle&&(this.layer.destroyFeatures([this.radiusHandle],{silent:!0}),delete this.radiusHandle),this.feature=null,this.dragControl.deactivate(),this.onModificationEnd(a),this.layer.events.triggerEvent("afterfeaturemodified",{feature:a,modified:this.modified}),this.modified=!1},dragStart:function(a,b){a==this.feature||a.geometry.parent||a==this.dragHandle||a==this.radiusHandle||(!1===this.standalone&&this.feature&&this.selectControl.clickFeature.apply(this.selectControl,[this.feature]),null!=this.geometryTypes&&-1==OpenLayers.Util.indexOf(this.geometryTypes,a.geometry.CLASS_NAME))||(this.standalone||this.selectControl.clickFeature.apply(this.selectControl,[a]),this.dragControl.overFeature.apply(this.dragControl,[a]),this.dragControl.lastPixel=b,this.dragControl.handlers.drag.started=!0,this.dragControl.handlers.drag.start=b,this.dragControl.handlers.drag.last=b)},dragVertex:function(a,b){this.modified=!0,"OpenLayers.Geometry.Point"==this.feature.geometry.CLASS_NAME?(this.feature!=a&&(this.feature=a),this.layer.events.triggerEvent("vertexmodified",{vertex:a.geometry,feature:this.feature,pixel:b})):(a._index?(a.geometry.parent.addComponent(a.geometry,a._index),delete a._index,OpenLayers.Util.removeItem(this.virtualVertices,a),this.vertices.push(a)):a==this.dragHandle?(this.layer.removeFeatures(this.vertices,{silent:!0}),this.vertices=[],this.radiusHandle&&(this.layer.destroyFeatures([this.radiusHandle],{silent:!0}),this.radiusHandle=null)):a!==this.radiusHandle&&this.layer.events.triggerEvent("vertexmodified",{vertex:a.geometry,feature:this.feature,pixel:b}),0<this.virtualVertices.length&&(this.layer.destroyFeatures(this.virtualVertices,{silent:!0}),this.virtualVertices=[]),this.layer.drawFeature(this.feature,this.standalone?void 0:this.selectControl.renderIntent)),this.layer.drawFeature(a)},dragComplete:function(){this.resetVertices(),this.setFeatureState(),this.onModification(this.feature),this.layer.events.triggerEvent("featuremodified",{feature:this.feature})},setFeatureState:function(){if(this.feature.state!=OpenLayers.State.INSERT&&this.feature.state!=OpenLayers.State.DELETE&&(this.feature.state=OpenLayers.State.UPDATE,this.modified&&this._originalGeometry)){var a=this.feature;a.modified=OpenLayers.Util.extend(a.modified,{geometry:this._originalGeometry}),delete this._originalGeometry}},resetVertices:function(){this.dragControl.feature&&this.dragControl.outFeature(this.dragControl.feature),0<this.vertices.length&&(this.layer.removeFeatures(this.vertices,{silent:!0}),this.vertices=[]),0<this.virtualVertices.length&&(this.layer.removeFeatures(this.virtualVertices,{silent:!0}),this.virtualVertices=[]),this.dragHandle&&(this.layer.destroyFeatures([this.dragHandle],{silent:!0}),this.dragHandle=null),this.radiusHandle&&(this.layer.destroyFeatures([this.radiusHandle],{silent:!0}),this.radiusHandle=null),this.feature&&"OpenLayers.Geometry.Point"!=this.feature.geometry.CLASS_NAME&&(this.mode&OpenLayers.Control.ModifyFeature.DRAG&&this.collectDragHandle(),this.mode&(OpenLayers.Control.ModifyFeature.ROTATE|OpenLayers.Control.ModifyFeature.RESIZE)&&this.collectRadiusHandle(),this.mode&OpenLayers.Control.ModifyFeature.RESHAPE&&(this.mode&OpenLayers.Control.ModifyFeature.RESIZE||this.collectVertices()))},handleKeypress:function(a){var b=a.keyCode;this.feature&&-1!=OpenLayers.Util.indexOf(this.deleteCodes,b)&&(b=this.dragControl.feature)&&-1!=OpenLayers.Util.indexOf(this.vertices,b)&&!this.dragControl.handlers.drag.dragging&&b.geometry.parent&&(b.geometry.parent.removeComponent(b.geometry),this.layer.events.triggerEvent("vertexremoved",{vertex:b.geometry,feature:this.feature,pixel:a.xy}),this.layer.drawFeature(this.feature,this.standalone?void 0:this.selectControl.renderIntent),this.modified=!0,this.resetVertices(),this.setFeatureState(),this.onModification(this.feature),this.layer.events.triggerEvent("featuremodified",{feature:this.feature}))},collectVertices:function(){function a(c){var d,e,f;if("OpenLayers.Geometry.Point"==c.CLASS_NAME)e=new OpenLayers.Feature.Vector(c),e._sketch=!0,e.renderIntent=b.vertexRenderIntent,b.vertices.push(e);else{for(f=c.components.length,"OpenLayers.Geometry.LinearRing"==c.CLASS_NAME&&(f-=1),d=0;f>d;++d)e=c.components[d],"OpenLayers.Geometry.Point"==e.CLASS_NAME?(e=new OpenLayers.Feature.Vector(e),e._sketch=!0,e.renderIntent=b.vertexRenderIntent,b.vertices.push(e)):a(e);if(b.createVertices&&"OpenLayers.Geometry.MultiPoint"!=c.CLASS_NAME)for(d=0,f=c.components.length;f-1>d;++d){e=c.components[d];var g=c.components[d+1];"OpenLayers.Geometry.Point"==e.CLASS_NAME&&"OpenLayers.Geometry.Point"==g.CLASS_NAME&&(e=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point((e.x+g.x)/2,(e.y+g.y)/2),null,b.virtualStyle),e.geometry.parent=c,e._index=d+1,e._sketch=!0,b.virtualVertices.push(e))}}}this.vertices=[],this.virtualVertices=[];var b=this;a.call(this,this.feature.geometry),this.layer.addFeatures(this.virtualVertices,{silent:!0}),this.layer.addFeatures(this.vertices,{silent:!0})},collectDragHandle:function(){var a=this.feature.geometry,b=a.getBounds().getCenterLonLat(),b=new OpenLayers.Geometry.Point(b.lon,b.lat),c=new OpenLayers.Feature.Vector(b);b.move=function(b,c){OpenLayers.Geometry.Point.prototype.move.call(this,b,c),a.move(b,c)},c._sketch=!0,this.dragHandle=c,this.dragHandle.renderIntent=this.vertexRenderIntent,this.layer.addFeatures([this.dragHandle],{silent:!0})},collectRadiusHandle:function(){var a=this.feature.geometry,b=a.getBounds(),c=b.getCenterLonLat(),d=new OpenLayers.Geometry.Point(c.lon,c.lat),b=new OpenLayers.Geometry.Point(b.right,b.bottom),c=new OpenLayers.Feature.Vector(b),e=this.mode&OpenLayers.Control.ModifyFeature.RESIZE,f=this.mode&OpenLayers.Control.ModifyFeature.RESHAPE,g=this.mode&OpenLayers.Control.ModifyFeature.ROTATE;b.move=function(b,c){OpenLayers.Geometry.Point.prototype.move.call(this,b,c);var h=this.x-d.x,i=this.y-d.y,j=h-b,k=i-c;if(g){var l=Math.atan2(k,j),l=Math.atan2(i,h)-l,l=l*(180/Math.PI);a.rotate(l,d)}if(e){var m;f?(i/=k,m=h/j/i):(j=Math.sqrt(j*j+k*k),i=Math.sqrt(h*h+i*i)/j),a.resize(i,d,m)}},c._sketch=!0,this.radiusHandle=c,this.radiusHandle.renderIntent=this.vertexRenderIntent,this.layer.addFeatures([this.radiusHandle],{silent:!0})},setMap:function(a){this.standalone||this.selectControl.setMap(a),this.dragControl.setMap(a),OpenLayers.Control.prototype.setMap.apply(this,arguments)},CLASS_NAME:"OpenLayers.Control.ModifyFeature"}),OpenLayers.Control.ModifyFeature.RESHAPE=1,OpenLayers.Control.ModifyFeature.RESIZE=2,OpenLayers.Control.ModifyFeature.ROTATE=4,OpenLayers.Control.ModifyFeature.DRAG=8,OpenLayers.Layer.Bing=OpenLayers.Class(OpenLayers.Layer.XYZ,{key:null,serverResolutions:[156543.03390625,78271.516953125,39135.7584765625,19567.87923828125,9783.939619140625,4891.9698095703125,2445.9849047851562,1222.9924523925781,611.4962261962891,305.74811309814453,152.87405654907226,76.43702827453613,38.218514137268066,19.109257068634033,9.554628534317017,4.777314267158508,2.388657133579254,1.194328566789627,.5971642833948135,.29858214169740677,.14929107084870338,.07464553542435169,.03732276771218,.01866138385609],attributionTemplate:'<span class="olBingAttribution ${type}"><div><a target="_blank" href="http://www.bing.com/maps/"><img src="${logo}" /></a></div>${copyrights}<a style="white-space: nowrap" target="_blank" href="http://www.microsoft.com/maps/product/terms.html">Terms of Use</a></span>',metadata:null,protocolRegex:/^http:/i,type:"Road",culture:"en-US",metadataParams:null,tileOptions:null,protocol:~window.location.href.indexOf("http")?"":"http:",initialize:function(a){a=OpenLayers.Util.applyDefaults({sphericalMercator:!0},a);var b=a.name||"Bing "+(a.type||this.type),c=[b,null,a];OpenLayers.Layer.XYZ.prototype.initialize.apply(this,c),this.tileOptions=OpenLayers.Util.extend({crossOriginKeyword:"anonymous"},this.options.tileOptions),this.loadMetadata()},loadMetadata:function(){this._callbackId="_callback_"+this.id.replace(/\./g,"_"),window[this._callbackId]=OpenLayers.Function.bind(OpenLayers.Layer.Bing.processMetadata,this);var a=OpenLayers.Util.applyDefaults({key:this.key,jsonp:this._callbackId,include:"ImageryProviders"},this.metadataParams),b=this.protocol+"//dev.virtualearth.net/REST/v1/Imagery/Metadata/"+this.type+"?"+OpenLayers.Util.getParameterString(a),c=document.createElement("script");c.type="text/javascript",c.src=b,c.id=this._callbackId,document.getElementsByTagName("head")[0].appendChild(c)},initLayer:function(){var a=this.metadata.resourceSets[0].resources[0],b=a.imageUrl.replace("{quadkey}","${quadkey}");b=b.replace("{culture}",this.culture),b=b.replace(this.protocolRegex,this.protocol),this.url=[];for(var c=0;c<a.imageUrlSubdomains.length;++c)this.url.push(b.replace("{subdomain}",a.imageUrlSubdomains[c]));this.addOptions({maxResolution:Math.min(this.serverResolutions[a.zoomMin],this.maxResolution||Number.POSITIVE_INFINITY),numZoomLevels:Math.min(a.zoomMax+1-a.zoomMin,this.numZoomLevels)},!0),this.isBaseLayer||this.redraw(),this.updateAttribution()},getURL:function(a){if(this.url){for(var b=this.getXYZ(a),c=b.x,d=b.y,e=b.z,f=[],g=e;g>0;--g){var h="0",i=1<<g-1;0!=(c&i)&&h++,0!=(d&i)&&(h++,h++),f.push(h)}var j=f.join(""),k=this.selectUrl(""+c+d+e,this.url);return OpenLayers.String.format(k,{quadkey:j})}},updateAttribution:function(){var a=this.metadata;if(a.resourceSets&&this.map&&this.map.center){var b,c,d,e,f,g,h,i=a.resourceSets[0].resources[0],j=this.map.getExtent().transform(this.map.getProjectionObject(),new OpenLayers.Projection("EPSG:4326")),k=i.imageryProviders||[],l=OpenLayers.Util.indexOf(this.serverResolutions,this.getServerResolution()),m="";for(c=0,d=k.length;d>c;++c)for(b=k[c],e=0,f=b.coverageAreas.length;f>e;++e)h=b.coverageAreas[e],g=OpenLayers.Bounds.fromArray(h.bbox,!0),j.intersectsBounds(g)&&l<=h.zoomMax&&l>=h.zoomMin&&(m+=b.attribution+" ");var n=a.brandLogoUri.replace(this.protocolRegex,this.protocol);this.attribution=OpenLayers.String.format(this.attributionTemplate,{type:this.type.toLowerCase(),logo:n,copyrights:m}),this.map&&this.map.events.triggerEvent("changelayer",{layer:this,property:"attribution"})}},setMap:function(){OpenLayers.Layer.XYZ.prototype.setMap.apply(this,arguments),this.map.events.register("moveend",this,this.updateAttribution)},clone:function(a){return null==a&&(a=new OpenLayers.Layer.Bing(this.options)),a=OpenLayers.Layer.XYZ.prototype.clone.apply(this,[a])},destroy:function(){this.map&&this.map.events.unregister("moveend",this,this.updateAttribution),OpenLayers.Layer.XYZ.prototype.destroy.apply(this,arguments)},CLASS_NAME:"OpenLayers.Layer.Bing"}),OpenLayers.Layer.Bing.processMetadata=function(a){this.metadata=a,this.initLayer();var b=document.getElementById(this._callbackId);b.parentNode.removeChild(b),window[this._callbackId]=void 0,delete this._callbackId},OpenLayers.Layer.PointGrid=OpenLayers.Class(OpenLayers.Layer.Vector,{dx:null,dy:null,ratio:1.5,maxFeatures:250,rotation:0,origin:null,gridBounds:null,initialize:function(a){a=a||{},OpenLayers.Layer.Vector.prototype.initialize.apply(this,[a.name,a])},setMap:function(a){OpenLayers.Layer.Vector.prototype.setMap.apply(this,arguments),a.events.register("moveend",this,this.onMoveEnd)},removeMap:function(a){a.events.unregister("moveend",this,this.onMoveEnd),OpenLayers.Layer.Vector.prototype.removeMap.apply(this,arguments)},setRatio:function(a){this.ratio=a,this.updateGrid(!0)},setMaxFeatures:function(a){this.maxFeatures=a,this.updateGrid(!0)},setSpacing:function(a,b){this.dx=a,this.dy=b||a,this.updateGrid(!0)},setOrigin:function(a){this.origin=a,this.updateGrid(!0)},getOrigin:function(){return this.origin||(this.origin=this.map.getExtent().getCenterLonLat()),this.origin},setRotation:function(a){this.rotation=a,this.updateGrid(!0)},onMoveEnd:function(){this.updateGrid()},getViewBounds:function(){var a=this.map.getExtent();if(this.rotation){var b=this.getOrigin(),b=new OpenLayers.Geometry.Point(b.lon,b.lat),a=a.toGeometry();a.rotate(-this.rotation,b),a=a.getBounds()}return a},updateGrid:function(a){if(a||this.invalidBounds()){var b=this.getViewBounds(),c=this.getOrigin(),a=new OpenLayers.Geometry.Point(c.lon,c.lat),d=b.getWidth(),e=b.getHeight(),f=d/e,g=Math.sqrt(this.dx*this.dy*this.maxFeatures/f),d=Math.min(d*this.ratio,g*f),e=Math.min(e*this.ratio,g),b=b.getCenterLonLat();this.gridBounds=new OpenLayers.Bounds(b.lon-d/2,b.lat-e/2,b.lon+d/2,b.lat+e/2);for(var h,b=Math.floor(e/this.dy),d=Math.floor(d/this.dx),e=c.lon+this.dx*Math.ceil((this.gridBounds.left-c.lon)/this.dx),c=c.lat+this.dy*Math.ceil((this.gridBounds.bottom-c.lat)/this.dy),g=Array(b*d),i=0;d>i;++i)for(var f=e+i*this.dx,j=0;b>j;++j)h=c+j*this.dy,h=new OpenLayers.Geometry.Point(f,h),this.rotation&&h.rotate(this.rotation,a),g[i*b+j]=new OpenLayers.Feature.Vector(h);this.destroyFeatures(this.features,{silent:!0}),this.addFeatures(g,{silent:!0})}},invalidBounds:function(){return!this.gridBounds||!this.gridBounds.containsBounds(this.getViewBounds())},CLASS_NAME:"OpenLayers.Layer.PointGrid"}),OpenLayers.Handler.MouseWheel=OpenLayers.Class(OpenLayers.Handler,{wheelListener:null,mousePosition:null,interval:0,delta:0,cumulative:!0,initialize:function(){OpenLayers.Handler.prototype.initialize.apply(this,arguments),this.wheelListener=OpenLayers.Function.bindAsEventListener(this.onWheelEvent,this)},destroy:function(){OpenLayers.Handler.prototype.destroy.apply(this,arguments),this.wheelListener=null},onWheelEvent:function(a){if(this.map&&this.checkModifiers(a)){for(var b=!1,c=!1,d=!1,e=OpenLayers.Event.element(a);null!=e&&!d&&!b;){if(!b)try{var f=e.currentStyle?e.currentStyle.overflow:document.defaultView.getComputedStyle(e,null).getPropertyValue("overflow"),b=f&&"auto"==f||"scroll"==f}catch(g){}if(!c)for(var d=0,h=this.map.layers.length;h>d;d++)if(e==this.map.layers[d].div||e==this.map.layers[d].pane){c=!0;break}d=e==this.map.div,e=e.parentNode}!b&&d&&(c&&(b=0,a||(a=window.event),a.wheelDelta?(b=a.wheelDelta/120,window.opera&&9.2>window.opera.version()&&(b=-b)):a.detail&&(b=-a.detail/3),this.delta+=b,this.interval?(window.clearTimeout(this._timeoutId),this._timeoutId=window.setTimeout(OpenLayers.Function.bind(function(){this.wheelZoom(a)},this),this.interval)):this.wheelZoom(a)),OpenLayers.Event.stop(a))}},wheelZoom:function(a){var b=this.delta;this.delta=0,b&&(this.mousePosition&&(a.xy=this.mousePosition),a.xy||(a.xy=this.map.getPixelFromLonLat(this.map.getCenter())),0>b?this.callback("down",[a,this.cumulative?b:-1]):this.callback("up",[a,this.cumulative?b:1]))},mousemove:function(a){this.mousePosition=a.xy},activate:function(){if(OpenLayers.Handler.prototype.activate.apply(this,arguments)){var a=this.wheelListener;return OpenLayers.Event.observe(window,"DOMMouseScroll",a),OpenLayers.Event.observe(window,"mousewheel",a),OpenLayers.Event.observe(document,"mousewheel",a),!0}return!1},deactivate:function(){if(OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){var a=this.wheelListener;return OpenLayers.Event.stopObserving(window,"DOMMouseScroll",a),OpenLayers.Event.stopObserving(window,"mousewheel",a),OpenLayers.Event.stopObserving(document,"mousewheel",a),!0}return!1},CLASS_NAME:"OpenLayers.Handler.MouseWheel"}),OpenLayers.Symbolizer=OpenLayers.Class({zIndex:0,initialize:function(a){OpenLayers.Util.extend(this,a)},clone:function(){return new(eval(this.CLASS_NAME))(OpenLayers.Util.extend({},this))},CLASS_NAME:"OpenLayers.Symbolizer"}),OpenLayers.Symbolizer.Raster=OpenLayers.Class(OpenLayers.Symbolizer,{initialize:function(){OpenLayers.Symbolizer.prototype.initialize.apply(this,arguments)},CLASS_NAME:"OpenLayers.Symbolizer.Raster"}),OpenLayers.Rule=OpenLayers.Class({id:null,name:null,title:null,description:null,context:null,filter:null,elseFilter:!1,symbolizer:null,symbolizers:null,minScaleDenominator:null,maxScaleDenominator:null,initialize:function(a){this.symbolizer={},OpenLayers.Util.extend(this,a),this.symbolizers&&delete this.symbolizer,this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},destroy:function(){for(var a in this.symbolizer)this.symbolizer[a]=null;this.symbolizer=null,delete this.symbolizers},evaluate:function(a){var b=this.getContext(a),c=!0;if(this.minScaleDenominator||this.maxScaleDenominator)var d=a.layer.map.getScale();return this.minScaleDenominator&&(c=d>=OpenLayers.Style.createLiteral(this.minScaleDenominator,b)),c&&this.maxScaleDenominator&&(c=d<OpenLayers.Style.createLiteral(this.maxScaleDenominator,b)),c&&this.filter&&(c=this.filter.evaluate("OpenLayers.Filter.FeatureId"==this.filter.CLASS_NAME?a:b)),c},getContext:function(a){var b=this.context;return b||(b=a.attributes||a.data),"function"==typeof this.context&&(b=this.context(a)),b},clone:function(){var a=OpenLayers.Util.extend({},this);if(this.symbolizers){var b=this.symbolizers.length;a.symbolizers=Array(b);for(var c=0;b>c;++c)a.symbolizers[c]=this.symbolizers[c].clone()}else{a.symbolizer={};for(var d in this.symbolizer)b=this.symbolizer[d],c=typeof b,"object"===c?a.symbolizer[d]=OpenLayers.Util.extend({},b):"string"===c&&(a.symbolizer[d]=b)}return a.filter=this.filter&&this.filter.clone(),a.context=this.context&&OpenLayers.Util.extend({},this.context),new OpenLayers.Rule(a)},CLASS_NAME:"OpenLayers.Rule"}),OpenLayers.Filter.Spatial=OpenLayers.Class(OpenLayers.Filter,{type:null,property:null,value:null,distance:null,distanceUnits:null,evaluate:function(a){var b=!1;switch(this.type){case OpenLayers.Filter.Spatial.BBOX:case OpenLayers.Filter.Spatial.INTERSECTS:if(a.geometry){var c=this.value;"OpenLayers.Bounds"==this.value.CLASS_NAME&&(c=this.value.toGeometry()),a.geometry.intersects(c)&&(b=!0)}break;default:throw Error("evaluate is not implemented for this filter type.")}return b},clone:function(){var a=OpenLayers.Util.applyDefaults({value:this.value&&this.value.clone&&this.value.clone()},this);
return new OpenLayers.Filter.Spatial(a)},CLASS_NAME:"OpenLayers.Filter.Spatial"}),OpenLayers.Filter.Spatial.BBOX="BBOX",OpenLayers.Filter.Spatial.INTERSECTS="INTERSECTS",OpenLayers.Filter.Spatial.DWITHIN="DWITHIN",OpenLayers.Filter.Spatial.WITHIN="WITHIN",OpenLayers.Filter.Spatial.CONTAINS="CONTAINS",OpenLayers.Format.SLD=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{profile:null,defaultVersion:"1.0.0",stringifyOutput:!0,namedLayersAsArray:!1,CLASS_NAME:"OpenLayers.Format.SLD"}),OpenLayers.Symbolizer.Polygon=OpenLayers.Class(OpenLayers.Symbolizer,{initialize:function(){OpenLayers.Symbolizer.prototype.initialize.apply(this,arguments)},CLASS_NAME:"OpenLayers.Symbolizer.Polygon"}),OpenLayers.Format.GML.v2=OpenLayers.Class(OpenLayers.Format.GML.Base,{schemaLocation:"http://www.opengis.net/gml http://schemas.opengis.net/gml/2.1.2/feature.xsd",initialize:function(a){OpenLayers.Format.GML.Base.prototype.initialize.apply(this,[a])},readers:{gml:OpenLayers.Util.applyDefaults({outerBoundaryIs:function(a,b){var c={};this.readChildNodes(a,c),b.outer=c.components[0]},innerBoundaryIs:function(a,b){var c={};this.readChildNodes(a,c),b.inner.push(c.components[0])},Box:function(a,b){var c={};this.readChildNodes(a,c),b.components||(b.components=[]);var d=c.points[0],c=c.points[1];b.components.push(new OpenLayers.Bounds(d.x,d.y,c.x,c.y))}},OpenLayers.Format.GML.Base.prototype.readers.gml),feature:OpenLayers.Format.GML.Base.prototype.readers.feature,wfs:OpenLayers.Format.GML.Base.prototype.readers.wfs},write:function(a){return a=this.writeNode(OpenLayers.Util.isArray(a)?"wfs:FeatureCollection":"gml:featureMember",a),this.setAttributeNS(a,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation),OpenLayers.Format.XML.prototype.write.apply(this,[a])},writers:{gml:OpenLayers.Util.applyDefaults({Point:function(a){var b=this.createElementNSPlus("gml:Point");return this.writeNode("coordinates",[a],b),b},coordinates:function(a){for(var b,c=a.length,d=Array(c),e=0;c>e;++e)b=a[e],d[e]=this.xy?b.x+","+b.y:b.y+","+b.x,void 0!=b.z&&(d[e]+=","+b.z);return this.createElementNSPlus("gml:coordinates",{attributes:{decimal:".",cs:",",ts:" "},value:1==c?d[0]:d.join(" ")})},LineString:function(a){var b=this.createElementNSPlus("gml:LineString");return this.writeNode("coordinates",a.components,b),b},Polygon:function(a){var b=this.createElementNSPlus("gml:Polygon");this.writeNode("outerBoundaryIs",a.components[0],b);for(var c=1;c<a.components.length;++c)this.writeNode("innerBoundaryIs",a.components[c],b);return b},outerBoundaryIs:function(a){var b=this.createElementNSPlus("gml:outerBoundaryIs");return this.writeNode("LinearRing",a,b),b},innerBoundaryIs:function(a){var b=this.createElementNSPlus("gml:innerBoundaryIs");return this.writeNode("LinearRing",a,b),b},LinearRing:function(a){var b=this.createElementNSPlus("gml:LinearRing");return this.writeNode("coordinates",a.components,b),b},Box:function(a){var b=this.createElementNSPlus("gml:Box");return this.writeNode("coordinates",[{x:a.left,y:a.bottom},{x:a.right,y:a.top}],b),this.srsName&&b.setAttribute("srsName",this.srsName),b}},OpenLayers.Format.GML.Base.prototype.writers.gml),feature:OpenLayers.Format.GML.Base.prototype.writers.feature,wfs:OpenLayers.Format.GML.Base.prototype.writers.wfs},CLASS_NAME:"OpenLayers.Format.GML.v2"}),OpenLayers.Format.Filter.v1_0_0=OpenLayers.Class(OpenLayers.Format.GML.v2,OpenLayers.Format.Filter.v1,{VERSION:"1.0.0",schemaLocation:"http://www.opengis.net/ogc/filter/1.0.0/filter.xsd",initialize:function(a){OpenLayers.Format.GML.v2.prototype.initialize.apply(this,[a])},readers:{ogc:OpenLayers.Util.applyDefaults({PropertyIsEqualTo:function(a,b){var c=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO});this.readChildNodes(a,c),b.filters.push(c)},PropertyIsNotEqualTo:function(a,b){var c=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.NOT_EQUAL_TO});this.readChildNodes(a,c),b.filters.push(c)},PropertyIsLike:function(a,b){var c=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LIKE});this.readChildNodes(a,c);var d=a.getAttribute("wildCard"),e=a.getAttribute("singleChar"),f=a.getAttribute("escape");c.value2regex(d,e,f),b.filters.push(c)}},OpenLayers.Format.Filter.v1.prototype.readers.ogc),gml:OpenLayers.Format.GML.v2.prototype.readers.gml,feature:OpenLayers.Format.GML.v2.prototype.readers.feature},writers:{ogc:OpenLayers.Util.applyDefaults({PropertyIsEqualTo:function(a){var b=this.createElementNSPlus("ogc:PropertyIsEqualTo");return this.writeNode("PropertyName",a,b),this.writeOgcExpression(a.value,b),b},PropertyIsNotEqualTo:function(a){var b=this.createElementNSPlus("ogc:PropertyIsNotEqualTo");return this.writeNode("PropertyName",a,b),this.writeOgcExpression(a.value,b),b},PropertyIsLike:function(a){var b=this.createElementNSPlus("ogc:PropertyIsLike",{attributes:{wildCard:"*",singleChar:".",escape:"!"}});return this.writeNode("PropertyName",a,b),this.writeNode("Literal",a.regex2value(),b),b},BBOX:function(a){var b=this.createElementNSPlus("ogc:BBOX");a.property&&this.writeNode("PropertyName",a,b);var c=this.writeNode("gml:Box",a.value,b);return a.projection&&c.setAttribute("srsName",a.projection),b}},OpenLayers.Format.Filter.v1.prototype.writers.ogc),gml:OpenLayers.Format.GML.v2.prototype.writers.gml,feature:OpenLayers.Format.GML.v2.prototype.writers.feature},writeSpatial:function(a,b){var c=this.createElementNSPlus("ogc:"+b);if(this.writeNode("PropertyName",a,c),a.value instanceof OpenLayers.Filter.Function)this.writeNode("Function",a.value,c);else{var d;d=a.value instanceof OpenLayers.Geometry?this.writeNode("feature:_geometry",a.value).firstChild:this.writeNode("gml:Box",a.value),a.projection&&d.setAttribute("srsName",a.projection),c.appendChild(d)}return c},CLASS_NAME:"OpenLayers.Format.Filter.v1_0_0"}),OpenLayers.Format.WFST.v1_0_0=OpenLayers.Class(OpenLayers.Format.Filter.v1_0_0,OpenLayers.Format.WFST.v1,{version:"1.0.0",srsNameInQuery:!1,schemaLocations:{wfs:"http://schemas.opengis.net/wfs/1.0.0/WFS-transaction.xsd"},initialize:function(a){OpenLayers.Format.Filter.v1_0_0.prototype.initialize.apply(this,[a]),OpenLayers.Format.WFST.v1.prototype.initialize.apply(this,[a])},readNode:function(a,b){return OpenLayers.Format.GML.v2.prototype.readNode.apply(this,[a,b])},readers:{wfs:OpenLayers.Util.applyDefaults({WFS_TransactionResponse:function(a,b){b.insertIds=[],b.success=!1,this.readChildNodes(a,b)},InsertResult:function(a,b){var c={fids:[]};this.readChildNodes(a,c),b.insertIds.push(c.fids[0])},TransactionResult:function(a,b){this.readChildNodes(a,b)},Status:function(a,b){this.readChildNodes(a,b)},SUCCESS:function(a,b){b.success=!0}},OpenLayers.Format.WFST.v1.prototype.readers.wfs),gml:OpenLayers.Format.GML.v2.prototype.readers.gml,feature:OpenLayers.Format.GML.v2.prototype.readers.feature,ogc:OpenLayers.Format.Filter.v1_0_0.prototype.readers.ogc},writers:{wfs:OpenLayers.Util.applyDefaults({Query:function(a){var a=OpenLayers.Util.extend({featureNS:this.featureNS,featurePrefix:this.featurePrefix,featureType:this.featureType,srsName:this.srsName,srsNameInQuery:this.srsNameInQuery},a),b=a.featurePrefix,c=this.createElementNSPlus("wfs:Query",{attributes:{typeName:(b?b+":":"")+a.featureType}});if(a.srsNameInQuery&&a.srsName&&c.setAttribute("srsName",a.srsName),a.featureNS&&c.setAttribute("xmlns:"+b,a.featureNS),a.propertyNames)for(var b=0,d=a.propertyNames.length;d>b;b++)this.writeNode("ogc:PropertyName",{property:a.propertyNames[b]},c);return a.filter&&(this.setFilterProperty(a.filter),this.writeNode("ogc:Filter",a.filter,c)),c}},OpenLayers.Format.WFST.v1.prototype.writers.wfs),gml:OpenLayers.Format.GML.v2.prototype.writers.gml,feature:OpenLayers.Format.GML.v2.prototype.writers.feature,ogc:OpenLayers.Format.Filter.v1_0_0.prototype.writers.ogc},CLASS_NAME:"OpenLayers.Format.WFST.v1_0_0"}),OpenLayers.ElementsIndexer=OpenLayers.Class({maxZIndex:null,order:null,indices:null,compare:null,initialize:function(a){this.compare=a?OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER_Y_ORDER:OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER_DRAWING_ORDER,this.clear()},insert:function(a){this.exists(a)&&this.remove(a);var b=a.id;this.determineZIndex(a);for(var c,d=-1,e=this.order.length;e-d>1;)c=parseInt((d+e)/2),0<this.compare(this,a,OpenLayers.Util.getElement(this.order[c]))?d=c:e=c;return this.order.splice(e,0,b),this.indices[b]=this.getZIndex(a),this.getNextElement(e)},remove:function(a){var a=a.id,b=OpenLayers.Util.indexOf(this.order,a);b>=0&&(this.order.splice(b,1),delete this.indices[a],this.maxZIndex=0<this.order.length?this.indices[this.order[this.order.length-1]]:0)},clear:function(){this.order=[],this.indices={},this.maxZIndex=0},exists:function(a){return null!=this.indices[a.id]},getZIndex:function(a){return a._style.graphicZIndex},determineZIndex:function(a){var b=a._style.graphicZIndex;null==b?(b=this.maxZIndex,a._style.graphicZIndex=b):b>this.maxZIndex&&(this.maxZIndex=b)},getNextElement:function(a){if(a+=1,a<this.order.length){var b=OpenLayers.Util.getElement(this.order[a]);return void 0==b&&(b=this.getNextElement(a)),b}return null},CLASS_NAME:"OpenLayers.ElementsIndexer"}),OpenLayers.ElementsIndexer.IndexingMethods={Z_ORDER:function(a,b,c){var b=a.getZIndex(b),d=0;return c&&(a=a.getZIndex(c),d=b-a),d},Z_ORDER_DRAWING_ORDER:function(a,b,c){return a=OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER(a,b,c),c&&0==a&&(a=1),a},Z_ORDER_Y_ORDER:function(a,b,c){return a=OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER(a,b,c),c&&0===a&&(b=c._boundsBottom-b._boundsBottom,a=0===b?1:b),a}},OpenLayers.Renderer.Elements=OpenLayers.Class(OpenLayers.Renderer,{rendererRoot:null,root:null,vectorRoot:null,textRoot:null,xmlns:null,xOffset:0,indexer:null,BACKGROUND_ID_SUFFIX:"_background",LABEL_ID_SUFFIX:"_label",LABEL_OUTLINE_SUFFIX:"_outline",initialize:function(a,b){OpenLayers.Renderer.prototype.initialize.apply(this,arguments),this.rendererRoot=this.createRenderRoot(),this.root=this.createRoot("_root"),this.vectorRoot=this.createRoot("_vroot"),this.textRoot=this.createRoot("_troot"),this.root.appendChild(this.vectorRoot),this.root.appendChild(this.textRoot),this.rendererRoot.appendChild(this.root),this.container.appendChild(this.rendererRoot),b&&(b.zIndexing||b.yOrdering)&&(this.indexer=new OpenLayers.ElementsIndexer(b.yOrdering))},destroy:function(){this.clear(),this.xmlns=this.root=this.rendererRoot=null,OpenLayers.Renderer.prototype.destroy.apply(this,arguments)},clear:function(){var a,b=this.vectorRoot;if(b)for(;a=b.firstChild;)b.removeChild(a);if(b=this.textRoot)for(;a=b.firstChild;)b.removeChild(a);this.indexer&&this.indexer.clear()},setExtent:function(a,b){var c=OpenLayers.Renderer.prototype.setExtent.apply(this,arguments),d=this.getResolution();if(this.map.baseLayer&&this.map.baseLayer.wrapDateLine){var e,f=a.getWidth()/this.map.getExtent().getWidth(),a=a.scale(1/f),f=this.map.getMaxExtent();f.right>a.left&&f.right<a.right?e=!0:f.left>a.left&&f.left<a.right&&(e=!1),(e!==this.rightOfDateLine||b)&&(c=!1,this.xOffset=!0===e?f.getWidth()/d:0),this.rightOfDateLine=e}return c},getNodeType:function(){},drawGeometry:function(a,b,c){var d=a.CLASS_NAME,e=!0;if("OpenLayers.Geometry.Collection"==d||"OpenLayers.Geometry.MultiPoint"==d||"OpenLayers.Geometry.MultiLineString"==d||"OpenLayers.Geometry.MultiPolygon"==d){for(var d=0,f=a.components.length;f>d;d++)e=this.drawGeometry(a.components[d],b,c)&&e;return e}return d=e=!1,"none"!=b.display&&(b.backgroundGraphic?this.redrawBackgroundNode(a.id,a,b,c):d=!0,e=this.redrawNode(a.id,a,b,c)),0==e&&(b=document.getElementById(a.id))&&(b._style.backgroundGraphic&&(d=!0),b.parentNode.removeChild(b)),d&&(b=document.getElementById(a.id+this.BACKGROUND_ID_SUFFIX))&&b.parentNode.removeChild(b),e},redrawNode:function(a,b,c,d){return c=this.applyDefaultSymbolizer(c),a=this.nodeFactory(a,this.getNodeType(b,c)),a._featureId=d,a._boundsBottom=b.getBounds().bottom,a._geometryClass=b.CLASS_NAME,a._style=c,b=this.drawGeometryNode(a,b,c),!1===b?!1:(a=b.node,this.indexer?(c=this.indexer.insert(a))?this.vectorRoot.insertBefore(a,c):this.vectorRoot.appendChild(a):a.parentNode!==this.vectorRoot&&this.vectorRoot.appendChild(a),this.postDraw(a),b.complete)},redrawBackgroundNode:function(a,b,c){return c=OpenLayers.Util.extend({},c),c.externalGraphic=c.backgroundGraphic,c.graphicXOffset=c.backgroundXOffset,c.graphicYOffset=c.backgroundYOffset,c.graphicZIndex=c.backgroundGraphicZIndex,c.graphicWidth=c.backgroundWidth||c.graphicWidth,c.graphicHeight=c.backgroundHeight||c.graphicHeight,c.backgroundGraphic=null,c.backgroundXOffset=null,c.backgroundYOffset=null,c.backgroundGraphicZIndex=null,this.redrawNode(a+this.BACKGROUND_ID_SUFFIX,b,c,null)},drawGeometryNode:function(a,b,c){var d,c=c||a._style,e={isFilled:void 0===c.fill?!0:c.fill,isStroked:void 0===c.stroke?!!c.strokeWidth:c.stroke};switch(b.CLASS_NAME){case"OpenLayers.Geometry.Point":!1===c.graphic&&(e.isFilled=!1,e.isStroked=!1),d=this.drawPoint(a,b);break;case"OpenLayers.Geometry.LineString":e.isFilled=!1,d=this.drawLineString(a,b);break;case"OpenLayers.Geometry.LinearRing":d=this.drawLinearRing(a,b);break;case"OpenLayers.Geometry.Polygon":d=this.drawPolygon(a,b);break;case"OpenLayers.Geometry.Rectangle":d=this.drawRectangle(a,b)}return a._options=e,0!=d?{node:this.setStyle(a,c,e,b),complete:d}:!1},postDraw:function(){},drawPoint:function(){},drawLineString:function(){},drawLinearRing:function(){},drawPolygon:function(){},drawRectangle:function(){},drawCircle:function(){},removeText:function(a){var b=document.getElementById(a+this.LABEL_ID_SUFFIX);b&&this.textRoot.removeChild(b),(a=document.getElementById(a+this.LABEL_OUTLINE_SUFFIX))&&this.textRoot.removeChild(a)},getFeatureIdFromEvent:function(a){var b=a.target,c=b&&b.correspondingUseElement;return(c?c:b||a.srcElement)._featureId},eraseGeometry:function(a,b){if("OpenLayers.Geometry.MultiPoint"==a.CLASS_NAME||"OpenLayers.Geometry.MultiLineString"==a.CLASS_NAME||"OpenLayers.Geometry.MultiPolygon"==a.CLASS_NAME||"OpenLayers.Geometry.Collection"==a.CLASS_NAME)for(var c=0,d=a.components.length;d>c;c++)this.eraseGeometry(a.components[c],b);else(c=OpenLayers.Util.getElement(a.id))&&c.parentNode&&(c.geometry&&(c.geometry.destroy(),c.geometry=null),c.parentNode.removeChild(c),this.indexer&&this.indexer.remove(c),c._style.backgroundGraphic&&(c=OpenLayers.Util.getElement(a.id+this.BACKGROUND_ID_SUFFIX))&&c.parentNode&&c.parentNode.removeChild(c))},nodeFactory:function(a,b){var c=OpenLayers.Util.getElement(a);return c?this.nodeTypeCompare(c,b)||(c.parentNode.removeChild(c),c=this.nodeFactory(a,b)):c=this.createNode(b,a),c},nodeTypeCompare:function(){},createNode:function(){},moveRoot:function(a){var b=this.root;a.root.parentNode==this.rendererRoot&&(b=a.root),b.parentNode.removeChild(b),a.rendererRoot.appendChild(b)},getRenderLayerId:function(){return this.root.parentNode.parentNode.id},isComplexSymbol:function(a){return"circle"!=a&&!!a},CLASS_NAME:"OpenLayers.Renderer.Elements"}),OpenLayers.Control.ArgParser=OpenLayers.Class(OpenLayers.Control,{center:null,zoom:null,layers:null,displayProjection:null,getParameters:function(a){var a=a||window.location.href,b=OpenLayers.Util.getParameters(a),c=a.indexOf("#");return c>0&&(a="?"+a.substring(c+1,a.length),OpenLayers.Util.extend(b,OpenLayers.Util.getParameters(a))),b},setMap:function(){OpenLayers.Control.prototype.setMap.apply(this,arguments);for(var a=0,b=this.map.controls.length;b>a;a++){var c=this.map.controls[a];if(c!=this&&"OpenLayers.Control.ArgParser"==c.CLASS_NAME){c.displayProjection!=this.displayProjection&&(this.displayProjection=c.displayProjection);break}}a==this.map.controls.length&&(a=this.getParameters(),a.layers&&(this.layers=a.layers,this.map.events.register("addlayer",this,this.configureLayers),this.configureLayers()),a.lat&&a.lon)&&(this.center=new OpenLayers.LonLat(parseFloat(a.lon),parseFloat(a.lat)),a.zoom&&(this.zoom=parseFloat(a.zoom)),this.map.events.register("changebaselayer",this,this.setCenter),this.setCenter())},setCenter:function(){this.map.baseLayer&&(this.map.events.unregister("changebaselayer",this,this.setCenter),this.displayProjection&&this.center.transform(this.displayProjection,this.map.getProjectionObject()),this.map.setCenter(this.center,this.zoom))},configureLayers:function(){if(this.layers.length==this.map.layers.length){this.map.events.unregister("addlayer",this,this.configureLayers);for(var a=0,b=this.layers.length;b>a;a++){var c=this.map.layers[a],d=this.layers.charAt(a);"B"==d?this.map.setBaseLayer(c):("T"==d||"F"==d)&&c.setVisibility("T"==d)}}},CLASS_NAME:"OpenLayers.Control.ArgParser"}),OpenLayers.Control.Permalink=OpenLayers.Class(OpenLayers.Control,{argParserClass:OpenLayers.Control.ArgParser,element:null,anchor:!1,base:"",displayProjection:null,initialize:function(a,b,c){null===a||"object"!=typeof a||OpenLayers.Util.isElement(a)?(OpenLayers.Control.prototype.initialize.apply(this,[c]),this.element=OpenLayers.Util.getElement(a),this.base=b||document.location.href):(this.base=document.location.href,OpenLayers.Control.prototype.initialize.apply(this,[a]),null!=this.element&&(this.element=OpenLayers.Util.getElement(this.element)))},destroy:function(){this.element&&this.element.parentNode==this.div&&(this.div.removeChild(this.element),this.element=null),this.map&&this.map.events.unregister("moveend",this,this.updateLink),OpenLayers.Control.prototype.destroy.apply(this,arguments)},setMap:function(){OpenLayers.Control.prototype.setMap.apply(this,arguments);for(var a=0,b=this.map.controls.length;b>a;a++){var c=this.map.controls[a];if(c.CLASS_NAME==this.argParserClass.CLASS_NAME){c.displayProjection!=this.displayProjection&&(this.displayProjection=c.displayProjection);break}}a==this.map.controls.length&&this.map.addControl(new this.argParserClass({displayProjection:this.displayProjection}))},draw:function(){return OpenLayers.Control.prototype.draw.apply(this,arguments),!this.element&&!this.anchor&&(this.element=document.createElement("a"),this.element.innerHTML=OpenLayers.i18n("Permalink"),this.element.href="",this.div.appendChild(this.element)),this.map.events.on({moveend:this.updateLink,changelayer:this.updateLink,changebaselayer:this.updateLink,scope:this}),this.updateLink(),this.div},updateLink:function(){var a=this.anchor?"#":"?",b=this.base;-1!=b.indexOf(a)&&(b=b.substring(0,b.indexOf(a))),b+=a+OpenLayers.Util.getParameterString(this.createParams()),this.anchor&&!this.element?window.location.href=b:this.element.href=b},createParams:function(a,b,c){var a=a||this.map.getCenter(),d=OpenLayers.Util.getParameters(this.base);if(a)for(d.zoom=b||this.map.getZoom(),b=a.lat,a=a.lon,this.displayProjection&&(b=OpenLayers.Projection.transform({x:a,y:b},this.map.getProjectionObject(),this.displayProjection),a=b.x,b=b.y),d.lat=Math.round(1e5*b)/1e5,d.lon=Math.round(1e5*a)/1e5,c=c||this.map.layers,d.layers="",a=0,b=c.length;b>a;a++){var e=c[a];d.layers=e.isBaseLayer?d.layers+(e==this.map.baseLayer?"B":"0"):d.layers+(e.getVisibility()?"T":"F")}return d},CLASS_NAME:"OpenLayers.Control.Permalink"}),OpenLayers.Layer.TMS=OpenLayers.Class(OpenLayers.Layer.Grid,{serviceVersion:"1.0.0",layername:null,type:null,isBaseLayer:!0,tileOrigin:null,serverResolutions:null,zoomOffset:0,initialize:function(a,b,c){var d=[];d.push(a,b,{},c),OpenLayers.Layer.Grid.prototype.initialize.apply(this,d)},clone:function(a){return null==a&&(a=new OpenLayers.Layer.TMS(this.name,this.url,this.getOptions())),a=OpenLayers.Layer.Grid.prototype.clone.apply(this,[a])},getURL:function(a){var a=this.adjustBounds(a),b=this.getServerResolution(),c=Math.round((a.left-this.tileOrigin.lon)/(b*this.tileSize.w)),a=Math.round((a.bottom-this.tileOrigin.lat)/(b*this.tileSize.h)),c=this.serviceVersion+"/"+this.layername+"/"+this.getServerZoom()+"/"+c+"/"+a+"."+this.type,a=this.url;return OpenLayers.Util.isArray(a)&&(a=this.selectUrl(c,a)),a+c},setMap:function(){OpenLayers.Layer.Grid.prototype.setMap.apply(this,arguments),this.tileOrigin||(this.tileOrigin=new OpenLayers.LonLat(this.map.maxExtent.left,this.map.maxExtent.bottom))},CLASS_NAME:"OpenLayers.Layer.TMS"}),OpenLayers.Strategy.Fixed=OpenLayers.Class(OpenLayers.Strategy,{preload:!1,activate:function(){return OpenLayers.Strategy.prototype.activate.apply(this,arguments)?(this.layer.events.on({refresh:this.load,scope:this}),1==this.layer.visibility||this.preload?this.load():this.layer.events.on({visibilitychanged:this.load,scope:this}),!0):!1},deactivate:function(){var a=OpenLayers.Strategy.prototype.deactivate.call(this);return a&&this.layer.events.un({refresh:this.load,visibilitychanged:this.load,scope:this}),a},load:function(a){var b=this.layer;b.events.triggerEvent("loadstart"),b.protocol.read(OpenLayers.Util.applyDefaults({callback:OpenLayers.Function.bind(this.merge,this,b.map.getProjectionObject()),filter:b.filter},a)),b.events.un({visibilitychanged:this.load,scope:this})},merge:function(a,b){var c=this.layer;c.destroyFeatures();var d=b.features;if(d&&0<d.length){if(!a.equals(c.projection))for(var e,f=0,g=d.length;g>f;++f)(e=d[f].geometry)&&e.transform(c.projection,a);c.addFeatures(d)}c.events.triggerEvent("loadend")},CLASS_NAME:"OpenLayers.Strategy.Fixed"}),OpenLayers.Control.Zoom=OpenLayers.Class(OpenLayers.Control,{zoomInText:"+",zoomInId:"olZoomInLink",zoomOutText:"-",zoomOutId:"olZoomOutLink",draw:function(){var a=OpenLayers.Control.prototype.draw.apply(this),b=this.getOrCreateLinks(a),c=b.zoomIn,b=b.zoomOut,d=this.map.events;return b.parentNode!==a&&(d=this.events,d.attachToElement(b.parentNode)),d.register("buttonclick",this,this.onZoomClick),this.zoomInLink=c,this.zoomOutLink=b,a},getOrCreateLinks:function(a){var b=document.getElementById(this.zoomInId),c=document.getElementById(this.zoomOutId);return b||(b=document.createElement("a"),b.href="#zoomIn",b.appendChild(document.createTextNode(this.zoomInText)),b.className="olControlZoomIn",a.appendChild(b)),OpenLayers.Element.addClass(b,"olButton"),c||(c=document.createElement("a"),c.href="#zoomOut",c.appendChild(document.createTextNode(this.zoomOutText)),c.className="olControlZoomOut",a.appendChild(c)),OpenLayers.Element.addClass(c,"olButton"),{zoomIn:b,zoomOut:c}},onZoomClick:function(a){a=a.buttonElement,a===this.zoomInLink?this.map.zoomIn():a===this.zoomOutLink&&this.map.zoomOut()},destroy:function(){this.map&&this.map.events.unregister("buttonclick",this,this.onZoomClick),delete this.zoomInLink,delete this.zoomOutLink,OpenLayers.Control.prototype.destroy.apply(this)},CLASS_NAME:"OpenLayers.Control.Zoom"}),OpenLayers.Layer.PointTrack=OpenLayers.Class(OpenLayers.Layer.Vector,{dataFrom:null,styleFrom:null,addNodes:function(a,b){if(2>a.length)throw Error("At least two point features have to be added to create a line from");for(var c,d,e,f=Array(a.length-1),g=0,h=a.length;h>g;g++){if(c=a[g],e=c.geometry){if("OpenLayers.Geometry.Point"!=e.CLASS_NAME)throw new TypeError("Only features with point geometries are supported.")}else e=c.lonlat,e=new OpenLayers.Geometry.Point(e.lon,e.lat);if(g>0){c=null!=this.dataFrom?a[g+this.dataFrom].data||a[g+this.dataFrom].attributes:null;var i=null!=this.styleFrom?a[g+this.styleFrom].style:null;d=new OpenLayers.Geometry.LineString([d,e]),f[g-1]=new OpenLayers.Feature.Vector(d,c,i)}d=e}this.addFeatures(f,b)},CLASS_NAME:"OpenLayers.Layer.PointTrack"}),OpenLayers.Layer.PointTrack.SOURCE_NODE=-1,OpenLayers.Layer.PointTrack.TARGET_NODE=0,OpenLayers.Layer.PointTrack.dataFrom={SOURCE_NODE:-1,TARGET_NODE:0},OpenLayers.Protocol.WFS=function(a){var a=OpenLayers.Util.applyDefaults(a,OpenLayers.Protocol.WFS.DEFAULTS),b=OpenLayers.Protocol.WFS["v"+a.version.replace(/\./g,"_")];if(!b)throw"Unsupported WFS version: "+a.version;return new b(a)},OpenLayers.Protocol.WFS.fromWMSLayer=function(a,b){var c,d;return c=a.params.LAYERS,c=(OpenLayers.Util.isArray(c)?c[0]:c).split(":"),1<c.length&&(d=c[0]),c=c.pop(),d={url:a.url,featureType:c,featurePrefix:d,srsName:a.projection&&a.projection.getCode()||a.map&&a.map.getProjectionObject().getCode(),version:"1.1.0"},new OpenLayers.Protocol.WFS(OpenLayers.Util.applyDefaults(b,d))},OpenLayers.Protocol.WFS.DEFAULTS={version:"1.0.0"},OpenLayers.Layer.Markers=OpenLayers.Class(OpenLayers.Layer,{isBaseLayer:!1,markers:null,drawn:!1,initialize:function(){OpenLayers.Layer.prototype.initialize.apply(this,arguments),this.markers=[]},destroy:function(){this.clearMarkers(),this.markers=null,OpenLayers.Layer.prototype.destroy.apply(this,arguments)},setOpacity:function(a){if(a!=this.opacity){this.opacity=a;for(var a=0,b=this.markers.length;b>a;a++)this.markers[a].setOpacity(this.opacity)}},moveTo:function(a,b){if(OpenLayers.Layer.prototype.moveTo.apply(this,arguments),b||!this.drawn){for(var c=0,d=this.markers.length;d>c;c++)this.drawMarker(this.markers[c]);this.drawn=!0}},addMarker:function(a){this.markers.push(a),1>this.opacity&&a.setOpacity(this.opacity),this.map&&this.map.getExtent()&&(a.map=this.map,this.drawMarker(a))},removeMarker:function(a){this.markers&&this.markers.length&&(OpenLayers.Util.removeItem(this.markers,a),a.erase())},clearMarkers:function(){if(null!=this.markers)for(;0<this.markers.length;)this.removeMarker(this.markers[0])},drawMarker:function(a){var b=this.map.getLayerPxFromLonLat(a.lonlat);null==b?a.display(!1):a.isDrawn()?a.icon&&a.icon.moveTo(b):this.div.appendChild(a.draw(b))},getDataExtent:function(){var a=null;if(this.markers&&0<this.markers.length)for(var a=new OpenLayers.Bounds,b=0,c=this.markers.length;c>b;b++)a.extend(this.markers[b].lonlat);return a},CLASS_NAME:"OpenLayers.Layer.Markers"}),OpenLayers.Control.Pan=OpenLayers.Class(OpenLayers.Control,{slideFactor:50,slideRatio:null,direction:null,type:OpenLayers.Control.TYPE_BUTTON,initialize:function(a,b){this.direction=a,this.CLASS_NAME+=this.direction,OpenLayers.Control.prototype.initialize.apply(this,[b])},trigger:function(){var a=OpenLayers.Function.bind(function(a){return this.slideRatio?this.map.getSize()[a]*this.slideRatio:this.slideFactor},this);switch(this.direction){case OpenLayers.Control.Pan.NORTH:this.map.pan(0,-a("h"));break;case OpenLayers.Control.Pan.SOUTH:this.map.pan(0,a("h"));break;case OpenLayers.Control.Pan.WEST:this.map.pan(-a("w"),0);break;case OpenLayers.Control.Pan.EAST:this.map.pan(a("w"),0)}},CLASS_NAME:"OpenLayers.Control.Pan"}),OpenLayers.Control.Pan.NORTH="North",OpenLayers.Control.Pan.SOUTH="South",OpenLayers.Control.Pan.EAST="East",OpenLayers.Control.Pan.WEST="West",OpenLayers.Format.CSWGetDomain=function(a){var a=OpenLayers.Util.applyDefaults(a,OpenLayers.Format.CSWGetDomain.DEFAULTS),b=OpenLayers.Format.CSWGetDomain["v"+a.version.replace(/\./g,"_")];if(!b)throw"Unsupported CSWGetDomain version: "+a.version;return new b(a)},OpenLayers.Format.CSWGetDomain.DEFAULTS={version:"2.0.2"},OpenLayers.Format.CSWGetDomain.v2_0_2=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance",csw:"http://www.opengis.net/cat/csw/2.0.2"},defaultPrefix:"csw",version:"2.0.2",schemaLocation:"http://www.opengis.net/cat/csw/2.0.2 http://schemas.opengis.net/csw/2.0.2/CSW-discovery.xsd",PropertyName:null,ParameterName:null,read:function(a){"string"==typeof a&&(a=OpenLayers.Format.XML.prototype.read.apply(this,[a])),a&&9==a.nodeType&&(a=a.documentElement);var b={};return this.readNode(a,b),b},readers:{csw:{GetDomainResponse:function(a,b){this.readChildNodes(a,b)},DomainValues:function(a,b){OpenLayers.Util.isArray(b.DomainValues)||(b.DomainValues=[]);for(var c=a.attributes,d={},e=0,f=c.length;f>e;++e)d[c[e].name]=c[e].nodeValue;this.readChildNodes(a,d),b.DomainValues.push(d)},PropertyName:function(a,b){b.PropertyName=this.getChildValue(a)},ParameterName:function(a,b){b.ParameterName=this.getChildValue(a)},ListOfValues:function(a,b){OpenLayers.Util.isArray(b.ListOfValues)||(b.ListOfValues=[]),this.readChildNodes(a,b.ListOfValues)},Value:function(a,b){for(var c=a.attributes,d={},e=0,f=c.length;f>e;++e)d[c[e].name]=c[e].nodeValue;d.value=this.getChildValue(a),b.push({Value:d})},ConceptualScheme:function(a,b){b.ConceptualScheme={},this.readChildNodes(a,b.ConceptualScheme)},Name:function(a,b){b.Name=this.getChildValue(a)},Document:function(a,b){b.Document=this.getChildValue(a)},Authority:function(a,b){b.Authority=this.getChildValue(a)},RangeOfValues:function(a,b){b.RangeOfValues={},this.readChildNodes(a,b.RangeOfValues)},MinValue:function(a,b){for(var c=a.attributes,d={},e=0,f=c.length;f>e;++e)d[c[e].name]=c[e].nodeValue;d.value=this.getChildValue(a),b.MinValue=d},MaxValue:function(a,b){for(var c=a.attributes,d={},e=0,f=c.length;f>e;++e)d[c[e].name]=c[e].nodeValue;d.value=this.getChildValue(a),b.MaxValue=d}}},write:function(a){return a=this.writeNode("csw:GetDomain",a),OpenLayers.Format.XML.prototype.write.apply(this,[a])},writers:{csw:{GetDomain:function(a){var b=this.createElementNSPlus("csw:GetDomain",{attributes:{service:"CSW",version:this.version}});return a.PropertyName||this.PropertyName?this.writeNode("csw:PropertyName",a.PropertyName||this.PropertyName,b):(a.ParameterName||this.ParameterName)&&this.writeNode("csw:ParameterName",a.ParameterName||this.ParameterName,b),this.readChildNodes(b,a),b},PropertyName:function(a){return this.createElementNSPlus("csw:PropertyName",{value:a})},ParameterName:function(a){return this.createElementNSPlus("csw:ParameterName",{value:a})}}},CLASS_NAME:"OpenLayers.Format.CSWGetDomain.v2_0_2"}),OpenLayers.Format.ArcXML.Features=OpenLayers.Class(OpenLayers.Format.XML,{read:function(a){return(new OpenLayers.Format.ArcXML).read(a).features.feature}}),OpenLayers.Control.Snapping=OpenLayers.Class(OpenLayers.Control,{DEFAULTS:{tolerance:10,node:!0,edge:!0,vertex:!0},greedy:!0,precedence:["node","vertex","edge"],resolution:null,geoToleranceCache:null,layer:null,feature:null,point:null,initialize:function(a){OpenLayers.Control.prototype.initialize.apply(this,[a]),this.options=a||{},this.options.layer&&this.setLayer(this.options.layer),a=OpenLayers.Util.extend({},this.options.defaults),this.defaults=OpenLayers.Util.applyDefaults(a,this.DEFAULTS),this.setTargets(this.options.targets),0===this.targets.length&&this.layer&&this.addTargetLayer(this.layer),this.geoToleranceCache={}},setLayer:function(a){this.active?(this.deactivate(),this.layer=a,this.activate()):this.layer=a},setTargets:function(a){if(this.targets=[],a&&a.length)for(var b,c=0,d=a.length;d>c;++c)b=a[c],b instanceof OpenLayers.Layer.Vector?this.addTargetLayer(b):this.addTarget(b)},addTargetLayer:function(a){this.addTarget({layer:a})},addTarget:function(a){a=OpenLayers.Util.applyDefaults(a,this.defaults),a.nodeTolerance=a.nodeTolerance||a.tolerance,a.vertexTolerance=a.vertexTolerance||a.tolerance,a.edgeTolerance=a.edgeTolerance||a.tolerance,this.targets.push(a)},removeTargetLayer:function(a){for(var b,c=this.targets.length-1;c>=0;--c)b=this.targets[c],b.layer===a&&this.removeTarget(b)},removeTarget:function(a){return OpenLayers.Util.removeItem(this.targets,a)},activate:function(){var a=OpenLayers.Control.prototype.activate.call(this);return a&&this.layer&&this.layer.events&&this.layer.events.on({sketchstarted:this.onSketchModified,sketchmodified:this.onSketchModified,vertexmodified:this.onVertexModified,scope:this}),a},deactivate:function(){var a=OpenLayers.Control.prototype.deactivate.call(this);return a&&this.layer&&this.layer.events&&this.layer.events.un({sketchstarted:this.onSketchModified,sketchmodified:this.onSketchModified,vertexmodified:this.onVertexModified,scope:this}),this.point=this.feature=null,a},onSketchModified:function(a){this.feature=a.feature,this.considerSnapping(a.vertex,a.vertex)},onVertexModified:function(a){this.feature=a.feature;var b=this.layer.map.getLonLatFromViewPortPx(a.pixel);this.considerSnapping(a.vertex,new OpenLayers.Geometry.Point(b.lon,b.lat))},considerSnapping:function(a,b){for(var c,d,e={rank:Number.POSITIVE_INFINITY,dist:Number.POSITIVE_INFINITY,x:null,y:null},f=!1,g=0,h=this.targets.length;h>g;++g)if(d=this.targets[g],c=this.testTarget(d,b)){if(this.greedy){e=c,e.target=d,f=!0;break}(c.rank<e.rank||c.rank===e.rank&&c.dist<e.dist)&&(e=c,e.target=d,f=!0)
}f&&(!1!==this.events.triggerEvent("beforesnap",{point:a,x:e.x,y:e.y,distance:e.dist,layer:e.target.layer,snapType:this.precedence[e.rank]})?(a.x=e.x,a.y=e.y,this.point=a,this.events.triggerEvent("snap",{point:a,snapType:this.precedence[e.rank],layer:e.target.layer,distance:e.dist})):f=!1),this.point&&!f&&(a.x=b.x,a.y=b.y,this.point=null,this.events.triggerEvent("unsnap",{point:a}))},testTarget:function(a,b){var c=this.layer.map.getResolution();if("minResolution"in a&&c<a.minResolution||"maxResolution"in a&&c>=a.maxResolution)return null;for(var d,e,f,g,h,i,c={node:this.getGeoTolerance(a.nodeTolerance,c),vertex:this.getGeoTolerance(a.vertexTolerance,c),edge:this.getGeoTolerance(a.edgeTolerance,c)},j=Math.max(c.node,c.vertex,c.edge),k={rank:Number.POSITIVE_INFINITY,dist:Number.POSITIVE_INFINITY},l=!1,m=a.layer.features,n=this.precedence.length,o=new OpenLayers.LonLat(b.x,b.y),p=0,q=m.length;q>p;++p)if(d=m[p],d!==this.feature&&!d._sketch&&d.state!==OpenLayers.State.DELETE&&(!a.filter||a.filter.evaluate(d))&&d.atPoint(o,j,j))for(var r=0,s=Math.min(k.rank+1,n);s>r;++r)if(e=this.precedence[r],a[e])if("edge"===e){if(f=d.geometry.distanceTo(b,{details:!0}),h=f.distance,h<=c[e]&&h<k.dist){k={rank:r,dist:h,x:f.x0,y:f.y0},l=!0;break}}else{f=d.geometry.getVertices("node"===e),i=!1;for(var t=0,u=f.length;u>t;++t)g=f[t],h=g.distanceTo(b),h<=c[e]&&(r<k.rank||r===k.rank&&h<k.dist)&&(k={rank:r,dist:h,x:g.x,y:g.y},i=l=!0);if(i)break}return l?k:null},getGeoTolerance:function(a,b){b!==this.resolution&&(this.resolution=b,this.geoToleranceCache={});var c=this.geoToleranceCache[a];return void 0===c&&(c=a*b,this.geoToleranceCache[a]=c),c},destroy:function(){this.active&&this.deactivate(),delete this.layer,delete this.targets,OpenLayers.Control.prototype.destroy.call(this)},CLASS_NAME:"OpenLayers.Control.Snapping"}),OpenLayers.Date={toISOString:function(){if("toISOString"in Date.prototype)return function(a){return a.toISOString()};var a=function(a,b){for(var c=a+"";c.length<b;)c="0"+c;return c};return function(b){return isNaN(b.getTime())?"Invalid Date":b.getUTCFullYear()+"-"+a(b.getUTCMonth()+1,2)+"-"+a(b.getUTCDate(),2)+"T"+a(b.getUTCHours(),2)+":"+a(b.getUTCMinutes(),2)+":"+a(b.getUTCSeconds(),2)+"."+a(b.getUTCMilliseconds(),3)+"Z"}}(),parse:function(a){var b;if((a=a.match(/^(?:(\d{4})(?:-(\d{2})(?:-(\d{2}))?)?)?(?:(?:T(\d{1,2}):(\d{2}):(\d{2}(?:\.\d+)?)(Z|(?:[+-]\d{1,2}(?::(\d{2}))?)))|Z)?$/))&&(a[1]||a[7])){b=parseInt(a[1],10)||0;var c=parseInt(a[2],10)-1||0,d=parseInt(a[3],10)||1;if(b=new Date(Date.UTC(b,c,d)),c=a[7]){var d=parseInt(a[4],10),e=parseInt(a[5],10),f=parseFloat(a[6]),g=0|f,f=Math.round(1e3*(f-g));b.setUTCHours(d,e,g,f),"Z"!==c&&(c=parseInt(c,10),a=parseInt(a[8],10)||0,b=new Date(b.getTime()+-1e3*(3600*c+60*a)))}}else b=new Date("invalid");return b}},function(){function a(){this._object=f&&!i?new f:new window.ActiveXObject("Microsoft.XMLHTTP"),this._listeners=[]}function b(){return new a}function c(a){b.onreadystatechange&&b.onreadystatechange.apply(a),a.dispatchEvent({type:"readystatechange",bubbles:!1,cancelable:!1,timeStamp:new Date+0})}function d(a){try{a.responseText=a._object.responseText}catch(b){}try{var c,d=a._object,e=d.responseXML,f=d.responseText;h&&f&&e&&!e.documentElement&&d.getResponseHeader("Content-Type").match(/[^\/]+\/[^\+]+\+xml/)&&(e=new window.ActiveXObject("Microsoft.XMLDOM"),e.async=!1,e.validateOnParse=!1,e.loadXML(f)),c=e&&(h&&0!=e.parseError||!e.documentElement||e.documentElement&&"parsererror"==e.documentElement.tagName)?null:e,a.responseXML=c}catch(g){}try{a.status=a._object.status}catch(i){}try{a.statusText=a._object.statusText}catch(j){}}function e(a){a._object.onreadystatechange=new window.Function}var f=window.XMLHttpRequest,g=!!window.controllers,h=window.document.all&&!window.opera,i=h&&window.navigator.userAgent.match(/MSIE 7.0/);b.prototype=a.prototype,g&&f.wrapped&&(b.wrapped=f.wrapped),b.UNSENT=0,b.OPENED=1,b.HEADERS_RECEIVED=2,b.LOADING=3,b.DONE=4,b.prototype.readyState=b.UNSENT,b.prototype.responseText="",b.prototype.responseXML=null,b.prototype.status=0,b.prototype.statusText="",b.prototype.priority="NORMAL",b.prototype.onreadystatechange=null,b.onreadystatechange=null,b.onopen=null,b.onsend=null,b.onabort=null,b.prototype.open=function(a,f,i,j,k){delete this._headers,arguments.length<3&&(i=!0),this._async=i;var l,m=this,n=this.readyState;h&&i&&(l=function(){n!=b.DONE&&(e(m),m.abort())},window.attachEvent("onunload",l)),b.onopen&&b.onopen.apply(this,arguments),arguments.length>4?this._object.open(a,f,i,j,k):arguments.length>3?this._object.open(a,f,i,j):this._object.open(a,f,i),this.readyState=b.OPENED,c(this),this._object.onreadystatechange=function(){(!g||i)&&(m.readyState=m._object.readyState,d(m),m._aborted?m.readyState=b.UNSENT:(m.readyState==b.DONE&&(delete m._data,e(m),h&&i&&window.detachEvent("onunload",l)),n!=m.readyState&&c(m),n=m.readyState))}},b.prototype.send=function(a){b.onsend&&b.onsend.apply(this,arguments),arguments.length||(a=null),a&&a.nodeType&&(a=window.XMLSerializer?(new window.XMLSerializer).serializeToString(a):a.xml,this._headers["Content-Type"]||this._object.setRequestHeader("Content-Type","application/xml")),this._data=a;a:if(this._object.send(this._data),g&&!this._async)for(this.readyState=b.OPENED,d(this);this.readyState<b.DONE;)if(this.readyState++,c(this),this._aborted)break a},b.prototype.abort=function(){b.onabort&&b.onabort.apply(this,arguments),this.readyState>b.UNSENT&&(this._aborted=!0),this._object.abort(),e(this),this.readyState=b.UNSENT,delete this._data},b.prototype.getAllResponseHeaders=function(){return this._object.getAllResponseHeaders()},b.prototype.getResponseHeader=function(a){return this._object.getResponseHeader(a)},b.prototype.setRequestHeader=function(a,b){return this._headers||(this._headers={}),this._headers[a]=b,this._object.setRequestHeader(a,b)},b.prototype.addEventListener=function(a,b,c){for(var d,e=0;d=this._listeners[e];e++)if(d[0]==a&&d[1]==b&&d[2]==c)return;this._listeners.push([a,b,c])},b.prototype.removeEventListener=function(a,b,c){for(var d,e=0;(d=this._listeners[e])&&(d[0]!=a||d[1]!=b||d[2]!=c);e++);d&&this._listeners.splice(e,1)},b.prototype.dispatchEvent=function(a){a={type:a.type,target:this,currentTarget:this,eventPhase:2,bubbles:a.bubbles,cancelable:a.cancelable,timeStamp:a.timeStamp,stopPropagation:function(){},preventDefault:function(){},initEvent:function(){}},"readystatechange"==a.type&&this.onreadystatechange&&(this.onreadystatechange.handleEvent||this.onreadystatechange).apply(this,[a]);for(var b,c=0;b=this._listeners[c];c++)b[0]==a.type&&!b[2]&&(b[1].handleEvent||b[1]).apply(this,[a])},b.prototype.toString=function(){return"[object XMLHttpRequest]"},b.toString=function(){return"[XMLHttpRequest]"},window.Function.prototype.apply||(window.Function.prototype.apply=function(a,b){b||(b=[]),a.__func=this,a.__func(b[0],b[1],b[2],b[3],b[4]),delete a.__func}),OpenLayers.Request.XMLHttpRequest=b}(),OpenLayers.Format.KML=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{kml:"http://www.opengis.net/kml/2.2",gx:"http://www.google.com/kml/ext/2.2"},kmlns:"http://earth.google.com/kml/2.0",placemarksDesc:"No description available",foldersName:"OpenLayers export",foldersDesc:"Exported on "+new Date,extractAttributes:!0,kvpAttributes:!1,extractStyles:!1,extractTracks:!1,trackAttributes:null,internalns:null,features:null,styles:null,styleBaseUrl:"",fetched:null,maxDepth:0,initialize:function(a){this.regExes={trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g,kmlColor:/(\w{2})(\w{2})(\w{2})(\w{2})/,kmlIconPalette:/root:\/\/icons\/palette-(\d+)(\.\w+)/,straightBracket:/\$\[(.*?)\]/g},this.externalProjection=new OpenLayers.Projection("EPSG:4326"),OpenLayers.Format.XML.prototype.initialize.apply(this,[a])},read:function(a){return this.features=[],this.styles={},this.fetched={},this.parseData(a,{depth:0,styleBaseUrl:this.styleBaseUrl})},parseData:function(a,b){"string"==typeof a&&(a=OpenLayers.Format.XML.prototype.read.apply(this,[a]));for(var c=["Link","NetworkLink","Style","StyleMap","Placemark"],d=0,e=c.length;e>d;++d){var f=c[d],g=this.getElementsByTagNameNS(a,"*",f);if(0!=g.length)switch(f.toLowerCase()){case"link":case"networklink":this.parseLinks(g,b);break;case"style":this.extractStyles&&this.parseStyles(g,b);break;case"stylemap":this.extractStyles&&this.parseStyleMaps(g,b);break;case"placemark":this.parseFeatures(g,b)}}return this.features},parseLinks:function(a,b){if(b.depth>=this.maxDepth)return!1;var c=OpenLayers.Util.extend({},b);c.depth++;for(var d=0,e=a.length;e>d;d++){var f=this.parseProperty(a[d],"*","href");f&&!this.fetched[f]&&(this.fetched[f]=!0,(f=this.fetchLink(f))&&this.parseData(f,c))}},fetchLink:function(a){return(a=OpenLayers.Request.GET({url:a,async:!1}))?a.responseText:void 0},parseStyles:function(a,b){for(var c=0,d=a.length;d>c;c++){var e=this.parseStyle(a[c]);e&&(this.styles[(b.styleBaseUrl||"")+"#"+e.id]=e)}},parseKmlColor:function(a){var b=null;return a&&(a=a.match(this.regExes.kmlColor))&&(b={color:"#"+a[4]+a[3]+a[2],opacity:parseInt(a[1],16)/255}),b},parseStyle:function(a){for(var b,c,d={},e=["LineStyle","PolyStyle","IconStyle","BalloonStyle","LabelStyle"],f=0,g=e.length;g>f;++f)if(b=e[f],c=this.getElementsByTagNameNS(a,"*",b)[0])switch(b.toLowerCase()){case"linestyle":b=this.parseProperty(c,"*","color"),(b=this.parseKmlColor(b))&&(d.strokeColor=b.color,d.strokeOpacity=b.opacity),(b=this.parseProperty(c,"*","width"))&&(d.strokeWidth=b);break;case"polystyle":b=this.parseProperty(c,"*","color"),(b=this.parseKmlColor(b))&&(d.fillOpacity=b.opacity,d.fillColor=b.color),"0"==this.parseProperty(c,"*","fill")&&(d.fillColor="none"),"0"==this.parseProperty(c,"*","outline")&&(d.strokeWidth="0");break;case"iconstyle":var h=parseFloat(this.parseProperty(c,"*","scale")||1);b=32*h;var i=32*h,j=this.getElementsByTagNameNS(c,"*","Icon")[0];if(j){var k=this.parseProperty(j,"*","href");if(k){var l=this.parseProperty(j,"*","w"),m=this.parseProperty(j,"*","h");OpenLayers.String.startsWith(k,"http://maps.google.com/mapfiles/kml")&&!l&&!m&&(m=l=64,h/=2),l=l||m,m=m||l,l&&(b=parseInt(l)*h),m&&(i=parseInt(m)*h),(m=k.match(this.regExes.kmlIconPalette))&&(l=m[1],m=m[2],k=this.parseProperty(j,"*","x"),j=this.parseProperty(j,"*","y"),k="http://maps.google.com/mapfiles/kml/pal"+l+"/icon"+(8*(j?7-j/32:7)+(k?k/32:0))+m),d.graphicOpacity=1,d.externalGraphic=k}}(c=this.getElementsByTagNameNS(c,"*","hotSpot")[0])&&(k=parseFloat(c.getAttribute("x")),j=parseFloat(c.getAttribute("y")),l=c.getAttribute("xunits"),"pixels"==l?d.graphicXOffset=-k*h:"insetPixels"==l?d.graphicXOffset=-b+k*h:"fraction"==l&&(d.graphicXOffset=-b*k),c=c.getAttribute("yunits"),"pixels"==c?d.graphicYOffset=-i+j*h+1:"insetPixels"==c?d.graphicYOffset=-(j*h)+1:"fraction"==c&&(d.graphicYOffset=-i*(1-j)+1)),d.graphicWidth=b,d.graphicHeight=i;break;case"balloonstyle":(c=OpenLayers.Util.getXmlNodeValue(c))&&(d.balloonStyle=c.replace(this.regExes.straightBracket,"${$1}"));break;case"labelstyle":b=this.parseProperty(c,"*","color"),(b=this.parseKmlColor(b))&&(d.fontColor=b.color,d.fontOpacity=b.opacity)}return!d.strokeColor&&d.fillColor&&(d.strokeColor=d.fillColor),(a=a.getAttribute("id"))&&d&&(d.id=a),d},parseStyleMaps:function(a,b){for(var c=0,d=a.length;d>c;c++)for(var e=a[c],f=this.getElementsByTagNameNS(e,"*","Pair"),e=e.getAttribute("id"),g=0,h=f.length;h>g;g++){var i=f[g],j=this.parseProperty(i,"*","key");(i=this.parseProperty(i,"*","styleUrl"))&&"normal"==j&&(this.styles[(b.styleBaseUrl||"")+"#"+e]=this.styles[(b.styleBaseUrl||"")+i])}},parseFeatures:function(a,b){for(var c=[],d=0,e=a.length;e>d;d++){var f=a[d],g=this.parseFeature.apply(this,[f]);if(!g)throw"Bad Placemark: "+d;if(this.extractStyles&&g.attributes&&g.attributes.styleUrl&&(g.style=this.getStyle(g.attributes.styleUrl,b)),this.extractStyles){var h=this.getElementsByTagNameNS(f,"*","Style")[0];h&&(h=this.parseStyle(h))&&(g.style=OpenLayers.Util.extend(g.style,h))}this.extractTracks?(f=this.getElementsByTagNameNS(f,this.namespaces.gx,"Track"))&&0<f.length&&(g={features:[],feature:g},this.readNode(f[0],g),0<g.features.length&&c.push.apply(c,g.features)):c.push(g)}this.features=this.features.concat(c)},readers:{kml:{when:function(a,b){b.whens.push(OpenLayers.Date.parse(this.getChildValue(a)))},_trackPointAttribute:function(a,b){var c=a.nodeName.split(":").pop();b.attributes[c].push(this.getChildValue(a))}},gx:{Track:function(a,b){var c={whens:[],points:[],angles:[]};if(this.trackAttributes){var d;c.attributes={};for(var e=0,f=this.trackAttributes.length;f>e;++e)d=this.trackAttributes[e],c.attributes[d]=[],d in this.readers.kml||(this.readers.kml[d]=this.readers.kml._trackPointAttribute)}if(this.readChildNodes(a,c),c.whens.length!==c.points.length)throw Error("gx:Track with unequal number of when ("+c.whens.length+") and gx:coord ("+c.points.length+") elements.");var g=0<c.angles.length;if(g&&c.whens.length!==c.angles.length)throw Error("gx:Track with unequal number of when ("+c.whens.length+") and gx:angles ("+c.angles.length+") elements.");for(var h,i,e=0,f=c.whens.length;f>e;++e){if(h=b.feature.clone(),h.fid=b.feature.fid||b.feature.id,i=c.points[e],h.geometry=i,"z"in i&&(h.attributes.altitude=i.z),this.internalProjection&&this.externalProjection&&h.geometry.transform(this.externalProjection,this.internalProjection),this.trackAttributes){i=0;for(var j=this.trackAttributes.length;j>i;++i)h.attributes[d]=c.attributes[this.trackAttributes[i]][e]}h.attributes.when=c.whens[e],h.attributes.trackId=b.feature.id,g&&(i=c.angles[e],h.attributes.heading=parseFloat(i[0]),h.attributes.tilt=parseFloat(i[1]),h.attributes.roll=parseFloat(i[2])),b.features.push(h)}},coord:function(a,b){var c=this.getChildValue(a).replace(this.regExes.trimSpace,"").split(/\s+/),d=new OpenLayers.Geometry.Point(c[0],c[1]);2<c.length&&(d.z=parseFloat(c[2])),b.points.push(d)},angles:function(a,b){var c=this.getChildValue(a).replace(this.regExes.trimSpace,"").split(/\s+/);b.angles.push(c)}}},parseFeature:function(a){for(var b,c,d,e=["MultiGeometry","Polygon","LineString","Point"],f=0,g=e.length;g>f;++f)if(b=e[f],this.internalns=a.namespaceURI?a.namespaceURI:this.kmlns,c=this.getElementsByTagNameNS(a,this.internalns,b),0<c.length){if(!(e=this.parseGeometry[b.toLowerCase()]))throw new TypeError("Unsupported geometry type: "+b);d=e.apply(this,[c[0]]),this.internalProjection&&this.externalProjection&&d.transform(this.externalProjection,this.internalProjection);break}var h;return this.extractAttributes&&(h=this.parseAttributes(a)),b=new OpenLayers.Feature.Vector(d,h),a=a.getAttribute("id")||a.getAttribute("name"),null!=a&&(b.fid=a),b},getStyle:function(a,b){var c=OpenLayers.Util.removeTail(a),d=OpenLayers.Util.extend({},b);return d.depth++,d.styleBaseUrl=c,!this.styles[a]&&!OpenLayers.String.startsWith(a,"#")&&d.depth<=this.maxDepth&&!this.fetched[c]&&(c=this.fetchLink(c))&&this.parseData(c,d),OpenLayers.Util.extend({},this.styles[a])},parseGeometry:{point:function(a){var b=this.getElementsByTagNameNS(a,this.internalns,"coordinates"),a=[];if(0<b.length)var c=b[0].firstChild.nodeValue,c=c.replace(this.regExes.removeSpace,""),a=c.split(",");if(b=null,!(1<a.length))throw"Bad coordinate string: "+c;return 2==a.length&&(a[2]=null),b=new OpenLayers.Geometry.Point(a[0],a[1],a[2])},linestring:function(a,b){var c=this.getElementsByTagNameNS(a,this.internalns,"coordinates"),d=null;if(0<c.length){for(var e,f,c=this.getChildValue(c[0]),c=c.replace(this.regExes.trimSpace,""),c=c.replace(this.regExes.trimComma,","),d=c.split(this.regExes.splitSpace),g=d.length,h=Array(g),i=0;g>i;++i){if(e=d[i].split(","),f=e.length,!(f>1))throw"Bad LineString point coordinates: "+d[i];2==e.length&&(e[2]=null),h[i]=new OpenLayers.Geometry.Point(e[0],e[1],e[2])}if(!g)throw"Bad LineString coordinates: "+c;d=b?new OpenLayers.Geometry.LinearRing(h):new OpenLayers.Geometry.LineString(h)}return d},polygon:function(a){var a=this.getElementsByTagNameNS(a,this.internalns,"LinearRing"),b=a.length,c=Array(b);if(b>0)for(var d=0,e=a.length;e>d;++d){if(!(b=this.parseGeometry.linestring.apply(this,[a[d],!0])))throw"Bad LinearRing geometry: "+d;c[d]=b}return new OpenLayers.Geometry.Polygon(c)},multigeometry:function(a){for(var b,c=[],d=a.childNodes,e=0,f=d.length;f>e;++e)a=d[e],1==a.nodeType&&(b=this.parseGeometry[(a.prefix?a.nodeName.split(":")[1]:a.nodeName).toLowerCase()])&&c.push(b.apply(this,[a]));return new OpenLayers.Geometry.Collection(c)}},parseAttributes:function(a){var b={},c=a.getElementsByTagName("ExtendedData");c.length&&(b=this.parseExtendedData(c[0]));for(var d,e,f,a=a.childNodes,c=0,g=a.length;g>c;++c)if(d=a[c],1==d.nodeType&&(e=d.childNodes,1<=e.length&&3>=e.length)){switch(e.length){case 1:f=e[0];break;case 2:f=e[0],e=e[1],f=3==f.nodeType||4==f.nodeType?f:e;break;default:f=e[1]}(3==f.nodeType||4==f.nodeType)&&(d=d.prefix?d.nodeName.split(":")[1]:d.nodeName,(f=OpenLayers.Util.getXmlNodeValue(f))&&(f=f.replace(this.regExes.trimSpace,""),b[d]=f))}return b},parseExtendedData:function(a){var b,c,d,e,f={},g=a.getElementsByTagName("Data");for(b=0,c=g.length;c>b;b++){d=g[b],e=d.getAttribute("name");var h={},i=d.getElementsByTagName("value");i.length&&(h.value=this.getChildValue(i[0])),this.kvpAttributes?f[e]=h.value:(d=d.getElementsByTagName("displayName"),d.length&&(h.displayName=this.getChildValue(d[0])),f[e]=h)}for(a=a.getElementsByTagName("SimpleData"),b=0,c=a.length;c>b;b++)h={},d=a[b],e=d.getAttribute("name"),h.value=this.getChildValue(d),this.kvpAttributes?f[e]=h.value:(h.displayName=e,f[e]=h);return f},parseProperty:function(a,b,c){var d,a=this.getElementsByTagNameNS(a,b,c);try{d=OpenLayers.Util.getXmlNodeValue(a[0])}catch(e){d=null}return d},write:function(a){OpenLayers.Util.isArray(a)||(a=[a]);for(var b=this.createElementNS(this.kmlns,"kml"),c=this.createFolderXML(),d=0,e=a.length;e>d;++d)c.appendChild(this.createPlacemarkXML(a[d]));return b.appendChild(c),OpenLayers.Format.XML.prototype.write.apply(this,[b])},createFolderXML:function(){var a=this.createElementNS(this.kmlns,"Folder");if(this.foldersName){var b=this.createElementNS(this.kmlns,"name"),c=this.createTextNode(this.foldersName);b.appendChild(c),a.appendChild(b)}return this.foldersDesc&&(b=this.createElementNS(this.kmlns,"description"),c=this.createTextNode(this.foldersDesc),b.appendChild(c),a.appendChild(b)),a},createPlacemarkXML:function(a){var b=this.createElementNS(this.kmlns,"name");b.appendChild(this.createTextNode(a.style&&a.style.label?a.style.label:a.attributes.name||a.id));var c=this.createElementNS(this.kmlns,"description");c.appendChild(this.createTextNode(a.attributes.description||this.placemarksDesc));var d=this.createElementNS(this.kmlns,"Placemark");return null!=a.fid&&d.setAttribute("id",a.fid),d.appendChild(b),d.appendChild(c),b=this.buildGeometryNode(a.geometry),d.appendChild(b),a.attributes&&(a=this.buildExtendedData(a.attributes))&&d.appendChild(a),d},buildGeometryNode:function(a){var b=a.CLASS_NAME,b=this.buildGeometry[b.substring(b.lastIndexOf(".")+1).toLowerCase()],c=null;return b&&(c=b.apply(this,[a])),c},buildGeometry:{point:function(a){var b=this.createElementNS(this.kmlns,"Point");return b.appendChild(this.buildCoordinatesNode(a)),b},multipoint:function(a){return this.buildGeometry.collection.apply(this,[a])},linestring:function(a){var b=this.createElementNS(this.kmlns,"LineString");return b.appendChild(this.buildCoordinatesNode(a)),b},multilinestring:function(a){return this.buildGeometry.collection.apply(this,[a])},linearring:function(a){var b=this.createElementNS(this.kmlns,"LinearRing");return b.appendChild(this.buildCoordinatesNode(a)),b},polygon:function(a){for(var b,c,d=this.createElementNS(this.kmlns,"Polygon"),a=a.components,e=0,f=a.length;f>e;++e)b=0==e?"outerBoundaryIs":"innerBoundaryIs",b=this.createElementNS(this.kmlns,b),c=this.buildGeometry.linearring.apply(this,[a[e]]),b.appendChild(c),d.appendChild(b);return d},multipolygon:function(a){return this.buildGeometry.collection.apply(this,[a])},collection:function(a){for(var b,c=this.createElementNS(this.kmlns,"MultiGeometry"),d=0,e=a.components.length;e>d;++d)(b=this.buildGeometryNode.apply(this,[a.components[d]]))&&c.appendChild(b);return c}},buildCoordinatesNode:function(a){var b,c=this.createElementNS(this.kmlns,"coordinates");if(b=a.components){for(var d=b.length,e=Array(d),f=0;d>f;++f)a=b[f],e[f]=this.buildCoordinates(a);b=e.join(" ")}else b=this.buildCoordinates(a);return b=this.createTextNode(b),c.appendChild(b),c},buildCoordinates:function(a){return this.internalProjection&&this.externalProjection&&(a=a.clone(),a.transform(this.internalProjection,this.externalProjection)),a.x+","+a.y},buildExtendedData:function(a){var b,c=this.createElementNS(this.kmlns,"ExtendedData");for(b in a)if(a[b]&&"name"!=b&&"description"!=b&&"styleUrl"!=b){var d=this.createElementNS(this.kmlns,"Data");d.setAttribute("name",b);var e=this.createElementNS(this.kmlns,"value");if("object"==typeof a[b]){if(a[b].value&&e.appendChild(this.createTextNode(a[b].value)),a[b].displayName){var f=this.createElementNS(this.kmlns,"displayName");f.appendChild(this.getXMLDoc().createCDATASection(a[b].displayName)),d.appendChild(f)}}else e.appendChild(this.createTextNode(a[b]));d.appendChild(e),c.appendChild(d)}return this.isSimpleContent(c)?null:c},CLASS_NAME:"OpenLayers.Format.KML"}),OpenLayers.Popup=OpenLayers.Class({events:null,id:"",lonlat:null,div:null,contentSize:null,size:null,contentHTML:null,backgroundColor:"",opacity:"",border:"",contentDiv:null,groupDiv:null,closeDiv:null,autoSize:!1,minSize:null,maxSize:null,displayClass:"olPopup",contentDisplayClass:"olPopupContent",padding:0,disableFirefoxOverflowHack:!1,fixPadding:function(){"number"==typeof this.padding&&(this.padding=new OpenLayers.Bounds(this.padding,this.padding,this.padding,this.padding))},panMapIfOutOfView:!1,keepInMap:!1,closeOnMove:!1,map:null,initialize:function(a,b,c,d,e,f){null==a&&(a=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")),this.id=a,this.lonlat=b,this.contentSize=null!=c?c:new OpenLayers.Size(OpenLayers.Popup.WIDTH,OpenLayers.Popup.HEIGHT),null!=d&&(this.contentHTML=d),this.backgroundColor=OpenLayers.Popup.COLOR,this.opacity=OpenLayers.Popup.OPACITY,this.border=OpenLayers.Popup.BORDER,this.div=OpenLayers.Util.createDiv(this.id,null,null,null,null,null,"hidden"),this.div.className=this.displayClass,this.groupDiv=OpenLayers.Util.createDiv(this.id+"_GroupDiv",null,null,null,"relative",null,"hidden"),a=this.div.id+"_contentDiv",this.contentDiv=OpenLayers.Util.createDiv(a,null,this.contentSize.clone(),null,"relative"),this.contentDiv.className=this.contentDisplayClass,this.groupDiv.appendChild(this.contentDiv),this.div.appendChild(this.groupDiv),e&&this.addCloseBox(f),this.registerEvents()},destroy:function(){this.border=this.opacity=this.backgroundColor=this.contentHTML=this.size=this.lonlat=this.id=null,this.closeOnMove&&this.map&&this.map.events.unregister("movestart",this,this.hide),this.events.destroy(),this.events=null,this.closeDiv&&(OpenLayers.Event.stopObservingElement(this.closeDiv),this.groupDiv.removeChild(this.closeDiv)),this.closeDiv=null,this.div.removeChild(this.groupDiv),this.groupDiv=null,null!=this.map&&this.map.removePopup(this),this.panMapIfOutOfView=this.padding=this.maxSize=this.minSize=this.autoSize=this.div=this.map=null},draw:function(a){return null==a&&null!=this.lonlat&&null!=this.map&&(a=this.map.getLayerPxFromLonLat(this.lonlat)),this.closeOnMove&&this.map.events.register("movestart",this,this.hide),!this.disableFirefoxOverflowHack&&"firefox"==OpenLayers.BROWSER_NAME&&(this.map.events.register("movestart",this,function(){var a=document.defaultView.getComputedStyle(this.contentDiv,null).getPropertyValue("overflow");"hidden"!=a&&(this.contentDiv._oldOverflow=a,this.contentDiv.style.overflow="hidden")}),this.map.events.register("moveend",this,function(){var a=this.contentDiv._oldOverflow;a&&(this.contentDiv.style.overflow=a,this.contentDiv._oldOverflow=null)})),this.moveTo(a),!this.autoSize&&!this.size&&this.setSize(this.contentSize),this.setBackgroundColor(),this.setOpacity(),this.setBorder(),this.setContentHTML(),this.panMapIfOutOfView&&this.panIntoView(),this.div},updatePosition:function(){if(this.lonlat&&this.map){var a=this.map.getLayerPxFromLonLat(this.lonlat);a&&this.moveTo(a)}},moveTo:function(a){null!=a&&null!=this.div&&(this.div.style.left=a.x+"px",this.div.style.top=a.y+"px")},visible:function(){return OpenLayers.Element.visible(this.div)},toggle:function(){this.visible()?this.hide():this.show()},show:function(){this.div.style.display="",this.panMapIfOutOfView&&this.panIntoView()},hide:function(){this.div.style.display="none"},setSize:function(a){this.size=a.clone();var b=this.getContentDivPadding(),c=b.left+b.right,d=b.top+b.bottom;if(this.fixPadding(),c+=this.padding.left+this.padding.right,d+=this.padding.top+this.padding.bottom,this.closeDiv)var e=parseInt(this.closeDiv.style.width),c=c+(e+b.right);this.size.w+=c,this.size.h+=d,"msie"==OpenLayers.BROWSER_NAME&&(this.contentSize.w+=b.left+b.right,this.contentSize.h+=b.bottom+b.top),null!=this.div&&(this.div.style.width=this.size.w+"px",this.div.style.height=this.size.h+"px"),null!=this.contentDiv&&(this.contentDiv.style.width=a.w+"px",this.contentDiv.style.height=a.h+"px")},updateSize:function(){var a="<div class='"+this.contentDisplayClass+"'>"+this.contentDiv.innerHTML+"</div>",b=this.map?this.map.div:document.body,c=OpenLayers.Util.getRenderedDimensions(a,null,{displayClass:this.displayClass,containerElement:b}),d=this.getSafeContentSize(c),e=null;d.equals(c)?e=c:(c={w:d.w<c.w?d.w:null,h:d.h<c.h?d.h:null},c.w&&c.h?e=d:(a=OpenLayers.Util.getRenderedDimensions(a,c,{displayClass:this.contentDisplayClass,containerElement:b}),"hidden"!=OpenLayers.Element.getStyle(this.contentDiv,"overflow")&&a.equals(d)&&(d=OpenLayers.Util.getScrollbarWidth(),c.w?a.h+=d:a.w+=d),e=this.getSafeContentSize(a))),this.setSize(e)},setBackgroundColor:function(a){void 0!=a&&(this.backgroundColor=a),null!=this.div&&(this.div.style.backgroundColor=this.backgroundColor)},setOpacity:function(a){void 0!=a&&(this.opacity=a),null!=this.div&&(this.div.style.opacity=this.opacity,this.div.style.filter="alpha(opacity="+100*this.opacity+")")},setBorder:function(a){void 0!=a&&(this.border=a),null!=this.div&&(this.div.style.border=this.border)},setContentHTML:function(a){null!=a&&(this.contentHTML=a),null!=this.contentDiv&&null!=this.contentHTML&&this.contentHTML!=this.contentDiv.innerHTML&&(this.contentDiv.innerHTML=this.contentHTML,this.autoSize&&(this.registerImageListeners(),this.updateSize()))},registerImageListeners:function(){for(var a=function(){null!==this.popup.id&&(this.popup.updateSize(),this.popup.visible()&&this.popup.panMapIfOutOfView&&this.popup.panIntoView(),OpenLayers.Event.stopObserving(this.img,"load",this.img._onImageLoad))},b=this.contentDiv.getElementsByTagName("img"),c=0,d=b.length;d>c;c++){var e=b[c];(0==e.width||0==e.height)&&(e._onImgLoad=OpenLayers.Function.bind(a,{popup:this,img:e}),OpenLayers.Event.observe(e,"load",e._onImgLoad))}},getSafeContentSize:function(a){var a=a.clone(),b=this.getContentDivPadding(),c=b.left+b.right,d=b.top+b.bottom;if(this.fixPadding(),c+=this.padding.left+this.padding.right,d+=this.padding.top+this.padding.bottom,this.closeDiv)var e=parseInt(this.closeDiv.style.width),c=c+(e+b.right);if(this.minSize&&(a.w=Math.max(a.w,this.minSize.w-c),a.h=Math.max(a.h,this.minSize.h-d)),this.maxSize&&(a.w=Math.min(a.w,this.maxSize.w-c),a.h=Math.min(a.h,this.maxSize.h-d)),this.map&&this.map.size){if(e=b=0,this.keepInMap&&!this.panMapIfOutOfView)switch(e=this.map.getPixelFromLonLat(this.lonlat),this.relativePosition){case"tr":b=e.x,e=this.map.size.h-e.y;break;case"tl":b=this.map.size.w-e.x,e=this.map.size.h-e.y;break;case"bl":b=this.map.size.w-e.x,e=e.y;break;case"br":b=e.x,e=e.y;break;default:b=e.x,e=this.map.size.h-e.y}d=this.map.size.h-this.map.paddingForPopups.top-this.map.paddingForPopups.bottom-d-e,a.w=Math.min(a.w,this.map.size.w-this.map.paddingForPopups.left-this.map.paddingForPopups.right-c-b),a.h=Math.min(a.h,d)}return a},getContentDivPadding:function(){var a=this._contentDivPadding;return a||(null==this.div.parentNode&&(this.div.style.display="none",document.body.appendChild(this.div)),this._contentDivPadding=a=new OpenLayers.Bounds(OpenLayers.Element.getStyle(this.contentDiv,"padding-left"),OpenLayers.Element.getStyle(this.contentDiv,"padding-bottom"),OpenLayers.Element.getStyle(this.contentDiv,"padding-right"),OpenLayers.Element.getStyle(this.contentDiv,"padding-top")),this.div.parentNode!=document.body)||(document.body.removeChild(this.div),this.div.style.display=""),a},addCloseBox:function(a){this.closeDiv=OpenLayers.Util.createDiv(this.id+"_close",null,{w:17,h:17}),this.closeDiv.className="olPopupCloseBox";var b=this.getContentDivPadding();this.closeDiv.style.right=b.right+"px",this.closeDiv.style.top=b.top+"px",this.groupDiv.appendChild(this.closeDiv),a=a||function(a){this.hide(),OpenLayers.Event.stop(a)},OpenLayers.Event.observe(this.closeDiv,"touchend",OpenLayers.Function.bindAsEventListener(a,this)),OpenLayers.Event.observe(this.closeDiv,"click",OpenLayers.Function.bindAsEventListener(a,this))},panIntoView:function(){var a=this.map.getSize(),b=this.map.getViewPortPxFromLayerPx(new OpenLayers.Pixel(parseInt(this.div.style.left),parseInt(this.div.style.top))),c=b.clone();b.x<this.map.paddingForPopups.left?c.x=this.map.paddingForPopups.left:b.x+this.size.w>a.w-this.map.paddingForPopups.right&&(c.x=a.w-this.map.paddingForPopups.right-this.size.w),b.y<this.map.paddingForPopups.top?c.y=this.map.paddingForPopups.top:b.y+this.size.h>a.h-this.map.paddingForPopups.bottom&&(c.y=a.h-this.map.paddingForPopups.bottom-this.size.h),this.map.pan(b.x-c.x,b.y-c.y)},registerEvents:function(){this.events=new OpenLayers.Events(this,this.div,null,!0),this.events.on({mousedown:this.onmousedown,mousemove:this.onmousemove,mouseup:this.onmouseup,click:this.onclick,mouseout:this.onmouseout,dblclick:this.ondblclick,touchstart:function(a){OpenLayers.Event.stop(a,!0)},scope:this})},onmousedown:function(a){this.mousedown=!0,OpenLayers.Event.stop(a,!0)},onmousemove:function(a){this.mousedown&&OpenLayers.Event.stop(a,!0)},onmouseup:function(a){this.mousedown&&(this.mousedown=!1,OpenLayers.Event.stop(a,!0))},onclick:function(a){OpenLayers.Event.stop(a,!0)},onmouseout:function(){this.mousedown=!1},ondblclick:function(a){OpenLayers.Event.stop(a,!0)},CLASS_NAME:"OpenLayers.Popup"}),OpenLayers.Popup.WIDTH=200,OpenLayers.Popup.HEIGHT=200,OpenLayers.Popup.COLOR="white",OpenLayers.Popup.OPACITY=1,OpenLayers.Popup.BORDER="0px",OpenLayers.Popup.Anchored=OpenLayers.Class(OpenLayers.Popup,{relativePosition:null,keepInMap:!0,anchor:null,initialize:function(a,b,c,d,e,f,g){OpenLayers.Popup.prototype.initialize.apply(this,[a,b,c,d,f,g]),this.anchor=null!=e?e:{size:new OpenLayers.Size(0,0),offset:new OpenLayers.Pixel(0,0)}},destroy:function(){this.relativePosition=this.anchor=null,OpenLayers.Popup.prototype.destroy.apply(this,arguments)},show:function(){this.updatePosition(),OpenLayers.Popup.prototype.show.apply(this,arguments)},moveTo:function(a){var b=this.relativePosition;this.relativePosition=this.calculateRelativePosition(a),a=this.calculateNewPx(a),OpenLayers.Popup.prototype.moveTo.apply(this,Array(a)),this.relativePosition!=b&&this.updateRelativePosition()},setSize:function(){OpenLayers.Popup.prototype.setSize.apply(this,arguments),this.lonlat&&this.map&&this.moveTo(this.map.getLayerPxFromLonLat(this.lonlat))},calculateRelativePosition:function(a){return a=this.map.getLonLatFromLayerPx(a),a=this.map.getExtent().determineQuadrant(a),OpenLayers.Bounds.oppositeQuadrant(a)},updateRelativePosition:function(){},calculateNewPx:function(a){var a=a.offset(this.anchor.offset),b=this.size||this.contentSize,c="t"==this.relativePosition.charAt(0);return a.y+=c?-b.h:this.anchor.size.h,c="l"==this.relativePosition.charAt(1),a.x+=c?-b.w:this.anchor.size.w,a},CLASS_NAME:"OpenLayers.Popup.Anchored"}),OpenLayers.Console.warn("OpenLayers.Rico is deprecated"),OpenLayers.Rico=OpenLayers.Rico||{},OpenLayers.Rico.Color=OpenLayers.Class({initialize:function(a,b,c){this.rgb={r:a,g:b,b:c}
},setRed:function(a){this.rgb.r=a},setGreen:function(a){this.rgb.g=a},setBlue:function(a){this.rgb.b=a},setHue:function(a){var b=this.asHSB();b.h=a,this.rgb=OpenLayers.Rico.Color.HSBtoRGB(b.h,b.s,b.b)},setSaturation:function(a){var b=this.asHSB();b.s=a,this.rgb=OpenLayers.Rico.Color.HSBtoRGB(b.h,b.s,b.b)},setBrightness:function(a){var b=this.asHSB();b.b=a,this.rgb=OpenLayers.Rico.Color.HSBtoRGB(b.h,b.s,b.b)},darken:function(a){var b=this.asHSB();this.rgb=OpenLayers.Rico.Color.HSBtoRGB(b.h,b.s,Math.max(b.b-a,0))},brighten:function(a){var b=this.asHSB();this.rgb=OpenLayers.Rico.Color.HSBtoRGB(b.h,b.s,Math.min(b.b+a,1))},blend:function(a){this.rgb.r=Math.floor((this.rgb.r+a.rgb.r)/2),this.rgb.g=Math.floor((this.rgb.g+a.rgb.g)/2),this.rgb.b=Math.floor((this.rgb.b+a.rgb.b)/2)},isBright:function(){return this.asHSB(),.5<this.asHSB().b},isDark:function(){return!this.isBright()},asRGB:function(){return"rgb("+this.rgb.r+","+this.rgb.g+","+this.rgb.b+")"},asHex:function(){return"#"+this.rgb.r.toColorPart()+this.rgb.g.toColorPart()+this.rgb.b.toColorPart()},asHSB:function(){return OpenLayers.Rico.Color.RGBtoHSB(this.rgb.r,this.rgb.g,this.rgb.b)},toString:function(){return this.asHex()}}),OpenLayers.Rico.Color.createFromHex=function(a){if(4==a.length)for(var b=a,a="#",c=1;4>c;c++)a+=b.charAt(c)+b.charAt(c);return 0==a.indexOf("#")&&(a=a.substring(1)),b=a.substring(0,2),c=a.substring(2,4),a=a.substring(4,6),new OpenLayers.Rico.Color(parseInt(b,16),parseInt(c,16),parseInt(a,16))},OpenLayers.Rico.Color.createColorFromBackground=function(a){var b=OpenLayers.Element.getStyle(OpenLayers.Util.getElement(a),"backgroundColor");return"transparent"==b&&a.parentNode?OpenLayers.Rico.Color.createColorFromBackground(a.parentNode):null==b?new OpenLayers.Rico.Color(255,255,255):0==b.indexOf("rgb(")?(a=b.substring(4,b.length-1).split(","),new OpenLayers.Rico.Color(parseInt(a[0]),parseInt(a[1]),parseInt(a[2]))):0==b.indexOf("#")?OpenLayers.Rico.Color.createFromHex(b):new OpenLayers.Rico.Color(255,255,255)},OpenLayers.Rico.Color.HSBtoRGB=function(a,b,c){var d=0,e=0,f=0;if(0==b)f=e=d=parseInt(255*c+.5);else{var a=6*(a-Math.floor(a)),g=a-Math.floor(a),h=c*(1-b),i=c*(1-b*g),b=c*(1-b*(1-g));switch(parseInt(a)){case 0:d=255*c+.5,e=255*b+.5,f=255*h+.5;break;case 1:d=255*i+.5,e=255*c+.5,f=255*h+.5;break;case 2:d=255*h+.5,e=255*c+.5,f=255*b+.5;break;case 3:d=255*h+.5,e=255*i+.5,f=255*c+.5;break;case 4:d=255*b+.5,e=255*h+.5,f=255*c+.5;break;case 5:d=255*c+.5,e=255*h+.5,f=255*i+.5}}return{r:parseInt(d),g:parseInt(e),b:parseInt(f)}},OpenLayers.Rico.Color.RGBtoHSB=function(a,b,c){var d,e=a>b?a:b;c>e&&(e=c);var f=b>a?a:b;if(f>c&&(f=c),d=0!=e?(e-f)/e:0,0==d)a=0;else{var g=(e-a)/(e-f),h=(e-b)/(e-f),c=(e-c)/(e-f),a=(a==e?c-h:b==e?2+g-c:4+h-g)/6;0>a&&(a+=1)}return{h:a,s:d,b:e/255}},OpenLayers.Console.warn("OpenLayers.Rico is deprecated"),OpenLayers.Rico=OpenLayers.Rico||{},OpenLayers.Rico.Corner={round:function(a,b){a=OpenLayers.Util.getElement(a),this._setOptions(b);var c=this.options.color;"fromElement"==this.options.color&&(c=this._background(a));var d=this.options.bgColor;"fromParent"==this.options.bgColor&&(d=this._background(a.offsetParent)),this._roundCornersImpl(a,c,d)},changeColor:function(a,b){a.style.backgroundColor=b;for(var c=a.parentNode.getElementsByTagName("span"),d=0;d<c.length;d++)c[d].style.backgroundColor=b},changeOpacity:function(a,b){var c="alpha(opacity="+100*b+")";a.style.opacity=b,a.style.filter=c;for(var d=a.parentNode.getElementsByTagName("span"),e=0;e<d.length;e++)d[e].style.opacity=b,d[e].style.filter=c},reRound:function(a,b){var c=a.parentNode.childNodes[2];a.parentNode.removeChild(a.parentNode.childNodes[0]),a.parentNode.removeChild(c),this.round(a.parentNode,b)},_roundCornersImpl:function(a,b,c){this.options.border&&this._renderBorder(a,c),this._isTopRounded()&&this._roundTopCorners(a,b,c),this._isBottomRounded()&&this._roundBottomCorners(a,b,c)},_renderBorder:function(a,b){var c="1px solid "+this._borderColor(b);a.innerHTML="<div "+("style='border-left: "+c+";border-right: "+c+"'")+">"+a.innerHTML+"</div>"},_roundTopCorners:function(a,b,c){for(var d=this._createCorner(c),e=0;e<this.options.numSlices;e++)d.appendChild(this._createCornerSlice(b,c,e,"top"));a.style.paddingTop=0,a.insertBefore(d,a.firstChild)},_roundBottomCorners:function(a,b,c){for(var d=this._createCorner(c),e=this.options.numSlices-1;e>=0;e--)d.appendChild(this._createCornerSlice(b,c,e,"bottom"));a.style.paddingBottom=0,a.appendChild(d)},_createCorner:function(a){var b=document.createElement("div");return b.style.backgroundColor=this._isTransparent()?"transparent":a,b},_createCornerSlice:function(a,b,c,d){var e=document.createElement("span"),f=e.style;return f.backgroundColor=a,f.display="block",f.height="1px",f.overflow="hidden",f.fontSize="1px",a=this._borderColor(a,b),this.options.border&&0==c?(f.borderTopStyle="solid",f.borderTopWidth="1px",f.borderLeftWidth="0px",f.borderRightWidth="0px",f.borderBottomWidth="0px",f.height="0px",f.borderColor=a):a&&(f.borderColor=a,f.borderStyle="solid",f.borderWidth="0px 1px"),!this.options.compact&&c==this.options.numSlices-1&&(f.height="2px"),this._setMargin(e,c,d),this._setBorder(e,c,d),e},_setOptions:function(a){this.options={corners:"all",color:"fromElement",bgColor:"fromParent",blend:!0,border:!1,compact:!1},OpenLayers.Util.extend(this.options,a||{}),this.options.numSlices=this.options.compact?2:4,this._isTransparent()&&(this.options.blend=!1)},_whichSideTop:function(){return this._hasString(this.options.corners,"all","top")||0<=this.options.corners.indexOf("tl")&&0<=this.options.corners.indexOf("tr")?"":0<=this.options.corners.indexOf("tl")?"left":0<=this.options.corners.indexOf("tr")?"right":""},_whichSideBottom:function(){return this._hasString(this.options.corners,"all","bottom")||0<=this.options.corners.indexOf("bl")&&0<=this.options.corners.indexOf("br")?"":0<=this.options.corners.indexOf("bl")?"left":0<=this.options.corners.indexOf("br")?"right":""},_borderColor:function(a,b){return"transparent"==a?b:this.options.border?this.options.border:this.options.blend?this._blend(b,a):""},_setMargin:function(a,b,c){b=this._marginSize(b),c="top"==c?this._whichSideTop():this._whichSideBottom(),"left"==c?(a.style.marginLeft=b+"px",a.style.marginRight="0px"):"right"==c?(a.style.marginRight=b+"px",a.style.marginLeft="0px"):(a.style.marginLeft=b+"px",a.style.marginRight=b+"px")},_setBorder:function(a,b,c){b=this._borderSize(b),c="top"==c?this._whichSideTop():this._whichSideBottom(),"left"==c?(a.style.borderLeftWidth=b+"px",a.style.borderRightWidth="0px"):"right"==c?(a.style.borderRightWidth=b+"px",a.style.borderLeftWidth="0px"):(a.style.borderLeftWidth=b+"px",a.style.borderRightWidth=b+"px"),0!=this.options.border&&(a.style.borderLeftWidth=b+"px",a.style.borderRightWidth=b+"px")},_marginSize:function(a){if(this._isTransparent())return 0;var b=[5,3,2,1],c=[3,2,1,0],d=[2,1],e=[1,0];return this.options.compact&&this.options.blend?e[a]:this.options.compact?d[a]:this.options.blend?c[a]:b[a]},_borderSize:function(a){var b=[5,3,2,1],c=[2,1,1,1],d=[1,0],e=[0,2,0,0];return this.options.compact&&(this.options.blend||this._isTransparent())?1:this.options.compact?d[a]:this.options.blend?c[a]:this.options.border?e[a]:this._isTransparent()?b[a]:0},_hasString:function(a){for(var b=1;b<arguments.length;b++)if(0<=a.indexOf(arguments[b]))return!0;return!1},_blend:function(a,b){var c=OpenLayers.Rico.Color.createFromHex(a);return c.blend(OpenLayers.Rico.Color.createFromHex(b)),c},_background:function(a){try{return OpenLayers.Rico.Color.createColorFromBackground(a).asHex()}catch(b){return"#ffffff"}},_isTransparent:function(){return"transparent"==this.options.color},_isTopRounded:function(){return this._hasString(this.options.corners,"all","top","tl","tr")},_isBottomRounded:function(){return this._hasString(this.options.corners,"all","bottom","bl","br")},_hasSingleTextChild:function(a){return 1==a.childNodes.length&&3==a.childNodes[0].nodeType}},OpenLayers.Popup.AnchoredBubble=OpenLayers.Class(OpenLayers.Popup.Anchored,{rounded:!1,initialize:function(){OpenLayers.Console.warn("AnchoredBubble is deprecated"),this.padding=new OpenLayers.Bounds(0,OpenLayers.Popup.AnchoredBubble.CORNER_SIZE,0,OpenLayers.Popup.AnchoredBubble.CORNER_SIZE),OpenLayers.Popup.Anchored.prototype.initialize.apply(this,arguments)},draw:function(){return OpenLayers.Popup.Anchored.prototype.draw.apply(this,arguments),this.setContentHTML(),this.setBackgroundColor(),this.setOpacity(),this.div},updateRelativePosition:function(){this.setRicoCorners()},setSize:function(){OpenLayers.Popup.Anchored.prototype.setSize.apply(this,arguments),this.setRicoCorners()},setBackgroundColor:function(a){void 0!=a&&(this.backgroundColor=a),null!=this.div&&null!=this.contentDiv&&(this.div.style.background="transparent",OpenLayers.Rico.Corner.changeColor(this.groupDiv,this.backgroundColor))},setOpacity:function(a){OpenLayers.Popup.Anchored.prototype.setOpacity.call(this,a),null!=this.div&&null!=this.groupDiv&&OpenLayers.Rico.Corner.changeOpacity(this.groupDiv,this.opacity)},setBorder:function(){this.border=0},setRicoCorners:function(){var a={corners:this.getCornersToRound(this.relativePosition),color:this.backgroundColor,bgColor:"transparent",blend:!1};this.rounded?(OpenLayers.Rico.Corner.reRound(this.groupDiv,a),this.setBackgroundColor(),this.setOpacity()):(OpenLayers.Rico.Corner.round(this.div,a),this.rounded=!0)},getCornersToRound:function(){var a=["tl","tr","bl","br"],b=OpenLayers.Bounds.oppositeQuadrant(this.relativePosition);return OpenLayers.Util.removeItem(a,b),a.join(" ")},CLASS_NAME:"OpenLayers.Popup.AnchoredBubble"}),OpenLayers.Popup.AnchoredBubble.CORNER_SIZE=5,OpenLayers.Protocol.WFS.v1=OpenLayers.Class(OpenLayers.Protocol,{version:null,srsName:"EPSG:4326",featureType:null,featureNS:null,geometryName:"the_geom",schema:null,featurePrefix:"feature",formatOptions:null,readFormat:null,readOptions:null,initialize:function(a){OpenLayers.Protocol.prototype.initialize.apply(this,[a]),a.format||(this.format=OpenLayers.Format.WFST(OpenLayers.Util.extend({version:this.version,featureType:this.featureType,featureNS:this.featureNS,featurePrefix:this.featurePrefix,geometryName:this.geometryName,srsName:this.srsName,schema:this.schema},this.formatOptions))),!a.geometryName&&1<parseFloat(this.format.version)&&this.setGeometryName(null)},destroy:function(){this.options&&!this.options.format&&this.format.destroy(),this.format=null,OpenLayers.Protocol.prototype.destroy.apply(this)},read:function(a){OpenLayers.Protocol.prototype.read.apply(this,arguments),a=OpenLayers.Util.extend({},a),OpenLayers.Util.applyDefaults(a,this.options||{});var b=new OpenLayers.Protocol.Response({requestType:"read"}),c=OpenLayers.Format.XML.prototype.write.apply(this.format,[this.format.writeNode("wfs:GetFeature",a)]);return b.priv=OpenLayers.Request.POST({url:a.url,callback:this.createCallback(this.handleRead,b,a),params:a.params,headers:a.headers,data:c}),b},setFeatureType:function(a){this.featureType=a,this.format.featureType=a},setGeometryName:function(a){this.geometryName=a,this.format.geometryName=a},handleRead:function(a,b){if(b=OpenLayers.Util.extend({},b),OpenLayers.Util.applyDefaults(b,this.options),b.callback){var c=a.priv;200<=c.status&&300>c.status?(c=this.parseResponse(c,b.readOptions))&&!1!==c.success?(b.readOptions&&"object"==b.readOptions.output?OpenLayers.Util.extend(a,c):a.features=c,a.code=OpenLayers.Protocol.Response.SUCCESS):(a.code=OpenLayers.Protocol.Response.FAILURE,a.error=c):a.code=OpenLayers.Protocol.Response.FAILURE,b.callback.call(b.scope,a)}},parseResponse:function(a,b){var c=a.responseXML;if(c&&c.documentElement||(c=a.responseText),!c||0>=c.length)return null;if(c=null!==this.readFormat?this.readFormat.read(c):this.format.read(c,b),!this.featureNS){var d=this.readFormat||this.format;this.featureNS=d.featureNS,d.autoConfig=!1,this.geometryName||this.setGeometryName(d.geometryName)}return c},commit:function(a,b){b=OpenLayers.Util.extend({},b),OpenLayers.Util.applyDefaults(b,this.options);var c=new OpenLayers.Protocol.Response({requestType:"commit",reqFeatures:a});return c.priv=OpenLayers.Request.POST({url:b.url,headers:b.headers,data:this.format.write(a,b),callback:this.createCallback(this.handleCommit,c,b)}),c},handleCommit:function(a,b){if(b.callback){var c=a.priv,d=c.responseXML;d&&d.documentElement||(d=c.responseText),c=this.format.read(d)||{},a.insertIds=c.insertIds||[],c.success?a.code=OpenLayers.Protocol.Response.SUCCESS:(a.code=OpenLayers.Protocol.Response.FAILURE,a.error=c),b.callback.call(b.scope,a)}},filterDelete:function(a,b){b=OpenLayers.Util.extend({},b),OpenLayers.Util.applyDefaults(b,this.options),new OpenLayers.Protocol.Response({requestType:"commit"});var c=this.format.createElementNSPlus("wfs:Transaction",{attributes:{service:"WFS",version:this.version}}),d=this.format.createElementNSPlus("wfs:Delete",{attributes:{typeName:(b.featureNS?this.featurePrefix+":":"")+b.featureType}});b.featureNS&&d.setAttribute("xmlns:"+this.featurePrefix,b.featureNS);var e=this.format.writeNode("ogc:Filter",a);return d.appendChild(e),c.appendChild(d),c=OpenLayers.Format.XML.prototype.write.apply(this.format,[c]),OpenLayers.Request.POST({url:this.url,callback:b.callback||function(){},data:c})},abort:function(a){a&&a.priv.abort()},CLASS_NAME:"OpenLayers.Protocol.WFS.v1"}),OpenLayers.Handler.Point=OpenLayers.Class(OpenLayers.Handler,{point:null,layer:null,multi:!1,citeCompliant:!1,mouseDown:!1,stoppedDown:null,lastDown:null,lastUp:null,persist:!1,stopDown:!1,stopUp:!1,layerOptions:null,pixelTolerance:5,touch:!1,lastTouchPx:null,initialize:function(a,b,c){c&&c.layerOptions&&c.layerOptions.styleMap||(this.style=OpenLayers.Util.extend(OpenLayers.Feature.Vector.style["default"],{})),OpenLayers.Handler.prototype.initialize.apply(this,arguments)},activate:function(){if(!OpenLayers.Handler.prototype.activate.apply(this,arguments))return!1;var a=OpenLayers.Util.extend({displayInLayerSwitcher:!1,calculateInRange:OpenLayers.Function.True,wrapDateLine:this.citeCompliant},this.layerOptions);return this.layer=new OpenLayers.Layer.Vector(this.CLASS_NAME,a),this.map.addLayer(this.layer),!0},createFeature:function(a){a=this.layer.getLonLatFromViewPortPx(a),a=new OpenLayers.Geometry.Point(a.lon,a.lat),this.point=new OpenLayers.Feature.Vector(a),this.callback("create",[this.point.geometry,this.point]),this.point.geometry.clearBounds(),this.layer.addFeatures([this.point],{silent:!0})},deactivate:function(){return OpenLayers.Handler.prototype.deactivate.apply(this,arguments)?(this.cancel(),null!=this.layer.map&&(this.destroyFeature(!0),this.layer.destroy(!1)),this.layer=null,this.touch=!1,!0):!1},destroyFeature:function(a){this.layer&&(a||!this.persist)&&this.layer.destroyFeatures(),this.point=null},destroyPersistedFeature:function(){var a=this.layer;a&&1<a.features.length&&this.layer.features[0].destroy()},finalize:function(a){this.mouseDown=!1,this.lastTouchPx=this.lastUp=this.lastDown=null,this.callback(a?"cancel":"done",[this.geometryClone()]),this.destroyFeature(a)},cancel:function(){this.finalize(!0)},click:function(a){return OpenLayers.Event.stop(a),!1},dblclick:function(a){return OpenLayers.Event.stop(a),!1},modifyFeature:function(a){this.point||this.createFeature(a),a=this.layer.getLonLatFromViewPortPx(a),this.point.geometry.x=a.lon,this.point.geometry.y=a.lat,this.callback("modify",[this.point.geometry,this.point,!1]),this.point.geometry.clearBounds(),this.drawFeature()},drawFeature:function(){this.layer.drawFeature(this.point,this.style)},getGeometry:function(){var a=this.point&&this.point.geometry;return a&&this.multi&&(a=new OpenLayers.Geometry.MultiPoint([a])),a},geometryClone:function(){var a=this.getGeometry();return a&&a.clone()},mousedown:function(a){return this.down(a)},touchstart:function(a){return this.touch||(this.touch=!0,this.map.events.un({mousedown:this.mousedown,mouseup:this.mouseup,mousemove:this.mousemove,click:this.click,dblclick:this.dblclick,scope:this})),this.lastTouchPx=a.xy,this.down(a)},mousemove:function(a){return this.move(a)},touchmove:function(a){return this.lastTouchPx=a.xy,this.move(a)},mouseup:function(a){return this.up(a)},touchend:function(a){return a.xy=this.lastTouchPx,this.up(a)},down:function(a){return this.mouseDown=!0,this.lastDown=a.xy,this.touch||this.modifyFeature(a.xy),this.stoppedDown=this.stopDown,!this.stopDown},move:function(a){return!this.touch&&(!this.mouseDown||this.stoppedDown)&&this.modifyFeature(a.xy),!0},up:function(a){return this.mouseDown=!1,this.stoppedDown=this.stopDown,!this.checkModifiers(a)||this.lastUp&&this.lastUp.equals(a.xy)||!this.lastDown||!this.passesTolerance(this.lastDown,a.xy,this.pixelTolerance)?!0:(this.touch&&this.modifyFeature(a.xy),this.persist&&this.destroyPersistedFeature(),this.lastUp=a.xy,this.finalize(),!this.stopUp)},mouseout:function(a){OpenLayers.Util.mouseLeft(a,this.map.viewPortDiv)&&(this.stoppedDown=this.stopDown,this.mouseDown=!1)},passesTolerance:function(a,b,c){var d=!0;return null!=c&&a&&b&&a.distanceTo(b)>c&&(d=!1),d},CLASS_NAME:"OpenLayers.Handler.Point"}),OpenLayers.Handler.Path=OpenLayers.Class(OpenLayers.Handler.Point,{line:null,maxVertices:null,doubleTouchTolerance:20,freehand:!1,freehandToggle:"shiftKey",timerId:null,redoStack:null,createFeature:function(a){a=this.layer.getLonLatFromViewPortPx(a),a=new OpenLayers.Geometry.Point(a.lon,a.lat),this.point=new OpenLayers.Feature.Vector(a),this.line=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.LineString([this.point.geometry])),this.callback("create",[this.point.geometry,this.getSketch()]),this.point.geometry.clearBounds(),this.layer.addFeatures([this.line,this.point],{silent:!0})},destroyFeature:function(a){OpenLayers.Handler.Point.prototype.destroyFeature.call(this,a),this.line=null},destroyPersistedFeature:function(){var a=this.layer;a&&2<a.features.length&&this.layer.features[0].destroy()},removePoint:function(){this.point&&this.layer.removeFeatures([this.point])},addPoint:function(a){this.layer.removeFeatures([this.point]),a=this.layer.getLonLatFromViewPortPx(a),this.point=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(a.lon,a.lat)),this.line.geometry.addComponent(this.point.geometry,this.line.geometry.components.length),this.layer.addFeatures([this.point]),this.callback("point",[this.point.geometry,this.getGeometry()]),this.callback("modify",[this.point.geometry,this.getSketch()]),this.drawFeature(),delete this.redoStack},insertXY:function(a,b){this.line.geometry.addComponent(new OpenLayers.Geometry.Point(a,b),this.getCurrentPointIndex()),this.drawFeature(),delete this.redoStack},insertDeltaXY:function(a,b){var c=this.line.geometry.components[this.getCurrentPointIndex()-1];c&&!isNaN(c.x)&&!isNaN(c.y)&&this.insertXY(c.x+a,c.y+b)},insertDirectionLength:function(a,b){var a=a*(Math.PI/180),c=b*Math.cos(a),d=b*Math.sin(a);this.insertDeltaXY(c,d)},insertDeflectionLength:function(a,b){var c=this.getCurrentPointIndex()-1;if(c>0){var d=this.line.geometry.components[c],c=this.line.geometry.components[c-1];this.insertDirectionLength(180*Math.atan2(d.y-c.y,d.x-c.x)/Math.PI+a,b)}},getCurrentPointIndex:function(){return this.line.geometry.components.length-1},undo:function(){var a=this.line.geometry,b=a.components,c=this.getCurrentPointIndex()-1,b=b[c];return(a=a.removeComponent(b))&&(this.redoStack||(this.redoStack=[]),this.redoStack.push(b),this.drawFeature()),a},redo:function(){var a=this.redoStack&&this.redoStack.pop();return a&&(this.line.geometry.addComponent(a,this.getCurrentPointIndex()),this.drawFeature()),!!a},freehandMode:function(a){return this.freehandToggle&&a[this.freehandToggle]?!this.freehand:this.freehand},modifyFeature:function(a,b){this.line||this.createFeature(a);var c=this.layer.getLonLatFromViewPortPx(a);this.point.geometry.x=c.lon,this.point.geometry.y=c.lat,this.callback("modify",[this.point.geometry,this.getSketch(),b]),this.point.geometry.clearBounds(),this.drawFeature()},drawFeature:function(){this.layer.drawFeature(this.line,this.style),this.layer.drawFeature(this.point,this.style)},getSketch:function(){return this.line},getGeometry:function(){var a=this.line&&this.line.geometry;return a&&this.multi&&(a=new OpenLayers.Geometry.MultiLineString([a])),a},touchstart:function(a){return this.timerId&&this.passesTolerance(this.lastTouchPx,a.xy,this.doubleTouchTolerance)?(this.finishGeometry(),window.clearTimeout(this.timerId),this.timerId=null,!1):(this.timerId&&(window.clearTimeout(this.timerId),this.timerId=null),this.timerId=window.setTimeout(OpenLayers.Function.bind(function(){this.timerId=null},this),300),OpenLayers.Handler.Point.prototype.touchstart.call(this,a))},down:function(a){var b=this.stopDown;return this.freehandMode(a)&&(b=!0,this.touch&&(this.modifyFeature(a.xy,!!this.lastUp),OpenLayers.Event.stop(a))),!(this.touch||this.lastDown&&this.passesTolerance(this.lastDown,a.xy,this.pixelTolerance)||!this.modifyFeature(a.xy,!!this.lastUp)),this.mouseDown=!0,this.lastDown=a.xy,this.stoppedDown=b,!b},move:function(a){return this.stoppedDown&&this.freehandMode(a)?(this.persist&&this.destroyPersistedFeature(),this.maxVertices&&this.line&&this.line.geometry.components.length===this.maxVertices?(this.removePoint(),this.finalize()):this.addPoint(a.xy),!1):(!this.touch&&(!this.mouseDown||this.stoppedDown)&&this.modifyFeature(a.xy,!!this.lastUp),!0)},up:function(a){return!this.mouseDown||this.lastUp&&this.lastUp.equals(a.xy)||(this.stoppedDown&&this.freehandMode(a)?(this.persist&&this.destroyPersistedFeature(),this.removePoint(),this.finalize()):this.passesTolerance(this.lastDown,a.xy,this.pixelTolerance)&&(this.touch&&this.modifyFeature(a.xy),null==this.lastUp&&this.persist&&this.destroyPersistedFeature(),this.addPoint(a.xy),this.lastUp=a.xy,this.line.geometry.components.length===this.maxVertices+1&&this.finishGeometry())),this.stoppedDown=this.stopDown,this.mouseDown=!1,!this.stopUp},finishGeometry:function(){this.line.geometry.removeComponent(this.line.geometry.components[this.line.geometry.components.length-1]),this.removePoint(),this.finalize()},dblclick:function(a){return this.freehandMode(a)||this.finishGeometry(),!1},CLASS_NAME:"OpenLayers.Handler.Path"}),OpenLayers.Spherical=OpenLayers.Spherical||{},OpenLayers.Spherical.DEFAULT_RADIUS=6378137,OpenLayers.Spherical.computeDistanceBetween=function(a,b,c){var c=c||OpenLayers.Spherical.DEFAULT_RADIUS,d=Math.sin(Math.PI*(b.lon-a.lon)/360),e=Math.sin(Math.PI*(b.lat-a.lat)/360),a=e*e+d*d*Math.cos(Math.PI*a.lat/180)*Math.cos(Math.PI*b.lat/180);return 2*c*Math.atan2(Math.sqrt(a),Math.sqrt(1-a))},OpenLayers.Spherical.computeHeading=function(a,b){var c=Math.sin(Math.PI*(a.lon-b.lon)/180)*Math.cos(Math.PI*b.lat/180),d=Math.cos(Math.PI*a.lat/180)*Math.sin(Math.PI*b.lat/180)-Math.sin(Math.PI*a.lat/180)*Math.cos(Math.PI*b.lat/180)*Math.cos(Math.PI*(a.lon-b.lon)/180);return 180*Math.atan2(c,d)/Math.PI},OpenLayers.Control.CacheWrite=OpenLayers.Class(OpenLayers.Control,{layers:null,imageFormat:"image/png",quotaRegEx:/quota/i,setMap:function(a){OpenLayers.Control.prototype.setMap.apply(this,arguments);var b,c=this.layers||a.layers;for(b=c.length-1;b>=0;--b)this.addLayer({layer:c[b]});this.layers||a.events.on({addlayer:this.addLayer,removeLayer:this.removeLayer,scope:this})},addLayer:function(a){a.layer.events.on({tileloadstart:this.makeSameOrigin,tileloaded:this.cache,scope:this})},removeLayer:function(a){a.layer.events.un({tileloadstart:this.makeSameOrigin,tileloaded:this.cache,scope:this})},makeSameOrigin:function(a){if(this.active&&(a=a.tile,a instanceof OpenLayers.Tile.Image&&!a.crossOriginKeyword&&"data:"!==a.url.substr(0,5))){var b=OpenLayers.Request.makeSameOrigin(a.url,OpenLayers.ProxyHost);OpenLayers.Control.CacheWrite.urlMap[b]=a.url,a.url=b}},cache:function(a){if(this.active&&window.localStorage&&(a=a.tile,a instanceof OpenLayers.Tile.Image&&"data:"!==a.url.substr(0,5)))try{var b=a.getCanvasContext();if(b){var c=OpenLayers.Control.CacheWrite.urlMap;window.localStorage.setItem("olCache_"+(c[a.url]||a.url),b.canvas.toDataURL(this.imageFormat)),delete c[a.url]}}catch(d){(b=d.name||d.message)&&this.quotaRegEx.test(b)?this.events.triggerEvent("cachefull",{tile:a}):OpenLayers.Console.error(d.toString())}},destroy:function(){if(this.layers||this.map){var a,b=this.layers||this.map.layers;for(a=b.length-1;a>=0;--a)this.removeLayer({layer:b[a]})}this.map&&this.map.events.un({addlayer:this.addLayer,removeLayer:this.removeLayer,scope:this}),OpenLayers.Control.prototype.destroy.apply(this,arguments)},CLASS_NAME:"OpenLayers.Control.CacheWrite"}),OpenLayers.Control.CacheWrite.clearCache=function(){if(window.localStorage){var a,b;for(a=window.localStorage.length-1;a>=0;--a)b=window.localStorage.key(a),"olCache_"===b.substr(0,8)&&window.localStorage.removeItem(b)}},OpenLayers.Control.CacheWrite.urlMap={},OpenLayers.Format.Context=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{layerOptions:null,layerParams:null,read:function(a,b){var c=OpenLayers.Format.XML.VersionedOGC.prototype.read.apply(this,arguments);if(b&&b.map)if(this.context=c,b.map instanceof OpenLayers.Map)c=this.mergeContextToMap(c,b.map);else{var d=b.map;(OpenLayers.Util.isElement(d)||"string"==typeof d)&&(d={div:d}),c=this.contextToMap(c,d)}return c},getLayerFromContext:function(a){var b,c,d={queryable:a.queryable,visibility:a.visibility,maxExtent:a.maxExtent,metadata:OpenLayers.Util.applyDefaults(a.metadata,{styles:a.styles,formats:a.formats,"abstract":a["abstract"],dataURL:a.dataURL}),numZoomLevels:a.numZoomLevels,units:a.units,isBaseLayer:a.isBaseLayer,opacity:a.opacity,displayInLayerSwitcher:a.displayInLayerSwitcher,singleTile:a.singleTile,tileSize:a.tileSize?new OpenLayers.Size(a.tileSize.width,a.tileSize.height):void 0,minScale:a.minScale||a.maxScaleDenominator,maxScale:a.maxScale||a.minScaleDenominator,srs:a.srs,dimensions:a.dimensions,metadataURL:a.metadataURL};this.layerOptions&&OpenLayers.Util.applyDefaults(d,this.layerOptions);var e={layers:a.name,transparent:a.transparent,version:a.version};if(a.formats&&0<a.formats.length)for(e.format=a.formats[0].value,b=0,c=a.formats.length;c>b;b++){var f=a.formats[b];if(1==f.current){e.format=f.value;break}}if(a.styles&&0<a.styles.length)for(b=0,c=a.styles.length;c>b;b++)if(f=a.styles[b],1==f.current){f.href?e.sld=f.href:f.body?e.sld_body=f.body:e.styles=f.name;break}return this.layerParams&&OpenLayers.Util.applyDefaults(e,this.layerParams),b=null,c=a.service,c==OpenLayers.Format.Context.serviceTypes.WFS?(d.strategies=[new OpenLayers.Strategy.BBOX],d.protocol=new OpenLayers.Protocol.WFS({url:a.url,featurePrefix:a.name.split(":")[0],featureType:a.name.split(":").pop()}),b=new OpenLayers.Layer.Vector(a.title||a.name,d)):c==OpenLayers.Format.Context.serviceTypes.KML?(d.strategies=[new OpenLayers.Strategy.Fixed],d.protocol=new OpenLayers.Protocol.HTTP({url:a.url,format:new OpenLayers.Format.KML}),b=new OpenLayers.Layer.Vector(a.title||a.name,d)):c==OpenLayers.Format.Context.serviceTypes.GML?(d.strategies=[new OpenLayers.Strategy.Fixed],d.protocol=new OpenLayers.Protocol.HTTP({url:a.url,format:new OpenLayers.Format.GML}),b=new OpenLayers.Layer.Vector(a.title||a.name,d)):a.features?(b=new OpenLayers.Layer.Vector(a.title||a.name,d),b.addFeatures(a.features)):!0!==a.categoryLayer&&(b=new OpenLayers.Layer.WMS(a.title||a.name,a.url,e,d)),b},getLayersFromContext:function(a){for(var b=[],c=0,d=a.length;d>c;c++){var e=this.getLayerFromContext(a[c]);null!==e&&b.push(e)}return b},contextToMap:function(a,b){b=OpenLayers.Util.applyDefaults({maxExtent:a.maxExtent,projection:a.projection,units:a.units},b),b.maxExtent&&(b.maxResolution=b.maxExtent.getWidth()/OpenLayers.Map.TILE_WIDTH),b.metadata={contactInformation:a.contactInformation,"abstract":a["abstract"],keywords:a.keywords,logo:a.logo,descriptionURL:a.descriptionURL};var c=new OpenLayers.Map(b);return c.addLayers(this.getLayersFromContext(a.layersContext)),c.setCenter(a.bounds.getCenterLonLat(),c.getZoomForExtent(a.bounds,!0)),c},mergeContextToMap:function(a,b){return b.addLayers(this.getLayersFromContext(a.layersContext)),b},write:function(a){return a=this.toContext(a),OpenLayers.Format.XML.VersionedOGC.prototype.write.apply(this,arguments)},CLASS_NAME:"OpenLayers.Format.Context"}),OpenLayers.Format.Context.serviceTypes={WMS:"urn:ogc:serviceType:WMS",WFS:"urn:ogc:serviceType:WFS",WCS:"urn:ogc:serviceType:WCS",GML:"urn:ogc:serviceType:GML",SLD:"urn:ogc:serviceType:SLD",FES:"urn:ogc:serviceType:FES",KML:"urn:ogc:serviceType:KML"},OpenLayers.Format.WMC=OpenLayers.Class(OpenLayers.Format.Context,{defaultVersion:"1.1.0",layerToContext:function(a){var b=this.getParser(),c={queryable:a.queryable,visibility:a.visibility,name:a.params.LAYERS,title:a.name,"abstract":a.metadata["abstract"],dataURL:a.metadata.dataURL,metadataURL:a.metadataURL,server:{version:a.params.VERSION,url:a.url},maxExtent:a.maxExtent,transparent:a.params.TRANSPARENT,numZoomLevels:a.numZoomLevels,units:a.units,isBaseLayer:a.isBaseLayer,opacity:1==a.opacity?void 0:a.opacity,displayInLayerSwitcher:a.displayInLayerSwitcher,singleTile:a.singleTile,tileSize:a.singleTile||!a.tileSize?void 0:{width:a.tileSize.w,height:a.tileSize.h},minScale:a.options.resolutions||a.options.scales||a.options.maxResolution||a.options.minScale?a.minScale:void 0,maxScale:a.options.resolutions||a.options.scales||a.options.minResolution||a.options.maxScale?a.maxScale:void 0,formats:[],styles:[],srs:a.srs,dimensions:a.dimensions};if(a.metadata.servertitle&&(c.server.title=a.metadata.servertitle),a.metadata.formats&&0<a.metadata.formats.length)for(var d=0,e=a.metadata.formats.length;e>d;d++){var f=a.metadata.formats[d];c.formats.push({value:f.value,current:f.value==a.params.FORMAT})}else c.formats.push({value:a.params.FORMAT,current:!0});if(a.metadata.styles&&0<a.metadata.styles.length)for(d=0,e=a.metadata.styles.length;e>d;d++)b=a.metadata.styles[d],b.current=b.href==a.params.SLD||b.body==a.params.SLD_BODY||b.name==a.params.STYLES?!0:!1,c.styles.push(b);else c.styles.push({href:a.params.SLD,body:a.params.SLD_BODY,name:a.params.STYLES||b.defaultStyleName,title:b.defaultStyleTitle,current:!0});return c},toContext:function(a){var b={},c=a.layers;if("OpenLayers.Map"==a.CLASS_NAME){var d=a.metadata||{};b.size=a.getSize(),b.bounds=a.getExtent(),b.projection=a.projection,b.title=a.title,b.keywords=d.keywords,b["abstract"]=d["abstract"],b.logo=d.logo,b.descriptionURL=d.descriptionURL,b.contactInformation=d.contactInformation,b.maxExtent=a.maxExtent}else OpenLayers.Util.applyDefaults(b,a),void 0!=b.layers&&delete b.layers;if(void 0==b.layersContext&&(b.layersContext=[]),void 0!=c&&OpenLayers.Util.isArray(c))for(a=0,d=c.length;d>a;a++){var e=c[a];e instanceof OpenLayers.Layer.WMS&&b.layersContext.push(this.layerToContext(e))}return b},CLASS_NAME:"OpenLayers.Format.WMC"}),OpenLayers.Format.WMC.v1=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{ol:"http://openlayers.org/context",wmc:"http://www.opengis.net/context",sld:"http://www.opengis.net/sld",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},schemaLocation:"",getNamespacePrefix:function(a){var b=null;if(null==a)b=this.namespaces[this.defaultPrefix];else for(b in this.namespaces)if(this.namespaces[b]==a)break;return b},defaultPrefix:"wmc",rootPrefix:null,defaultStyleName:"",defaultStyleTitle:"Default",initialize:function(a){OpenLayers.Format.XML.prototype.initialize.apply(this,[a])},read:function(a){"string"==typeof a&&(a=OpenLayers.Format.XML.prototype.read.apply(this,[a])),a=a.documentElement,this.rootPrefix=a.prefix;var b={version:a.getAttribute("version")};return this.runChildNodes(b,a),b},runChildNodes:function(a,b){for(var c,d,e,f=b.childNodes,g=0,h=f.length;h>g;++g)c=f[g],1==c.nodeType&&(d=this.getNamespacePrefix(c.namespaceURI),e=c.nodeName.split(":").pop(),(d=this["read_"+d+"_"+e])&&d.apply(this,[a,c]))},read_wmc_General:function(a,b){this.runChildNodes(a,b)},read_wmc_BoundingBox:function(a,b){a.projection=b.getAttribute("SRS"),a.bounds=new OpenLayers.Bounds(b.getAttribute("minx"),b.getAttribute("miny"),b.getAttribute("maxx"),b.getAttribute("maxy"))
},read_wmc_LayerList:function(a,b){a.layersContext=[],this.runChildNodes(a,b)},read_wmc_Layer:function(a,b){var c={visibility:"1"!=b.getAttribute("hidden"),queryable:"1"==b.getAttribute("queryable"),formats:[],styles:[],metadata:{}};this.runChildNodes(c,b),a.layersContext.push(c)},read_wmc_Extension:function(a,b){this.runChildNodes(a,b)},read_ol_units:function(a,b){a.units=this.getChildValue(b)},read_ol_maxExtent:function(a,b){var c=new OpenLayers.Bounds(b.getAttribute("minx"),b.getAttribute("miny"),b.getAttribute("maxx"),b.getAttribute("maxy"));a.maxExtent=c},read_ol_transparent:function(a,b){a.transparent=this.getChildValue(b)},read_ol_numZoomLevels:function(a,b){a.numZoomLevels=parseInt(this.getChildValue(b))},read_ol_opacity:function(a,b){a.opacity=parseFloat(this.getChildValue(b))},read_ol_singleTile:function(a,b){a.singleTile="true"==this.getChildValue(b)},read_ol_tileSize:function(a,b){var c={width:b.getAttribute("width"),height:b.getAttribute("height")};a.tileSize=c},read_ol_isBaseLayer:function(a,b){a.isBaseLayer="true"==this.getChildValue(b)},read_ol_displayInLayerSwitcher:function(a,b){a.displayInLayerSwitcher="true"==this.getChildValue(b)},read_wmc_Server:function(a,b){a.version=b.getAttribute("version"),a.url=this.getOnlineResource_href(b),a.metadata.servertitle=b.getAttribute("title")},read_wmc_FormatList:function(a,b){this.runChildNodes(a,b)},read_wmc_Format:function(a,b){var c={value:this.getChildValue(b)};"1"==b.getAttribute("current")&&(c.current=!0),a.formats.push(c)},read_wmc_StyleList:function(a,b){this.runChildNodes(a,b)},read_wmc_Style:function(a,b){var c={};this.runChildNodes(c,b),"1"==b.getAttribute("current")&&(c.current=!0),a.styles.push(c)},read_wmc_SLD:function(a,b){this.runChildNodes(a,b)},read_sld_StyledLayerDescriptor:function(a,b){var c=OpenLayers.Format.XML.prototype.write.apply(this,[b]);a.body=c},read_sld_FeatureTypeStyle:function(a,b){var c=OpenLayers.Format.XML.prototype.write.apply(this,[b]);a.body=c},read_wmc_OnlineResource:function(a,b){a.href=this.getAttributeNS(b,this.namespaces.xlink,"href")},read_wmc_Name:function(a,b){var c=this.getChildValue(b);c&&(a.name=c)},read_wmc_Title:function(a,b){var c=this.getChildValue(b);c&&(a.title=c)},read_wmc_MetadataURL:function(a,b){a.metadataURL=this.getOnlineResource_href(b)},read_wmc_KeywordList:function(a,b){a.keywords=[],this.runChildNodes(a.keywords,b)},read_wmc_Keyword:function(a,b){a.push(this.getChildValue(b))},read_wmc_Abstract:function(a,b){var c=this.getChildValue(b);c&&(a["abstract"]=c)},read_wmc_LogoURL:function(a,b){a.logo={width:b.getAttribute("width"),height:b.getAttribute("height"),format:b.getAttribute("format"),href:this.getOnlineResource_href(b)}},read_wmc_DescriptionURL:function(a,b){a.descriptionURL=this.getOnlineResource_href(b)},read_wmc_ContactInformation:function(a,b){var c={};this.runChildNodes(c,b),a.contactInformation=c},read_wmc_ContactPersonPrimary:function(a,b){var c={};this.runChildNodes(c,b),a.personPrimary=c},read_wmc_ContactPerson:function(a,b){var c=this.getChildValue(b);c&&(a.person=c)},read_wmc_ContactOrganization:function(a,b){var c=this.getChildValue(b);c&&(a.organization=c)},read_wmc_ContactPosition:function(a,b){var c=this.getChildValue(b);c&&(a.position=c)},read_wmc_ContactAddress:function(a,b){var c={};this.runChildNodes(c,b),a.contactAddress=c},read_wmc_AddressType:function(a,b){var c=this.getChildValue(b);c&&(a.type=c)},read_wmc_Address:function(a,b){var c=this.getChildValue(b);c&&(a.address=c)},read_wmc_City:function(a,b){var c=this.getChildValue(b);c&&(a.city=c)},read_wmc_StateOrProvince:function(a,b){var c=this.getChildValue(b);c&&(a.stateOrProvince=c)},read_wmc_PostCode:function(a,b){var c=this.getChildValue(b);c&&(a.postcode=c)},read_wmc_Country:function(a,b){var c=this.getChildValue(b);c&&(a.country=c)},read_wmc_ContactVoiceTelephone:function(a,b){var c=this.getChildValue(b);c&&(a.phone=c)},read_wmc_ContactFacsimileTelephone:function(a,b){var c=this.getChildValue(b);c&&(a.fax=c)},read_wmc_ContactElectronicMailAddress:function(a,b){var c=this.getChildValue(b);c&&(a.email=c)},read_wmc_DataURL:function(a,b){a.dataURL=this.getOnlineResource_href(b)},read_wmc_LegendURL:function(a,b){var c={width:b.getAttribute("width"),height:b.getAttribute("height"),format:b.getAttribute("format"),href:this.getOnlineResource_href(b)};a.legend=c},read_wmc_DimensionList:function(a,b){a.dimensions={},this.runChildNodes(a.dimensions,b)},read_wmc_Dimension:function(a,b){var c={name:b.getAttribute("name").toLowerCase(),units:b.getAttribute("units")||"",unitSymbol:b.getAttribute("unitSymbol")||"",userValue:b.getAttribute("userValue")||"",nearestValue:"1"===b.getAttribute("nearestValue"),multipleValues:"1"===b.getAttribute("multipleValues"),current:"1"===b.getAttribute("current"),"default":b.getAttribute("default")||""},d=this.getChildValue(b);c.values=d.split(","),a[c.name]=c},write:function(a,b){var c=this.createElementDefaultNS("ViewContext");return this.setAttributes(c,{version:this.VERSION,id:b&&"string"==typeof b.id?b.id:OpenLayers.Util.createUniqueID("OpenLayers_Context_")}),this.setAttributeNS(c,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation),c.appendChild(this.write_wmc_General(a)),c.appendChild(this.write_wmc_LayerList(a)),OpenLayers.Format.XML.prototype.write.apply(this,[c])},createElementDefaultNS:function(a,b,c){return a=this.createElementNS(this.namespaces[this.defaultPrefix],a),b&&a.appendChild(this.createTextNode(b)),c&&this.setAttributes(a,c),a},setAttributes:function(a,b){var c,d;for(d in b)c=b[d].toString(),c.match(/[A-Z]/)?this.setAttributeNS(a,null,d,c):a.setAttribute(d,c)},write_wmc_General:function(a){var b=this.createElementDefaultNS("General");a.size&&b.appendChild(this.createElementDefaultNS("Window",null,{width:a.size.w,height:a.size.h}));var c=a.bounds;return b.appendChild(this.createElementDefaultNS("BoundingBox",null,{minx:c.left.toPrecision(18),miny:c.bottom.toPrecision(18),maxx:c.right.toPrecision(18),maxy:c.top.toPrecision(18),SRS:a.projection})),b.appendChild(this.createElementDefaultNS("Title",a.title)),a.keywords&&b.appendChild(this.write_wmc_KeywordList(a.keywords)),a["abstract"]&&b.appendChild(this.createElementDefaultNS("Abstract",a["abstract"])),a.logo&&b.appendChild(this.write_wmc_URLType("LogoURL",a.logo.href,a.logo)),a.descriptionURL&&b.appendChild(this.write_wmc_URLType("DescriptionURL",a.descriptionURL)),a.contactInformation&&b.appendChild(this.write_wmc_ContactInformation(a.contactInformation)),b.appendChild(this.write_ol_MapExtension(a)),b},write_wmc_KeywordList:function(a){for(var b=this.createElementDefaultNS("KeywordList"),c=0,d=a.length;d>c;c++)b.appendChild(this.createElementDefaultNS("Keyword",a[c]));return b},write_wmc_ContactInformation:function(a){var b=this.createElementDefaultNS("ContactInformation");return a.personPrimary&&b.appendChild(this.write_wmc_ContactPersonPrimary(a.personPrimary)),a.position&&b.appendChild(this.createElementDefaultNS("ContactPosition",a.position)),a.contactAddress&&b.appendChild(this.write_wmc_ContactAddress(a.contactAddress)),a.phone&&b.appendChild(this.createElementDefaultNS("ContactVoiceTelephone",a.phone)),a.fax&&b.appendChild(this.createElementDefaultNS("ContactFacsimileTelephone",a.fax)),a.email&&b.appendChild(this.createElementDefaultNS("ContactElectronicMailAddress",a.email)),b},write_wmc_ContactPersonPrimary:function(a){var b=this.createElementDefaultNS("ContactPersonPrimary");return a.person&&b.appendChild(this.createElementDefaultNS("ContactPerson",a.person)),a.organization&&b.appendChild(this.createElementDefaultNS("ContactOrganization",a.organization)),b},write_wmc_ContactAddress:function(a){var b=this.createElementDefaultNS("ContactAddress");return a.type&&b.appendChild(this.createElementDefaultNS("AddressType",a.type)),a.address&&b.appendChild(this.createElementDefaultNS("Address",a.address)),a.city&&b.appendChild(this.createElementDefaultNS("City",a.city)),a.stateOrProvince&&b.appendChild(this.createElementDefaultNS("StateOrProvince",a.stateOrProvince)),a.postcode&&b.appendChild(this.createElementDefaultNS("PostCode",a.postcode)),a.country&&b.appendChild(this.createElementDefaultNS("Country",a.country)),b},write_ol_MapExtension:function(a){var b=this.createElementDefaultNS("Extension");if(a=a.maxExtent){var c=this.createElementNS(this.namespaces.ol,"ol:maxExtent");this.setAttributes(c,{minx:a.left.toPrecision(18),miny:a.bottom.toPrecision(18),maxx:a.right.toPrecision(18),maxy:a.top.toPrecision(18)}),b.appendChild(c)}return b},write_wmc_LayerList:function(a){for(var b=this.createElementDefaultNS("LayerList"),c=0,d=a.layersContext.length;d>c;++c)b.appendChild(this.write_wmc_Layer(a.layersContext[c]));return b},write_wmc_Layer:function(a){var b=this.createElementDefaultNS("Layer",null,{queryable:a.queryable?"1":"0",hidden:a.visibility?"0":"1"});return b.appendChild(this.write_wmc_Server(a)),b.appendChild(this.createElementDefaultNS("Name",a.name)),b.appendChild(this.createElementDefaultNS("Title",a.title)),a["abstract"]&&b.appendChild(this.createElementDefaultNS("Abstract",a["abstract"])),a.dataURL&&b.appendChild(this.write_wmc_URLType("DataURL",a.dataURL)),a.metadataURL&&b.appendChild(this.write_wmc_URLType("MetadataURL",a.metadataURL)),b},write_wmc_LayerExtension:function(a){var b=this.createElementDefaultNS("Extension"),c=a.maxExtent,d=this.createElementNS(this.namespaces.ol,"ol:maxExtent");this.setAttributes(d,{minx:c.left.toPrecision(18),miny:c.bottom.toPrecision(18),maxx:c.right.toPrecision(18),maxy:c.top.toPrecision(18)}),b.appendChild(d),a.tileSize&&!a.singleTile&&(c=this.createElementNS(this.namespaces.ol,"ol:tileSize"),this.setAttributes(c,a.tileSize),b.appendChild(c));for(var c="transparent numZoomLevels units isBaseLayer opacity displayInLayerSwitcher singleTile".split(" "),e=0,f=c.length;f>e;++e)(d=this.createOLPropertyNode(a,c[e]))&&b.appendChild(d);return b},createOLPropertyNode:function(a,b){var c=null;return null!=a[b]&&(c=this.createElementNS(this.namespaces.ol,"ol:"+b),c.appendChild(this.createTextNode(a[b].toString()))),c},write_wmc_Server:function(a){var a=a.server,b=this.createElementDefaultNS("Server"),c={service:"OGC:WMS",version:a.version};return a.title&&(c.title=a.title),this.setAttributes(b,c),b.appendChild(this.write_wmc_OnlineResource(a.url)),b},write_wmc_URLType:function(a,b,c){if(a=this.createElementDefaultNS(a),a.appendChild(this.write_wmc_OnlineResource(b)),c)for(var b=["width","height","format"],d=0;d<b.length;d++)b[d]in c&&a.setAttribute(b[d],c[b[d]]);return a},write_wmc_DimensionList:function(a){var b,c=this.createElementDefaultNS("DimensionList");for(b in a.dimensions){var d,e={},f=a.dimensions[b];for(d in f)e[d]="boolean"==typeof f[d]?Number(f[d]):f[d];f="",e.values&&(f=e.values.join(","),delete e.values),c.appendChild(this.createElementDefaultNS("Dimension",f,e))}return c},write_wmc_FormatList:function(a){for(var b=this.createElementDefaultNS("FormatList"),c=0,d=a.formats.length;d>c;c++){var e=a.formats[c];b.appendChild(this.createElementDefaultNS("Format",e.value,e.current&&1==e.current?{current:"1"}:null))}return b},write_wmc_StyleList:function(a){var b=this.createElementDefaultNS("StyleList");if((a=a.styles)&&OpenLayers.Util.isArray(a))for(var c,d=0,e=a.length;e>d;d++){var f=a[d],g=this.createElementDefaultNS("Style",null,f.current&&1==f.current?{current:"1"}:null);f.href?(c=this.createElementDefaultNS("SLD"),f.name&&c.appendChild(this.createElementDefaultNS("Name",f.name)),f.title&&c.appendChild(this.createElementDefaultNS("Title",f.title)),f.legend&&c.appendChild(this.write_wmc_URLType("LegendURL",f.legend.href,f.legend)),f=this.write_wmc_OnlineResource(f.href),c.appendChild(f),g.appendChild(c)):f.body?(c=this.createElementDefaultNS("SLD"),f.name&&c.appendChild(this.createElementDefaultNS("Name",f.name)),f.title&&c.appendChild(this.createElementDefaultNS("Title",f.title)),f.legend&&c.appendChild(this.write_wmc_URLType("LegendURL",f.legend.href,f.legend)),f=OpenLayers.Format.XML.prototype.read.apply(this,[f.body]).documentElement,c.ownerDocument&&c.ownerDocument.importNode&&(f=c.ownerDocument.importNode(f,!0)),c.appendChild(f),g.appendChild(c)):(g.appendChild(this.createElementDefaultNS("Name",f.name)),g.appendChild(this.createElementDefaultNS("Title",f.title)),f["abstract"]&&g.appendChild(this.createElementDefaultNS("Abstract",f["abstract"])),f.legend&&g.appendChild(this.write_wmc_URLType("LegendURL",f.legend.href,f.legend))),b.appendChild(g)}return b},write_wmc_OnlineResource:function(a){var b=this.createElementDefaultNS("OnlineResource");return this.setAttributeNS(b,this.namespaces.xlink,"xlink:type","simple"),this.setAttributeNS(b,this.namespaces.xlink,"xlink:href",a),b},getOnlineResource_href:function(a){var b={},a=a.getElementsByTagName("OnlineResource");return 0<a.length&&this.read_wmc_OnlineResource(b,a[0]),b.href},CLASS_NAME:"OpenLayers.Format.WMC.v1"}),OpenLayers.Control.PanPanel=OpenLayers.Class(OpenLayers.Control.Panel,{slideFactor:50,slideRatio:null,initialize:function(a){OpenLayers.Control.Panel.prototype.initialize.apply(this,[a]),a={slideFactor:this.slideFactor,slideRatio:this.slideRatio},this.addControls([new OpenLayers.Control.Pan(OpenLayers.Control.Pan.NORTH,a),new OpenLayers.Control.Pan(OpenLayers.Control.Pan.SOUTH,a),new OpenLayers.Control.Pan(OpenLayers.Control.Pan.EAST,a),new OpenLayers.Control.Pan(OpenLayers.Control.Pan.WEST,a)])},CLASS_NAME:"OpenLayers.Control.PanPanel"}),OpenLayers.Control.Attribution=OpenLayers.Class(OpenLayers.Control,{separator:", ",template:"${layers}",destroy:function(){this.map.events.un({removelayer:this.updateAttribution,addlayer:this.updateAttribution,changelayer:this.updateAttribution,changebaselayer:this.updateAttribution,scope:this}),OpenLayers.Control.prototype.destroy.apply(this,arguments)},draw:function(){return OpenLayers.Control.prototype.draw.apply(this,arguments),this.map.events.on({changebaselayer:this.updateAttribution,changelayer:this.updateAttribution,addlayer:this.updateAttribution,removelayer:this.updateAttribution,scope:this}),this.updateAttribution(),this.div},updateAttribution:function(){var a=[];if(this.map&&this.map.layers){for(var b=0,c=this.map.layers.length;c>b;b++){var d=this.map.layers[b];d.attribution&&d.getVisibility()&&-1===OpenLayers.Util.indexOf(a,d.attribution)&&a.push(d.attribution)}this.div.innerHTML=OpenLayers.String.format(this.template,{layers:a.join(this.separator)})}},CLASS_NAME:"OpenLayers.Control.Attribution"}),OpenLayers.Kinetic=OpenLayers.Class({threshold:0,deceleration:.0035,nbPoints:100,delay:200,points:void 0,timerId:void 0,initialize:function(a){OpenLayers.Util.extend(this,a)},begin:function(){OpenLayers.Animation.stop(this.timerId),this.timerId=void 0,this.points=[]},update:function(a){this.points.unshift({xy:a,tick:(new Date).getTime()}),this.points.length>this.nbPoints&&this.points.pop()},end:function(a){for(var b,c,d=(new Date).getTime(),e=0,f=this.points.length;f>e&&(c=this.points[e],!(d-c.tick>this.delay));e++)b=c;return!b||(e=(new Date).getTime()-b.tick,d=Math.sqrt(Math.pow(a.x-b.xy.x,2)+Math.pow(a.y-b.xy.y,2)),e=d/e,0==e||e<this.threshold)?void 0:(d=Math.asin((a.y-b.xy.y)/d),b.xy.x<=a.x&&(d=Math.PI-d),{speed:e,theta:d})},move:function(a,b){var c=a.speed,d=Math.cos(a.theta),e=-Math.sin(a.theta),f=(new Date).getTime(),g=0,h=0;this.timerId=OpenLayers.Animation.start(OpenLayers.Function.bind(function(){if(null!=this.timerId){var a,i,j=(new Date).getTime()-f,k=-this.deceleration*Math.pow(j,2)/2+c*j,l=k*d,k=k*e;a=!1,0>=-this.deceleration*j+c&&(OpenLayers.Animation.stop(this.timerId),this.timerId=null,a=!0),j=l-g,i=k-h,g=l,h=k,b(j,i,a)}},this))},CLASS_NAME:"OpenLayers.Kinetic"}),OpenLayers.Layer.GeoRSS=OpenLayers.Class(OpenLayers.Layer.Markers,{location:null,features:null,formatOptions:null,selectedFeature:null,icon:null,popupSize:null,useFeedTitle:!0,initialize:function(a,b,c){OpenLayers.Layer.Markers.prototype.initialize.apply(this,[a,c]),this.location=b,this.features=[]},destroy:function(){OpenLayers.Layer.Markers.prototype.destroy.apply(this,arguments),this.clearFeatures(),this.features=null},loadRSS:function(){this.loaded||(this.events.triggerEvent("loadstart"),OpenLayers.Request.GET({url:this.location,success:this.parseData,scope:this}),this.loaded=!0)},moveTo:function(){OpenLayers.Layer.Markers.prototype.moveTo.apply(this,arguments),this.visibility&&!this.loaded&&this.loadRSS()},parseData:function(a){var b=a.responseXML;if(b&&b.documentElement||(b=OpenLayers.Format.XML.prototype.read(a.responseText)),this.useFeedTitle){a=null;try{a=b.getElementsByTagNameNS("*","title")[0].firstChild.nodeValue}catch(c){a=b.getElementsByTagName("title")[0].firstChild.nodeValue}a&&this.setName(a)}a={},OpenLayers.Util.extend(a,this.formatOptions),this.map&&!this.projection.equals(this.map.getProjectionObject())&&(a.externalProjection=this.projection,a.internalProjection=this.map.getProjectionObject());for(var b=new OpenLayers.Format.GeoRSS(a).read(b),a=0,d=b.length;d>a;a++){var e={},f=b[a];if(f.geometry){var g=f.attributes.title?f.attributes.title:"Untitled",h=f.attributes.description?f.attributes.description:"No description.",i=f.attributes.link?f.attributes.link:"",f=f.geometry.getBounds().getCenterLonLat();if(e.icon=null==this.icon?OpenLayers.Marker.defaultIcon():this.icon.clone(),e.popupSize=this.popupSize?this.popupSize.clone():new OpenLayers.Size(250,120),g||h){e.title=g,e.description=h;var j='<div class="olLayerGeoRSSClose">[x]</div>',j=j+'<div class="olLayerGeoRSSTitle">';i&&(j+='<a class="link" href="'+i+'" target="_blank">'),j+=g,i&&(j+="</a>"),j+="</div>",j+='<div style="" class="olLayerGeoRSSDescription">',j+=h,j+="</div>",e.popupContentHTML=j}f=new OpenLayers.Feature(this,f,e),this.features.push(f),e=f.createMarker(),e.events.register("click",f,this.markerClick),this.addMarker(e)}}this.events.triggerEvent("loadend")},markerClick:function(a){var b=this==this.layer.selectedFeature;this.layer.selectedFeature=b?null:this;for(var c=0,d=this.layer.map.popups.length;d>c;c++)this.layer.map.removePopup(this.layer.map.popups[c]);b||(b=this.createPopup(),OpenLayers.Event.observe(b.div,"click",OpenLayers.Function.bind(function(){for(var a=0,b=this.layer.map.popups.length;b>a;a++)this.layer.map.removePopup(this.layer.map.popups[a])},this)),this.layer.map.addPopup(b)),OpenLayers.Event.stop(a)},clearFeatures:function(){if(null!=this.features)for(;0<this.features.length;){var a=this.features[0];OpenLayers.Util.removeItem(this.features,a),a.destroy()}},CLASS_NAME:"OpenLayers.Layer.GeoRSS"}),OpenLayers.Symbolizer.Point=OpenLayers.Class(OpenLayers.Symbolizer,{initialize:function(){OpenLayers.Symbolizer.prototype.initialize.apply(this,arguments)},CLASS_NAME:"OpenLayers.Symbolizer.Point"}),OpenLayers.Symbolizer.Line=OpenLayers.Class(OpenLayers.Symbolizer,{initialize:function(){OpenLayers.Symbolizer.prototype.initialize.apply(this,arguments)},CLASS_NAME:"OpenLayers.Symbolizer.Line"}),OpenLayers.Symbolizer.Text=OpenLayers.Class(OpenLayers.Symbolizer,{initialize:function(){OpenLayers.Symbolizer.prototype.initialize.apply(this,arguments)},CLASS_NAME:"OpenLayers.Symbolizer.Text"}),OpenLayers.Format.SLD.v1=OpenLayers.Class(OpenLayers.Format.Filter.v1_0_0,{namespaces:{sld:"http://www.opengis.net/sld",ogc:"http://www.opengis.net/ogc",gml:"http://www.opengis.net/gml",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},defaultPrefix:"sld",schemaLocation:null,multipleSymbolizers:!1,featureTypeCounter:null,defaultSymbolizer:{fillColor:"#808080",fillOpacity:1,strokeColor:"#000000",strokeOpacity:1,strokeWidth:1,strokeDashstyle:"solid",pointRadius:3,graphicName:"square"},read:function(a,b){var b=OpenLayers.Util.applyDefaults(b,this.options),c={namedLayers:!0===b.namedLayersAsArray?[]:{}};return this.readChildNodes(a,c),c},readers:OpenLayers.Util.applyDefaults({sld:{StyledLayerDescriptor:function(a,b){b.version=a.getAttribute("version"),this.readChildNodes(a,b)},Name:function(a,b){b.name=this.getChildValue(a)},Title:function(a,b){b.title=this.getChildValue(a)},Abstract:function(a,b){b.description=this.getChildValue(a)},NamedLayer:function(a,b){var c={userStyles:[],namedStyles:[]};this.readChildNodes(a,c);for(var d=0,e=c.userStyles.length;e>d;++d)c.userStyles[d].layerName=c.name;OpenLayers.Util.isArray(b.namedLayers)?b.namedLayers.push(c):b.namedLayers[c.name]=c},NamedStyle:function(a,b){b.namedStyles.push(this.getChildName(a.firstChild))},UserStyle:function(a,b){var c={defaultsPerSymbolizer:!0,rules:[]};this.featureTypeCounter=-1,this.readChildNodes(a,c),this.multipleSymbolizers?(delete c.defaultsPerSymbolizer,c=new OpenLayers.Style2(c)):c=new OpenLayers.Style(this.defaultSymbolizer,c),b.userStyles.push(c)},IsDefault:function(a,b){"1"==this.getChildValue(a)&&(b.isDefault=!0)},FeatureTypeStyle:function(a,b){++this.featureTypeCounter;var c={rules:this.multipleSymbolizers?b.rules:[]};this.readChildNodes(a,c),this.multipleSymbolizers||(b.rules=c.rules)},Rule:function(a,b){var c;this.multipleSymbolizers&&(c={symbolizers:[]}),c=new OpenLayers.Rule(c),this.readChildNodes(a,c),b.rules.push(c)},ElseFilter:function(a,b){b.elseFilter=!0},MinScaleDenominator:function(a,b){b.minScaleDenominator=parseFloat(this.getChildValue(a))},MaxScaleDenominator:function(a,b){b.maxScaleDenominator=parseFloat(this.getChildValue(a))},TextSymbolizer:function(a,b){var c={};this.readChildNodes(a,c),this.multipleSymbolizers?(c.zIndex=this.featureTypeCounter,b.symbolizers.push(new OpenLayers.Symbolizer.Text(c))):b.symbolizer.Text=OpenLayers.Util.applyDefaults(c,b.symbolizer.Text)},LabelPlacement:function(a,b){this.readChildNodes(a,b)},PointPlacement:function(a,b){var c={};this.readChildNodes(a,c),c.labelRotation=c.rotation,delete c.rotation;var d,e=b.labelAnchorPointX,f=b.labelAnchorPointY;1/3>=e?d="l":e>1/3&&2/3>e?d="c":e>=2/3&&(d="r"),1/3>=f?d+="b":f>1/3&&2/3>f?d+="m":f>=2/3&&(d+="t"),c.labelAlign=d,OpenLayers.Util.applyDefaults(b,c)},AnchorPoint:function(a,b){this.readChildNodes(a,b)},AnchorPointX:function(a,b){var c=this.readers.ogc._expression.call(this,a);c&&(b.labelAnchorPointX=c)},AnchorPointY:function(a,b){var c=this.readers.ogc._expression.call(this,a);c&&(b.labelAnchorPointY=c)},Displacement:function(a,b){this.readChildNodes(a,b)},DisplacementX:function(a,b){var c=this.readers.ogc._expression.call(this,a);c&&(b.labelXOffset=c)},DisplacementY:function(a,b){var c=this.readers.ogc._expression.call(this,a);c&&(b.labelYOffset=c)},LinePlacement:function(a,b){this.readChildNodes(a,b)},PerpendicularOffset:function(a,b){var c=this.readers.ogc._expression.call(this,a);c&&(b.labelPerpendicularOffset=c)},Label:function(a,b){var c=this.readers.ogc._expression.call(this,a);c&&(b.label=c)},Font:function(a,b){this.readChildNodes(a,b)},Halo:function(a,b){var c={};this.readChildNodes(a,c),b.haloRadius=c.haloRadius,b.haloColor=c.fillColor,b.haloOpacity=c.fillOpacity},Radius:function(a,b){var c=this.readers.ogc._expression.call(this,a);null!=c&&(b.haloRadius=c)},RasterSymbolizer:function(a,b){var c={};this.readChildNodes(a,c),this.multipleSymbolizers?(c.zIndex=this.featureTypeCounter,b.symbolizers.push(new OpenLayers.Symbolizer.Raster(c))):b.symbolizer.Raster=OpenLayers.Util.applyDefaults(c,b.symbolizer.Raster)},Geometry:function(a,b){b.geometry={},this.readChildNodes(a,b.geometry)},ColorMap:function(a,b){b.colorMap=[],this.readChildNodes(a,b.colorMap)},ColorMapEntry:function(a,b){var c=a.getAttribute("quantity"),d=a.getAttribute("opacity");b.push({color:a.getAttribute("color"),quantity:null!==c?parseFloat(c):void 0,label:a.getAttribute("label")||void 0,opacity:null!==d?parseFloat(d):void 0})},LineSymbolizer:function(a,b){var c={};this.readChildNodes(a,c),this.multipleSymbolizers?(c.zIndex=this.featureTypeCounter,b.symbolizers.push(new OpenLayers.Symbolizer.Line(c))):b.symbolizer.Line=OpenLayers.Util.applyDefaults(c,b.symbolizer.Line)},PolygonSymbolizer:function(a,b){var c={fill:!1,stroke:!1};this.multipleSymbolizers||(c=b.symbolizer.Polygon||c),this.readChildNodes(a,c),this.multipleSymbolizers?(c.zIndex=this.featureTypeCounter,b.symbolizers.push(new OpenLayers.Symbolizer.Polygon(c))):b.symbolizer.Polygon=c},PointSymbolizer:function(a,b){var c={fill:!1,stroke:!1,graphic:!1};this.multipleSymbolizers||(c=b.symbolizer.Point||c),this.readChildNodes(a,c),this.multipleSymbolizers?(c.zIndex=this.featureTypeCounter,b.symbolizers.push(new OpenLayers.Symbolizer.Point(c))):b.symbolizer.Point=c},Stroke:function(a,b){b.stroke=!0,this.readChildNodes(a,b)},Fill:function(a,b){b.fill=!0,this.readChildNodes(a,b)},CssParameter:function(a,b){var c=a.getAttribute("name"),d=this.cssMap[c];b.label&&("fill"===c?d="fontColor":"fill-opacity"===c&&(d="fontOpacity")),d&&(c=this.readers.ogc._expression.call(this,a))&&(b[d]=c)},Graphic:function(a,b){b.graphic=!0;var c={};this.readChildNodes(a,c);for(var d,e,f="stroke strokeColor strokeWidth strokeOpacity strokeLinecap fill fillColor fillOpacity graphicName rotation graphicFormat".split(" "),g=0,h=f.length;h>g;++g)d=f[g],e=c[d],void 0!=e&&(b[d]=e);void 0!=c.opacity&&(b.graphicOpacity=c.opacity),void 0!=c.size&&(isNaN(c.size/2)?b.graphicWidth=c.size:b.pointRadius=c.size/2),void 0!=c.href&&(b.externalGraphic=c.href),void 0!=c.rotation&&(b.rotation=c.rotation)},ExternalGraphic:function(a,b){this.readChildNodes(a,b)},Mark:function(a,b){this.readChildNodes(a,b)},WellKnownName:function(a,b){b.graphicName=this.getChildValue(a)},Opacity:function(a,b){var c=this.readers.ogc._expression.call(this,a);c&&(b.opacity=c)},Size:function(a,b){var c=this.readers.ogc._expression.call(this,a);c&&(b.size=c)},Rotation:function(a,b){var c=this.readers.ogc._expression.call(this,a);c&&(b.rotation=c)},OnlineResource:function(a,b){b.href=this.getAttributeNS(a,this.namespaces.xlink,"href")},Format:function(a,b){b.graphicFormat=this.getChildValue(a)}}},OpenLayers.Format.Filter.v1_0_0.prototype.readers),cssMap:{stroke:"strokeColor","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","stroke-linecap":"strokeLinecap","stroke-dasharray":"strokeDashstyle",fill:"fillColor","fill-opacity":"fillOpacity","font-family":"fontFamily","font-size":"fontSize","font-weight":"fontWeight","font-style":"fontStyle"},getCssProperty:function(a){var b,c=null;for(b in this.cssMap)if(this.cssMap[b]==a){c=b;break}return c},getGraphicFormat:function(a){var b,c;for(c in this.graphicFormats)if(this.graphicFormats[c].test(a)){b=c;break}return b||this.defaultGraphicFormat},defaultGraphicFormat:"image/png",graphicFormats:{"image/jpeg":/\.jpe?g$/i,"image/gif":/\.gif$/i,"image/png":/\.png$/i},write:function(a){return this.writers.sld.StyledLayerDescriptor.apply(this,[a])},writers:OpenLayers.Util.applyDefaults({sld:{_OGCExpression:function(a,b){var c=this.createElementNSPlus(a),d="string"==typeof b?b.split("${"):[b];c.appendChild(this.createTextNode(d[0]));for(var e,f,g=1,h=d.length;h>g;g++)e=d[g],f=e.indexOf("}"),f>0?(this.writeNode("ogc:PropertyName",{property:e.substring(0,f)},c),c.appendChild(this.createTextNode(e.substring(++f)))):c.appendChild(this.createTextNode("${"+e));return c},StyledLayerDescriptor:function(a){var b=this.createElementNSPlus("sld:StyledLayerDescriptor",{attributes:{version:this.VERSION,"xsi:schemaLocation":this.schemaLocation}});if(b.setAttribute("xmlns:ogc",this.namespaces.ogc),b.setAttribute("xmlns:gml",this.namespaces.gml),a.name&&this.writeNode("Name",a.name,b),a.title&&this.writeNode("Title",a.title,b),a.description&&this.writeNode("Abstract",a.description,b),OpenLayers.Util.isArray(a.namedLayers))for(var c=0,d=a.namedLayers.length;d>c;++c)this.writeNode("NamedLayer",a.namedLayers[c],b);else for(c in a.namedLayers)this.writeNode("NamedLayer",a.namedLayers[c],b);return b},Name:function(a){return this.createElementNSPlus("sld:Name",{value:a})},Title:function(a){return this.createElementNSPlus("sld:Title",{value:a})},Abstract:function(a){return this.createElementNSPlus("sld:Abstract",{value:a})},NamedLayer:function(a){var b=this.createElementNSPlus("sld:NamedLayer");if(this.writeNode("Name",a.name,b),a.namedStyles)for(var c=0,d=a.namedStyles.length;d>c;++c)this.writeNode("NamedStyle",a.namedStyles[c],b);if(a.userStyles)for(c=0,d=a.userStyles.length;d>c;++c)this.writeNode("UserStyle",a.userStyles[c],b);return b},NamedStyle:function(a){var b=this.createElementNSPlus("sld:NamedStyle");return this.writeNode("Name",a,b),b},UserStyle:function(a){var b=this.createElementNSPlus("sld:UserStyle");if(a.name&&this.writeNode("Name",a.name,b),a.title&&this.writeNode("Title",a.title,b),a.description&&this.writeNode("Abstract",a.description,b),a.isDefault&&this.writeNode("IsDefault",a.isDefault,b),this.multipleSymbolizers&&a.rules){for(var c,d,e,f,g,h={0:[]},i=[0],j=0,k=a.rules.length;k>j;++j)if(c=a.rules[j],c.symbolizers){d={};for(var l=0,m=c.symbolizers.length;m>l;++l)e=c.symbolizers[l],f=e.zIndex,f in d||(g=c.clone(),g.symbolizers=[],d[f]=g),d[f].symbolizers.push(e.clone());for(f in d)f in h||(i.push(f),h[f]=[]),h[f].push(d[f])}else h[0].push(c.clone());for(i.sort(),j=0,k=i.length;k>j;++j)c=h[i[j]],0<c.length&&(g=a.clone(),g.rules=h[i[j]],this.writeNode("FeatureTypeStyle",g,b))}else this.writeNode("FeatureTypeStyle",a,b);return b},IsDefault:function(a){return this.createElementNSPlus("sld:IsDefault",{value:a?"1":"0"})},FeatureTypeStyle:function(a){for(var b=this.createElementNSPlus("sld:FeatureTypeStyle"),c=0,d=a.rules.length;d>c;++c)this.writeNode("Rule",a.rules[c],b);return b},Rule:function(a){var b=this.createElementNSPlus("sld:Rule");a.name&&this.writeNode("Name",a.name,b),a.title&&this.writeNode("Title",a.title,b),a.description&&this.writeNode("Abstract",a.description,b),a.elseFilter?this.writeNode("ElseFilter",null,b):a.filter&&this.writeNode("ogc:Filter",a.filter,b),void 0!=a.minScaleDenominator&&this.writeNode("MinScaleDenominator",a.minScaleDenominator,b),void 0!=a.maxScaleDenominator&&this.writeNode("MaxScaleDenominator",a.maxScaleDenominator,b);var c,d;if(this.multipleSymbolizers&&a.symbolizers)for(var e=0,f=a.symbolizers.length;f>e;++e)d=a.symbolizers[e],c=d.CLASS_NAME.split(".").pop(),this.writeNode(c+"Symbolizer",d,b);else for(var f=OpenLayers.Style.SYMBOLIZER_PREFIXES,e=0,g=f.length;g>e;++e)c=f[e],(d=a.symbolizer[c])&&this.writeNode(c+"Symbolizer",d,b);return b},ElseFilter:function(){return this.createElementNSPlus("sld:ElseFilter")},MinScaleDenominator:function(a){return this.createElementNSPlus("sld:MinScaleDenominator",{value:a})},MaxScaleDenominator:function(a){return this.createElementNSPlus("sld:MaxScaleDenominator",{value:a})},LineSymbolizer:function(a){var b=this.createElementNSPlus("sld:LineSymbolizer");return this.writeNode("Stroke",a,b),b},Stroke:function(a){var b=this.createElementNSPlus("sld:Stroke");return void 0!=a.strokeColor&&this.writeNode("CssParameter",{symbolizer:a,key:"strokeColor"},b),void 0!=a.strokeOpacity&&this.writeNode("CssParameter",{symbolizer:a,key:"strokeOpacity"},b),void 0!=a.strokeWidth&&this.writeNode("CssParameter",{symbolizer:a,key:"strokeWidth"},b),void 0!=a.strokeDashstyle&&"solid"!==a.strokeDashstyle&&this.writeNode("CssParameter",{symbolizer:a,key:"strokeDashstyle"},b),void 0!=a.strokeLinecap&&this.writeNode("CssParameter",{symbolizer:a,key:"strokeLinecap"},b),b},CssParameter:function(a){return this.createElementNSPlus("sld:CssParameter",{attributes:{name:this.getCssProperty(a.key)},value:a.symbolizer[a.key]})},TextSymbolizer:function(a){var b=this.createElementNSPlus("sld:TextSymbolizer");return null!=a.label&&this.writeNode("Label",a.label,b),(null!=a.fontFamily||null!=a.fontSize||null!=a.fontWeight||null!=a.fontStyle)&&this.writeNode("Font",a,b),(null!=a.labelAnchorPointX||null!=a.labelAnchorPointY||null!=a.labelAlign||null!=a.labelXOffset||null!=a.labelYOffset||null!=a.labelRotation||null!=a.labelPerpendicularOffset)&&this.writeNode("LabelPlacement",a,b),(null!=a.haloRadius||null!=a.haloColor||null!=a.haloOpacity)&&this.writeNode("Halo",a,b),(null!=a.fontColor||null!=a.fontOpacity)&&this.writeNode("Fill",{fillColor:a.fontColor,fillOpacity:a.fontOpacity},b),b},LabelPlacement:function(a){var b=this.createElementNSPlus("sld:LabelPlacement");
return(null!=a.labelAnchorPointX||null!=a.labelAnchorPointY||null!=a.labelAlign||null!=a.labelXOffset||null!=a.labelYOffset||null!=a.labelRotation)&&null==a.labelPerpendicularOffset&&this.writeNode("PointPlacement",a,b),null!=a.labelPerpendicularOffset&&this.writeNode("LinePlacement",a,b),b},LinePlacement:function(a){var b=this.createElementNSPlus("sld:LinePlacement");return this.writeNode("PerpendicularOffset",a.labelPerpendicularOffset,b),b},PerpendicularOffset:function(a){return this.createElementNSPlus("sld:PerpendicularOffset",{value:a})},PointPlacement:function(a){var b=this.createElementNSPlus("sld:PointPlacement");return(null!=a.labelAnchorPointX||null!=a.labelAnchorPointY||null!=a.labelAlign)&&this.writeNode("AnchorPoint",a,b),(null!=a.labelXOffset||null!=a.labelYOffset)&&this.writeNode("Displacement",a,b),null!=a.labelRotation&&this.writeNode("Rotation",a.labelRotation,b),b},AnchorPoint:function(a){var b=this.createElementNSPlus("sld:AnchorPoint"),c=a.labelAnchorPointX,d=a.labelAnchorPointY;if(null!=c&&this.writeNode("AnchorPointX",c,b),null!=d&&this.writeNode("AnchorPointY",d,b),null==c&&null==d){var e=a.labelAlign.substr(0,1),a=a.labelAlign.substr(1,1);"l"===e?c=0:"c"===e?c=.5:"r"===e&&(c=1),"b"===a?d=0:"m"===a?d=.5:"t"===a&&(d=1),this.writeNode("AnchorPointX",c,b),this.writeNode("AnchorPointY",d,b)}return b},AnchorPointX:function(a){return this.createElementNSPlus("sld:AnchorPointX",{value:a})},AnchorPointY:function(a){return this.createElementNSPlus("sld:AnchorPointY",{value:a})},Displacement:function(a){var b=this.createElementNSPlus("sld:Displacement");return null!=a.labelXOffset&&this.writeNode("DisplacementX",a.labelXOffset,b),null!=a.labelYOffset&&this.writeNode("DisplacementY",a.labelYOffset,b),b},DisplacementX:function(a){return this.createElementNSPlus("sld:DisplacementX",{value:a})},DisplacementY:function(a){return this.createElementNSPlus("sld:DisplacementY",{value:a})},Font:function(a){var b=this.createElementNSPlus("sld:Font");return a.fontFamily&&this.writeNode("CssParameter",{symbolizer:a,key:"fontFamily"},b),a.fontSize&&this.writeNode("CssParameter",{symbolizer:a,key:"fontSize"},b),a.fontWeight&&this.writeNode("CssParameter",{symbolizer:a,key:"fontWeight"},b),a.fontStyle&&this.writeNode("CssParameter",{symbolizer:a,key:"fontStyle"},b),b},Label:function(a){return this.writers.sld._OGCExpression.call(this,"sld:Label",a)},Halo:function(a){var b=this.createElementNSPlus("sld:Halo");return a.haloRadius&&this.writeNode("Radius",a.haloRadius,b),(a.haloColor||a.haloOpacity)&&this.writeNode("Fill",{fillColor:a.haloColor,fillOpacity:a.haloOpacity},b),b},Radius:function(a){return this.createElementNSPlus("sld:Radius",{value:a})},RasterSymbolizer:function(a){var b=this.createElementNSPlus("sld:RasterSymbolizer");return a.geometry&&this.writeNode("Geometry",a.geometry,b),a.opacity&&this.writeNode("Opacity",a.opacity,b),a.colorMap&&this.writeNode("ColorMap",a.colorMap,b),b},Geometry:function(a){var b=this.createElementNSPlus("sld:Geometry");return a.property&&this.writeNode("ogc:PropertyName",a,b),b},ColorMap:function(a){for(var b=this.createElementNSPlus("sld:ColorMap"),c=0,d=a.length;d>c;++c)this.writeNode("ColorMapEntry",a[c],b);return b},ColorMapEntry:function(a){var b=this.createElementNSPlus("sld:ColorMapEntry");return b.setAttribute("color",a.color),void 0!==a.opacity&&b.setAttribute("opacity",parseFloat(a.opacity)),void 0!==a.quantity&&b.setAttribute("quantity",parseFloat(a.quantity)),void 0!==a.label&&b.setAttribute("label",a.label),b},PolygonSymbolizer:function(a){var b=this.createElementNSPlus("sld:PolygonSymbolizer");return!1!==a.fill&&this.writeNode("Fill",a,b),!1!==a.stroke&&this.writeNode("Stroke",a,b),b},Fill:function(a){var b=this.createElementNSPlus("sld:Fill");return a.fillColor&&this.writeNode("CssParameter",{symbolizer:a,key:"fillColor"},b),null!=a.fillOpacity&&this.writeNode("CssParameter",{symbolizer:a,key:"fillOpacity"},b),b},PointSymbolizer:function(a){var b=this.createElementNSPlus("sld:PointSymbolizer");return this.writeNode("Graphic",a,b),b},Graphic:function(a){var b=this.createElementNSPlus("sld:Graphic");return void 0!=a.externalGraphic?this.writeNode("ExternalGraphic",a,b):this.writeNode("Mark",a,b),void 0!=a.graphicOpacity&&this.writeNode("Opacity",a.graphicOpacity,b),void 0!=a.pointRadius?this.writeNode("Size",2*a.pointRadius,b):void 0!=a.graphicWidth&&this.writeNode("Size",a.graphicWidth,b),void 0!=a.rotation&&this.writeNode("Rotation",a.rotation,b),b},ExternalGraphic:function(a){var b=this.createElementNSPlus("sld:ExternalGraphic");return this.writeNode("OnlineResource",a.externalGraphic,b),this.writeNode("Format",a.graphicFormat||this.getGraphicFormat(a.externalGraphic),b),b},Mark:function(a){var b=this.createElementNSPlus("sld:Mark");return a.graphicName&&this.writeNode("WellKnownName",a.graphicName,b),!1!==a.fill&&this.writeNode("Fill",a,b),!1!==a.stroke&&this.writeNode("Stroke",a,b),b},WellKnownName:function(a){return this.createElementNSPlus("sld:WellKnownName",{value:a})},Opacity:function(a){return this.createElementNSPlus("sld:Opacity",{value:a})},Size:function(a){return this.writers.sld._OGCExpression.call(this,"sld:Size",a)},Rotation:function(a){return this.createElementNSPlus("sld:Rotation",{value:a})},OnlineResource:function(a){return this.createElementNSPlus("sld:OnlineResource",{attributes:{"xlink:type":"simple","xlink:href":a}})},Format:function(a){return this.createElementNSPlus("sld:Format",{value:a})}}},OpenLayers.Format.Filter.v1_0_0.prototype.writers),CLASS_NAME:"OpenLayers.Format.SLD.v1"}),OpenLayers.Layer.WMS=OpenLayers.Class(OpenLayers.Layer.Grid,{DEFAULT_PARAMS:{service:"WMS",version:"1.1.1",request:"GetMap",styles:"",format:"image/jpeg"},isBaseLayer:!0,encodeBBOX:!1,noMagic:!1,yx:{},initialize:function(a,b,c,d){var e=[],c=OpenLayers.Util.upperCaseObject(c);1.3<=parseFloat(c.VERSION)&&!c.EXCEPTIONS&&(c.EXCEPTIONS="INIMAGE"),e.push(a,b,c,d),OpenLayers.Layer.Grid.prototype.initialize.apply(this,e),OpenLayers.Util.applyDefaults(this.params,OpenLayers.Util.upperCaseObject(this.DEFAULT_PARAMS)),!this.noMagic&&this.params.TRANSPARENT&&"true"==this.params.TRANSPARENT.toString().toLowerCase()&&(null!=d&&d.isBaseLayer||(this.isBaseLayer=!1),"image/jpeg"==this.params.FORMAT&&(this.params.FORMAT=OpenLayers.Util.alphaHack()?"image/gif":"image/png"))},clone:function(a){return null==a&&(a=new OpenLayers.Layer.WMS(this.name,this.url,this.params,this.getOptions())),a=OpenLayers.Layer.Grid.prototype.clone.apply(this,[a])},reverseAxisOrder:function(){var a=this.projection.getCode();return 1.3<=parseFloat(this.params.VERSION)&&!(!this.yx[a]&&!OpenLayers.Projection.defaults[a].yx)},getURL:function(a){var a=this.adjustBounds(a),b=this.getImageSize(),c={},d=this.reverseAxisOrder();return c.BBOX=this.encodeBBOX?a.toBBOX(null,d):a.toArray(d),c.WIDTH=b.w,c.HEIGHT=b.h,this.getFullRequestString(c)},mergeNewParams:function(a){return a=[OpenLayers.Util.upperCaseObject(a)],OpenLayers.Layer.Grid.prototype.mergeNewParams.apply(this,a)},getFullRequestString:function(a){var b=this.map.getProjectionObject(),b=this.projection&&this.projection.equals(b)?this.projection.getCode():b.getCode(),b="none"==b?null:b;return 1.3<=parseFloat(this.params.VERSION)?this.params.CRS=b:this.params.SRS=b,"boolean"==typeof this.params.TRANSPARENT&&(a.TRANSPARENT=this.params.TRANSPARENT?"TRUE":"FALSE"),OpenLayers.Layer.Grid.prototype.getFullRequestString.apply(this,arguments)},CLASS_NAME:"OpenLayers.Layer.WMS"}),OpenLayers.Format.WMC.v1_1_0=OpenLayers.Class(OpenLayers.Format.WMC.v1,{VERSION:"1.1.0",schemaLocation:"http://www.opengis.net/context http://schemas.opengis.net/context/1.1.0/context.xsd",initialize:function(a){OpenLayers.Format.WMC.v1.prototype.initialize.apply(this,[a])},read_sld_MinScaleDenominator:function(a,b){var c=parseFloat(this.getChildValue(b));c>0&&(a.maxScale=c)},read_sld_MaxScaleDenominator:function(a,b){a.minScale=parseFloat(this.getChildValue(b))},read_wmc_SRS:function(a,b){"srs"in a||(a.srs={}),a.srs[this.getChildValue(b)]=!0},write_wmc_Layer:function(a){var b=OpenLayers.Format.WMC.v1.prototype.write_wmc_Layer.apply(this,[a]);if(a.maxScale){var c=this.createElementNS(this.namespaces.sld,"sld:MinScaleDenominator");c.appendChild(this.createTextNode(a.maxScale.toPrecision(16))),b.appendChild(c)}if(a.minScale&&(c=this.createElementNS(this.namespaces.sld,"sld:MaxScaleDenominator"),c.appendChild(this.createTextNode(a.minScale.toPrecision(16))),b.appendChild(c)),a.srs)for(var d in a.srs)b.appendChild(this.createElementDefaultNS("SRS",d));return b.appendChild(this.write_wmc_FormatList(a)),b.appendChild(this.write_wmc_StyleList(a)),a.dimensions&&b.appendChild(this.write_wmc_DimensionList(a)),b.appendChild(this.write_wmc_LayerExtension(a)),b},CLASS_NAME:"OpenLayers.Format.WMC.v1_1_0"}),OpenLayers.Format.XLS=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.1.0",stringifyOutput:!0,CLASS_NAME:"OpenLayers.Format.XLS"}),OpenLayers.Format.XLS.v1=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{xls:"http://www.opengis.net/xls",gml:"http://www.opengis.net/gml",xsi:"http://www.w3.org/2001/XMLSchema-instance"},regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},xy:!0,defaultPrefix:"xls",schemaLocation:null,read:function(a,b){OpenLayers.Util.applyDefaults(b,this.options);var c={};return this.readChildNodes(a,c),c},readers:{xls:{XLS:function(a,b){b.version=a.getAttribute("version"),this.readChildNodes(a,b)},Response:function(a,b){this.readChildNodes(a,b)},GeocodeResponse:function(a,b){b.responseLists=[],this.readChildNodes(a,b)},GeocodeResponseList:function(a,b){var c={features:[],numberOfGeocodedAddresses:parseInt(a.getAttribute("numberOfGeocodedAddresses"))};b.responseLists.push(c),this.readChildNodes(a,c)},GeocodedAddress:function(a,b){var c=new OpenLayers.Feature.Vector;b.features.push(c),this.readChildNodes(a,c),c.geometry=c.components[0]},GeocodeMatchCode:function(a,b){b.attributes.matchCode={accuracy:parseFloat(a.getAttribute("accuracy")),matchType:a.getAttribute("matchType")}},Address:function(a,b){var c={countryCode:a.getAttribute("countryCode"),addressee:a.getAttribute("addressee"),street:[],place:[]};b.attributes.address=c,this.readChildNodes(a,c)},freeFormAddress:function(a,b){b.freeFormAddress=this.getChildValue(a)},StreetAddress:function(a,b){this.readChildNodes(a,b)},Building:function(a,b){b.building={number:a.getAttribute("number"),subdivision:a.getAttribute("subdivision"),buildingName:a.getAttribute("buildingName")}},Street:function(a,b){b.street.push(this.getChildValue(a))},Place:function(a,b){b.place[a.getAttribute("type")]=this.getChildValue(a)},PostalCode:function(a,b){b.postalCode=this.getChildValue(a)}},gml:OpenLayers.Format.GML.v3.prototype.readers.gml},write:function(a){return this.writers.xls.XLS.apply(this,[a])},writers:{xls:{XLS:function(a){var b=this.createElementNSPlus("xls:XLS",{attributes:{version:this.VERSION,"xsi:schemaLocation":this.schemaLocation}});return this.writeNode("RequestHeader",a.header,b),this.writeNode("Request",a,b),b},RequestHeader:function(){return this.createElementNSPlus("xls:RequestHeader")},Request:function(a){var b=this.createElementNSPlus("xls:Request",{attributes:{methodName:"GeocodeRequest",requestID:a.requestID||"",version:this.VERSION}});return this.writeNode("GeocodeRequest",a.addresses,b),b},GeocodeRequest:function(a){for(var b=this.createElementNSPlus("xls:GeocodeRequest"),c=0,d=a.length;d>c;c++)this.writeNode("Address",a[c],b);return b},Address:function(a){var b=this.createElementNSPlus("xls:Address",{attributes:{countryCode:a.countryCode}});return a.freeFormAddress?this.writeNode("freeFormAddress",a.freeFormAddress,b):(a.street&&this.writeNode("StreetAddress",a,b),a.municipality&&this.writeNode("Municipality",a.municipality,b),a.countrySubdivision&&this.writeNode("CountrySubdivision",a.countrySubdivision,b),a.postalCode&&this.writeNode("PostalCode",a.postalCode,b)),b},freeFormAddress:function(a){return this.createElementNSPlus("freeFormAddress",{value:a})},StreetAddress:function(a){var b=this.createElementNSPlus("xls:StreetAddress");a.building&&this.writeNode(b,"Building",a.building),a=a.street,OpenLayers.Util.isArray(a)||(a=[a]);for(var c=0,d=a.length;d>c;c++)this.writeNode("Street",a[c],b);return b},Building:function(a){return this.createElementNSPlus("xls:Building",{attributes:{number:a.number,subdivision:a.subdivision,buildingName:a.buildingName}})},Street:function(a){return this.createElementNSPlus("xls:Street",{value:a})},Municipality:function(a){return this.createElementNSPlus("xls:Place",{attributes:{type:"Municipality"},value:a})},CountrySubdivision:function(a){return this.createElementNSPlus("xls:Place",{attributes:{type:"CountrySubdivision"},value:a})},PostalCode:function(a){return this.createElementNSPlus("xls:PostalCode",{value:a})}}},CLASS_NAME:"OpenLayers.Format.XLS.v1"}),OpenLayers.Format.XLS.v1_1_0=OpenLayers.Class(OpenLayers.Format.XLS.v1,{VERSION:"1.1",schemaLocation:"http://www.opengis.net/xls http://schemas.opengis.net/ols/1.1.0/LocationUtilityService.xsd",CLASS_NAME:"OpenLayers.Format.XLS.v1_1_0"}),OpenLayers.Format.XLS.v1_1=OpenLayers.Format.XLS.v1_1_0,OpenLayers.Renderer.SVG=OpenLayers.Class(OpenLayers.Renderer.Elements,{xmlns:"http://www.w3.org/2000/svg",xlinkns:"http://www.w3.org/1999/xlink",MAX_PIXEL:15e3,translationParameters:null,symbolMetrics:null,initialize:function(){this.supported()&&(OpenLayers.Renderer.Elements.prototype.initialize.apply(this,arguments),this.translationParameters={x:0,y:0},this.symbolMetrics={})},supported:function(){return document.implementation&&(document.implementation.hasFeature("org.w3c.svg","1.0")||document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#SVG","1.1")||document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1"))},inValidRange:function(a,b,c){return a+=c?0:this.translationParameters.x,b+=c?0:this.translationParameters.y,a>=-this.MAX_PIXEL&&a<=this.MAX_PIXEL&&b>=-this.MAX_PIXEL&&b<=this.MAX_PIXEL},setExtent:function(a,b){var c=OpenLayers.Renderer.Elements.prototype.setExtent.apply(this,arguments),d=this.getResolution(),e=-a.left/d,d=a.top/d;return b?(this.left=e,this.top=d,this.rendererRoot.setAttributeNS(null,"viewBox","0 0 "+this.size.w+" "+this.size.h),this.translate(this.xOffset,0),!0):((e=this.translate(e-this.left+this.xOffset,d-this.top))||this.setExtent(a,!0),c&&e)},translate:function(a,b){if(this.inValidRange(a,b,!0)){var c="";return(a||b)&&(c="translate("+a+","+b+")"),this.root.setAttributeNS(null,"transform",c),this.translationParameters={x:a,y:b},!0}return!1},setSize:function(){OpenLayers.Renderer.prototype.setSize.apply(this,arguments),this.rendererRoot.setAttributeNS(null,"width",this.size.w),this.rendererRoot.setAttributeNS(null,"height",this.size.h)},getNodeType:function(a,b){var c=null;switch(a.CLASS_NAME){case"OpenLayers.Geometry.Point":c=b.externalGraphic?"image":this.isComplexSymbol(b.graphicName)?"svg":"circle";break;case"OpenLayers.Geometry.Rectangle":c="rect";break;case"OpenLayers.Geometry.LineString":c="polyline";break;case"OpenLayers.Geometry.LinearRing":c="polygon";break;case"OpenLayers.Geometry.Polygon":case"OpenLayers.Geometry.Curve":c="path"}return c},setStyle:function(a,b,c){var d,b=b||a._style,c=c||a._options,e=parseFloat(a.getAttributeNS(null,"r")),f=1;if("OpenLayers.Geometry.Point"==a._geometryClass&&e){if(a.style.visibility="",!1===b.graphic)a.style.visibility="hidden";else if(b.externalGraphic){d=this.getPosition(a),b.graphicTitle&&(a.setAttributeNS(null,"title",b.graphicTitle),e=a.getElementsByTagName("title"),0<e.length?e[0].firstChild.textContent=b.graphicTitle:(e=this.nodeFactory(null,"title"),e.textContent=b.graphicTitle,a.appendChild(e))),b.graphicWidth&&b.graphicHeight&&a.setAttributeNS(null,"preserveAspectRatio","none");var e=b.graphicWidth||b.graphicHeight,g=b.graphicHeight||b.graphicWidth,e=e?e:2*b.pointRadius,g=g?g:2*b.pointRadius,h=void 0!=b.graphicYOffset?b.graphicYOffset:-(.5*g),i=b.graphicOpacity||b.fillOpacity;a.setAttributeNS(null,"x",(d.x+(void 0!=b.graphicXOffset?b.graphicXOffset:-(.5*e))).toFixed()),a.setAttributeNS(null,"y",(d.y+h).toFixed()),a.setAttributeNS(null,"width",e),a.setAttributeNS(null,"height",g),a.setAttributeNS(this.xlinkns,"href",b.externalGraphic),a.setAttributeNS(null,"style","opacity: "+i),a.onclick=OpenLayers.Renderer.SVG.preventDefault}else if(this.isComplexSymbol(b.graphicName)){var e=3*b.pointRadius,g=2*e,j=this.importSymbol(b.graphicName);d=this.getPosition(a),f=3*this.symbolMetrics[j.id][0]/g,h=a.parentNode,i=a.nextSibling,h&&h.removeChild(a),a.firstChild&&a.removeChild(a.firstChild),a.appendChild(j.firstChild.cloneNode(!0)),a.setAttributeNS(null,"viewBox",j.getAttributeNS(null,"viewBox")),a.setAttributeNS(null,"width",g),a.setAttributeNS(null,"height",g),a.setAttributeNS(null,"x",d.x-e),a.setAttributeNS(null,"y",d.y-e),i?h.insertBefore(a,i):h&&h.appendChild(a)}else a.setAttributeNS(null,"r",b.pointRadius);e=b.rotation,void 0===e&&void 0===a._rotation||!d||(a._rotation=e,e|=0,"svg"!==a.nodeName?a.setAttributeNS(null,"transform","rotate("+e+" "+d.x+" "+d.y+")"):(d=this.symbolMetrics[j.id],a.firstChild.setAttributeNS(null,"transform","rotate("+e+" "+d[1]+" "+d[2]+")")))}return c.isFilled?(a.setAttributeNS(null,"fill",b.fillColor),a.setAttributeNS(null,"fill-opacity",b.fillOpacity)):a.setAttributeNS(null,"fill","none"),c.isStroked?(a.setAttributeNS(null,"stroke",b.strokeColor),a.setAttributeNS(null,"stroke-opacity",b.strokeOpacity),a.setAttributeNS(null,"stroke-width",b.strokeWidth*f),a.setAttributeNS(null,"stroke-linecap",b.strokeLinecap||"round"),a.setAttributeNS(null,"stroke-linejoin","round"),b.strokeDashstyle&&a.setAttributeNS(null,"stroke-dasharray",this.dashStyle(b,f))):a.setAttributeNS(null,"stroke","none"),b.pointerEvents&&a.setAttributeNS(null,"pointer-events",b.pointerEvents),null!=b.cursor&&a.setAttributeNS(null,"cursor",b.cursor),a},dashStyle:function(a,b){var c=a.strokeWidth*b,d=a.strokeDashstyle;switch(d){case"solid":return"none";case"dot":return[1,4*c].join();case"dash":return[4*c,4*c].join();case"dashdot":return[4*c,4*c,1,4*c].join();case"longdash":return[8*c,4*c].join();case"longdashdot":return[8*c,4*c,1,4*c].join();default:return OpenLayers.String.trim(d).replace(/\s+/g,",")}},createNode:function(a,b){var c=document.createElementNS(this.xmlns,a);return b&&c.setAttributeNS(null,"id",b),c},nodeTypeCompare:function(a,b){return b==a.nodeName},createRenderRoot:function(){var a=this.nodeFactory(this.container.id+"_svgRoot","svg");return a.style.display="block",a},createRoot:function(a){return this.nodeFactory(this.container.id+a,"g")},createDefs:function(){var a=this.nodeFactory(this.container.id+"_defs","defs");return this.rendererRoot.appendChild(a),a},drawPoint:function(a,b){return this.drawCircle(a,b,1)},drawCircle:function(a,b,c){var d=this.getResolution(),e=(b.x-this.featureDx)/d+this.left,b=this.top-b.y/d;return this.inValidRange(e,b)?(a.setAttributeNS(null,"cx",e),a.setAttributeNS(null,"cy",b),a.setAttributeNS(null,"r",c),a):!1},drawLineString:function(a,b){var c=this.getComponentsString(b.components);return c.path?(a.setAttributeNS(null,"points",c.path),c.complete?a:null):!1},drawLinearRing:function(a,b){var c=this.getComponentsString(b.components);return c.path?(a.setAttributeNS(null,"points",c.path),c.complete?a:null):!1},drawPolygon:function(a,b){for(var c,d,e="",f=!0,g=!0,h=0,i=b.components.length;i>h;h++)e+=" M",c=this.getComponentsString(b.components[h].components," "),(d=c.path)?(e+=" "+d,g=c.complete&&g):f=!1;return f?(a.setAttributeNS(null,"d",e+" z"),a.setAttributeNS(null,"fill-rule","evenodd"),g?a:null):!1},drawRectangle:function(a,b){var c=this.getResolution(),d=(b.x-this.featureDx)/c+this.left,e=this.top-b.y/c;return this.inValidRange(d,e)?(a.setAttributeNS(null,"x",d),a.setAttributeNS(null,"y",e),a.setAttributeNS(null,"width",b.width/c),a.setAttributeNS(null,"height",b.height/c),a):!1},drawText:function(a,b,c){var d=!!b.labelOutlineWidth;if(d){var e=OpenLayers.Util.extend({},b);e.fontColor=e.labelOutlineColor,e.fontStrokeColor=e.labelOutlineColor,e.fontStrokeWidth=b.labelOutlineWidth,delete e.labelOutlineWidth,this.drawText(a,e,c)}var f=this.getResolution(),e=(c.x-this.featureDx)/f+this.left,g=c.y/f-this.top,d=d?this.LABEL_OUTLINE_SUFFIX:this.LABEL_ID_SUFFIX,f=this.nodeFactory(a+d,"text");f.setAttributeNS(null,"x",e),f.setAttributeNS(null,"y",-g),b.fontColor&&f.setAttributeNS(null,"fill",b.fontColor),b.fontStrokeColor&&f.setAttributeNS(null,"stroke",b.fontStrokeColor),b.fontStrokeWidth&&f.setAttributeNS(null,"stroke-width",b.fontStrokeWidth),b.fontOpacity&&f.setAttributeNS(null,"opacity",b.fontOpacity),b.fontFamily&&f.setAttributeNS(null,"font-family",b.fontFamily),b.fontSize&&f.setAttributeNS(null,"font-size",b.fontSize),b.fontWeight&&f.setAttributeNS(null,"font-weight",b.fontWeight),b.fontStyle&&f.setAttributeNS(null,"font-style",b.fontStyle),!0===b.labelSelect?(f.setAttributeNS(null,"pointer-events","visible"),f._featureId=a):f.setAttributeNS(null,"pointer-events","none"),g=b.labelAlign||OpenLayers.Renderer.defaultSymbolizer.labelAlign,f.setAttributeNS(null,"text-anchor",OpenLayers.Renderer.SVG.LABEL_ALIGN[g[0]]||"middle"),!0===OpenLayers.IS_GECKO&&f.setAttributeNS(null,"dominant-baseline",OpenLayers.Renderer.SVG.LABEL_ALIGN[g[1]]||"central");for(var h=b.label.split("\n"),i=h.length;f.childNodes.length>i;)f.removeChild(f.lastChild);for(var j=0;i>j;j++){var k=this.nodeFactory(a+d+"_tspan_"+j,"tspan");if(!0===b.labelSelect&&(k._featureId=a,k._geometry=c,k._geometryClass=c.CLASS_NAME),!1===OpenLayers.IS_GECKO&&k.setAttributeNS(null,"baseline-shift",OpenLayers.Renderer.SVG.LABEL_VSHIFT[g[1]]||"-35%"),k.setAttribute("x",e),0==j){var l=OpenLayers.Renderer.SVG.LABEL_VFACTOR[g[1]];null==l&&(l=-.5),k.setAttribute("dy",l*(i-1)+"em")}else k.setAttribute("dy","1em");k.textContent=""===h[j]?" ":h[j],k.parentNode||f.appendChild(k)}f.parentNode||this.textRoot.appendChild(f)},getComponentsString:function(a,b){for(var c,d=[],e=!0,f=a.length,g=[],h=0;f>h;h++)c=a[h],d.push(c),(c=this.getShortString(c))?g.push(c):(h>0&&this.getShortString(a[h-1])&&g.push(this.clipLine(a[h],a[h-1])),f-1>h&&this.getShortString(a[h+1])&&g.push(this.clipLine(a[h],a[h+1])),e=!1);return{path:g.join(b||","),complete:e}},clipLine:function(a,b){if(b.equals(a))return"";var c,d=this.getResolution(),e=this.MAX_PIXEL-this.translationParameters.x,f=this.MAX_PIXEL-this.translationParameters.y,g=(b.x-this.featureDx)/d+this.left,h=this.top-b.y/d,i=(a.x-this.featureDx)/d+this.left,d=this.top-a.y/d;return(-e>i||i>e)&&(c=(d-h)/(i-g),i=0>i?-e:e,d=h+(i-g)*c),(-f>d||d>f)&&(c=(i-g)/(d-h),d=0>d?-f:f,i=g+(d-h)*c),i+","+d},getShortString:function(a){var b=this.getResolution(),c=(a.x-this.featureDx)/b+this.left,a=this.top-a.y/b;return this.inValidRange(c,a)?c+","+a:!1},getPosition:function(a){return{x:parseFloat(a.getAttributeNS(null,"cx")),y:parseFloat(a.getAttributeNS(null,"cy"))}},importSymbol:function(a){this.defs||(this.defs=this.createDefs());var b=this.container.id+"-"+a,c=document.getElementById(b);if(null!=c)return c;var d=OpenLayers.Renderer.symbol[a];if(!d)throw Error(a+" is not a valid symbol name");var a=this.nodeFactory(b,"symbol"),e=this.nodeFactory(null,"polygon");a.appendChild(e);for(var f,g,c=new OpenLayers.Bounds(Number.MAX_VALUE,Number.MAX_VALUE,0,0),h=[],i=0;i<d.length;i+=2)f=d[i],g=d[i+1],c.left=Math.min(c.left,f),c.bottom=Math.min(c.bottom,g),c.right=Math.max(c.right,f),c.top=Math.max(c.top,g),h.push(f,",",g);return e.setAttributeNS(null,"points",h.join(" ")),d=c.getWidth(),e=c.getHeight(),a.setAttributeNS(null,"viewBox",[c.left-d,c.bottom-e,3*d,3*e].join(" ")),this.symbolMetrics[b]=[Math.max(d,e),c.getCenterLonLat().lon,c.getCenterLonLat().lat],this.defs.appendChild(a),a},getFeatureIdFromEvent:function(a){var b=OpenLayers.Renderer.Elements.prototype.getFeatureIdFromEvent.apply(this,arguments);return b||(b=a.target,b=b.parentNode&&b!=this.rendererRoot?b.parentNode._featureId:void 0),b},CLASS_NAME:"OpenLayers.Renderer.SVG"}),OpenLayers.Renderer.SVG.LABEL_ALIGN={l:"start",r:"end",b:"bottom",t:"hanging"},OpenLayers.Renderer.SVG.LABEL_VSHIFT={t:"-70%",b:"0"},OpenLayers.Renderer.SVG.LABEL_VFACTOR={t:0,b:-1},OpenLayers.Renderer.SVG.preventDefault=function(a){a.preventDefault&&a.preventDefault()},OpenLayers.Format.SLD.v1_0_0=OpenLayers.Class(OpenLayers.Format.SLD.v1,{VERSION:"1.0.0",schemaLocation:"http://www.opengis.net/sld http://schemas.opengis.net/sld/1.0.0/StyledLayerDescriptor.xsd",CLASS_NAME:"OpenLayers.Format.SLD.v1_0_0"}),OpenLayers.Format.OWSContext=OpenLayers.Class(OpenLayers.Format.Context,{defaultVersion:"0.3.1",getVersion:function(){var a=OpenLayers.Format.XML.VersionedOGC.prototype.getVersion.apply(this,arguments);return"0.3.0"===a&&(a=this.defaultVersion),a},toContext:function(a){var b={};return"OpenLayers.Map"==a.CLASS_NAME&&(b.bounds=a.getExtent(),b.maxExtent=a.maxExtent,b.projection=a.projection,b.size=a.getSize(),b.layers=a.layers),b},CLASS_NAME:"OpenLayers.Format.OWSContext"}),OpenLayers.Format.OWSContext.v0_3_1=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{owc:"http://www.opengis.net/ows-context",gml:"http://www.opengis.net/gml",kml:"http://www.opengis.net/kml/2.2",ogc:"http://www.opengis.net/ogc",ows:"http://www.opengis.net/ows",sld:"http://www.opengis.net/sld",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},VERSION:"0.3.1",schemaLocation:"http://www.opengis.net/ows-context http://www.ogcnetwork.net/schemas/owc/0.3.1/owsContext.xsd",defaultPrefix:"owc",extractAttributes:!0,xy:!0,regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},featureNS:"http://mapserver.gis.umn.edu/mapserver",featureType:"vector",geometryName:"geometry",nestingLayerLookup:null,initialize:function(a){OpenLayers.Format.XML.prototype.initialize.apply(this,[a]),OpenLayers.Format.GML.v2.prototype.setGeometryTypes.call(this)},setNestingPath:function(a){if(a.layersContext)for(var b=0,c=a.layersContext.length;c>b;b++){var d=a.layersContext[b],e=[],f=a.title||"";a.metadata&&a.metadata.nestingPath&&(e=a.metadata.nestingPath.slice()),""!=f&&e.push(f),d.metadata.nestingPath=e,d.layersContext&&this.setNestingPath(d)}},decomposeNestingPath:function(a){var b=[];if(OpenLayers.Util.isArray(a)){for(a=a.slice();0<a.length;)b.push(a.slice()),a.pop();b.reverse()}return b},read:function(a){"string"==typeof a&&(a=OpenLayers.Format.XML.prototype.read.apply(this,[a])),a&&9==a.nodeType&&(a=a.documentElement);var b={};return this.readNode(a,b),this.setNestingPath({layersContext:b.layersContext}),a=[],this.processLayer(a,b),delete b.layersContext,b.layersContext=a,b},processLayer:function(a,b){if(b.layersContext)for(var c=0,d=b.layersContext.length;d>c;c++){var e=b.layersContext[c];a.push(e),e.layersContext&&this.processLayer(a,e)}},write:function(a,b){this.nestingLayerLookup={},b=b||{},OpenLayers.Util.applyDefaults(b,a);var c=this.writeNode("OWSContext",b);return this.nestingLayerLookup=null,this.setAttributeNS(c,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation),OpenLayers.Format.XML.prototype.write.apply(this,[c])},readers:{kml:{Document:function(a,b){b.features=new OpenLayers.Format.KML({kmlns:this.namespaces.kml,extractStyles:!0}).read(a)}},owc:{OWSContext:function(a,b){this.readChildNodes(a,b)},General:function(a,b){this.readChildNodes(a,b)},ResourceList:function(a,b){this.readChildNodes(a,b)},Layer:function(a,b){var c={metadata:{},visibility:"1"!=a.getAttribute("hidden"),queryable:"1"==a.getAttribute("queryable"),opacity:null!=a.getAttribute("opacity")?parseFloat(a.getAttribute("opacity")):null,name:a.getAttribute("name"),categoryLayer:null==a.getAttribute("name"),formats:[],styles:[]};b.layersContext||(b.layersContext=[]),b.layersContext.push(c),this.readChildNodes(a,c)},InlineGeometry:function(a,b){b.features=[];var c,d=this.getElementsByTagNameNS(a,this.namespaces.gml,"featureMember");1<=d.length&&(c=d[0]),c&&c.firstChild&&(d=c.firstChild.nextSibling?c.firstChild.nextSibling:c.firstChild,this.setNamespace("feature",d.namespaceURI),this.featureType=d.localName||d.nodeName.split(":").pop(),this.readChildNodes(a,b))},Server:function(a,b){(!b.service&&!b.version||b.service!=OpenLayers.Format.Context.serviceTypes.WMS)&&(b.service=a.getAttribute("service"),b.version=a.getAttribute("version"),this.readChildNodes(a,b))},Name:function(a,b){b.name=this.getChildValue(a),this.readChildNodes(a,b)},Title:function(a,b){b.title=this.getChildValue(a),this.readChildNodes(a,b)},StyleList:function(a,b){this.readChildNodes(a,b.styles)},Style:function(a,b){var c={};b.push(c),this.readChildNodes(a,c)},LegendURL:function(a,b){var c={};b.legend=c,this.readChildNodes(a,c)},OnlineResource:function(a,b){b.url=this.getAttributeNS(a,this.namespaces.xlink,"href"),this.readChildNodes(a,b)}},ows:OpenLayers.Format.OWSCommon.v1_0_0.prototype.readers.ows,gml:OpenLayers.Format.GML.v2.prototype.readers.gml,sld:OpenLayers.Format.SLD.v1_0_0.prototype.readers.sld,feature:OpenLayers.Format.GML.v2.prototype.readers.feature},writers:{owc:{OWSContext:function(a){var b=this.createElementNSPlus("OWSContext",{attributes:{version:this.VERSION,id:a.id||OpenLayers.Util.createUniqueID("OpenLayers_OWSContext_")}});return this.writeNode("General",a,b),this.writeNode("ResourceList",a,b),b},General:function(a){var b=this.createElementNSPlus("General");return this.writeNode("ows:BoundingBox",a,b),this.writeNode("ows:Title",a.title||"OpenLayers OWSContext",b),b},ResourceList:function(a){for(var b=this.createElementNSPlus("ResourceList"),c=0,d=a.layers.length;d>c;c++){var e=a.layers[c],f=this.decomposeNestingPath(e.metadata.nestingPath);this.writeNode("_Layer",{layer:e,subPaths:f},b)}return b},Server:function(a){var b=this.createElementNSPlus("Server",{attributes:{version:a.version,service:a.service}});return this.writeNode("OnlineResource",a,b),b},OnlineResource:function(a){return this.createElementNSPlus("OnlineResource",{attributes:{"xlink:href":a.url}})},InlineGeometry:function(a){var b=this.createElementNSPlus("InlineGeometry");this.writeNode("gml:boundedBy",a.getDataExtent(),b);for(var c=0,d=a.features.length;d>c;c++)this.writeNode("gml:featureMember",a.features[c],b);return b},StyleList:function(a){for(var b=this.createElementNSPlus("StyleList"),c=0,d=a.length;d>c;c++)this.writeNode("Style",a[c],b);return b},Style:function(a){var b=this.createElementNSPlus("Style");return this.writeNode("Name",a,b),this.writeNode("Title",a,b),a.legend&&this.writeNode("LegendURL",a,b),b},Name:function(a){return this.createElementNSPlus("Name",{value:a.name})},Title:function(a){return this.createElementNSPlus("Title",{value:a.title})},LegendURL:function(a){var b=this.createElementNSPlus("LegendURL");return this.writeNode("OnlineResource",a.legend,b),b},_WMS:function(a){var b=this.createElementNSPlus("Layer",{attributes:{name:a.params.LAYERS,queryable:a.queryable?"1":"0",hidden:a.visibility?"0":"1",opacity:a.hasOwnProperty("opacity")?a.opacity:null}});return this.writeNode("ows:Title",a.name,b),this.writeNode("ows:OutputFormat",a.params.FORMAT,b),this.writeNode("Server",{service:OpenLayers.Format.Context.serviceTypes.WMS,version:a.params.VERSION,url:a.url},b),a.metadata.styles&&0<a.metadata.styles.length&&this.writeNode("StyleList",a.metadata.styles,b),b},_Layer:function(a){var b,c,d;return b=a.layer,c=a.subPaths,d=null,0<c.length?(b=c[0].join("/"),c=b.lastIndexOf("/"),d=this.nestingLayerLookup[b],c=c>0?b.substring(c+1,b.length):b,d||(d=this.createElementNSPlus("Layer"),this.writeNode("ows:Title",c,d),this.nestingLayerLookup[b]=d),a.subPaths.shift(),this.writeNode("_Layer",a,d)):(b instanceof OpenLayers.Layer.WMS?d=this.writeNode("_WMS",b):b instanceof OpenLayers.Layer.Vector&&(b.protocol instanceof OpenLayers.Protocol.WFS.v1?d=this.writeNode("_WFS",b):b.protocol instanceof OpenLayers.Protocol.HTTP?b.protocol.format instanceof OpenLayers.Format.GML?(b.protocol.format.version="2.1.2",d=this.writeNode("_GML",b)):b.protocol.format instanceof OpenLayers.Format.KML&&(b.protocol.format.version="2.2",d=this.writeNode("_KML",b)):(this.setNamespace("feature",this.featureNS),d=this.writeNode("_InlineGeometry",b))),b.options.maxScale&&this.writeNode("sld:MinScaleDenominator",b.options.maxScale,d),b.options.minScale&&this.writeNode("sld:MaxScaleDenominator",b.options.minScale,d),this.nestingLayerLookup[b.name]=d),d
},_WFS:function(a){var b=this.createElementNSPlus("Layer",{attributes:{name:a.protocol.featurePrefix+":"+a.protocol.featureType,hidden:a.visibility?"0":"1"}});return this.writeNode("ows:Title",a.name,b),this.writeNode("Server",{service:OpenLayers.Format.Context.serviceTypes.WFS,version:a.protocol.version,url:a.protocol.url},b),b},_InlineGeometry:function(a){var b=this.createElementNSPlus("Layer",{attributes:{name:this.featureType,hidden:a.visibility?"0":"1"}});return this.writeNode("ows:Title",a.name,b),this.writeNode("InlineGeometry",a,b),b},_GML:function(a){var b=this.createElementNSPlus("Layer");return this.writeNode("ows:Title",a.name,b),this.writeNode("Server",{service:OpenLayers.Format.Context.serviceTypes.GML,url:a.protocol.url,version:a.protocol.format.version},b),b},_KML:function(a){var b=this.createElementNSPlus("Layer");return this.writeNode("ows:Title",a.name,b),this.writeNode("Server",{service:OpenLayers.Format.Context.serviceTypes.KML,version:a.protocol.format.version,url:a.protocol.url},b),b}},gml:OpenLayers.Util.applyDefaults({boundedBy:function(a){var b=this.createElementNSPlus("gml:boundedBy");return this.writeNode("gml:Box",a,b),b}},OpenLayers.Format.GML.v2.prototype.writers.gml),ows:OpenLayers.Format.OWSCommon.v1_0_0.prototype.writers.ows,sld:OpenLayers.Format.SLD.v1_0_0.prototype.writers.sld,feature:OpenLayers.Format.GML.v2.prototype.writers.feature},CLASS_NAME:"OpenLayers.Format.OWSContext.v0_3_1"}),OpenLayers.Control.ScaleLine=OpenLayers.Class(OpenLayers.Control,{maxWidth:100,topOutUnits:"km",topInUnits:"m",bottomOutUnits:"mi",bottomInUnits:"ft",eTop:null,eBottom:null,geodesic:!1,draw:function(){return OpenLayers.Control.prototype.draw.apply(this,arguments),this.eTop||(this.eTop=document.createElement("div"),this.eTop.className=this.displayClass+"Top",this.div.appendChild(this.eTop),this.eTop.style.visibility=""==this.topOutUnits||""==this.topInUnits?"hidden":"visible",this.eBottom=document.createElement("div"),this.eBottom.className=this.displayClass+"Bottom",this.div.appendChild(this.eBottom),this.eBottom.style.visibility=""==this.bottomOutUnits||""==this.bottomInUnits?"hidden":"visible"),this.map.events.register("moveend",this,this.update),this.update(),this.div},getBarLen:function(a){var b=parseInt(Math.log(a)/Math.log(10)),b=Math.pow(10,b),a=parseInt(a/b);return(a>5?5:a>2?2:1)*b},update:function(){var a=this.map.getResolution();if(a){var b=this.map.getUnits(),c=OpenLayers.INCHES_PER_UNIT,d=this.maxWidth*a*c[b],e=1;!0===this.geodesic&&(e=(this.map.getGeodesicPixelSize().w||1e-6)*this.maxWidth/(d/c.km),d*=e);var f,g;d>1e5?(f=this.topOutUnits,g=this.bottomOutUnits):(f=this.topInUnits,g=this.bottomInUnits);var h=d/c[f],i=d/c[g],d=this.getBarLen(h),j=this.getBarLen(i),h=d/c[b]*c[f],i=j/c[b]*c[g],b=h/a/e,a=i/a/e;"visible"==this.eBottom.style.visibility&&(this.eBottom.style.width=Math.round(a)+"px",this.eBottom.innerHTML=j+" "+g),"visible"==this.eTop.style.visibility&&(this.eTop.style.width=Math.round(b)+"px",this.eTop.innerHTML=d+" "+f)}},CLASS_NAME:"OpenLayers.Control.ScaleLine"}),OpenLayers.Icon=OpenLayers.Class({url:null,size:null,offset:null,calculateOffset:null,imageDiv:null,px:null,initialize:function(a,b,c,d){this.url=a,this.size=b||{w:20,h:20},this.offset=c||{x:-(this.size.w/2),y:-(this.size.h/2)},this.calculateOffset=d,a=OpenLayers.Util.createUniqueID("OL_Icon_"),this.imageDiv=OpenLayers.Util.createAlphaImageDiv(a)},destroy:function(){this.erase(),OpenLayers.Event.stopObservingElement(this.imageDiv.firstChild),this.imageDiv.innerHTML="",this.imageDiv=null},clone:function(){return new OpenLayers.Icon(this.url,this.size,this.offset,this.calculateOffset)},setSize:function(a){null!=a&&(this.size=a),this.draw()},setUrl:function(a){null!=a&&(this.url=a),this.draw()},draw:function(a){return OpenLayers.Util.modifyAlphaImageDiv(this.imageDiv,null,null,this.size,this.url,"absolute"),this.moveTo(a),this.imageDiv},erase:function(){null!=this.imageDiv&&null!=this.imageDiv.parentNode&&OpenLayers.Element.remove(this.imageDiv)},setOpacity:function(a){OpenLayers.Util.modifyAlphaImageDiv(this.imageDiv,null,null,null,null,null,null,null,a)},moveTo:function(a){null!=a&&(this.px=a),null!=this.imageDiv&&(null==this.px?this.display(!1):(this.calculateOffset&&(this.offset=this.calculateOffset(this.size)),OpenLayers.Util.modifyAlphaImageDiv(this.imageDiv,null,{x:this.px.x+this.offset.x,y:this.px.y+this.offset.y})))},display:function(a){this.imageDiv.style.display=a?"":"none"},isDrawn:function(){return this.imageDiv&&this.imageDiv.parentNode&&11!=this.imageDiv.parentNode.nodeType},CLASS_NAME:"OpenLayers.Icon"}),OpenLayers.Marker=OpenLayers.Class({icon:null,lonlat:null,events:null,map:null,initialize:function(a,b){this.lonlat=a;var c=b?b:OpenLayers.Marker.defaultIcon();null==this.icon?this.icon=c:(this.icon.url=c.url,this.icon.size=c.size,this.icon.offset=c.offset,this.icon.calculateOffset=c.calculateOffset),this.events=new OpenLayers.Events(this,this.icon.imageDiv)},destroy:function(){this.erase(),this.map=null,this.events.destroy(),this.events=null,null!=this.icon&&(this.icon.destroy(),this.icon=null)},draw:function(a){return this.icon.draw(a)},erase:function(){null!=this.icon&&this.icon.erase()},moveTo:function(a){null!=a&&null!=this.icon&&this.icon.moveTo(a),this.lonlat=this.map.getLonLatFromLayerPx(a)},isDrawn:function(){return this.icon&&this.icon.isDrawn()},onScreen:function(){var a=!1;return this.map&&(a=this.map.getExtent().containsLonLat(this.lonlat)),a},inflate:function(a){this.icon&&this.icon.setSize({w:this.icon.size.w*a,h:this.icon.size.h*a})},setOpacity:function(a){this.icon.setOpacity(a)},setUrl:function(a){this.icon.setUrl(a)},display:function(a){this.icon.display(a)},CLASS_NAME:"OpenLayers.Marker"}),OpenLayers.Marker.defaultIcon=function(){return new OpenLayers.Icon(OpenLayers.Util.getImageLocation("marker.png"),{w:21,h:25},{x:-10.5,y:-25})},OpenLayers.Layer.TileCache=OpenLayers.Class(OpenLayers.Layer.Grid,{isBaseLayer:!0,format:"image/png",serverResolutions:null,initialize:function(a,b,c,d){this.layername=c,OpenLayers.Layer.Grid.prototype.initialize.apply(this,[a,b,{},d]),this.extension=this.format.split("/")[1].toLowerCase(),this.extension="jpg"==this.extension?"jpeg":this.extension},clone:function(a){return null==a&&(a=new OpenLayers.Layer.TileCache(this.name,this.url,this.layername,this.getOptions())),a=OpenLayers.Layer.Grid.prototype.clone.apply(this,[a])},getURL:function(a){function b(a,b){for(var a=""+a,c=[],d=0;b>d;++d)c.push("0");return c.join("").substring(0,b-a.length)+a}var c=this.getServerResolution(),d=this.maxExtent,e=this.tileSize,f=Math.round((a.left-d.left)/(c*e.w)),a=Math.round((a.bottom-d.bottom)/(c*e.h)),c=null!=this.serverResolutions?OpenLayers.Util.indexOf(this.serverResolutions,c):this.map.getZoom(),f=[this.layername,b(c,2),b(parseInt(f/1e6),3),b(parseInt(f/1e3)%1e3,3),b(parseInt(f)%1e3,3),b(parseInt(a/1e6),3),b(parseInt(a/1e3)%1e3,3),b(parseInt(a)%1e3,3)+"."+this.extension].join("/"),c=this.url;return OpenLayers.Util.isArray(c)&&(c=this.selectUrl(f,c)),c="/"==c.charAt(c.length-1)?c:c+"/",c+f},CLASS_NAME:"OpenLayers.Layer.TileCache"}),OpenLayers.Layer.KaMap=OpenLayers.Class(OpenLayers.Layer.Grid,{isBaseLayer:!0,DEFAULT_PARAMS:{i:"jpeg",map:""},initialize:function(){OpenLayers.Layer.Grid.prototype.initialize.apply(this,arguments),this.params=OpenLayers.Util.applyDefaults(this.params,this.DEFAULT_PARAMS)},getURL:function(a){var a=this.adjustBounds(a),b=this.map.getResolution(),c=Math.round(1e4*this.map.getScale())/1e4,d=Math.round(a.left/b);return this.getFullRequestString({t:-Math.round(a.top/b),l:d,s:c})},calculateGridLayout:function(a,b,c){var b=c*this.tileSize.w,c=c*this.tileSize.h,d=a.left,e=Math.floor(d/b)-this.buffer,d=-(d/b-e)*this.tileSize.w,e=e*b,a=a.top,f=Math.ceil(a/c)+this.buffer;return{tilelon:b,tilelat:c,tileoffsetlon:e,tileoffsetlat:f*c,tileoffsetx:d,tileoffsety:-(f-a/c+1)*this.tileSize.h}},clone:function(a){return null==a&&(a=new OpenLayers.Layer.KaMap(this.name,this.url,this.params,this.getOptions())),a=OpenLayers.Layer.Grid.prototype.clone.apply(this,[a]),null!=this.tileSize&&(a.tileSize=this.tileSize.clone()),a.grid=[],a},getTileBounds:function(a){var b=this.getResolution(),c=b*this.tileSize.w,b=b*this.tileSize.h,d=this.getLonLatFromViewPortPx(a),a=c*Math.floor(d.lon/c),d=b*Math.floor(d.lat/b);return new OpenLayers.Bounds(a,d,a+c,d+b)},CLASS_NAME:"OpenLayers.Layer.KaMap"}),OpenLayers.Control.TransformFeature=OpenLayers.Class(OpenLayers.Control,{geometryTypes:null,layer:null,preserveAspectRatio:!1,rotate:!0,feature:null,renderIntent:"temporary",rotationHandleSymbolizer:null,box:null,center:null,scale:1,ratio:1,rotation:0,handles:null,rotationHandles:null,dragControl:null,irregular:!1,initialize:function(a,b){OpenLayers.Control.prototype.initialize.apply(this,[b]),this.layer=a,this.rotationHandleSymbolizer||(this.rotationHandleSymbolizer={stroke:!1,pointRadius:10,fillOpacity:0,cursor:"pointer"}),this.createBox(),this.createControl()},activate:function(){var a=!1;return OpenLayers.Control.prototype.activate.apply(this,arguments)&&(this.dragControl.activate(),this.layer.addFeatures([this.box]),this.rotate&&this.layer.addFeatures(this.rotationHandles),this.layer.addFeatures(this.handles),a=!0),a},deactivate:function(){var a=!1;return OpenLayers.Control.prototype.deactivate.apply(this,arguments)&&(this.layer.removeFeatures(this.handles),this.rotate&&this.layer.removeFeatures(this.rotationHandles),this.layer.removeFeatures([this.box]),this.dragControl.deactivate(),a=!0),a},setMap:function(a){this.dragControl.setMap(a),OpenLayers.Control.prototype.setMap.apply(this,arguments)},setFeature:function(a,b){var b=OpenLayers.Util.applyDefaults(b,{rotation:0,scale:1,ratio:1}),c=this.rotation,d=this.center;if(OpenLayers.Util.extend(this,b),!1!==this.events.triggerEvent("beforesetfeature",{feature:a})){this.feature=a,this.activate(),this._setfeature=!0;var e=this.feature.geometry.getBounds();this.box.move(e.getCenterLonLat()),this.box.geometry.rotate(-c,d),this._angle=0,this.rotation?(c=a.geometry.clone(),c.rotate(-this.rotation,this.center),c=new OpenLayers.Feature.Vector(c.getBounds().toGeometry()),c.geometry.rotate(this.rotation,this.center),this.box.geometry.rotate(this.rotation,this.center),this.box.move(c.geometry.getBounds().getCenterLonLat()),c=c.geometry.components[0].components[0].getBounds().getCenterLonLat()):c=new OpenLayers.LonLat(e.left,e.bottom),this.handles[0].move(c),delete this._setfeature,this.events.triggerEvent("setfeature",{feature:a})}},unsetFeature:function(){this.active?this.deactivate():(this.feature=null,this.rotation=0,this.ratio=this.scale=1)},createBox:function(){var a=this;this.center=new OpenLayers.Geometry.Point(0,0),this.box=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.LineString([new OpenLayers.Geometry.Point(-1,-1),new OpenLayers.Geometry.Point(0,-1),new OpenLayers.Geometry.Point(1,-1),new OpenLayers.Geometry.Point(1,0),new OpenLayers.Geometry.Point(1,1),new OpenLayers.Geometry.Point(0,1),new OpenLayers.Geometry.Point(-1,1),new OpenLayers.Geometry.Point(-1,0),new OpenLayers.Geometry.Point(-1,-1)]),null,"string"==typeof this.renderIntent?null:this.renderIntent),this.box.geometry.move=function(b,c){a._moving=!0,OpenLayers.Geometry.LineString.prototype.move.apply(this,arguments),a.center.move(b,c),delete a._moving};for(var b,c,d,e=function(a,b){OpenLayers.Geometry.Point.prototype.move.apply(this,arguments),this._rotationHandle&&this._rotationHandle.geometry.move(a,b),this._handle.geometry.move(a,b)},f=function(a,b,c){OpenLayers.Geometry.Point.prototype.resize.apply(this,arguments),this._rotationHandle&&this._rotationHandle.geometry.resize(a,b,c),this._handle.geometry.resize(a,b,c)},g=function(a,b){OpenLayers.Geometry.Point.prototype.rotate.apply(this,arguments),this._rotationHandle&&this._rotationHandle.geometry.rotate(a,b),this._handle.geometry.rotate(a,b)},h=function(b,c){var d=this.x,e=this.y;if(OpenLayers.Geometry.Point.prototype.move.call(this,b,c),!a._moving){var f=a.dragControl.handlers.drag.evt,g=!(!a._setfeature&&a.preserveAspectRatio||f&&f.shiftKey),h=new OpenLayers.Geometry.Point(d,e),f=a.center;this.rotate(-a.rotation,f),h.rotate(-a.rotation,f);var i=this.x-f.x,j=this.y-f.y,k=i-(this.x-h.x),l=j-(this.y-h.y);a.irregular&&!a._setfeature&&(i-=(this.x-h.x)/2,j-=(this.y-h.y)/2),this.x=d,this.y=e,h=1,g?(j=1e-5>Math.abs(l)?1:j/l,h=(1e-5>Math.abs(k)?1:i/k)/j):(k=Math.sqrt(k*k+l*l),j=Math.sqrt(i*i+j*j)/k),a._moving=!0,a.box.geometry.rotate(-a.rotation,f),delete a._moving,a.box.geometry.resize(j,f,h),a.box.geometry.rotate(a.rotation,f),a.transformFeature({scale:j,ratio:h}),a.irregular&&!a._setfeature&&(i=f.clone(),i.x+=1e-5>Math.abs(d-f.x)?0:this.x-d,i.y+=1e-5>Math.abs(e-f.y)?0:this.y-e,a.box.geometry.move(this.x-d,this.y-e),a.transformFeature({center:i}))}},i=function(b,c){var d=this.x,e=this.y;if(OpenLayers.Geometry.Point.prototype.move.call(this,b,c),!a._moving){var f=a.dragControl.handlers.drag.evt,f=f&&f.shiftKey?45:1,g=a.center,h=this.x-g.x,i=this.y-g.y;this.x=d,this.y=e,d=Math.atan2(i-c,h-b),d=Math.atan2(i,h)-d,d*=180/Math.PI,a._angle=(a._angle+d)%360,d=a.rotation%f,(Math.abs(a._angle)>=f||0!==d)&&(d=Math.round(a._angle/f)*f-d,a._angle=0,a.box.geometry.rotate(d,g),a.transformFeature({rotation:d}))}},j=Array(8),k=Array(4),l="sw s se e ne n nw w".split(" "),m=0;8>m;++m)b=this.box.geometry.components[m],c=new OpenLayers.Feature.Vector(b.clone(),{role:l[m]+"-resize"},"string"==typeof this.renderIntent?null:this.renderIntent),0==m%2&&(d=new OpenLayers.Feature.Vector(b.clone(),{role:l[m]+"-rotate"},"string"==typeof this.rotationHandleSymbolizer?null:this.rotationHandleSymbolizer),d.geometry.move=i,b._rotationHandle=d,k[m/2]=d),b.move=e,b.resize=f,b.rotate=g,c.geometry.move=h,b._handle=c,j[m]=c;this.rotationHandles=k,this.handles=j},createControl:function(){var a=this;this.dragControl=new OpenLayers.Control.DragFeature(this.layer,{documentDrag:!0,moveFeature:function(){this.feature===a.feature&&(this.feature=a.box),OpenLayers.Control.DragFeature.prototype.moveFeature.apply(this,arguments)},onDrag:function(b){b===a.box&&a.transformFeature({center:a.center})},onStart:function(b){var c=!a.geometryTypes||-1!==OpenLayers.Util.indexOf(a.geometryTypes,b.geometry.CLASS_NAME),d=OpenLayers.Util.indexOf(a.handles,b),d=d+OpenLayers.Util.indexOf(a.rotationHandles,b);b!==a.feature&&b!==a.box&&-2==d&&c&&a.setFeature(b)},onComplete:function(){a.events.triggerEvent("transformcomplete",{feature:a.feature})}})},drawHandles:function(){for(var a=this.layer,b=0;8>b;++b)this.rotate&&0===b%2&&a.drawFeature(this.rotationHandles[b/2],this.rotationHandleSymbolizer),a.drawFeature(this.handles[b],this.renderIntent)},transformFeature:function(a){if(!this._setfeature){this.scale*=a.scale||1,this.ratio*=a.ratio||1;var b=this.rotation;if(this.rotation=(this.rotation+(a.rotation||0))%360,!1!==this.events.triggerEvent("beforetransform",a)){var c=this.feature,d=c.geometry,e=this.center;d.rotate(-b,e),a.scale||a.ratio?d.resize(a.scale,e,a.ratio):a.center&&c.move(a.center.getBounds().getCenterLonLat()),d.rotate(this.rotation,e),this.layer.drawFeature(c),c.toState(OpenLayers.State.UPDATE),this.events.triggerEvent("transform",a)}}this.layer.drawFeature(this.box,this.renderIntent),this.drawHandles()},destroy:function(){for(var a,b=0;8>b;++b)a=this.box.geometry.components[b],a._handle.destroy(),a._handle=null,a._rotationHandle&&a._rotationHandle.destroy(),a._rotationHandle=null;this.rotationHandles=this.rotationHandleSymbolizer=this.handles=this.feature=this.center=null,this.box.destroy(),this.layer=this.box=null,this.dragControl.destroy(),this.dragControl=null,OpenLayers.Control.prototype.destroy.apply(this,arguments)},CLASS_NAME:"OpenLayers.Control.TransformFeature"}),OpenLayers.Handler.Box=OpenLayers.Class(OpenLayers.Handler,{dragHandler:null,boxDivClassName:"olHandlerBoxZoomBox",boxOffsets:null,initialize:function(){OpenLayers.Handler.prototype.initialize.apply(this,arguments),this.dragHandler=new OpenLayers.Handler.Drag(this,{down:this.startBox,move:this.moveBox,out:this.removeBox,up:this.endBox},{keyMask:this.keyMask})},destroy:function(){OpenLayers.Handler.prototype.destroy.apply(this,arguments),this.dragHandler&&(this.dragHandler.destroy(),this.dragHandler=null)},setMap:function(a){OpenLayers.Handler.prototype.setMap.apply(this,arguments),this.dragHandler&&this.dragHandler.setMap(a)},startBox:function(){this.callback("start",[]),this.zoomBox=OpenLayers.Util.createDiv("zoomBox",{x:-9999,y:-9999}),this.zoomBox.className=this.boxDivClassName,this.zoomBox.style.zIndex=this.map.Z_INDEX_BASE.Popup-1,this.map.viewPortDiv.appendChild(this.zoomBox),OpenLayers.Element.addClass(this.map.viewPortDiv,"olDrawBox")},moveBox:function(a){var b=this.dragHandler.start.x,c=this.dragHandler.start.y,d=Math.abs(b-a.x),e=Math.abs(c-a.y),f=this.getBoxOffsets();this.zoomBox.style.width=d+f.width+1+"px",this.zoomBox.style.height=e+f.height+1+"px",this.zoomBox.style.left=(a.x<b?b-d-f.left:b-f.left)+"px",this.zoomBox.style.top=(a.y<c?c-e-f.top:c-f.top)+"px"},endBox:function(a){var b;if(5<Math.abs(this.dragHandler.start.x-a.x)||5<Math.abs(this.dragHandler.start.y-a.y)){var c=this.dragHandler.start;b=Math.min(c.y,a.y);var d=Math.max(c.y,a.y),e=Math.min(c.x,a.x),a=Math.max(c.x,a.x);b=new OpenLayers.Bounds(e,d,a,b)}else b=this.dragHandler.start.clone();this.removeBox(),this.callback("done",[b])},removeBox:function(){this.map.viewPortDiv.removeChild(this.zoomBox),this.boxOffsets=this.zoomBox=null,OpenLayers.Element.removeClass(this.map.viewPortDiv,"olDrawBox")},activate:function(){return OpenLayers.Handler.prototype.activate.apply(this,arguments)?(this.dragHandler.activate(),!0):!1},deactivate:function(){return OpenLayers.Handler.prototype.deactivate.apply(this,arguments)?(this.dragHandler.deactivate()&&this.zoomBox&&this.removeBox(),!0):!1},getBoxOffsets:function(){if(!this.boxOffsets){var a=document.createElement("div");a.style.position="absolute",a.style.border="1px solid black",a.style.width="3px",document.body.appendChild(a);var b=3==a.clientWidth;document.body.removeChild(a);var a=parseInt(OpenLayers.Element.getStyle(this.zoomBox,"border-left-width")),c=parseInt(OpenLayers.Element.getStyle(this.zoomBox,"border-right-width")),d=parseInt(OpenLayers.Element.getStyle(this.zoomBox,"border-top-width")),e=parseInt(OpenLayers.Element.getStyle(this.zoomBox,"border-bottom-width"));this.boxOffsets={left:a,right:c,top:d,bottom:e,width:!1===b?a+c:0,height:!1===b?d+e:0}}return this.boxOffsets},CLASS_NAME:"OpenLayers.Handler.Box"}),OpenLayers.Control.ZoomBox=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_TOOL,out:!1,keyMask:null,alwaysZoom:!1,draw:function(){this.handler=new OpenLayers.Handler.Box(this,{done:this.zoomBox},{keyMask:this.keyMask})},zoomBox:function(a){if(a instanceof OpenLayers.Bounds){var b;if(this.out){b=Math.abs(a.right-a.left);var c=Math.abs(a.top-a.bottom);b=Math.min(this.map.size.h/c,this.map.size.w/b);var c=this.map.getExtent(),d=this.map.getLonLatFromPixel(a.getCenterPixel()),a=d.lon-c.getWidth()/2*b,e=d.lon+c.getWidth()/2*b,f=d.lat-c.getHeight()/2*b;b=d.lat+c.getHeight()/2*b,b=new OpenLayers.Bounds(a,f,e,b)}else b=this.map.getLonLatFromPixel({x:a.left,y:a.bottom}),c=this.map.getLonLatFromPixel({x:a.right,y:a.top}),b=new OpenLayers.Bounds(b.lon,b.lat,c.lon,c.lat);c=this.map.getZoom(),this.map.zoomToExtent(b),c==this.map.getZoom()&&1==this.alwaysZoom&&this.map.zoomTo(c+(this.out?-1:1))}else this.out?this.map.setCenter(this.map.getLonLatFromPixel(a),this.map.getZoom()-1):this.map.setCenter(this.map.getLonLatFromPixel(a),this.map.getZoom()+1)},CLASS_NAME:"OpenLayers.Control.ZoomBox"}),OpenLayers.Control.DragPan=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_TOOL,panned:!1,interval:1,documentDrag:!1,kinetic:null,enableKinetic:!1,kineticInterval:10,draw:function(){if(this.enableKinetic){var a={interval:this.kineticInterval};"object"==typeof this.enableKinetic&&(a=OpenLayers.Util.extend(a,this.enableKinetic)),this.kinetic=new OpenLayers.Kinetic(a)}this.handler=new OpenLayers.Handler.Drag(this,{move:this.panMap,done:this.panMapDone,down:this.panMapStart},{interval:this.interval,documentDrag:this.documentDrag})},panMapStart:function(){this.kinetic&&this.kinetic.begin()},panMap:function(a){this.kinetic&&this.kinetic.update(a),this.panned=!0,this.map.pan(this.handler.last.x-a.x,this.handler.last.y-a.y,{dragging:!0,animate:!1})},panMapDone:function(a){if(this.panned){var b=null;if(this.kinetic&&(b=this.kinetic.end(a)),this.map.pan(this.handler.last.x-a.x,this.handler.last.y-a.y,{dragging:!!b,animate:!1}),b){var c=this;this.kinetic.move(b,function(a,b,d){c.map.pan(a,b,{dragging:!d,animate:!1})})}this.panned=!1}},CLASS_NAME:"OpenLayers.Control.DragPan"}),OpenLayers.Handler.Click=OpenLayers.Class(OpenLayers.Handler,{delay:300,single:!0,"double":!1,pixelTolerance:0,dblclickTolerance:13,stopSingle:!1,stopDouble:!1,timerId:null,touch:!1,down:null,last:null,first:null,rightclickTimerId:null,touchstart:function(a){return this.touch||(this.unregisterMouseListeners(),this.touch=!0),this.down=this.getEventInfo(a),this.last=this.getEventInfo(a),!0},touchmove:function(a){return this.last=this.getEventInfo(a),!0},touchend:function(a){return this.down&&(a.xy=this.last.xy,a.lastTouches=this.last.touches,this.handleSingle(a),this.down=null),!0},unregisterMouseListeners:function(){this.map.events.un({mousedown:this.mousedown,mouseup:this.mouseup,click:this.click,dblclick:this.dblclick,scope:this})},mousedown:function(a){return this.down=this.getEventInfo(a),this.last=this.getEventInfo(a),!0},mouseup:function(a){var b=!0;return this.checkModifiers(a)&&this.control.handleRightClicks&&OpenLayers.Event.isRightClick(a)&&(b=this.rightclick(a)),b},rightclick:function(a){if(this.passesTolerance(a)){if(null!=this.rightclickTimerId)return this.clearTimer(),this.callback("dblrightclick",[a]),!this.stopDouble;a=this["double"]?OpenLayers.Util.extend({},a):this.callback("rightclick",[a]),a=OpenLayers.Function.bind(this.delayedRightCall,this,a),this.rightclickTimerId=window.setTimeout(a,this.delay)}return!this.stopSingle},delayedRightCall:function(a){this.rightclickTimerId=null,a&&this.callback("rightclick",[a])},click:function(a){return this.last||(this.last=this.getEventInfo(a)),this.handleSingle(a),!this.stopSingle},dblclick:function(a){return this.handleDouble(a),!this.stopDouble},handleDouble:function(a){this.passesDblclickTolerance(a)&&(this["double"]&&this.callback("dblclick",[a]),this.clearTimer())},handleSingle:function(a){this.passesTolerance(a)&&(null!=this.timerId?(this.last.touches&&1===this.last.touches.length&&(this["double"]&&OpenLayers.Event.stop(a),this.handleDouble(a)),(!this.last.touches||2!==this.last.touches.length)&&this.clearTimer()):(this.first=this.getEventInfo(a),this.queuePotentialClick(this.single?OpenLayers.Util.extend({},a):null)))},queuePotentialClick:function(a){this.timerId=window.setTimeout(OpenLayers.Function.bind(this.delayedCall,this,a),this.delay)},passesTolerance:function(a){var b=!0;if(null!=this.pixelTolerance&&this.down&&this.down.xy&&(b=this.pixelTolerance>=this.down.xy.distanceTo(a.xy))&&this.touch&&this.down.touches.length===this.last.touches.length)for(var a=0,c=this.down.touches.length;c>a;++a)if(this.getTouchDistance(this.down.touches[a],this.last.touches[a])>this.pixelTolerance){b=!1;break}return b},getTouchDistance:function(a,b){return Math.sqrt(Math.pow(a.clientX-b.clientX,2)+Math.pow(a.clientY-b.clientY,2))},passesDblclickTolerance:function(){var a=!0;return this.down&&this.first&&(a=this.down.xy.distanceTo(this.first.xy)<=this.dblclickTolerance),a},clearTimer:function(){null!=this.timerId&&(window.clearTimeout(this.timerId),this.timerId=null),null!=this.rightclickTimerId&&(window.clearTimeout(this.rightclickTimerId),this.rightclickTimerId=null)},delayedCall:function(a){this.timerId=null,a&&this.callback("click",[a])},getEventInfo:function(a){var b;if(a.touches){var c=a.touches.length;b=Array(c);for(var d,e=0;c>e;e++)d=a.touches[e],b[e]={clientX:d.clientX,clientY:d.clientY}}return{xy:a.xy,touches:b}},deactivate:function(){var a=!1;return OpenLayers.Handler.prototype.deactivate.apply(this,arguments)&&(this.clearTimer(),this.last=this.first=this.down=null,this.touch=!1,a=!0),a},CLASS_NAME:"OpenLayers.Handler.Click"}),OpenLayers.Control.Navigation=OpenLayers.Class(OpenLayers.Control,{dragPan:null,dragPanOptions:null,pinchZoom:null,pinchZoomOptions:null,documentDrag:!1,zoomBox:null,zoomBoxEnabled:!0,zoomWheelEnabled:!0,mouseWheelOptions:null,handleRightClicks:!1,zoomBoxKeyMask:OpenLayers.Handler.MOD_SHIFT,autoActivate:!0,initialize:function(){this.handlers={},OpenLayers.Control.prototype.initialize.apply(this,arguments)},destroy:function(){this.deactivate(),this.dragPan&&this.dragPan.destroy(),this.dragPan=null,this.zoomBox&&this.zoomBox.destroy(),this.zoomBox=null,this.pinchZoom&&this.pinchZoom.destroy(),this.pinchZoom=null,OpenLayers.Control.prototype.destroy.apply(this,arguments)},activate:function(){return this.dragPan.activate(),this.zoomWheelEnabled&&this.handlers.wheel.activate(),this.handlers.click.activate(),this.zoomBoxEnabled&&this.zoomBox.activate(),this.pinchZoom&&this.pinchZoom.activate(),OpenLayers.Control.prototype.activate.apply(this,arguments)},deactivate:function(){return this.pinchZoom&&this.pinchZoom.deactivate(),this.zoomBox.deactivate(),this.dragPan.deactivate(),this.handlers.click.deactivate(),this.handlers.wheel.deactivate(),OpenLayers.Control.prototype.deactivate.apply(this,arguments)},draw:function(){this.handleRightClicks&&(this.map.viewPortDiv.oncontextmenu=OpenLayers.Function.False),this.handlers.click=new OpenLayers.Handler.Click(this,{click:this.defaultClick,dblclick:this.defaultDblClick,dblrightclick:this.defaultDblRightClick},{"double":!0,stopDouble:!0}),this.dragPan=new OpenLayers.Control.DragPan(OpenLayers.Util.extend({map:this.map,documentDrag:this.documentDrag},this.dragPanOptions)),this.zoomBox=new OpenLayers.Control.ZoomBox({map:this.map,keyMask:this.zoomBoxKeyMask}),this.dragPan.draw(),this.zoomBox.draw(),this.handlers.wheel=new OpenLayers.Handler.MouseWheel(this,{up:this.wheelUp,down:this.wheelDown},this.mouseWheelOptions),OpenLayers.Control.PinchZoom&&(this.pinchZoom=new OpenLayers.Control.PinchZoom(OpenLayers.Util.extend({map:this.map},this.pinchZoomOptions)))},defaultClick:function(a){a.lastTouches&&2==a.lastTouches.length&&this.map.zoomOut()},defaultDblClick:function(a){this.map.setCenter(this.map.getLonLatFromViewPortPx(a.xy),this.map.zoom+1)},defaultDblRightClick:function(a){this.map.setCenter(this.map.getLonLatFromViewPortPx(a.xy),this.map.zoom-1)},wheelChange:function(a,b){var c=this.map.getZoom(),d=this.map.getZoom()+Math.round(b),d=Math.max(d,0),d=Math.min(d,this.map.getNumZoomLevels());if(d!==c){var e=this.map.getSize(),c=e.w/2-a.xy.x,e=a.xy.y-e.h/2,f=this.map.baseLayer.getResolutionForZoom(d),g=this.map.getLonLatFromPixel(a.xy);this.map.setCenter(new OpenLayers.LonLat(g.lon+c*f,g.lat+e*f),d)}},wheelUp:function(a,b){this.wheelChange(a,b||1)},wheelDown:function(a,b){this.wheelChange(a,b||-1)},disableZoomBox:function(){this.zoomBoxEnabled=!1,this.zoomBox.deactivate()},enableZoomBox:function(){this.zoomBoxEnabled=!0,this.active&&this.zoomBox.activate()},disableZoomWheel:function(){this.zoomWheelEnabled=!1,this.handlers.wheel.deactivate()},enableZoomWheel:function(){this.zoomWheelEnabled=!0,this.active&&this.handlers.wheel.activate()},CLASS_NAME:"OpenLayers.Control.Navigation"}),OpenLayers.Control.DrawFeature=OpenLayers.Class(OpenLayers.Control,{layer:null,callbacks:null,multi:!1,featureAdded:function(){},handlerOptions:null,initialize:function(a,b,c){OpenLayers.Control.prototype.initialize.apply(this,[c]),this.callbacks=OpenLayers.Util.extend({done:this.drawFeature,modify:function(a,b){this.layer.events.triggerEvent("sketchmodified",{vertex:a,feature:b})},create:function(a,b){this.layer.events.triggerEvent("sketchstarted",{vertex:a,feature:b})}},this.callbacks),this.layer=a,this.handlerOptions=this.handlerOptions||{},this.handlerOptions.layerOptions=OpenLayers.Util.applyDefaults(this.handlerOptions.layerOptions,{renderers:a.renderers,rendererOptions:a.rendererOptions}),"multi"in this.handlerOptions||(this.handlerOptions.multi=this.multi),(a=this.layer.styleMap&&this.layer.styleMap.styles.temporary)&&(this.handlerOptions.layerOptions=OpenLayers.Util.applyDefaults(this.handlerOptions.layerOptions,{styleMap:new OpenLayers.StyleMap({"default":a})})),this.handler=new b(this,this.callbacks,this.handlerOptions)},drawFeature:function(a){a=new OpenLayers.Feature.Vector(a),!1!==this.layer.events.triggerEvent("sketchcomplete",{feature:a})&&(a.state=OpenLayers.State.INSERT,this.layer.addFeatures([a]),this.featureAdded(a),this.events.triggerEvent("featureadded",{feature:a}))},insertXY:function(a,b){this.handler&&this.handler.line&&this.handler.insertXY(a,b)},insertDeltaXY:function(a,b){this.handler&&this.handler.line&&this.handler.insertDeltaXY(a,b)},insertDirectionLength:function(a,b){this.handler&&this.handler.line&&this.handler.insertDirectionLength(a,b)},insertDeflectionLength:function(a,b){this.handler&&this.handler.line&&this.handler.insertDeflectionLength(a,b)},undo:function(){return this.handler.undo&&this.handler.undo()},redo:function(){return this.handler.redo&&this.handler.redo()},finishSketch:function(){this.handler.finishGeometry()},cancel:function(){this.handler.cancel()},CLASS_NAME:"OpenLayers.Control.DrawFeature"}),OpenLayers.Handler.Polygon=OpenLayers.Class(OpenLayers.Handler.Path,{holeModifier:null,drawingHole:!1,polygon:null,createFeature:function(a){a=this.layer.getLonLatFromViewPortPx(a),a=new OpenLayers.Geometry.Point(a.lon,a.lat),this.point=new OpenLayers.Feature.Vector(a),this.line=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.LinearRing([this.point.geometry])),this.polygon=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Polygon([this.line.geometry])),this.callback("create",[this.point.geometry,this.getSketch()]),this.point.geometry.clearBounds(),this.layer.addFeatures([this.polygon,this.point],{silent:!0})},addPoint:function(){if(!this.drawingHole&&this.holeModifier&&this.evt&&this.evt[this.holeModifier])for(var a,b=this.point.geometry,c=this.control.layer.features,d=c.length-1;d>=0;--d)if(a=c[d].geometry,(a instanceof OpenLayers.Geometry.Polygon||a instanceof OpenLayers.Geometry.MultiPolygon)&&a.intersects(b)){b=c[d],this.control.layer.removeFeatures([b],{silent:!0}),this.control.layer.events.registerPriority("sketchcomplete",this,this.finalizeInteriorRing),this.control.layer.events.registerPriority("sketchmodified",this,this.enforceTopology),b.geometry.addComponent(this.line.geometry),this.polygon=b,this.drawingHole=!0;break}OpenLayers.Handler.Path.prototype.addPoint.apply(this,arguments)},getCurrentPointIndex:function(){return this.line.geometry.components.length-2},enforceTopology:function(a){var a=a.vertex,b=this.line.geometry.components;this.polygon.geometry.intersects(a)||(b=b[b.length-3],a.x=b.x,a.y=b.y)},finishGeometry:function(){this.line.geometry.removeComponent(this.line.geometry.components[this.line.geometry.components.length-2]),this.removePoint(),this.finalize()},finalizeInteriorRing:function(){var a=this.line.geometry,b=0!==a.getArea();if(b){for(var c=this.polygon.geometry.components,d=c.length-2;d>=0;--d)if(a.intersects(c[d])){b=!1;break}if(b){d=c.length-2;a:for(;d>0;--d)for(var e=c[d].components,f=0,g=e.length;g>f;++f)if(a.containsPoint(e[f])){b=!1;break a}}}return b?this.polygon.state!==OpenLayers.State.INSERT&&(this.polygon.state=OpenLayers.State.UPDATE):this.polygon.geometry.removeComponent(a),this.restoreFeature(),!1},cancel:function(){return this.drawingHole&&(this.polygon.geometry.removeComponent(this.line.geometry),this.restoreFeature(!0)),OpenLayers.Handler.Path.prototype.cancel.apply(this,arguments)},restoreFeature:function(a){this.control.layer.events.unregister("sketchcomplete",this,this.finalizeInteriorRing),this.control.layer.events.unregister("sketchmodified",this,this.enforceTopology),this.layer.removeFeatures([this.polygon],{silent:!0}),this.control.layer.addFeatures([this.polygon],{silent:!0}),this.drawingHole=!1,a||this.control.layer.events.triggerEvent("sketchcomplete",{feature:this.polygon})
},destroyFeature:function(a){OpenLayers.Handler.Path.prototype.destroyFeature.call(this,a),this.polygon=null},drawFeature:function(){this.layer.drawFeature(this.polygon,this.style),this.layer.drawFeature(this.point,this.style)},getSketch:function(){return this.polygon},getGeometry:function(){var a=this.polygon&&this.polygon.geometry;return a&&this.multi&&(a=new OpenLayers.Geometry.MultiPolygon([a])),a},CLASS_NAME:"OpenLayers.Handler.Polygon"}),OpenLayers.Control.EditingToolbar=OpenLayers.Class(OpenLayers.Control.Panel,{citeCompliant:!1,initialize:function(a,b){OpenLayers.Control.Panel.prototype.initialize.apply(this,[b]),this.addControls([new OpenLayers.Control.Navigation]),this.addControls([new OpenLayers.Control.DrawFeature(a,OpenLayers.Handler.Point,{displayClass:"olControlDrawFeaturePoint",handlerOptions:{citeCompliant:this.citeCompliant}}),new OpenLayers.Control.DrawFeature(a,OpenLayers.Handler.Path,{displayClass:"olControlDrawFeaturePath",handlerOptions:{citeCompliant:this.citeCompliant}}),new OpenLayers.Control.DrawFeature(a,OpenLayers.Handler.Polygon,{displayClass:"olControlDrawFeaturePolygon",handlerOptions:{citeCompliant:this.citeCompliant}})])},draw:function(){var a=OpenLayers.Control.Panel.prototype.draw.apply(this,arguments);return null===this.defaultControl&&(this.defaultControl=this.controls[0]),a},CLASS_NAME:"OpenLayers.Control.EditingToolbar"}),OpenLayers.Strategy.BBOX=OpenLayers.Class(OpenLayers.Strategy,{bounds:null,resolution:null,ratio:2,resFactor:null,response:null,activate:function(){var a=OpenLayers.Strategy.prototype.activate.call(this);return a&&(this.layer.events.on({moveend:this.update,refresh:this.update,visibilitychanged:this.update,scope:this}),this.update()),a},deactivate:function(){var a=OpenLayers.Strategy.prototype.deactivate.call(this);return a&&this.layer.events.un({moveend:this.update,refresh:this.update,visibilitychanged:this.update,scope:this}),a},update:function(a){var b=this.getMapBounds();null!==b&&(a&&a.force||this.layer.visibility&&this.layer.calculateInRange()&&this.invalidBounds(b))&&(this.calculateBounds(b),this.resolution=this.layer.map.getResolution(),this.triggerRead(a))},getMapBounds:function(){if(null===this.layer.map)return null;var a=this.layer.map.getExtent();return a&&!this.layer.projection.equals(this.layer.map.getProjectionObject())&&(a=a.clone().transform(this.layer.map.getProjectionObject(),this.layer.projection)),a},invalidBounds:function(a){return a||(a=this.getMapBounds()),a=!this.bounds||!this.bounds.containsBounds(a),!a&&this.resFactor&&(a=this.resolution/this.layer.map.getResolution(),a=a>=this.resFactor||a<=1/this.resFactor),a},calculateBounds:function(a){a||(a=this.getMapBounds());var b=a.getCenterLonLat(),c=a.getWidth()*this.ratio,a=a.getHeight()*this.ratio;this.bounds=new OpenLayers.Bounds(b.lon-c/2,b.lat-a/2,b.lon+c/2,b.lat+a/2)},triggerRead:function(a){this.response&&!(a&&!0===a.noAbort)&&(this.layer.protocol.abort(this.response),this.layer.events.triggerEvent("loadend")),this.layer.events.triggerEvent("loadstart"),this.response=this.layer.protocol.read(OpenLayers.Util.applyDefaults({filter:this.createFilter(),callback:this.merge,scope:this},a))},createFilter:function(){var a=new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.BBOX,value:this.bounds,projection:this.layer.projection});return this.layer.filter&&(a=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.AND,filters:[this.layer.filter,a]})),a},merge:function(a){if(this.layer.destroyFeatures(),(a=a.features)&&0<a.length){var b=this.layer.projection,c=this.layer.map.getProjectionObject();if(!c.equals(b))for(var d,e=0,f=a.length;f>e;++e)(d=a[e].geometry)&&d.transform(b,c);this.layer.addFeatures(a)}this.response=null,this.layer.events.triggerEvent("loadend")},CLASS_NAME:"OpenLayers.Strategy.BBOX"}),OpenLayers.Layer.WorldWind=OpenLayers.Class(OpenLayers.Layer.Grid,{DEFAULT_PARAMS:{},isBaseLayer:!0,lzd:null,zoomLevels:null,initialize:function(a,b,c,d,e,f){this.lzd=c,this.zoomLevels=d,c=[],c.push(a,b,e,f),OpenLayers.Layer.Grid.prototype.initialize.apply(this,c),this.params=OpenLayers.Util.applyDefaults(this.params,this.DEFAULT_PARAMS)},getZoom:function(){var a=this.map.getZoom();return this.map.getMaxExtent(),a-=Math.log(this.maxResolution/(this.lzd/512))/Math.log(2)},getURL:function(a){var a=this.adjustBounds(a),b=this.getZoom(),c=this.map.getMaxExtent(),d=this.lzd/Math.pow(2,this.getZoom()),e=Math.floor((a.left-c.left)/d),a=Math.floor((a.bottom-c.bottom)/d);return this.map.getResolution()<=this.lzd/512&&this.getZoom()<=this.zoomLevels?this.getFullRequestString({L:b,X:e,Y:a}):OpenLayers.Util.getImageLocation("blank.gif")},CLASS_NAME:"OpenLayers.Layer.WorldWind"}),OpenLayers.Protocol.CSW=function(a){var a=OpenLayers.Util.applyDefaults(a,OpenLayers.Protocol.CSW.DEFAULTS),b=OpenLayers.Protocol.CSW["v"+a.version.replace(/\./g,"_")];if(!b)throw"Unsupported CSW version: "+a.version;return new b(a)},OpenLayers.Protocol.CSW.DEFAULTS={version:"2.0.2"},OpenLayers.Format.WMTSCapabilities=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.0.0",yx:{"urn:ogc:def:crs:EPSG::4326":!0},createLayer:function(a,b){var c,d,e={layer:!0,matrixSet:!0};for(d in e)if(!(d in b))throw Error("Missing property '"+d+"' in layer configuration.");e=a.contents,d=e.tileMatrixSets[b.matrixSet];for(var f,g=0,h=e.layers.length;h>g;++g)if(e.layers[g].identifier===b.layer){f=e.layers[g];break}if(f&&d){for(var i,g=0,h=f.styles.length;h>g&&(i=f.styles[g],!i.isDefault);++g);c=new OpenLayers.Layer.WMTS(OpenLayers.Util.applyDefaults(b,{url:"REST"===b.requestEncoding&&f.resourceUrl?f.resourceUrl.tile.template:a.operationsMetadata.GetTile.dcp.http.get[0].url,name:f.title,style:i.identifier,matrixIds:d.matrixIds,tileFullExtent:d.bounds}))}return c},CLASS_NAME:"OpenLayers.Format.WMTSCapabilities"}),OpenLayers.Layer.Google.v3={DEFAULTS:{sphericalMercator:!0,projection:"EPSG:900913"},animationEnabled:!0,loadMapObject:function(){this.type||(this.type=google.maps.MapTypeId.ROADMAP);var a,b=OpenLayers.Layer.Google.cache[this.map.id];b?(a=b.mapObject,++b.count):(b=this.map.viewPortDiv,a=document.createElement("div"),a.id=this.map.id+"_GMapContainer",a.style.position="absolute",a.style.width="100%",a.style.height="100%",b.appendChild(a),b=this.map.getCenter(),a=new google.maps.Map(a,{center:b?new google.maps.LatLng(b.lat,b.lon):new google.maps.LatLng(0,0),zoom:this.map.getZoom()||0,mapTypeId:this.type,disableDefaultUI:!0,keyboardShortcuts:!1,draggable:!1,disableDoubleClickZoom:!0,scrollwheel:!1,streetViewControl:!1}),b={mapObject:a,count:1},OpenLayers.Layer.Google.cache[this.map.id]=b,this.repositionListener=google.maps.event.addListenerOnce(a,"center_changed",OpenLayers.Function.bind(this.repositionMapElements,this))),this.mapObject=a,this.setGMapVisibility(this.visibility)},repositionMapElements:function(){google.maps.event.trigger(this.mapObject,"resize");var a=this.mapObject.getDiv().firstChild;if(!a||3>a.childNodes.length)return this.repositionTimer=window.setTimeout(OpenLayers.Function.bind(this.repositionMapElements,this),250),!1;for(var b=OpenLayers.Layer.Google.cache[this.map.id],c=this.map.viewPortDiv,d=a.children.length-1;d>=0;--d){if(1000001==a.children[d].style.zIndex){var e=a.children[d];c.appendChild(e),e.style.zIndex="1100",e.style.bottom="",e.className="olLayerGoogleCopyright olLayerGoogleV3",e.style.display="",b.termsOfUse=e}1e6==a.children[d].style.zIndex&&(e=a.children[d],c.appendChild(e),e.style.zIndex="1100",e.style.bottom="",e.className="olLayerGooglePoweredBy olLayerGoogleV3 gmnoprint",e.style.display="",b.poweredBy=e),10000002==a.children[d].style.zIndex&&c.appendChild(a.children[d])}this.setGMapVisibility(this.visibility)},onMapResize:function(){if(this.visibility)google.maps.event.trigger(this.mapObject,"resize");else{var a=OpenLayers.Layer.Google.cache[this.map.id];if(!a.resized){var b=this;google.maps.event.addListenerOnce(this.mapObject,"tilesloaded",function(){google.maps.event.trigger(b.mapObject,"resize"),b.moveTo(b.map.getCenter(),b.map.getZoom()),delete a.resized})}a.resized=!0}},setGMapVisibility:function(a){var b=OpenLayers.Layer.Google.cache[this.map.id];if(b){for(var c,d=this.type,e=this.map.layers,f=e.length-1;f>=0;--f)if(c=e[f],c instanceof OpenLayers.Layer.Google&&!0===c.visibility&&!0===c.inRange){d=c.type,a=!0;break}e=this.mapObject.getDiv(),!0===a?(this.mapObject.setMapTypeId(d),e.style.left="",b.termsOfUse&&b.termsOfUse.style&&(b.termsOfUse.style.left="",b.termsOfUse.style.display="",b.poweredBy.style.display=""),b.displayed=this.id):(delete b.displayed,e.style.left="-9999px",b.termsOfUse&&b.termsOfUse.style&&(b.termsOfUse.style.display="none",b.termsOfUse.style.left="-9999px",b.poweredBy.style.display="none"))}},getMapContainer:function(){return this.mapObject.getDiv()},getMapObjectBoundsFromOLBounds:function(a){var b=null;return null!=a&&(b=this.sphericalMercator?this.inverseMercator(a.bottom,a.left):new OpenLayers.LonLat(a.bottom,a.left),a=this.sphericalMercator?this.inverseMercator(a.top,a.right):new OpenLayers.LonLat(a.top,a.right),b=new google.maps.LatLngBounds(new google.maps.LatLng(b.lat,b.lon),new google.maps.LatLng(a.lat,a.lon))),b},getMapObjectLonLatFromMapObjectPixel:function(a){var b=this.map.getSize(),c=this.getLongitudeFromMapObjectLonLat(this.mapObject.center),d=this.getLatitudeFromMapObjectLonLat(this.mapObject.center),e=this.map.getResolution(),a=new OpenLayers.LonLat(c+(a.x-b.w/2)*e,d-(a.y-b.h/2)*e);return this.wrapDateLine&&(a=a.wrapDateLine(this.maxExtent)),this.getMapObjectLonLatFromLonLat(a.lon,a.lat)},getMapObjectPixelFromMapObjectLonLat:function(a){var b=this.getLongitudeFromMapObjectLonLat(a),a=this.getLatitudeFromMapObjectLonLat(a),c=this.map.getResolution(),d=this.map.getExtent();return this.getMapObjectPixelFromXY(1/c*(b-d.left),1/c*(d.top-a))},setMapObjectCenter:function(a,b){if(!1===this.animationEnabled&&b!=this.mapObject.zoom){var c=this.getMapContainer();google.maps.event.addListenerOnce(this.mapObject,"idle",function(){c.style.visibility=""}),c.style.visibility="hidden"}this.mapObject.setOptions({center:a,zoom:b})},getMapObjectZoomFromMapObjectBounds:function(a){return this.mapObject.getBoundsZoomLevel(a)},getMapObjectLonLatFromLonLat:function(a,b){var c;return this.sphericalMercator?(c=this.inverseMercator(a,b),c=new google.maps.LatLng(c.lat,c.lon)):c=new google.maps.LatLng(b,a),c},getMapObjectPixelFromXY:function(a,b){return new google.maps.Point(a,b)},destroy:function(){this.repositionListener&&google.maps.event.removeListener(this.repositionListener),this.repositionTimer&&window.clearTimeout(this.repositionTimer),OpenLayers.Layer.Google.prototype.destroy.apply(this,arguments)}},OpenLayers.Format.WPSDescribeProcess=OpenLayers.Class(OpenLayers.Format.XML,{VERSION:"1.0.0",namespaces:{wps:"http://www.opengis.net/wps/1.0.0",ows:"http://www.opengis.net/ows/1.1",xsi:"http://www.w3.org/2001/XMLSchema-instance"},schemaLocation:"http://www.opengis.net/wps/1.0.0 http://schemas.opengis.net/wps/1.0.0/wpsAll.xsd",defaultPrefix:"wps",regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},read:function(a){"string"==typeof a&&(a=OpenLayers.Format.XML.prototype.read.apply(this,[a])),a&&9==a.nodeType&&(a=a.documentElement);var b={};return this.readNode(a,b),b},readers:{wps:{ProcessDescriptions:function(a,b){b.processDescriptions={},this.readChildNodes(a,b.processDescriptions)},ProcessDescription:function(a,b){var c={processVersion:this.getAttributeNS(a,this.namespaces.wps,"processVersion"),statusSupported:"true"===a.getAttribute("statusSupported"),storeSupported:"true"===a.getAttribute("storeSupported")};this.readChildNodes(a,c),b[c.identifier]=c},DataInputs:function(a,b){b.dataInputs=[],this.readChildNodes(a,b.dataInputs)},ProcessOutputs:function(a,b){b.processOutputs=[],this.readChildNodes(a,b.processOutputs)},Output:function(a,b){var c={};this.readChildNodes(a,c),b.push(c)},ComplexOutput:function(a,b){b.complexOutput={},this.readChildNodes(a,b.complexOutput)},Input:function(a,b){var c={maxOccurs:parseInt(a.getAttribute("maxOccurs")),minOccurs:parseInt(a.getAttribute("minOccurs"))};this.readChildNodes(a,c),b.push(c)},BoundingBoxData:function(a,b){b.boundingBoxData={},this.readChildNodes(a,b.boundingBoxData)},CRS:function(a,b){b.CRSs||(b.CRSs={}),b.CRSs[this.getChildValue(a)]=!0},LiteralData:function(a,b){b.literalData={},this.readChildNodes(a,b.literalData)},ComplexData:function(a,b){b.complexData={},this.readChildNodes(a,b.complexData)},Default:function(a,b){b["default"]={},this.readChildNodes(a,b["default"])},Supported:function(a,b){b.supported={},this.readChildNodes(a,b.supported)},Format:function(a,b){var c={};this.readChildNodes(a,c),b.formats||(b.formats={}),b.formats[c.mimeType]=!0},MimeType:function(a,b){b.mimeType=this.getChildValue(a)}},ows:OpenLayers.Format.OWSCommon.v1_1_0.prototype.readers.ows},CLASS_NAME:"OpenLayers.Format.WPSDescribeProcess"}),OpenLayers.Format.CSWGetRecords.v2_0_2=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{csw:"http://www.opengis.net/cat/csw/2.0.2",dc:"http://purl.org/dc/elements/1.1/",dct:"http://purl.org/dc/terms/",gmd:"http://www.isotc211.org/2005/gmd",geonet:"http://www.fao.org/geonetwork",ogc:"http://www.opengis.net/ogc",ows:"http://www.opengis.net/ows",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},defaultPrefix:"csw",version:"2.0.2",schemaLocation:"http://www.opengis.net/cat/csw/2.0.2 http://schemas.opengis.net/csw/2.0.2/CSW-discovery.xsd",requestId:null,resultType:null,outputFormat:null,outputSchema:null,startPosition:null,maxRecords:null,DistributedSearch:null,ResponseHandler:null,Query:null,regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},initialize:function(a){OpenLayers.Format.XML.prototype.initialize.apply(this,[a])},read:function(a){"string"==typeof a&&(a=OpenLayers.Format.XML.prototype.read.apply(this,[a])),a&&9==a.nodeType&&(a=a.documentElement);var b={};return this.readNode(a,b),b},readers:{csw:{GetRecordsResponse:function(a,b){b.records=[],this.readChildNodes(a,b);var c=this.getAttributeNS(a,"","version");""!=c&&(b.version=c)},RequestId:function(a,b){b.RequestId=this.getChildValue(a)},SearchStatus:function(a,b){b.SearchStatus={};var c=this.getAttributeNS(a,"","timestamp");""!=c&&(b.SearchStatus.timestamp=c)},SearchResults:function(a,b){this.readChildNodes(a,b);for(var c=a.attributes,d={},e=0,f=c.length;f>e;++e)d[c[e].name]="numberOfRecordsMatched"==c[e].name||"numberOfRecordsReturned"==c[e].name||"nextRecord"==c[e].name?parseInt(c[e].nodeValue):c[e].nodeValue;b.SearchResults=d},SummaryRecord:function(a,b){var c={type:"SummaryRecord"};this.readChildNodes(a,c),b.records.push(c)},BriefRecord:function(a,b){var c={type:"BriefRecord"};this.readChildNodes(a,c),b.records.push(c)},DCMIRecord:function(a,b){var c={type:"DCMIRecord"};this.readChildNodes(a,c),b.records.push(c)},Record:function(a,b){var c={type:"Record"};this.readChildNodes(a,c),b.records.push(c)},"*":function(a,b){var c=a.localName||a.nodeName.split(":").pop();b[c]=this.getChildValue(a)}},geonet:{info:function(a,b){var c={};this.readChildNodes(a,c),b.gninfo=c}},dc:{"*":function(a,b){var c=a.localName||a.nodeName.split(":").pop();OpenLayers.Util.isArray(b[c])||(b[c]=[]);for(var d={},e=a.attributes,f=0,g=e.length;g>f;++f)d[e[f].name]=e[f].nodeValue;d.value=this.getChildValue(a),""!=d.value&&b[c].push(d)}},dct:{"*":function(a,b){var c=a.localName||a.nodeName.split(":").pop();OpenLayers.Util.isArray(b[c])||(b[c]=[]),b[c].push(this.getChildValue(a))}},ows:OpenLayers.Util.applyDefaults({BoundingBox:function(a,b){b.bounds&&(b.BoundingBox=[{crs:b.projection,value:[b.bounds.left,b.bounds.bottom,b.bounds.right,b.bounds.top]}],delete b.projection,delete b.bounds),OpenLayers.Format.OWSCommon.v1_0_0.prototype.readers.ows.BoundingBox.apply(this,arguments)}},OpenLayers.Format.OWSCommon.v1_0_0.prototype.readers.ows)},write:function(a){return a=this.writeNode("csw:GetRecords",a),a.setAttribute("xmlns:gmd",this.namespaces.gmd),OpenLayers.Format.XML.prototype.write.apply(this,[a])},writers:{csw:{GetRecords:function(a){a||(a={});var b=this.createElementNSPlus("csw:GetRecords",{attributes:{service:"CSW",version:this.version,requestId:a.requestId||this.requestId,resultType:a.resultType||this.resultType,outputFormat:a.outputFormat||this.outputFormat,outputSchema:a.outputSchema||this.outputSchema,startPosition:a.startPosition||this.startPosition,maxRecords:a.maxRecords||this.maxRecords}});(a.DistributedSearch||this.DistributedSearch)&&this.writeNode("csw:DistributedSearch",a.DistributedSearch||this.DistributedSearch,b);var c=a.ResponseHandler||this.ResponseHandler;if(OpenLayers.Util.isArray(c)&&0<c.length)for(var d=0,e=c.length;e>d;d++)this.writeNode("csw:ResponseHandler",c[d],b);return this.writeNode("Query",a.Query||this.Query,b),b},DistributedSearch:function(a){return this.createElementNSPlus("csw:DistributedSearch",{attributes:{hopCount:a.hopCount}})},ResponseHandler:function(a){return this.createElementNSPlus("csw:ResponseHandler",{value:a.value})},Query:function(a){a||(a={});var b=this.createElementNSPlus("csw:Query",{attributes:{typeNames:a.typeNames||"csw:Record"}}),c=a.ElementName;if(OpenLayers.Util.isArray(c)&&0<c.length)for(var d=0,e=c.length;e>d;d++)this.writeNode("csw:ElementName",c[d],b);else this.writeNode("csw:ElementSetName",a.ElementSetName||{value:"summary"},b);return a.Constraint&&this.writeNode("csw:Constraint",a.Constraint,b),a.SortBy&&this.writeNode("ogc:SortBy",a.SortBy,b),b},ElementName:function(a){return this.createElementNSPlus("csw:ElementName",{value:a.value})},ElementSetName:function(a){return this.createElementNSPlus("csw:ElementSetName",{attributes:{typeNames:a.typeNames},value:a.value})},Constraint:function(a){var b=this.createElementNSPlus("csw:Constraint",{attributes:{version:a.version}});if(a.Filter){var c=new OpenLayers.Format.Filter({version:a.version});b.appendChild(c.write(a.Filter))}else a.CqlText&&(a=this.createElementNSPlus("CqlText",{value:a.CqlText.value}),b.appendChild(a));return b}},ogc:OpenLayers.Format.Filter.v1_1_0.prototype.writers.ogc},CLASS_NAME:"OpenLayers.Format.CSWGetRecords.v2_0_2"}),OpenLayers.Marker.Box=OpenLayers.Class(OpenLayers.Marker,{bounds:null,div:null,initialize:function(a,b,c){this.bounds=a,this.div=OpenLayers.Util.createDiv(),this.div.style.overflow="hidden",this.events=new OpenLayers.Events(this,this.div),this.setBorder(b,c)},destroy:function(){this.div=this.bounds=null,OpenLayers.Marker.prototype.destroy.apply(this,arguments)},setBorder:function(a,b){a||(a="red"),b||(b=2),this.div.style.border=b+"px solid "+a},draw:function(a,b){return OpenLayers.Util.modifyDOMElement(this.div,null,a,b),this.div},onScreen:function(){var a=!1;return this.map&&(a=this.map.getExtent().containsBounds(this.bounds,!0,!0)),a},display:function(a){this.div.style.display=a?"":"none"},CLASS_NAME:"OpenLayers.Marker.Box"}),OpenLayers.Format.Text=OpenLayers.Class(OpenLayers.Format,{defaultStyle:null,extractStyles:!0,initialize:function(a){a=a||{},!1!==a.extractStyles&&(a.defaultStyle={externalGraphic:OpenLayers.Util.getImageLocation("marker.png"),graphicWidth:21,graphicHeight:25,graphicXOffset:-10.5,graphicYOffset:-12.5}),OpenLayers.Format.prototype.initialize.apply(this,[a])},read:function(a){for(var b,a=a.split("\n"),c=[],d=0;d<a.length-1;d++){var e=a[d].replace(/^\s*/,"").replace(/\s*$/,"");if("#"!=e.charAt(0))if(b){for(var e=e.split("	"),f=new OpenLayers.Geometry.Point(0,0),g={},h=this.defaultStyle?OpenLayers.Util.applyDefaults({},this.defaultStyle):null,i=!1,j=0;j<e.length;j++)if(e[j])if("point"==b[j])i=e[j].split(","),f.y=parseFloat(i[0]),f.x=parseFloat(i[1]),i=!0;else if("lat"==b[j])f.y=parseFloat(e[j]),i=!0;else if("lon"==b[j])f.x=parseFloat(e[j]),i=!0;else if("title"==b[j])g.title=e[j];else if("image"==b[j]||"icon"==b[j]&&h)h.externalGraphic=e[j];else if("iconSize"==b[j]&&h){var k=e[j].split(",");h.graphicWidth=parseFloat(k[0]),h.graphicHeight=parseFloat(k[1])}else"iconOffset"==b[j]&&h?(k=e[j].split(","),h.graphicXOffset=parseFloat(k[0]),h.graphicYOffset=parseFloat(k[1])):"description"==b[j]?g.description=e[j]:"overflow"==b[j]?g.overflow=e[j]:g[b[j]]=e[j];i&&(this.internalProjection&&this.externalProjection&&f.transform(this.externalProjection,this.internalProjection),e=new OpenLayers.Feature.Vector(f,g,h),c.push(e))}else b=e.split("	")}return c},CLASS_NAME:"OpenLayers.Format.Text"}),OpenLayers.Layer.Text=OpenLayers.Class(OpenLayers.Layer.Markers,{location:null,features:null,formatOptions:null,selectedFeature:null,initialize:function(){OpenLayers.Layer.Markers.prototype.initialize.apply(this,arguments),this.features=[]},destroy:function(){OpenLayers.Layer.Markers.prototype.destroy.apply(this,arguments),this.clearFeatures(),this.features=null},loadText:function(){!this.loaded&&null!=this.location&&(this.events.triggerEvent("loadstart"),OpenLayers.Request.GET({url:this.location,success:this.parseData,failure:function(){this.events.triggerEvent("loadend")},scope:this}),this.loaded=!0)},moveTo:function(){OpenLayers.Layer.Markers.prototype.moveTo.apply(this,arguments),this.visibility&&!this.loaded&&this.loadText()},parseData:function(a){var a=a.responseText,b={};OpenLayers.Util.extend(b,this.formatOptions),this.map&&!this.projection.equals(this.map.getProjectionObject())&&(b.externalProjection=this.projection,b.internalProjection=this.map.getProjectionObject());for(var a=new OpenLayers.Format.Text(b).read(a),b=0,c=a.length;c>b;b++){var d,e,f,g={},h=a[b];d=new OpenLayers.LonLat(h.geometry.x,h.geometry.y),h.style.graphicWidth&&h.style.graphicHeight&&(e=new OpenLayers.Size(h.style.graphicWidth,h.style.graphicHeight)),void 0!==h.style.graphicXOffset&&void 0!==h.style.graphicYOffset&&(f=new OpenLayers.Pixel(h.style.graphicXOffset,h.style.graphicYOffset)),null!=h.style.externalGraphic?g.icon=new OpenLayers.Icon(h.style.externalGraphic,e,f):(g.icon=OpenLayers.Marker.defaultIcon(),null!=e&&g.icon.setSize(e)),null!=h.attributes.title&&null!=h.attributes.description&&(g.popupContentHTML="<h2>"+h.attributes.title+"</h2><p>"+h.attributes.description+"</p>"),g.overflow=h.attributes.overflow||"auto",g=new OpenLayers.Feature(this,d,g),this.features.push(g),d=g.createMarker(),null!=h.attributes.title&&null!=h.attributes.description&&d.events.register("click",g,this.markerClick),this.addMarker(d)}this.events.triggerEvent("loadend")},markerClick:function(a){var b=this==this.layer.selectedFeature;this.layer.selectedFeature=b?null:this;for(var c=0,d=this.layer.map.popups.length;d>c;c++)this.layer.map.removePopup(this.layer.map.popups[c]);b||this.layer.map.addPopup(this.createPopup()),OpenLayers.Event.stop(a)},clearFeatures:function(){if(null!=this.features)for(;0<this.features.length;){var a=this.features[0];OpenLayers.Util.removeItem(this.features,a),a.destroy()}},CLASS_NAME:"OpenLayers.Layer.Text"}),OpenLayers.Handler.RegularPolygon=OpenLayers.Class(OpenLayers.Handler.Drag,{sides:4,radius:null,snapAngle:null,snapToggle:"shiftKey",layerOptions:null,persist:!1,irregular:!1,citeCompliant:!1,angle:null,fixedRadius:!1,feature:null,layer:null,origin:null,initialize:function(a,b,c){c&&c.layerOptions&&c.layerOptions.styleMap||(this.style=OpenLayers.Util.extend(OpenLayers.Feature.Vector.style["default"],{})),OpenLayers.Handler.Drag.prototype.initialize.apply(this,[a,b,c]),this.options=c?c:{}},setOptions:function(a){OpenLayers.Util.extend(this.options,a),OpenLayers.Util.extend(this,a)},activate:function(){var a=!1;return OpenLayers.Handler.Drag.prototype.activate.apply(this,arguments)&&(a=OpenLayers.Util.extend({displayInLayerSwitcher:!1,calculateInRange:OpenLayers.Function.True,wrapDateLine:this.citeCompliant},this.layerOptions),this.layer=new OpenLayers.Layer.Vector(this.CLASS_NAME,a),this.map.addLayer(this.layer),a=!0),a},deactivate:function(){var a=!1;return OpenLayers.Handler.Drag.prototype.deactivate.apply(this,arguments)&&(this.dragging&&this.cancel(),null!=this.layer.map&&(this.layer.destroy(!1),this.feature&&this.feature.destroy()),this.feature=this.layer=null,a=!0),a},down:function(a){this.fixedRadius=!!this.radius,a=this.layer.getLonLatFromViewPortPx(a.xy),this.origin=new OpenLayers.Geometry.Point(a.lon,a.lat),(!this.fixedRadius||this.irregular)&&(this.radius=this.map.getResolution()),this.persist&&this.clear(),this.feature=new OpenLayers.Feature.Vector,this.createGeometry(),this.callback("create",[this.origin,this.feature]),this.layer.addFeatures([this.feature],{silent:!0}),this.layer.drawFeature(this.feature,this.style)},move:function(a){var b=this.layer.getLonLatFromViewPortPx(a.xy),b=new OpenLayers.Geometry.Point(b.lon,b.lat);this.irregular?(a=Math.sqrt(2)*Math.abs(b.y-this.origin.y)/2,this.radius=Math.max(this.map.getResolution()/2,a)):this.fixedRadius?this.origin=b:(this.calculateAngle(b,a),this.radius=Math.max(this.map.getResolution()/2,b.distanceTo(this.origin))),this.modifyGeometry(),this.irregular&&(a=b.x-this.origin.x,b=b.y-this.origin.y,this.feature.geometry.resize(1,this.origin,0==b?a/(this.radius*Math.sqrt(2)):a/b),this.feature.geometry.move(a/2,b/2)),this.layer.drawFeature(this.feature,this.style)},up:function(a){this.finalize(),this.start==this.last&&this.callback("done",[a.xy])},out:function(){this.finalize()},createGeometry:function(){this.angle=Math.PI*(1/this.sides-.5),this.snapAngle&&(this.angle+=this.snapAngle*(Math.PI/180)),this.feature.geometry=OpenLayers.Geometry.Polygon.createRegularPolygon(this.origin,this.radius,this.sides,this.snapAngle)},modifyGeometry:function(){var a,b,c=this.feature.geometry.components[0];c.components.length!=this.sides+1&&(this.createGeometry(),c=this.feature.geometry.components[0]);for(var d=0;d<this.sides;++d)b=c.components[d],a=this.angle+2*d*Math.PI/this.sides,b.x=this.origin.x+this.radius*Math.cos(a),b.y=this.origin.y+this.radius*Math.sin(a),b.clearBounds()},calculateAngle:function(a,b){var c=Math.atan2(a.y-this.origin.y,a.x-this.origin.x);if(this.snapAngle&&this.snapToggle&&!b[this.snapToggle]){var d=Math.PI/180*this.snapAngle;this.angle=Math.round(c/d)*d}else this.angle=c},cancel:function(){this.callback("cancel",null),this.finalize()},finalize:function(){this.origin=null,this.radius=this.options.radius},clear:function(){this.layer&&(this.layer.renderer.clear(),this.layer.destroyFeatures())},callback:function(a){this.callbacks[a]&&this.callbacks[a].apply(this.control,[this.feature.geometry.clone()]),!this.persist&&("done"==a||"cancel"==a)&&this.clear()},CLASS_NAME:"OpenLayers.Handler.RegularPolygon"}),OpenLayers.Control.SLDSelect=OpenLayers.Class(OpenLayers.Control,{clearOnDeactivate:!1,layers:null,callbacks:null,selectionSymbolizer:{Polygon:{fillColor:"#FF0000",stroke:!1},Line:{strokeColor:"#FF0000",strokeWidth:2},Point:{graphicName:"square",fillColor:"#FF0000",pointRadius:5}},layerOptions:null,handlerOptions:null,sketchStyle:null,wfsCache:{},layerCache:{},initialize:function(a,b){OpenLayers.Control.prototype.initialize.apply(this,[b]),this.callbacks=OpenLayers.Util.extend({done:this.select,click:this.select},this.callbacks),this.handlerOptions=this.handlerOptions||{},this.layerOptions=OpenLayers.Util.applyDefaults(this.layerOptions,{displayInLayerSwitcher:!1,tileOptions:{maxGetUrlLength:2048}}),this.sketchStyle&&(this.handlerOptions.layerOptions=OpenLayers.Util.applyDefaults(this.handlerOptions.layerOptions,{styleMap:new OpenLayers.StyleMap({"default":this.sketchStyle})})),this.handler=new a(this,this.callbacks,this.handlerOptions)},destroy:function(){for(var a in this.layerCache)delete this.layerCache[a];for(a in this.wfsCache)delete this.wfsCache[a];OpenLayers.Control.prototype.destroy.apply(this,arguments)},coupleLayerVisiblity:function(a){this.setVisibility(a.object.getVisibility())},createSelectionLayer:function(a){var b;return this.layerCache[a.id]?b=this.layerCache[a.id]:(b=new OpenLayers.Layer.WMS(a.name,a.url,a.params,OpenLayers.Util.applyDefaults(this.layerOptions,a.getOptions())),this.layerCache[a.id]=b,!1===this.layerOptions.displayInLayerSwitcher&&a.events.on({visibilitychanged:this.coupleLayerVisiblity,scope:b}),this.map.addLayer(b)),b},createSLD:function(a,b,c){for(var d={version:"1.0.0",namedLayers:{}},e=(""+a.params.LAYERS).split(","),f=0,g=e.length;g>f;f++){var h=e[f];d.namedLayers[h]={name:h,userStyles:[]};var i=this.selectionSymbolizer,j=c[f];0<=j.type.indexOf("Polygon")?i={Polygon:this.selectionSymbolizer.Polygon}:0<=j.type.indexOf("LineString")?i={Line:this.selectionSymbolizer.Line}:0<=j.type.indexOf("Point")&&(i={Point:this.selectionSymbolizer.Point}),d.namedLayers[h].userStyles.push({name:"default",rules:[new OpenLayers.Rule({symbolizer:i,filter:b[f],maxScaleDenominator:a.options.minScale})]})}return new OpenLayers.Format.SLD({srsName:this.map.getProjection()}).write(d)},parseDescribeLayer:function(a){var b=new OpenLayers.Format.WMSDescribeLayer,c=a.responseXML;c&&c.documentElement||(c=a.responseText);for(var a=b.read(c),b=[],c=null,d=0,e=a.length;e>d;d++)"WFS"==a[d].owsType&&(b.push(a[d].typeName),c=a[d].owsURL);OpenLayers.Request.GET({url:c,params:{SERVICE:"WFS",TYPENAME:b.toString(),REQUEST:"DescribeFeatureType",VERSION:"1.0.0"},callback:function(a){var b=new OpenLayers.Format.WFSDescribeFeatureType,c=a.responseXML;c&&c.documentElement||(c=a.responseText),this.control.wfsCache[this.layer.id]=b.read(c),this.control._queue&&this.control.applySelection()},scope:this})},getGeometryAttributes:function(a){for(var b=[],a=this.wfsCache[a.id],c=0,d=a.featureTypes.length;d>c;c++)for(var e=a.featureTypes[c].properties,f=0,g=e.length;g>f;f++){var h=e[f],i=h.type;(0<=i.indexOf("LineString")||0<=i.indexOf("GeometryAssociationType")||0<=i.indexOf("GeometryPropertyType")||0<=i.indexOf("Point")||0<=i.indexOf("Polygon"))&&b.push(h)}return b},activate:function(){var a=OpenLayers.Control.prototype.activate.call(this);if(a)for(var b=0,c=this.layers.length;c>b;b++){var d=this.layers[b];d&&!this.wfsCache[d.id]&&OpenLayers.Request.GET({url:d.url,params:{SERVICE:"WMS",VERSION:d.params.VERSION,LAYERS:d.params.LAYERS,REQUEST:"DescribeLayer"},callback:this.parseDescribeLayer,scope:{layer:d,control:this}})}return a},deactivate:function(){var a=OpenLayers.Control.prototype.deactivate.call(this);if(a)for(var b=0,c=this.layers.length;c>b;b++){var d=this.layers[b];if(d&&!0===this.clearOnDeactivate){var e=this.layerCache,f=e[d.id];f&&(d.events.un({visibilitychanged:this.coupleLayerVisiblity,scope:f}),f.destroy(),delete e[d.id])}}return a},setLayers:function(a){this.active?(this.deactivate(),this.layers=a,this.activate()):this.layers=a},createFilter:function(a,b){var c=null;return this.handler instanceof OpenLayers.Handler.RegularPolygon?c=new OpenLayers.Filter.Spatial(!0===this.handler.irregular?{type:OpenLayers.Filter.Spatial.BBOX,property:a.name,value:b.getBounds()}:{type:OpenLayers.Filter.Spatial.INTERSECTS,property:a.name,value:b}):this.handler instanceof OpenLayers.Handler.Polygon?c=new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.INTERSECTS,property:a.name,value:b}):this.handler instanceof OpenLayers.Handler.Path?c=new OpenLayers.Filter.Spatial(0<=a.type.indexOf("Point")?{type:OpenLayers.Filter.Spatial.DWITHIN,property:a.name,distance:.01*this.map.getExtent().getWidth(),distanceUnits:this.map.getUnits(),value:b}:{type:OpenLayers.Filter.Spatial.INTERSECTS,property:a.name,value:b}):this.handler instanceof OpenLayers.Handler.Click&&(c=new OpenLayers.Filter.Spatial(0<=a.type.indexOf("Polygon")?{type:OpenLayers.Filter.Spatial.INTERSECTS,property:a.name,value:b}:{type:OpenLayers.Filter.Spatial.DWITHIN,property:a.name,distance:.01*this.map.getExtent().getWidth(),distanceUnits:this.map.getUnits(),value:b})),c},select:function(a){this._queue=function(){for(var b=0,c=this.layers.length;c>b;b++){for(var d=this.layers[b],e=this.getGeometryAttributes(d),f=[],g=0,h=e.length;h>g;g++){var i=e[g];if(null!==i){if(!(a instanceof OpenLayers.Geometry)){var j=this.map.getLonLatFromPixel(a.xy);a=new OpenLayers.Geometry.Point(j.lon,j.lat)}i=this.createFilter(i,a),null!==i&&f.push(i)}}g=this.createSelectionLayer(d),e=this.createSLD(d,f,e),this.events.triggerEvent("selected",{layer:d,filters:f}),g.mergeNewParams({SLD_BODY:e}),delete this._queue
}},this.applySelection()},applySelection:function(){for(var a=!0,b=0,c=this.layers.length;c>b;b++)if(!this.wfsCache[this.layers[b].id]){a=!1;break}a&&this._queue.call(this)},CLASS_NAME:"OpenLayers.Control.SLDSelect"}),OpenLayers.Control.Scale=OpenLayers.Class(OpenLayers.Control,{element:null,geodesic:!1,initialize:function(a,b){OpenLayers.Control.prototype.initialize.apply(this,[b]),this.element=OpenLayers.Util.getElement(a)},draw:function(){return OpenLayers.Control.prototype.draw.apply(this,arguments),this.element||(this.element=document.createElement("div"),this.div.appendChild(this.element)),this.map.events.register("moveend",this,this.updateScale),this.updateScale(),this.div},updateScale:function(){var a;if(!0===this.geodesic){if(!this.map.getUnits())return;a=OpenLayers.INCHES_PER_UNIT,a=(this.map.getGeodesicPixelSize().w||1e-6)*a.km*OpenLayers.DOTS_PER_INCH}else a=this.map.getScale();a&&(a=a>=9500&&95e4>=a?Math.round(a/1e3)+"K":a>=95e4?Math.round(a/1e6)+"M":Math.round(a),this.element.innerHTML=OpenLayers.i18n("Scale = 1 : ${scaleDenom}",{scaleDenom:a}))},CLASS_NAME:"OpenLayers.Control.Scale"}),OpenLayers.Control.Button=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_BUTTON,trigger:function(){},CLASS_NAME:"OpenLayers.Control.Button"}),OpenLayers.Layer.MapGuide=OpenLayers.Class(OpenLayers.Layer.Grid,{isBaseLayer:!0,useHttpTile:!1,singleTile:!1,useOverlay:!1,useAsyncOverlay:!0,TILE_PARAMS:{operation:"GETTILEIMAGE",version:"1.2.0"},SINGLE_TILE_PARAMS:{operation:"GETMAPIMAGE",format:"PNG",locale:"en",clip:"1",version:"1.0.0"},OVERLAY_PARAMS:{operation:"GETDYNAMICMAPOVERLAYIMAGE",format:"PNG",locale:"en",clip:"1",version:"2.0.0"},FOLDER_PARAMS:{tileColumnsPerFolder:30,tileRowsPerFolder:30,format:"png",querystring:null},defaultSize:new OpenLayers.Size(300,300),tileOriginCorner:"tl",initialize:function(a,b,c,d){OpenLayers.Layer.Grid.prototype.initialize.apply(this,arguments),(null==d||null==d.isBaseLayer)&&(this.isBaseLayer="true"!=this.transparent&&1!=this.transparent),d&&null!=d.useOverlay&&(this.useOverlay=d.useOverlay),this.singleTile?this.useOverlay?(OpenLayers.Util.applyDefaults(this.params,this.OVERLAY_PARAMS),this.useAsyncOverlay||(this.params.version="1.0.0")):OpenLayers.Util.applyDefaults(this.params,this.SINGLE_TILE_PARAMS):(this.useHttpTile?OpenLayers.Util.applyDefaults(this.params,this.FOLDER_PARAMS):OpenLayers.Util.applyDefaults(this.params,this.TILE_PARAMS),this.setTileSize(this.defaultSize))},clone:function(a){return null==a&&(a=new OpenLayers.Layer.MapGuide(this.name,this.url,this.params,this.getOptions())),a=OpenLayers.Layer.Grid.prototype.clone.apply(this,[a])},getURL:function(a){var b;b=a.getCenterLonLat();var c=this.map.getSize();return this.singleTile?(a={setdisplaydpi:OpenLayers.DOTS_PER_INCH,setdisplayheight:c.h*this.ratio,setdisplaywidth:c.w*this.ratio,setviewcenterx:b.lon,setviewcentery:b.lat,setviewscale:this.map.getScale()},this.useOverlay&&!this.useAsyncOverlay&&(b={},b=OpenLayers.Util.extend(b,a),b.operation="GETVISIBLEMAPEXTENT",b.version="1.0.0",b.session=this.params.session,b.mapName=this.params.mapName,b.format="text/xml",b=this.getFullRequestString(b),OpenLayers.Request.GET({url:b,async:!1})),b=this.getFullRequestString(a)):(c=this.map.getResolution(),b=Math.floor((a.left-this.maxExtent.left)/c),b=Math.round(b/this.tileSize.w),a=Math.floor((this.maxExtent.top-a.top)/c),a=Math.round(a/this.tileSize.h),b=this.useHttpTile?this.getImageFilePath({tilecol:b,tilerow:a,scaleindex:this.resolutions.length-this.map.zoom-1}):this.getFullRequestString({tilecol:b,tilerow:a,scaleindex:this.resolutions.length-this.map.zoom-1})),b},getFullRequestString:function(a,b){var c=null==b?this.url:b;"object"==typeof c&&(c=c[Math.floor(Math.random()*c.length)]);var d,e=c,f=OpenLayers.Util.extend({},this.params),f=OpenLayers.Util.extend(f,a),g=OpenLayers.Util.upperCaseObject(OpenLayers.Util.getParameters(c));for(d in f)d.toUpperCase()in g&&delete f[d];return f=OpenLayers.Util.getParameterString(f),f=f.replace(/,/g,"+"),""!=f&&(g=c.charAt(c.length-1),e="&"==g||"?"==g?e+f:-1==c.indexOf("?")?e+("?"+f):e+("&"+f)),e},getImageFilePath:function(a,b){var c=null==b?this.url:b;"object"==typeof c&&(c=c[Math.floor(Math.random()*c.length)]);var d="",e="";return 0>a.tilerow&&(d="-"),d=0==a.tilerow?d+"0":d+Math.floor(Math.abs(a.tilerow/this.params.tileRowsPerFolder))*this.params.tileRowsPerFolder,0>a.tilecol&&(e="-"),e=0==a.tilecol?e+"0":e+Math.floor(Math.abs(a.tilecol/this.params.tileColumnsPerFolder))*this.params.tileColumnsPerFolder,d="/S"+Math.floor(a.scaleindex)+"/"+this.params.basemaplayergroupname+"/R"+d+"/C"+e+"/"+a.tilerow%this.params.tileRowsPerFolder+"_"+a.tilecol%this.params.tileColumnsPerFolder+"."+this.params.format,this.params.querystring&&(d+="?"+this.params.querystring),c+d},calculateGridLayout:function(a,b,c){var d=c*this.tileSize.w,c=c*this.tileSize.h,e=a.left-b.lon,f=Math.floor(e/d)-this.buffer,a=b.lat-a.top+c,g=Math.floor(a/c)-this.buffer;return{tilelon:d,tilelat:c,tileoffsetlon:b.lon+f*d,tileoffsetlat:b.lat-c*g,tileoffsetx:-(e/d-f)*this.tileSize.w,tileoffsety:(g-a/c)*this.tileSize.h}},CLASS_NAME:"OpenLayers.Layer.MapGuide"}),OpenLayers.Control.Measure=OpenLayers.Class(OpenLayers.Control,{handlerOptions:null,callbacks:null,displaySystem:"metric",geodesic:!1,displaySystemUnits:{geographic:["dd"],english:["mi","ft","in"],metric:["km","m"]},partialDelay:300,delayedTrigger:null,persist:!1,immediate:!1,initialize:function(a,b){OpenLayers.Control.prototype.initialize.apply(this,[b]);var c={done:this.measureComplete,point:this.measurePartial};this.immediate&&(c.modify=this.measureImmediate),this.callbacks=OpenLayers.Util.extend(c,this.callbacks),this.handlerOptions=OpenLayers.Util.extend({persist:this.persist},this.handlerOptions),this.handler=new a(this,this.callbacks,this.handlerOptions)},deactivate:function(){return this.cancelDelay(),OpenLayers.Control.prototype.deactivate.apply(this,arguments)},cancel:function(){this.cancelDelay(),this.handler.cancel()},setImmediate:function(a){(this.immediate=a)?this.callbacks.modify=this.measureImmediate:delete this.callbacks.modify},updateHandler:function(a,b){var c=this.active;c&&this.deactivate(),this.handler=new a(this,this.callbacks,b),c&&this.activate()},measureComplete:function(a){this.cancelDelay(),this.measure(a,"measure")},measurePartial:function(a,b){this.cancelDelay(),b=b.clone(),this.handler.freehandMode(this.handler.evt)?this.measure(b,"measurepartial"):this.delayedTrigger=window.setTimeout(OpenLayers.Function.bind(function(){this.delayedTrigger=null,this.measure(b,"measurepartial")},this),this.partialDelay)},measureImmediate:function(a,b,c){c&&!this.handler.freehandMode(this.handler.evt)&&(this.cancelDelay(),this.measure(b.geometry,"measurepartial"))},cancelDelay:function(){null!==this.delayedTrigger&&(window.clearTimeout(this.delayedTrigger),this.delayedTrigger=null)},measure:function(a,b){var c,d;-1<a.CLASS_NAME.indexOf("LineString")?(c=this.getBestLength(a),d=1):(c=this.getBestArea(a),d=2),this.events.triggerEvent(b,{measure:c[0],units:c[1],order:d,geometry:a})},getBestArea:function(a){for(var b,c,d=this.displaySystemUnits[this.displaySystem],e=0,f=d.length;f>e&&(b=d[e],c=this.getArea(a,b),!(c>1));++e);return[c,b]},getArea:function(a,b){var c,d;this.geodesic?(c=a.getGeodesicArea(this.map.getProjectionObject()),d="m"):(c=a.getArea(),d=this.map.getUnits());var e=OpenLayers.INCHES_PER_UNIT[b];return e&&(c*=Math.pow(OpenLayers.INCHES_PER_UNIT[d]/e,2)),c},getBestLength:function(a){for(var b,c,d=this.displaySystemUnits[this.displaySystem],e=0,f=d.length;f>e&&(b=d[e],c=this.getLength(a,b),!(c>1));++e);return[c,b]},getLength:function(a,b){var c,d;this.geodesic?(c=a.getGeodesicLength(this.map.getProjectionObject()),d="m"):(c=a.getLength(),d=this.map.getUnits());var e=OpenLayers.INCHES_PER_UNIT[b];return e&&(c*=OpenLayers.INCHES_PER_UNIT[d]/e),c},CLASS_NAME:"OpenLayers.Control.Measure"}),OpenLayers.Format.WMC.v1_0_0=OpenLayers.Class(OpenLayers.Format.WMC.v1,{VERSION:"1.0.0",schemaLocation:"http://www.opengis.net/context http://schemas.opengis.net/context/1.0.0/context.xsd",initialize:function(a){OpenLayers.Format.WMC.v1.prototype.initialize.apply(this,[a])},read_wmc_SRS:function(a,b){var c=this.getChildValue(b);"object"!=typeof a.projections&&(a.projections={});for(var c=c.split(/ +/),d=0,e=c.length;e>d;d++)a.projections[c[d]]=!0},write_wmc_Layer:function(a){var b=OpenLayers.Format.WMC.v1.prototype.write_wmc_Layer.apply(this,[a]);if(a.srs){var c,d=[];for(c in a.srs)d.push(c);b.appendChild(this.createElementDefaultNS("SRS",d.join(" ")))}b.appendChild(this.write_wmc_FormatList(a)),b.appendChild(this.write_wmc_StyleList(a)),a.dimensions&&b.appendChild(this.write_wmc_DimensionList(a)),b.appendChild(this.write_wmc_LayerExtension(a))},CLASS_NAME:"OpenLayers.Format.WMC.v1_0_0"}),OpenLayers.Popup.Framed=OpenLayers.Class(OpenLayers.Popup.Anchored,{imageSrc:null,imageSize:null,isAlphaImage:!1,positionBlocks:null,blocks:null,fixedRelativePosition:!1,initialize:function(a,b,c,d,e,f){OpenLayers.Popup.Anchored.prototype.initialize.apply(this,arguments),this.fixedRelativePosition&&(this.updateRelativePosition(),this.calculateRelativePosition=function(){return this.relativePosition}),this.contentDiv.style.position="absolute",this.contentDiv.style.zIndex=1,f&&(this.closeDiv.style.zIndex=1),this.groupDiv.style.position="absolute",this.groupDiv.style.top="0px",this.groupDiv.style.left="0px",this.groupDiv.style.height="100%",this.groupDiv.style.width="100%"},destroy:function(){this.isAlphaImage=this.imageSize=this.imageSrc=null,this.fixedRelativePosition=!1,this.positionBlocks=null;for(var a=0;a<this.blocks.length;a++){var b=this.blocks[a];b.image&&b.div.removeChild(b.image),b.image=null,b.div&&this.groupDiv.removeChild(b.div),b.div=null}this.blocks=null,OpenLayers.Popup.Anchored.prototype.destroy.apply(this,arguments)},setBackgroundColor:function(){},setBorder:function(){},setOpacity:function(){},setSize:function(){OpenLayers.Popup.Anchored.prototype.setSize.apply(this,arguments),this.updateBlocks()},updateRelativePosition:function(){if(this.padding=this.positionBlocks[this.relativePosition].padding,this.closeDiv){var a=this.getContentDivPadding();this.closeDiv.style.right=a.right+this.padding.right+"px",this.closeDiv.style.top=a.top+this.padding.top+"px"}this.updateBlocks()},calculateNewPx:function(){var a=OpenLayers.Popup.Anchored.prototype.calculateNewPx.apply(this,arguments);return a=a.offset(this.positionBlocks[this.relativePosition].offset)},createBlocks:function(){this.blocks=[];var a,b=null;for(a in this.positionBlocks){b=a;break}for(b=this.positionBlocks[b],a=0;a<b.blocks.length;a++){var c={};this.blocks.push(c),c.div=OpenLayers.Util.createDiv(this.id+"_FrameDecorationDiv_"+a,null,null,null,"absolute",null,"hidden",null),c.image=(this.isAlphaImage?OpenLayers.Util.createAlphaImageDiv:OpenLayers.Util.createImage)(this.id+"_FrameDecorationImg_"+a,null,this.imageSize,this.imageSrc,"absolute",null,null,null),c.div.appendChild(c.image),this.groupDiv.appendChild(c.div)}},updateBlocks:function(){if(this.blocks||this.createBlocks(),this.size&&this.relativePosition){for(var a=this.positionBlocks[this.relativePosition],b=0;b<a.blocks.length;b++){var c=a.blocks[b],d=this.blocks[b],e=c.anchor.left,f=c.anchor.bottom,g=c.anchor.right,h=c.anchor.top,i=isNaN(c.size.w)?this.size.w-(g+e):c.size.w,j=isNaN(c.size.h)?this.size.h-(f+h):c.size.h;d.div.style.width=(0>i?0:i)+"px",d.div.style.height=(0>j?0:j)+"px",d.div.style.left=null!=e?e+"px":"",d.div.style.bottom=null!=f?f+"px":"",d.div.style.right=null!=g?g+"px":"",d.div.style.top=null!=h?h+"px":"",d.image.style.left=c.position.x+"px",d.image.style.top=c.position.y+"px"}this.contentDiv.style.left=this.padding.left+"px",this.contentDiv.style.top=this.padding.top+"px"}},CLASS_NAME:"OpenLayers.Popup.Framed"}),OpenLayers.Popup.FramedCloud=OpenLayers.Class(OpenLayers.Popup.Framed,{contentDisplayClass:"olFramedCloudPopupContent",autoSize:!0,panMapIfOutOfView:!0,imageSize:new OpenLayers.Size(1276,736),isAlphaImage:!1,fixedRelativePosition:!1,positionBlocks:{tl:{offset:new OpenLayers.Pixel(44,0),padding:new OpenLayers.Bounds(8,40,8,9),blocks:[{size:new OpenLayers.Size("auto","auto"),anchor:new OpenLayers.Bounds(0,51,22,0),position:new OpenLayers.Pixel(0,0)},{size:new OpenLayers.Size(22,"auto"),anchor:new OpenLayers.Bounds(null,50,0,0),position:new OpenLayers.Pixel(-1238,0)},{size:new OpenLayers.Size("auto",19),anchor:new OpenLayers.Bounds(0,32,22,null),position:new OpenLayers.Pixel(0,-631)},{size:new OpenLayers.Size(22,18),anchor:new OpenLayers.Bounds(null,32,0,null),position:new OpenLayers.Pixel(-1238,-632)},{size:new OpenLayers.Size(81,35),anchor:new OpenLayers.Bounds(null,0,0,null),position:new OpenLayers.Pixel(0,-688)}]},tr:{offset:new OpenLayers.Pixel(-45,0),padding:new OpenLayers.Bounds(8,40,8,9),blocks:[{size:new OpenLayers.Size("auto","auto"),anchor:new OpenLayers.Bounds(0,51,22,0),position:new OpenLayers.Pixel(0,0)},{size:new OpenLayers.Size(22,"auto"),anchor:new OpenLayers.Bounds(null,50,0,0),position:new OpenLayers.Pixel(-1238,0)},{size:new OpenLayers.Size("auto",19),anchor:new OpenLayers.Bounds(0,32,22,null),position:new OpenLayers.Pixel(0,-631)},{size:new OpenLayers.Size(22,19),anchor:new OpenLayers.Bounds(null,32,0,null),position:new OpenLayers.Pixel(-1238,-631)},{size:new OpenLayers.Size(81,35),anchor:new OpenLayers.Bounds(0,0,null,null),position:new OpenLayers.Pixel(-215,-687)}]},bl:{offset:new OpenLayers.Pixel(45,0),padding:new OpenLayers.Bounds(8,9,8,40),blocks:[{size:new OpenLayers.Size("auto","auto"),anchor:new OpenLayers.Bounds(0,21,22,32),position:new OpenLayers.Pixel(0,0)},{size:new OpenLayers.Size(22,"auto"),anchor:new OpenLayers.Bounds(null,21,0,32),position:new OpenLayers.Pixel(-1238,0)},{size:new OpenLayers.Size("auto",21),anchor:new OpenLayers.Bounds(0,0,22,null),position:new OpenLayers.Pixel(0,-629)},{size:new OpenLayers.Size(22,21),anchor:new OpenLayers.Bounds(null,0,0,null),position:new OpenLayers.Pixel(-1238,-629)},{size:new OpenLayers.Size(81,33),anchor:new OpenLayers.Bounds(null,null,0,0),position:new OpenLayers.Pixel(-101,-674)}]},br:{offset:new OpenLayers.Pixel(-44,0),padding:new OpenLayers.Bounds(8,9,8,40),blocks:[{size:new OpenLayers.Size("auto","auto"),anchor:new OpenLayers.Bounds(0,21,22,32),position:new OpenLayers.Pixel(0,0)},{size:new OpenLayers.Size(22,"auto"),anchor:new OpenLayers.Bounds(null,21,0,32),position:new OpenLayers.Pixel(-1238,0)},{size:new OpenLayers.Size("auto",21),anchor:new OpenLayers.Bounds(0,0,22,null),position:new OpenLayers.Pixel(0,-629)},{size:new OpenLayers.Size(22,21),anchor:new OpenLayers.Bounds(null,0,0,null),position:new OpenLayers.Pixel(-1238,-629)},{size:new OpenLayers.Size(81,33),anchor:new OpenLayers.Bounds(0,null,null,0),position:new OpenLayers.Pixel(-311,-674)}]}},minSize:new OpenLayers.Size(105,10),maxSize:new OpenLayers.Size(1200,660),initialize:function(){this.imageSrc=OpenLayers.Util.getImageLocation("cloud-popup-relative.png"),OpenLayers.Popup.Framed.prototype.initialize.apply(this,arguments),this.contentDiv.className=this.contentDisplayClass},CLASS_NAME:"OpenLayers.Popup.FramedCloud"}),OpenLayers.Tile.Image.IFrame={useIFrame:null,draw:function(){if(OpenLayers.Tile.Image.prototype.shouldDraw.call(this)){var a=this.layer.getURL(this.bounds),b=this.useIFrame;this.useIFrame=null!==this.maxGetUrlLength&&!this.layer.async&&a.length>this.maxGetUrlLength,a=b&&!this.useIFrame,b=!b&&this.useIFrame,(a||b)&&(this.imgDiv&&this.imgDiv.parentNode===this.frame&&this.frame.removeChild(this.imgDiv),this.imgDiv=null,a?(this.blankImageUrl=this._blankImageUrl,this.frame.removeChild(this.frame.firstChild)):(this._blankImageUrl=this.blankImageUrl,this.blankImageUrl="about:blank"))}return OpenLayers.Tile.Image.prototype.draw.apply(this,arguments)},getImage:function(){if(!0===this.useIFrame){if(!this.frame.childNodes.length){var a=document.createElement("div"),b=a.style;b.position="absolute",b.width="100%",b.height="100%",b.zIndex=1,b.backgroundImage="url("+this._blankImageUrl+")",this.frame.appendChild(a)}return a=this.id+"_iFrame",9>parseFloat(navigator.appVersion.split("MSIE")[1])?(b=document.createElement('<iframe name="'+a+'">'),b.style.backgroundColor="#FFFFFF",b.style.filter="chroma(color=#FFFFFF)"):(b=document.createElement("iframe"),b.style.backgroundColor="transparent",b.name=a),b.scrolling="no",b.marginWidth="0px",b.marginHeight="0px",b.frameBorder="0",b.style.position="absolute",b.style.width="100%",b.style.height="100%",1>this.layer.opacity&&OpenLayers.Util.modifyDOMElement(b,null,null,null,null,null,null,this.layer.opacity),this.frame.appendChild(b),this.imgDiv=b}return OpenLayers.Tile.Image.prototype.getImage.apply(this,arguments)},createRequestForm:function(){var a=document.createElement("form");a.method="POST";var b=this.layer.params._OLSALT,b=(b?b+"_":"")+this.bounds.toBBOX();a.action=OpenLayers.Util.urlAppend(this.layer.url,b),a.target=this.id+"_iFrame",this.layer.getImageSize();var c,d,b=OpenLayers.Util.getParameters(this.url);for(d in b)c=document.createElement("input"),c.type="hidden",c.name=d,c.value=b[d],a.appendChild(c);return a},setImgSrc:function(a){if(!0===this.useIFrame)if(a){var b=this.createRequestForm();this.frame.appendChild(b),b.submit(),this.frame.removeChild(b)}else this.imgDiv.parentNode===this.frame&&(this.frame.removeChild(this.imgDiv),this.imgDiv=null);else OpenLayers.Tile.Image.prototype.setImgSrc.apply(this,arguments)},onImageLoad:function(){OpenLayers.Tile.Image.prototype.onImageLoad.apply(this,arguments),!0===this.useIFrame&&(this.imgDiv.style.opacity=1,this.frame.style.opacity=this.layer.opacity)},createBackBuffer:function(){var a;return!1===this.useIFrame&&(a=OpenLayers.Tile.Image.prototype.createBackBuffer.call(this)),a}},OpenLayers.Format.SOSCapabilities=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.0.0",CLASS_NAME:"OpenLayers.Format.SOSCapabilities"}),OpenLayers.Format.SOSCapabilities.v1_0_0=OpenLayers.Class(OpenLayers.Format.SOSCapabilities,{namespaces:{ows:"http://www.opengis.net/ows/1.1",sos:"http://www.opengis.net/sos/1.0",gml:"http://www.opengis.net/gml",xlink:"http://www.w3.org/1999/xlink"},regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},initialize:function(a){OpenLayers.Format.XML.prototype.initialize.apply(this,[a]),this.options=a},read:function(a){"string"==typeof a&&(a=OpenLayers.Format.XML.prototype.read.apply(this,[a])),a&&9==a.nodeType&&(a=a.documentElement);var b={};return this.readNode(a,b),b},readers:{gml:OpenLayers.Util.applyDefaults({name:function(a,b){b.name=this.getChildValue(a)},TimePeriod:function(a,b){b.timePeriod={},this.readChildNodes(a,b.timePeriod)},beginPosition:function(a,b){b.beginPosition=this.getChildValue(a)},endPosition:function(a,b){b.endPosition=this.getChildValue(a)}},OpenLayers.Format.GML.v3.prototype.readers.gml),sos:{Capabilities:function(a,b){this.readChildNodes(a,b)},Contents:function(a,b){b.contents={},this.readChildNodes(a,b.contents)},ObservationOfferingList:function(a,b){b.offeringList={},this.readChildNodes(a,b.offeringList)},ObservationOffering:function(a,b){var c=this.getAttributeNS(a,this.namespaces.gml,"id");b[c]={procedures:[],observedProperties:[],featureOfInterestIds:[],responseFormats:[],resultModels:[],responseModes:[]},this.readChildNodes(a,b[c])},time:function(a,b){b.time={},this.readChildNodes(a,b.time)},procedure:function(a,b){b.procedures.push(this.getAttributeNS(a,this.namespaces.xlink,"href"))},observedProperty:function(a,b){b.observedProperties.push(this.getAttributeNS(a,this.namespaces.xlink,"href"))},featureOfInterest:function(a,b){b.featureOfInterestIds.push(this.getAttributeNS(a,this.namespaces.xlink,"href"))},responseFormat:function(a,b){b.responseFormats.push(this.getChildValue(a))},resultModel:function(a,b){b.resultModels.push(this.getChildValue(a))},responseMode:function(a,b){b.responseModes.push(this.getChildValue(a))}},ows:OpenLayers.Format.OWSCommon.v1_1_0.prototype.readers.ows},CLASS_NAME:"OpenLayers.Format.SOSCapabilities.v1_0_0"}),OpenLayers.Handler.Pinch=OpenLayers.Class(OpenLayers.Handler,{started:!1,stopDown:!1,pinching:!1,last:null,start:null,touchstart:function(a){var b=!0;return this.pinching=!1,OpenLayers.Event.isMultiTouch(a)?(this.started=!0,this.last=this.start={distance:this.getDistance(a.touches),delta:0,scale:1},this.callback("start",[a,this.start]),b=!this.stopDown):(this.started=!1,this.last=this.start=null),OpenLayers.Event.stop(a),b},touchmove:function(a){if(this.started&&OpenLayers.Event.isMultiTouch(a)){this.pinching=!0;var b=this.getPinchData(a);this.callback("move",[a,b]),this.last=b,OpenLayers.Event.stop(a)}return!0},touchend:function(a){return this.started&&(this.pinching=this.started=!1,this.callback("done",[a,this.start,this.last]),this.last=this.start=null),!0},activate:function(){var a=!1;return OpenLayers.Handler.prototype.activate.apply(this,arguments)&&(this.pinching=!1,a=!0),a},deactivate:function(){var a=!1;return OpenLayers.Handler.prototype.deactivate.apply(this,arguments)&&(this.pinching=this.started=!1,this.last=this.start=null,a=!0),a},getDistance:function(a){var b=a[0],a=a[1];return Math.sqrt(Math.pow(b.clientX-a.clientX,2)+Math.pow(b.clientY-a.clientY,2))},getPinchData:function(a){return a=this.getDistance(a.touches),{distance:a,delta:this.last.distance-a,scale:a/this.start.distance}},CLASS_NAME:"OpenLayers.Handler.Pinch"}),OpenLayers.Control.NavToolbar=OpenLayers.Class(OpenLayers.Control.Panel,{initialize:function(a){OpenLayers.Control.Panel.prototype.initialize.apply(this,[a]),this.addControls([new OpenLayers.Control.Navigation,new OpenLayers.Control.ZoomBox])},draw:function(){var a=OpenLayers.Control.Panel.prototype.draw.apply(this,arguments);return null===this.defaultControl&&(this.defaultControl=this.controls[0]),a},CLASS_NAME:"OpenLayers.Control.NavToolbar"}),OpenLayers.Strategy.Refresh=OpenLayers.Class(OpenLayers.Strategy,{force:!1,interval:0,timer:null,activate:function(){var a=OpenLayers.Strategy.prototype.activate.call(this);return a&&(!0===this.layer.visibility&&this.start(),this.layer.events.on({visibilitychanged:this.reset,scope:this})),a},deactivate:function(){var a=OpenLayers.Strategy.prototype.deactivate.call(this);return a&&this.stop(),a},reset:function(){!0===this.layer.visibility?this.start():this.stop()},start:function(){this.interval&&"number"==typeof this.interval&&0<this.interval&&(this.timer=window.setInterval(OpenLayers.Function.bind(this.refresh,this),this.interval))},refresh:function(){this.layer&&this.layer.refresh&&"function"==typeof this.layer.refresh&&this.layer.refresh({force:this.force})},stop:function(){null!==this.timer&&(window.clearInterval(this.timer),this.timer=null)},CLASS_NAME:"OpenLayers.Strategy.Refresh"}),OpenLayers.Layer.ArcGIS93Rest=OpenLayers.Class(OpenLayers.Layer.Grid,{DEFAULT_PARAMS:{format:"png"},isBaseLayer:!0,initialize:function(a,b,c,d){var e=[],c=OpenLayers.Util.upperCaseObject(c);e.push(a,b,c,d),OpenLayers.Layer.Grid.prototype.initialize.apply(this,e),OpenLayers.Util.applyDefaults(this.params,OpenLayers.Util.upperCaseObject(this.DEFAULT_PARAMS)),this.params.TRANSPARENT&&"true"==this.params.TRANSPARENT.toString().toLowerCase()&&(null!=d&&d.isBaseLayer||(this.isBaseLayer=!1),"jpg"==this.params.FORMAT&&(this.params.FORMAT=OpenLayers.Util.alphaHack()?"gif":"png"))},clone:function(a){return null==a&&(a=new OpenLayers.Layer.ArcGIS93Rest(this.name,this.url,this.params,this.getOptions())),a=OpenLayers.Layer.Grid.prototype.clone.apply(this,[a])},getURL:function(a){var a=this.adjustBounds(a),b=this.projection.getCode().split(":"),b=b[b.length-1],c=this.getImageSize(),a={BBOX:a.toBBOX(),SIZE:c.w+","+c.h,F:"image",BBOXSR:b,IMAGESR:b};if(this.layerDefs){var d,b=[];for(d in this.layerDefs)this.layerDefs.hasOwnProperty(d)&&this.layerDefs[d]&&(b.push(d),b.push(":"),b.push(this.layerDefs[d]),b.push(";"));0<b.length&&(a.LAYERDEFS=b.join(""))}return this.getFullRequestString(a)},setLayerFilter:function(a,b){this.layerDefs||(this.layerDefs={}),b?this.layerDefs[a]=b:delete this.layerDefs[a]},clearLayerFilter:function(a){a?delete this.layerDefs[a]:delete this.layerDefs},mergeNewParams:function(a){return a=[OpenLayers.Util.upperCaseObject(a)],OpenLayers.Layer.Grid.prototype.mergeNewParams.apply(this,a)},CLASS_NAME:"OpenLayers.Layer.ArcGIS93Rest"}),OpenLayers.Format.WKT=OpenLayers.Class(OpenLayers.Format,{initialize:function(a){this.regExes={typeStr:/^\s*(\w+)\s*\(\s*(.*)\s*\)\s*$/,spaces:/\s+/,parenComma:/\)\s*,\s*\(/,doubleParenComma:/\)\s*\)\s*,\s*\(\s*\(/,trimParens:/^\s*\(?(.*?)\)?\s*$/},OpenLayers.Format.prototype.initialize.apply(this,[a])},read:function(a){var b,c,a=a.replace(/[\n\r]/g," ");if((c=this.regExes.typeStr.exec(a))&&(a=c[1].toLowerCase(),c=c[2],this.parse[a]&&(b=this.parse[a].apply(this,[c])),this.internalProjection&&this.externalProjection))if(b&&"OpenLayers.Feature.Vector"==b.CLASS_NAME)b.geometry.transform(this.externalProjection,this.internalProjection);else if(b&&"geometrycollection"!=a&&"object"==typeof b)for(a=0,c=b.length;c>a;a++)b[a].geometry.transform(this.externalProjection,this.internalProjection);return b},write:function(a){var b,c;a.constructor==Array?c=!0:(a=[a],c=!1);var d=[];c&&d.push("GEOMETRYCOLLECTION(");for(var e=0,f=a.length;f>e;++e)c&&e>0&&d.push(","),b=a[e].geometry,d.push(this.extractGeometry(b));return c&&d.push(")"),d.join("")},extractGeometry:function(a){var b=a.CLASS_NAME.split(".")[2].toLowerCase();return this.extract[b]?(this.internalProjection&&this.externalProjection&&(a=a.clone(),a.transform(this.internalProjection,this.externalProjection)),("collection"==b?"GEOMETRYCOLLECTION":b.toUpperCase())+"("+this.extract[b].apply(this,[a])+")"):null},extract:{point:function(a){return a.x+" "+a.y},multipoint:function(a){for(var b=[],c=0,d=a.components.length;d>c;++c)b.push("("+this.extract.point.apply(this,[a.components[c]])+")");return b.join(",")},linestring:function(a){for(var b=[],c=0,d=a.components.length;d>c;++c)b.push(this.extract.point.apply(this,[a.components[c]]));return b.join(",")},multilinestring:function(a){for(var b=[],c=0,d=a.components.length;d>c;++c)b.push("("+this.extract.linestring.apply(this,[a.components[c]])+")");return b.join(",")},polygon:function(a){for(var b=[],c=0,d=a.components.length;d>c;++c)b.push("("+this.extract.linestring.apply(this,[a.components[c]])+")");return b.join(",")},multipolygon:function(a){for(var b=[],c=0,d=a.components.length;d>c;++c)b.push("("+this.extract.polygon.apply(this,[a.components[c]])+")");return b.join(",")},collection:function(a){for(var b=[],c=0,d=a.components.length;d>c;++c)b.push(this.extractGeometry.apply(this,[a.components[c]]));return b.join(",")}},parse:{point:function(a){return a=OpenLayers.String.trim(a).split(this.regExes.spaces),new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(a[0],a[1]))},multipoint:function(a){for(var b=OpenLayers.String.trim(a).split(","),c=[],d=0,e=b.length;e>d;++d)a=b[d].replace(this.regExes.trimParens,"$1"),c.push(this.parse.point.apply(this,[a]).geometry);return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.MultiPoint(c))},linestring:function(a){for(var a=OpenLayers.String.trim(a).split(","),b=[],c=0,d=a.length;d>c;++c)b.push(this.parse.point.apply(this,[a[c]]).geometry);return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.LineString(b))},multilinestring:function(a){for(var b=OpenLayers.String.trim(a).split(this.regExes.parenComma),c=[],d=0,e=b.length;e>d;++d)a=b[d].replace(this.regExes.trimParens,"$1"),c.push(this.parse.linestring.apply(this,[a]).geometry);return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.MultiLineString(c))},polygon:function(a){for(var b,a=OpenLayers.String.trim(a).split(this.regExes.parenComma),c=[],d=0,e=a.length;e>d;++d)b=a[d].replace(this.regExes.trimParens,"$1"),b=this.parse.linestring.apply(this,[b]).geometry,b=new OpenLayers.Geometry.LinearRing(b.components),c.push(b);return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Polygon(c))},multipolygon:function(a){for(var b=OpenLayers.String.trim(a).split(this.regExes.doubleParenComma),c=[],d=0,e=b.length;e>d;++d)a=b[d].replace(this.regExes.trimParens,"$1"),c.push(this.parse.polygon.apply(this,[a]).geometry);return new OpenLayers.Feature.Vector(new OpenLayers.Geometry.MultiPolygon(c))},geometrycollection:function(a){for(var a=a.replace(/,\s*([A-Za-z])/g,"|$1"),a=OpenLayers.String.trim(a).split("|"),b=[],c=0,d=a.length;d>c;++c)b.push(OpenLayers.Format.WKT.prototype.read.apply(this,[a[c]]));return b}},CLASS_NAME:"OpenLayers.Format.WKT"}),OpenLayers.Handler.Hover=OpenLayers.Class(OpenLayers.Handler,{delay:500,pixelTolerance:null,stopMove:!1,px:null,timerId:null,mousemove:function(a){return this.passesTolerance(a.xy)&&(this.clearTimer(),this.callback("move",[a]),this.px=a.xy,a=OpenLayers.Util.extend({},a),this.timerId=window.setTimeout(OpenLayers.Function.bind(this.delayedCall,this,a),this.delay)),!this.stopMove},mouseout:function(a){return OpenLayers.Util.mouseLeft(a,this.map.viewPortDiv)&&(this.clearTimer(),this.callback("move",[a])),!0},passesTolerance:function(a){var b=!0;return this.pixelTolerance&&this.px&&Math.sqrt(Math.pow(this.px.x-a.x,2)+Math.pow(this.px.y-a.y,2))<this.pixelTolerance&&(b=!1),b},clearTimer:function(){null!=this.timerId&&(window.clearTimeout(this.timerId),this.timerId=null)},delayedCall:function(a){this.callback("pause",[a])},deactivate:function(){var a=!1;return OpenLayers.Handler.prototype.deactivate.apply(this,arguments)&&(this.clearTimer(),a=!0),a},CLASS_NAME:"OpenLayers.Handler.Hover"}),OpenLayers.Control.GetFeature=OpenLayers.Class(OpenLayers.Control,{protocol:null,multipleKey:null,toggleKey:null,modifiers:null,multiple:!1,click:!0,single:!0,clickout:!0,toggle:!1,clickTolerance:5,hover:!1,box:!1,maxFeatures:10,features:null,hoverFeature:null,handlerOptions:null,handlers:null,hoverResponse:null,filterType:OpenLayers.Filter.Spatial.BBOX,initialize:function(a){a.handlerOptions=a.handlerOptions||{},OpenLayers.Control.prototype.initialize.apply(this,[a]),this.features={},this.handlers={},this.click&&(this.handlers.click=new OpenLayers.Handler.Click(this,{click:this.selectClick},this.handlerOptions.click||{})),this.box&&(this.handlers.box=new OpenLayers.Handler.Box(this,{done:this.selectBox},OpenLayers.Util.extend(this.handlerOptions.box,{boxDivClassName:"olHandlerBoxSelectFeature"}))),this.hover&&(this.handlers.hover=new OpenLayers.Handler.Hover(this,{move:this.cancelHover,pause:this.selectHover},OpenLayers.Util.extend(this.handlerOptions.hover,{delay:250,pixelTolerance:2})))},activate:function(){if(!this.active)for(var a in this.handlers)this.handlers[a].activate();return OpenLayers.Control.prototype.activate.apply(this,arguments)},deactivate:function(){if(this.active)for(var a in this.handlers)this.handlers[a].deactivate();return OpenLayers.Control.prototype.deactivate.apply(this,arguments)},selectClick:function(a){var b=this.pixelToBounds(a.xy);this.setModifiers(a),this.request(b,{single:this.single})},selectBox:function(a){var b;if(a instanceof OpenLayers.Bounds)b=this.map.getLonLatFromPixel({x:a.left,y:a.bottom}),a=this.map.getLonLatFromPixel({x:a.right,y:a.top}),b=new OpenLayers.Bounds(b.lon,b.lat,a.lon,a.lat);else{if(this.click)return;b=this.pixelToBounds(a)}this.setModifiers(this.handlers.box.dragHandler.evt),this.request(b)},selectHover:function(a){this.request(this.pixelToBounds(a.xy),{single:!0,hover:!0})},cancelHover:function(){this.hoverResponse&&(this.protocol.abort(this.hoverResponse),this.hoverResponse=null,OpenLayers.Element.removeClass(this.map.viewPortDiv,"olCursorWait"))},request:function(a,b){var b=b||{},c=new OpenLayers.Filter.Spatial({type:this.filterType,value:a});OpenLayers.Element.addClass(this.map.viewPortDiv,"olCursorWait"),c=this.protocol.read({maxFeatures:1==b.single?this.maxFeatures:void 0,filter:c,callback:function(c){c.success()&&(c.features.length?1==b.single?this.selectBestFeature(c.features,a.getCenterLonLat(),b):this.select(c.features):b.hover?this.hoverSelect():(this.events.triggerEvent("clickout"),this.clickout&&this.unselectAll())),OpenLayers.Element.removeClass(this.map.viewPortDiv,"olCursorWait")
},scope:this}),1==b.hover&&(this.hoverResponse=c)},selectBestFeature:function(a,b,c){if(c=c||{},a.length){for(var d,e,f,b=new OpenLayers.Geometry.Point(b.lon,b.lat),g=Number.MAX_VALUE,h=0;h<a.length&&(d=a[h],!(d.geometry&&(f=b.distanceTo(d.geometry,{edge:!1}),g>f&&(g=f,e=d,0==g))));++h);1==c.hover?this.hoverSelect(e):this.select(e||a)}},setModifiers:function(a){this.modifiers={multiple:this.multiple||this.multipleKey&&a[this.multipleKey],toggle:this.toggle||this.toggleKey&&a[this.toggleKey]}},select:function(a){!this.modifiers.multiple&&!this.modifiers.toggle&&this.unselectAll(),OpenLayers.Util.isArray(a)||(a=[a]);var b=this.events.triggerEvent("beforefeaturesselected",{features:a});if(!1!==b){for(var c,d=[],e=0,f=a.length;f>e;++e)c=a[e],this.features[c.fid||c.id]?this.modifiers.toggle&&this.unselect(this.features[c.fid||c.id]):(b=this.events.triggerEvent("beforefeatureselected",{feature:c}),!1!==b&&(this.features[c.fid||c.id]=c,d.push(c),this.events.triggerEvent("featureselected",{feature:c})));this.events.triggerEvent("featuresselected",{features:d})}},hoverSelect:function(a){var b=a?a.fid||a.id:null,c=this.hoverFeature?this.hoverFeature.fid||this.hoverFeature.id:null;c&&c!=b&&(this.events.triggerEvent("outfeature",{feature:this.hoverFeature}),this.hoverFeature=null),b&&b!=c&&(this.events.triggerEvent("hoverfeature",{feature:a}),this.hoverFeature=a)},unselect:function(a){delete this.features[a.fid||a.id],this.events.triggerEvent("featureunselected",{feature:a})},unselectAll:function(){for(var a in this.features)this.unselect(this.features[a])},setMap:function(a){for(var b in this.handlers)this.handlers[b].setMap(a);OpenLayers.Control.prototype.setMap.apply(this,arguments)},pixelToBounds:function(a){var b=a.add(-this.clickTolerance/2,this.clickTolerance/2),a=a.add(this.clickTolerance/2,-this.clickTolerance/2),b=this.map.getLonLatFromPixel(b),a=this.map.getLonLatFromPixel(a);return new OpenLayers.Bounds(b.lon,b.lat,a.lon,a.lat)},CLASS_NAME:"OpenLayers.Control.GetFeature"}),OpenLayers.Format.QueryStringFilter=function(){function a(a){return a=a.replace(/%/g,"\\%"),a=a.replace(/\\\\\.(\*)?/g,function(a,b){return b?a:"\\\\_"}),a=a.replace(/\\\\\.\*/g,"\\\\%"),a=a.replace(/(\\)?\.(\*)?/g,function(a,b,c){return b||c?a:"_"}),a=a.replace(/(\\)?\.\*/g,function(a,b){return b?a:"%"}),a=a.replace(/\\\./g,"."),a=a.replace(/(\\)?\\\*/g,function(a,b){return b?a:"*"})}var b={};return b[OpenLayers.Filter.Comparison.EQUAL_TO]="eq",b[OpenLayers.Filter.Comparison.NOT_EQUAL_TO]="ne",b[OpenLayers.Filter.Comparison.LESS_THAN]="lt",b[OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO]="lte",b[OpenLayers.Filter.Comparison.GREATER_THAN]="gt",b[OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO]="gte",b[OpenLayers.Filter.Comparison.LIKE]="ilike",OpenLayers.Class(OpenLayers.Format,{wildcarded:!1,srsInBBOX:!1,write:function(c,d){var d=d||{},e=c.CLASS_NAME,e=e.substring(e.lastIndexOf(".")+1);switch(e){case"Spatial":switch(c.type){case OpenLayers.Filter.Spatial.BBOX:d.bbox=c.value.toArray(),this.srsInBBOX&&c.projection&&d.bbox.push(c.projection.getCode());break;case OpenLayers.Filter.Spatial.DWITHIN:d.tolerance=c.distance;case OpenLayers.Filter.Spatial.WITHIN:d.lon=c.value.x,d.lat=c.value.y;break;default:OpenLayers.Console.warn("Unknown spatial filter type "+c.type)}break;case"Comparison":if(e=b[c.type],void 0!==e){var f=c.value;c.type==OpenLayers.Filter.Comparison.LIKE&&(f=a(f),this.wildcarded&&(f="%"+f+"%")),d[c.property+"__"+e]=f,d.queryable=d.queryable||[],d.queryable.push(c.property)}else OpenLayers.Console.warn("Unknown comparison filter type "+c.type);break;case"Logical":if(c.type===OpenLayers.Filter.Logical.AND)for(e=0,f=c.filters.length;f>e;e++)d=this.write(c.filters[e],d);else OpenLayers.Console.warn("Unsupported logical filter type "+c.type);break;default:OpenLayers.Console.warn("Unknown filter type "+e)}return d},CLASS_NAME:"OpenLayers.Format.QueryStringFilter"})}(),OpenLayers.Control.MousePosition=OpenLayers.Class(OpenLayers.Control,{autoActivate:!0,element:null,prefix:"",separator:", ",suffix:"",numDigits:5,granularity:10,emptyString:null,lastXy:null,displayProjection:null,destroy:function(){this.deactivate(),OpenLayers.Control.prototype.destroy.apply(this,arguments)},activate:function(){return OpenLayers.Control.prototype.activate.apply(this,arguments)?(this.map.events.register("mousemove",this,this.redraw),this.map.events.register("mouseout",this,this.reset),this.redraw(),!0):!1},deactivate:function(){return OpenLayers.Control.prototype.deactivate.apply(this,arguments)?(this.map.events.unregister("mousemove",this,this.redraw),this.map.events.unregister("mouseout",this,this.reset),this.element.innerHTML="",!0):!1},draw:function(){return OpenLayers.Control.prototype.draw.apply(this,arguments),this.element||(this.div.left="",this.div.top="",this.element=this.div),this.div},redraw:function(a){var b;null==a?this.reset():null==this.lastXy||Math.abs(a.xy.x-this.lastXy.x)>this.granularity||Math.abs(a.xy.y-this.lastXy.y)>this.granularity?this.lastXy=a.xy:(b=this.map.getLonLatFromPixel(a.xy))&&(this.displayProjection&&b.transform(this.map.getProjectionObject(),this.displayProjection),this.lastXy=a.xy,a=this.formatOutput(b),a!=this.element.innerHTML&&(this.element.innerHTML=a))},reset:function(){null!=this.emptyString&&(this.element.innerHTML=this.emptyString)},formatOutput:function(a){var b=parseInt(this.numDigits);return this.prefix+a.lon.toFixed(b)+this.separator+a.lat.toFixed(b)+this.suffix},CLASS_NAME:"OpenLayers.Control.MousePosition"}),OpenLayers.Control.Geolocate=OpenLayers.Class(OpenLayers.Control,{geolocation:navigator.geolocation,bind:!0,watch:!1,geolocationOptions:null,destroy:function(){this.deactivate(),OpenLayers.Control.prototype.destroy.apply(this,arguments)},activate:function(){return this.geolocation?OpenLayers.Control.prototype.activate.apply(this,arguments)?(this.watch?this.watchId=this.geolocation.watchPosition(OpenLayers.Function.bind(this.geolocate,this),OpenLayers.Function.bind(this.failure,this),this.geolocationOptions):this.getCurrentLocation(),!0):!1:(this.events.triggerEvent("locationuncapable"),!1)},deactivate:function(){return this.active&&null!==this.watchId&&this.geolocation.clearWatch(this.watchId),OpenLayers.Control.prototype.deactivate.apply(this,arguments)},geolocate:function(a){var b=new OpenLayers.LonLat(a.coords.longitude,a.coords.latitude).transform(new OpenLayers.Projection("EPSG:4326"),this.map.getProjectionObject());this.bind&&this.map.setCenter(b),this.events.triggerEvent("locationupdated",{position:a,point:new OpenLayers.Geometry.Point(b.lon,b.lat)})},getCurrentLocation:function(){return!this.active||this.watch?!1:(this.geolocation.getCurrentPosition(OpenLayers.Function.bind(this.geolocate,this),OpenLayers.Function.bind(this.failure,this),this.geolocationOptions),!0)},failure:function(a){this.events.triggerEvent("locationfailed",{error:a})},CLASS_NAME:"OpenLayers.Control.Geolocate"}),OpenLayers.Tile.UTFGrid=OpenLayers.Class(OpenLayers.Tile,{url:null,utfgridResolution:2,json:null,format:null,destroy:function(){this.clear(),OpenLayers.Tile.prototype.destroy.apply(this,arguments)},draw:function(){var a=OpenLayers.Tile.prototype.draw.apply(this,arguments);if(a)if(this.isLoading?(this.abortLoading(),this.events.triggerEvent("reload")):(this.isLoading=!0,this.events.triggerEvent("loadstart")),this.url=this.layer.getURL(this.bounds),this.layer.useJSONP){var b=new OpenLayers.Protocol.Script({url:this.url,callback:function(a){this.isLoading=!1,this.events.triggerEvent("loadend"),this.json=a.data},scope:this});b.read(),this.request=b}else this.request=OpenLayers.Request.GET({url:this.url,callback:function(a){this.isLoading=!1,this.events.triggerEvent("loadend"),200===a.status&&this.parseData(a.responseText)},scope:this});else this.unload();return a},abortLoading:function(){this.request&&(this.request.abort(),delete this.request),this.isLoading=!1},getFeatureInfo:function(a,b){var c=null;if(this.json){var d=this.getFeatureId(a,b);null!==d&&(c={id:d,data:this.json.data[d]})}return c},getFeatureId:function(a,b){var c=null;if(this.json){var d=this.utfgridResolution,d=this.indexFromCharCode(this.json.grid[Math.floor(b/d)].charCodeAt(Math.floor(a/d))),e=this.json.keys;!isNaN(d)&&d in e&&(c=e[d])}return c},indexFromCharCode:function(a){return a>=93&&a--,a>=35&&a--,a-32},parseData:function(a){this.format||(this.format=new OpenLayers.Format.JSON),this.json=this.format.read(a)},clear:function(){this.json=null},CLASS_NAME:"OpenLayers.Tile.UTFGrid"}),OpenLayers.Control.NavigationHistory=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_TOGGLE,previous:null,previousOptions:null,next:null,nextOptions:null,limit:50,autoActivate:!0,clearOnDeactivate:!1,registry:null,nextStack:null,previousStack:null,listeners:null,restoring:!1,initialize:function(a){OpenLayers.Control.prototype.initialize.apply(this,[a]),this.registry=OpenLayers.Util.extend({moveend:this.getState},this.registry),a={trigger:OpenLayers.Function.bind(this.previousTrigger,this),displayClass:this.displayClass+" "+this.displayClass+"Previous"},OpenLayers.Util.extend(a,this.previousOptions),this.previous=new OpenLayers.Control.Button(a),a={trigger:OpenLayers.Function.bind(this.nextTrigger,this),displayClass:this.displayClass+" "+this.displayClass+"Next"},OpenLayers.Util.extend(a,this.nextOptions),this.next=new OpenLayers.Control.Button(a),this.clear()},onPreviousChange:function(a){a&&!this.previous.active?this.previous.activate():!a&&this.previous.active&&this.previous.deactivate()},onNextChange:function(a){a&&!this.next.active?this.next.activate():!a&&this.next.active&&this.next.deactivate()},destroy:function(){OpenLayers.Control.prototype.destroy.apply(this),this.previous.destroy(),this.next.destroy(),this.deactivate();for(var a in this)this[a]=null},setMap:function(a){this.map=a,this.next.setMap(a),this.previous.setMap(a)},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments),this.next.draw(),this.previous.draw()},previousTrigger:function(){var a=this.previousStack.shift(),b=this.previousStack.shift();return void 0!=b?(this.nextStack.unshift(a),this.previousStack.unshift(b),this.restoring=!0,this.restore(b),this.restoring=!1,this.onNextChange(this.nextStack[0],this.nextStack.length),this.onPreviousChange(this.previousStack[1],this.previousStack.length-1)):this.previousStack.unshift(a),b},nextTrigger:function(){var a=this.nextStack.shift();return void 0!=a&&(this.previousStack.unshift(a),this.restoring=!0,this.restore(a),this.restoring=!1,this.onNextChange(this.nextStack[0],this.nextStack.length),this.onPreviousChange(this.previousStack[1],this.previousStack.length-1)),a},clear:function(){this.previousStack=[],this.previous.deactivate(),this.nextStack=[],this.next.deactivate()},getState:function(){return{center:this.map.getCenter(),resolution:this.map.getResolution(),projection:this.map.getProjectionObject(),units:this.map.getProjectionObject().getUnits()||this.map.units||this.map.baseLayer.units}},restore:function(a){var b,c;if(this.map.getProjectionObject()==a.projection)c=this.map.getZoomForResolution(a.resolution),b=a.center;else{b=a.center.clone(),b.transform(a.projection,this.map.getProjectionObject()),c=a.units;var d=this.map.getProjectionObject().getUnits()||this.map.units||this.map.baseLayer.units;c=this.map.getZoomForResolution((c&&d?OpenLayers.INCHES_PER_UNIT[c]/OpenLayers.INCHES_PER_UNIT[d]:1)*a.resolution)}this.map.setCenter(b,c)},setListeners:function(){this.listeners={};for(var a in this.registry)this.listeners[a]=OpenLayers.Function.bind(function(){return this.restoring||(this.previousStack.unshift(this.registry[a].apply(this,arguments)),1<this.previousStack.length&&this.onPreviousChange(this.previousStack[1],this.previousStack.length-1),this.previousStack.length>this.limit+1&&this.previousStack.pop(),0<this.nextStack.length&&(this.nextStack=[],this.onNextChange(null,0))),!0},this)},activate:function(){var a=!1;if(this.map&&OpenLayers.Control.prototype.activate.apply(this)){null==this.listeners&&this.setListeners();for(var b in this.listeners)this.map.events.register(b,this,this.listeners[b]);a=!0,0==this.previousStack.length&&this.initStack()}return a},initStack:function(){this.map.getCenter()&&this.listeners.moveend()},deactivate:function(){var a=!1;if(this.map&&OpenLayers.Control.prototype.deactivate.apply(this)){for(var b in this.listeners)this.map.events.unregister(b,this,this.listeners[b]);this.clearOnDeactivate&&this.clear(),a=!0}return a},CLASS_NAME:"OpenLayers.Control.NavigationHistory"}),OpenLayers.Protocol.HTTP=OpenLayers.Class(OpenLayers.Protocol,{url:null,headers:null,params:null,callback:null,scope:null,readWithPOST:!1,updateWithPOST:!1,deleteWithPOST:!1,wildcarded:!1,srsInBBOX:!1,initialize:function(a){if(a=a||{},this.params={},this.headers={},OpenLayers.Protocol.prototype.initialize.apply(this,arguments),!this.filterToParams&&OpenLayers.Format.QueryStringFilter){var b=new OpenLayers.Format.QueryStringFilter({wildcarded:this.wildcarded,srsInBBOX:this.srsInBBOX});this.filterToParams=function(a,c){return b.write(a,c)}}},destroy:function(){this.headers=this.params=null,OpenLayers.Protocol.prototype.destroy.apply(this)},read:function(a){OpenLayers.Protocol.prototype.read.apply(this,arguments),a=a||{},a.params=OpenLayers.Util.applyDefaults(a.params,this.options.params),a=OpenLayers.Util.applyDefaults(a,this.options),a.filter&&this.filterToParams&&(a.params=this.filterToParams(a.filter,a.params));var b=void 0!==a.readWithPOST?a.readWithPOST:this.readWithPOST,c=new OpenLayers.Protocol.Response({requestType:"read"});return b?(b=a.headers||{},b["Content-Type"]="application/x-www-form-urlencoded",c.priv=OpenLayers.Request.POST({url:a.url,callback:this.createCallback(this.handleRead,c,a),data:OpenLayers.Util.getParameterString(a.params),headers:b})):c.priv=OpenLayers.Request.GET({url:a.url,callback:this.createCallback(this.handleRead,c,a),params:a.params,headers:a.headers}),c},handleRead:function(a,b){this.handleResponse(a,b)},create:function(a,b){var b=OpenLayers.Util.applyDefaults(b,this.options),c=new OpenLayers.Protocol.Response({reqFeatures:a,requestType:"create"});return c.priv=OpenLayers.Request.POST({url:b.url,callback:this.createCallback(this.handleCreate,c,b),headers:b.headers,data:this.format.write(a)}),c},handleCreate:function(a,b){this.handleResponse(a,b)},update:function(a,b){var b=b||{},c=b.url||a.url||this.options.url+"/"+a.fid,b=OpenLayers.Util.applyDefaults(b,this.options),d=new OpenLayers.Protocol.Response({reqFeatures:a,requestType:"update"});return d.priv=OpenLayers.Request[this.updateWithPOST?"POST":"PUT"]({url:c,callback:this.createCallback(this.handleUpdate,d,b),headers:b.headers,data:this.format.write(a)}),d},handleUpdate:function(a,b){this.handleResponse(a,b)},"delete":function(a,b){var b=b||{},c=b.url||a.url||this.options.url+"/"+a.fid,b=OpenLayers.Util.applyDefaults(b,this.options),d=new OpenLayers.Protocol.Response({reqFeatures:a,requestType:"delete"}),e=this.deleteWithPOST?"POST":"DELETE",c={url:c,callback:this.createCallback(this.handleDelete,d,b),headers:b.headers};return this.deleteWithPOST&&(c.data=this.format.write(a)),d.priv=OpenLayers.Request[e](c),d},handleDelete:function(a,b){this.handleResponse(a,b)},handleResponse:function(a,b){var c=a.priv;b.callback&&(200<=c.status&&300>c.status?("delete"!=a.requestType&&(a.features=this.parseFeatures(c)),a.code=OpenLayers.Protocol.Response.SUCCESS):a.code=OpenLayers.Protocol.Response.FAILURE,b.callback.call(b.scope,a))},parseFeatures:function(a){var b=a.responseXML;return b&&b.documentElement||(b=a.responseText),!b||0>=b.length?null:this.format.read(b)},commit:function(a,b){function c(a){for(var b=a.features?a.features.length:0,c=Array(b),e=0;b>e;++e)c[e]=a.features[e].fid;o.insertIds=c,d.apply(this,[a])}function d(a){this.callUserCallback(a,b),n=n&&a.success(),f++,f>=m&&b.callback&&(o.code=n?OpenLayers.Protocol.Response.SUCCESS:OpenLayers.Protocol.Response.FAILURE,b.callback.apply(b.scope,[o]))}var b=OpenLayers.Util.applyDefaults(b,this.options),e=[],f=0,g={};g[OpenLayers.State.INSERT]=[],g[OpenLayers.State.UPDATE]=[],g[OpenLayers.State.DELETE]=[];for(var h,i,j=[],k=0,l=a.length;l>k;++k)h=a[k],(i=g[h.state])&&(i.push(h),j.push(h));var m=(0<g[OpenLayers.State.INSERT].length?1:0)+g[OpenLayers.State.UPDATE].length+g[OpenLayers.State.DELETE].length,n=!0,o=new OpenLayers.Protocol.Response({reqFeatures:j});for(h=g[OpenLayers.State.INSERT],0<h.length&&e.push(this.create(h,OpenLayers.Util.applyDefaults({callback:c,scope:this},b.create))),h=g[OpenLayers.State.UPDATE],k=h.length-1;k>=0;--k)e.push(this.update(h[k],OpenLayers.Util.applyDefaults({callback:d,scope:this},b.update)));for(h=g[OpenLayers.State.DELETE],k=h.length-1;k>=0;--k)e.push(this["delete"](h[k],OpenLayers.Util.applyDefaults({callback:d,scope:this},b["delete"])));return e},abort:function(a){a&&a.priv.abort()},callUserCallback:function(a,b){var c=b[a.requestType];c&&c.callback&&c.callback.call(c.scope,a)},CLASS_NAME:"OpenLayers.Protocol.HTTP"}),OpenLayers.Strategy.Cluster=OpenLayers.Class(OpenLayers.Strategy,{distance:20,threshold:null,features:null,clusters:null,clustering:!1,resolution:null,activate:function(){var a=OpenLayers.Strategy.prototype.activate.call(this);return a&&this.layer.events.on({beforefeaturesadded:this.cacheFeatures,moveend:this.cluster,scope:this}),a},deactivate:function(){var a=OpenLayers.Strategy.prototype.deactivate.call(this);return a&&(this.clearCache(),this.layer.events.un({beforefeaturesadded:this.cacheFeatures,moveend:this.cluster,scope:this})),a},cacheFeatures:function(a){var b=!0;return this.clustering||(this.clearCache(),this.features=a.features,this.cluster(),b=!1),b},clearCache:function(){this.features=null},cluster:function(a){if((!a||a.zoomChanged)&&this.features&&(a=this.layer.map.getResolution(),a!=this.resolution||!this.clustersExist())){this.resolution=a;for(var b,c,d,a=[],e=0;e<this.features.length;++e)if(b=this.features[e],b.geometry){c=!1;for(var f=a.length-1;f>=0;--f)if(d=a[f],this.shouldCluster(d,b)){this.addToCluster(d,b),c=!0;break}c||a.push(this.createCluster(this.features[e]))}if(this.layer.removeAllFeatures(),0<a.length){if(1<this.threshold)for(b=a.slice(),a=[],e=0,d=b.length;d>e;++e)c=b[e],c.attributes.count<this.threshold?Array.prototype.push.apply(a,c.cluster):a.push(c);this.clustering=!0,this.layer.addFeatures(a),this.clustering=!1}this.clusters=a}},clustersExist:function(){var a=!1;if(this.clusters&&0<this.clusters.length&&this.clusters.length==this.layer.features.length)for(var a=!0,b=0;b<this.clusters.length;++b)if(this.clusters[b]!=this.layer.features[b]){a=!1;break}return a},shouldCluster:function(a,b){var c=a.geometry.getBounds().getCenterLonLat(),d=b.geometry.getBounds().getCenterLonLat();return Math.sqrt(Math.pow(c.lon-d.lon,2)+Math.pow(c.lat-d.lat,2))/this.resolution<=this.distance},addToCluster:function(a,b){a.cluster.push(b),a.attributes.count+=1},createCluster:function(a){var b=a.geometry.getBounds().getCenterLonLat(),b=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(b.lon,b.lat),{count:1});return b.cluster=[a],b},CLASS_NAME:"OpenLayers.Strategy.Cluster"}),OpenLayers.Strategy.Filter=OpenLayers.Class(OpenLayers.Strategy,{filter:null,cache:null,caching:!1,activate:function(){var a=OpenLayers.Strategy.prototype.activate.apply(this,arguments);return a&&(this.cache=[],this.layer.events.on({beforefeaturesadded:this.handleAdd,beforefeaturesremoved:this.handleRemove,scope:this})),a},deactivate:function(){return this.cache=null,this.layer&&this.layer.events&&this.layer.events.un({beforefeaturesadded:this.handleAdd,beforefeaturesremoved:this.handleRemove,scope:this}),OpenLayers.Strategy.prototype.deactivate.apply(this,arguments)},handleAdd:function(a){if(!this.caching&&this.filter){var b=a.features;a.features=[];for(var c,d=0,e=b.length;e>d;++d)c=b[d],this.filter.evaluate(c)?a.features.push(c):this.cache.push(c)}},handleRemove:function(){this.caching||(this.cache=[])},setFilter:function(a){this.filter=a,a=this.cache,this.cache=[],this.handleAdd({features:this.layer.features}),0<this.cache.length&&(this.caching=!0,this.layer.removeFeatures(this.cache.slice()),this.caching=!1),0<a.length&&(a={features:a},this.handleAdd(a),0<a.features.length&&(this.caching=!0,this.layer.addFeatures(a.features),this.caching=!1))},CLASS_NAME:"OpenLayers.Strategy.Filter"}),OpenLayers.Protocol.SOS=function(a){var a=OpenLayers.Util.applyDefaults(a,OpenLayers.Protocol.SOS.DEFAULTS),b=OpenLayers.Protocol.SOS["v"+a.version.replace(/\./g,"_")];if(!b)throw"Unsupported SOS version: "+a.version;return new b(a)},OpenLayers.Protocol.SOS.DEFAULTS={version:"1.0.0"},OpenLayers.Format.WFSDescribeFeatureType=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{xsd:"http://www.w3.org/2001/XMLSchema"},readers:{xsd:{schema:function(a,b){var c=[],d={};this.readChildNodes(a,{complexTypes:c,customTypes:d});for(var e,f,g=a.attributes,h=0,i=g.length;i>h;++h)e=g[h],f=e.name,0==f.indexOf("xmlns")?this.setNamespace(f.split(":")[1]||"",e.value):b[f]=e.value;for(b.featureTypes=c,b.targetPrefix=this.namespaceAlias[b.targetNamespace],h=0,i=c.length;i>h;++h)g=c[h],e=d[g.typeName],d[g.typeName]&&(g.typeName=e.name)},complexType:function(a,b){var c={typeName:a.getAttribute("name")};this.readChildNodes(a,c),b.complexTypes.push(c)},complexContent:function(a,b){this.readChildNodes(a,b)},extension:function(a,b){this.readChildNodes(a,b)},sequence:function(a,b){var c={elements:[]};this.readChildNodes(a,c),b.properties=c.elements},element:function(a,b){if(b.elements){for(var c,d={},e=a.attributes,f=0,g=e.length;g>f;++f)c=e[f],d[c.name]=c.value;e=d.type,e||(e={},this.readChildNodes(a,e),d.restriction=e,d.type=e.base),d.localType=(e.base||e).split(":").pop(),b.elements.push(d)}b.complexTypes&&(e=a.getAttribute("type"),d=e.split(":").pop(),b.customTypes[d]={name:a.getAttribute("name"),type:e})},simpleType:function(a,b){this.readChildNodes(a,b)},restriction:function(a,b){b.base=a.getAttribute("base"),this.readRestriction(a,b)}}},readRestriction:function(a,b){for(var c,d,e=a.childNodes,f=0,g=e.length;g>f;++f)c=e[f],1==c.nodeType&&(d=c.nodeName.split(":").pop(),c=c.getAttribute("value"),b[d]?("string"==typeof b[d]&&(b[d]=[b[d]]),b[d].push(c)):b[d]=c)},read:function(a){"string"==typeof a&&(a=OpenLayers.Format.XML.prototype.read.apply(this,[a])),a&&9==a.nodeType&&(a=a.documentElement);var b={};return this.readNode(a,b),b},CLASS_NAME:"OpenLayers.Format.WFSDescribeFeatureType"}),OpenLayers.Format.GeoRSS=OpenLayers.Class(OpenLayers.Format.XML,{rssns:"http://backend.userland.com/rss2",featureNS:"http://mapserver.gis.umn.edu/mapserver",georssns:"http://www.georss.org/georss",geons:"http://www.w3.org/2003/01/geo/wgs84_pos#",featureTitle:"Untitled",featureDescription:"No Description",gmlParser:null,xy:!1,createGeometryFromItem:function(a){var b=this.getElementsByTagNameNS(a,this.georssns,"point"),c=this.getElementsByTagNameNS(a,this.geons,"lat"),d=this.getElementsByTagNameNS(a,this.geons,"long"),e=this.getElementsByTagNameNS(a,this.georssns,"line"),f=this.getElementsByTagNameNS(a,this.georssns,"polygon"),g=this.getElementsByTagNameNS(a,this.georssns,"where"),a=this.getElementsByTagNameNS(a,this.georssns,"box");if(0<b.length||0<c.length&&0<d.length){0<b.length?(c=OpenLayers.String.trim(b[0].firstChild.nodeValue).split(/\s+/),2!=c.length&&(c=OpenLayers.String.trim(b[0].firstChild.nodeValue).split(/\s*,\s*/))):c=[parseFloat(c[0].firstChild.nodeValue),parseFloat(d[0].firstChild.nodeValue)];var h=new OpenLayers.Geometry.Point(c[1],c[0])}else if(0<e.length){for(c=OpenLayers.String.trim(this.getChildValue(e[0])).split(/\s+/),d=[],e=0,f=c.length;f>e;e+=2)b=new OpenLayers.Geometry.Point(c[e+1],c[e]),d.push(b);h=new OpenLayers.Geometry.LineString(d)}else if(0<f.length){for(c=OpenLayers.String.trim(this.getChildValue(f[0])).split(/\s+/),d=[],e=0,f=c.length;f>e;e+=2)b=new OpenLayers.Geometry.Point(c[e+1],c[e]),d.push(b);h=new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing(d)])}else 0<g.length?(this.gmlParser||(this.gmlParser=new OpenLayers.Format.GML({xy:this.xy})),h=this.gmlParser.parseFeature(g[0]).geometry):0<a.length&&(c=OpenLayers.String.trim(a[0].firstChild.nodeValue).split(/\s+/),d=[],3<c.length&&(b=new OpenLayers.Geometry.Point(c[1],c[0]),d.push(b),b=new OpenLayers.Geometry.Point(c[1],c[2]),d.push(b),b=new OpenLayers.Geometry.Point(c[3],c[2]),d.push(b),b=new OpenLayers.Geometry.Point(c[3],c[0]),d.push(b),b=new OpenLayers.Geometry.Point(c[1],c[0]),d.push(b)),h=new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing(d)]));return h&&this.internalProjection&&this.externalProjection&&h.transform(this.externalProjection,this.internalProjection),h},createFeatureFromItem:function(a){var b=this.createGeometryFromItem(a),c=this._getChildValue(a,"*","title",this.featureTitle),d=this._getChildValue(a,"*","description",this._getChildValue(a,"*","content",this._getChildValue(a,"*","summary",this.featureDescription))),e=this._getChildValue(a,"*","link");if(!e)try{e=this.getElementsByTagNameNS(a,"*","link")[0].getAttribute("href")}catch(f){e=null}return a=this._getChildValue(a,"*","id",null),b=new OpenLayers.Feature.Vector(b,{title:c,description:d,link:e}),b.fid=a,b},_getChildValue:function(a,b,c,d){return(a=this.getElementsByTagNameNS(a,b,c))&&a[0]&&a[0].firstChild&&a[0].firstChild.nodeValue?this.getChildValue(a[0]):void 0==d?"":d},read:function(a){"string"==typeof a&&(a=OpenLayers.Format.XML.prototype.read.apply(this,[a]));var b=null,b=this.getElementsByTagNameNS(a,"*","item");0==b.length&&(b=this.getElementsByTagNameNS(a,"*","entry"));for(var a=b.length,c=Array(a),d=0;a>d;d++)c[d]=this.createFeatureFromItem(b[d]);return c},write:function(a){var b;if(OpenLayers.Util.isArray(a)){b=this.createElementNS(this.rssns,"rss");for(var c=0,d=a.length;d>c;c++)b.appendChild(this.createFeatureXML(a[c]))}else b=this.createFeatureXML(a);return OpenLayers.Format.XML.prototype.write.apply(this,[b])},createFeatureXML:function(a){var b=this.buildGeometryNode(a.geometry),c=this.createElementNS(this.rssns,"item"),d=this.createElementNS(this.rssns,"title");d.appendChild(this.createTextNode(a.attributes.title?a.attributes.title:""));var e=this.createElementNS(this.rssns,"description");e.appendChild(this.createTextNode(a.attributes.description?a.attributes.description:"")),c.appendChild(d),c.appendChild(e),a.attributes.link&&(d=this.createElementNS(this.rssns,"link"),d.appendChild(this.createTextNode(a.attributes.link)),c.appendChild(d));for(var f in a.attributes)"link"==f||"title"==f||"description"==f||(d=this.createTextNode(a.attributes[f]),e=f,-1!=f.search(":")&&(e=f.split(":")[1]),e=this.createElementNS(this.featureNS,"feature:"+e),e.appendChild(d),c.appendChild(e));return c.appendChild(b),c},buildGeometryNode:function(a){this.internalProjection&&this.externalProjection&&(a=a.clone(),a.transform(this.internalProjection,this.externalProjection));var b;if("OpenLayers.Geometry.Polygon"==a.CLASS_NAME)b=this.createElementNS(this.georssns,"georss:polygon"),b.appendChild(this.buildCoordinatesNode(a.components[0]));else if("OpenLayers.Geometry.LineString"==a.CLASS_NAME)b=this.createElementNS(this.georssns,"georss:line"),b.appendChild(this.buildCoordinatesNode(a));else{if("OpenLayers.Geometry.Point"!=a.CLASS_NAME)throw"Couldn't parse "+a.CLASS_NAME;b=this.createElementNS(this.georssns,"georss:point"),b.appendChild(this.buildCoordinatesNode(a))}return b},buildCoordinatesNode:function(a){var b=null;if(a.components&&(b=a.components),b){for(var a=b.length,c=Array(a),d=0;a>d;d++)c[d]=b[d].y+" "+b[d].x;b=c.join(" ")}else b=a.y+" "+a.x;return this.createTextNode(b)},CLASS_NAME:"OpenLayers.Format.GeoRSS"}),OpenLayers.Format.WPSCapabilities=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.0.0",CLASS_NAME:"OpenLayers.Format.WPSCapabilities"}),OpenLayers.Format.WPSCapabilities.v1_0_0=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{ows:"http://www.opengis.net/ows/1.1",wps:"http://www.opengis.net/wps/1.0.0",xlink:"http://www.w3.org/1999/xlink"},regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},initialize:function(a){OpenLayers.Format.XML.prototype.initialize.apply(this,[a])},read:function(a){"string"==typeof a&&(a=OpenLayers.Format.XML.prototype.read.apply(this,[a])),a&&9==a.nodeType&&(a=a.documentElement);var b={};return this.readNode(a,b),b},readers:{wps:{Capabilities:function(a,b){this.readChildNodes(a,b)},ProcessOfferings:function(a,b){b.processOfferings={},this.readChildNodes(a,b.processOfferings)},Process:function(a,b){var c={processVersion:this.getAttributeNS(a,this.namespaces.wps,"processVersion")};this.readChildNodes(a,c),b[c.identifier]=c},Languages:function(a,b){b.languages=[],this.readChildNodes(a,b.languages)},Default:function(a,b){var c={isDefault:!0};this.readChildNodes(a,c),b.push(c)},Supported:function(a,b){var c={};this.readChildNodes(a,c),b.push(c)}},ows:OpenLayers.Format.OWSCommon.v1_1_0.prototype.readers.ows},CLASS_NAME:"OpenLayers.Format.WPSCapabilities.v1_0_0"}),OpenLayers.Control.PinchZoom=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_TOOL,containerCenter:null,pinchOrigin:null,currentCenter:null,autoActivate:!0,initialize:function(){OpenLayers.Control.prototype.initialize.apply(this,arguments),this.handler=new OpenLayers.Handler.Pinch(this,{start:this.pinchStart,move:this.pinchMove,done:this.pinchDone},this.handlerOptions)},activate:function(){var a=OpenLayers.Control.prototype.activate.apply(this,arguments);return a&&(this.map.events.on({moveend:this.updateContainerCenter,scope:this}),this.updateContainerCenter()),a},deactivate:function(){var a=OpenLayers.Control.prototype.deactivate.apply(this,arguments);return this.map&&this.map.events&&this.map.events.un({moveend:this.updateContainerCenter,scope:this}),a},updateContainerCenter:function(){var a=this.map.layerContainerDiv;this.containerCenter={x:parseInt(a.style.left,10)+50,y:parseInt(a.style.top,10)+50}},pinchStart:function(a){this.currentCenter=this.pinchOrigin=a.xy},pinchMove:function(a,b){var c=b.scale,d=this.containerCenter,e=this.pinchOrigin,f=a.xy,g=Math.round(f.x-e.x+(c-1)*(d.x-e.x)),d=Math.round(f.y-e.y+(c-1)*(d.y-e.y));this.applyTransform("translate("+g+"px, "+d+"px) scale("+c+")"),this.currentCenter=f},applyTransform:function(a){var b=this.map.layerContainerDiv.style;b["-webkit-transform"]=a,b["-moz-transform"]=a},pinchDone:function(a,b,c){if(this.applyTransform(""),a=this.map.getZoomForResolution(this.map.getResolution()/c.scale,!0),a!==this.map.getZoom()||!this.currentCenter.equals(this.pinchOrigin)){var b=this.map.getResolutionForZoom(a),c=this.map.getLonLatFromPixel(this.pinchOrigin),d=this.currentCenter,e=this.map.getSize();c.lon+=b*(e.w/2-d.x),c.lat-=b*(e.h/2-d.y),this.map.div.clientWidth=this.map.div.clientWidth,this.map.setCenter(c,a)}},CLASS_NAME:"OpenLayers.Control.PinchZoom"}),OpenLayers.Control.TouchNavigation=OpenLayers.Class(OpenLayers.Control,{dragPan:null,dragPanOptions:null,pinchZoom:null,pinchZoomOptions:null,clickHandlerOptions:null,documentDrag:!1,autoActivate:!0,initialize:function(){this.handlers={},OpenLayers.Control.prototype.initialize.apply(this,arguments)},destroy:function(){this.deactivate(),this.dragPan&&this.dragPan.destroy(),this.dragPan=null,this.pinchZoom&&(this.pinchZoom.destroy(),delete this.pinchZoom),OpenLayers.Control.prototype.destroy.apply(this,arguments)},activate:function(){return OpenLayers.Control.prototype.activate.apply(this,arguments)?(this.dragPan.activate(),this.handlers.click.activate(),this.pinchZoom.activate(),!0):!1},deactivate:function(){return OpenLayers.Control.prototype.deactivate.apply(this,arguments)?(this.dragPan.deactivate(),this.handlers.click.deactivate(),this.pinchZoom.deactivate(),!0):!1},draw:function(){var a={click:this.defaultClick,dblclick:this.defaultDblClick},b=OpenLayers.Util.extend({"double":!0,stopDouble:!0,pixelTolerance:2},this.clickHandlerOptions);this.handlers.click=new OpenLayers.Handler.Click(this,a,b),this.dragPan=new OpenLayers.Control.DragPan(OpenLayers.Util.extend({map:this.map,documentDrag:this.documentDrag},this.dragPanOptions)),this.dragPan.draw(),this.pinchZoom=new OpenLayers.Control.PinchZoom(OpenLayers.Util.extend({map:this.map},this.pinchZoomOptions))
},defaultClick:function(a){a.lastTouches&&2==a.lastTouches.length&&this.map.zoomOut()},defaultDblClick:function(a){this.map.setCenter(this.map.getLonLatFromViewPortPx(a.xy),this.map.zoom+1)},CLASS_NAME:"OpenLayers.Control.TouchNavigation"}),OpenLayers.Style2=OpenLayers.Class({id:null,name:null,title:null,description:null,layerName:null,isDefault:!1,rules:null,initialize:function(a){OpenLayers.Util.extend(this,a),this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},destroy:function(){for(var a=0,b=this.rules.length;b>a;a++)this.rules[a].destroy();delete this.rules},clone:function(){var a=OpenLayers.Util.extend({},this);if(this.rules){a.rules=[];for(var b=0,c=this.rules.length;c>b;++b)a.rules.push(this.rules[b].clone())}return new OpenLayers.Style2(a)},CLASS_NAME:"OpenLayers.Style2"}),OpenLayers.Format.WFS=OpenLayers.Class(OpenLayers.Format.GML,{layer:null,wfsns:"http://www.opengis.net/wfs",ogcns:"http://www.opengis.net/ogc",initialize:function(a,b){OpenLayers.Format.GML.prototype.initialize.apply(this,[a]),this.layer=b,this.layer.featureNS&&(this.featureNS=this.layer.featureNS),this.layer.options.geometry_column&&(this.geometryName=this.layer.options.geometry_column),this.layer.options.typename&&(this.featureName=this.layer.options.typename)},write:function(a){var b=this.createElementNS(this.wfsns,"wfs:Transaction");b.setAttribute("version","1.0.0"),b.setAttribute("service","WFS");for(var c=0;c<a.length;c++)switch(a[c].state){case OpenLayers.State.INSERT:b.appendChild(this.insert(a[c]));break;case OpenLayers.State.UPDATE:b.appendChild(this.update(a[c]));break;case OpenLayers.State.DELETE:b.appendChild(this.remove(a[c]))}return OpenLayers.Format.XML.prototype.write.apply(this,[b])},createFeatureXML:function(a){var b=this.buildGeometryNode(a.geometry),c=this.createElementNS(this.featureNS,"feature:"+this.geometryName);c.appendChild(b),b=this.createElementNS(this.featureNS,"feature:"+this.featureName),b.appendChild(c);for(var d in a.attributes){var c=this.createTextNode(a.attributes[d]),e=d;-1!=d.search(":")&&(e=d.split(":")[1]),e=this.createElementNS(this.featureNS,"feature:"+e),e.appendChild(c),b.appendChild(e)}return b},insert:function(a){var b=this.createElementNS(this.wfsns,"wfs:Insert");return b.appendChild(this.createFeatureXML(a)),b},update:function(a){a.fid||OpenLayers.Console.userError(OpenLayers.i18n("noFID"));var b=this.createElementNS(this.wfsns,"wfs:Update");b.setAttribute("typeName",this.featurePrefix+":"+this.featureName),b.setAttribute("xmlns:"+this.featurePrefix,this.featureNS);var c=this.createElementNS(this.wfsns,"wfs:Property"),d=this.createElementNS(this.wfsns,"wfs:Name"),e=this.createTextNode(this.geometryName);d.appendChild(e),c.appendChild(d),d=this.createElementNS(this.wfsns,"wfs:Value"),e=this.buildGeometryNode(a.geometry),a.layer&&e.setAttribute("srsName",a.layer.projection.getCode()),d.appendChild(e),c.appendChild(d),b.appendChild(c);for(var f in a.attributes)c=this.createElementNS(this.wfsns,"wfs:Property"),d=this.createElementNS(this.wfsns,"wfs:Name"),d.appendChild(this.createTextNode(f)),c.appendChild(d),d=this.createElementNS(this.wfsns,"wfs:Value"),d.appendChild(this.createTextNode(a.attributes[f])),c.appendChild(d),b.appendChild(c);return c=this.createElementNS(this.ogcns,"ogc:Filter"),f=this.createElementNS(this.ogcns,"ogc:FeatureId"),f.setAttribute("fid",a.fid),c.appendChild(f),b.appendChild(c),b},remove:function(a){if(!a.fid)return OpenLayers.Console.userError(OpenLayers.i18n("noFID")),!1;var b=this.createElementNS(this.wfsns,"wfs:Delete");b.setAttribute("typeName",this.featurePrefix+":"+this.featureName),b.setAttribute("xmlns:"+this.featurePrefix,this.featureNS);var c=this.createElementNS(this.ogcns,"ogc:Filter"),d=this.createElementNS(this.ogcns,"ogc:FeatureId");return d.setAttribute("fid",a.fid),c.appendChild(d),b.appendChild(c),b},destroy:function(){this.layer=null},CLASS_NAME:"OpenLayers.Format.WFS"}),OpenLayers.Format.SLD.v1_0_0_GeoServer=OpenLayers.Class(OpenLayers.Format.SLD.v1_0_0,{version:"1.0.0",profile:"GeoServer",readers:OpenLayers.Util.applyDefaults({sld:OpenLayers.Util.applyDefaults({Priority:function(a,b){var c=this.readers.ogc._expression.call(this,a);c&&(b.priority=c)},VendorOption:function(a,b){b.vendorOptions||(b.vendorOptions={}),b.vendorOptions[a.getAttribute("name")]=this.getChildValue(a)}},OpenLayers.Format.SLD.v1_0_0.prototype.readers.sld)},OpenLayers.Format.SLD.v1_0_0.prototype.readers),writers:OpenLayers.Util.applyDefaults({sld:OpenLayers.Util.applyDefaults({Priority:function(a){return this.writers.sld._OGCExpression.call(this,"sld:Priority",a)},VendorOption:function(a){return this.createElementNSPlus("sld:VendorOption",{attributes:{name:a.name},value:a.value})},TextSymbolizer:function(a){var b=OpenLayers.Format.SLD.v1_0_0.prototype.writers.sld.TextSymbolizer.apply(this,arguments);return!1!==a.graphic&&(a.externalGraphic||a.graphicName)&&this.writeNode("Graphic",a,b),"priority"in a&&this.writeNode("Priority",a.priority,b),this.addVendorOptions(b,a)},PointSymbolizer:function(a){return this.addVendorOptions(OpenLayers.Format.SLD.v1_0_0.prototype.writers.sld.PointSymbolizer.apply(this,arguments),a)},LineSymbolizer:function(a){return this.addVendorOptions(OpenLayers.Format.SLD.v1_0_0.prototype.writers.sld.LineSymbolizer.apply(this,arguments),a)},PolygonSymbolizer:function(a){return this.addVendorOptions(OpenLayers.Format.SLD.v1_0_0.prototype.writers.sld.PolygonSymbolizer.apply(this,arguments),a)}},OpenLayers.Format.SLD.v1_0_0.prototype.writers.sld)},OpenLayers.Format.SLD.v1_0_0.prototype.writers),addVendorOptions:function(a,b){if(b.vendorOptions)for(var c in b.vendorOptions)this.writeNode("VendorOption",{name:c,value:b.vendorOptions[c]},a);return a},CLASS_NAME:"OpenLayers.Format.SLD.v1_0_0_GeoServer"}),OpenLayers.Layer.Boxes=OpenLayers.Class(OpenLayers.Layer.Markers,{drawMarker:function(a){var b=this.map.getLayerPxFromLonLat({lon:a.bounds.left,lat:a.bounds.top}),c=this.map.getLayerPxFromLonLat({lon:a.bounds.right,lat:a.bounds.bottom});null==c||null==b?a.display(!1):(b=a.draw(b,{w:Math.max(1,c.x-b.x),h:Math.max(1,c.y-b.y)}),a.drawn||(this.div.appendChild(b),a.drawn=!0))},removeMarker:function(a){OpenLayers.Util.removeItem(this.markers,a),null!=a.div&&a.div.parentNode==this.div&&this.div.removeChild(a.div)},CLASS_NAME:"OpenLayers.Layer.Boxes"}),OpenLayers.Format.WFSCapabilities.v1_0_0=OpenLayers.Class(OpenLayers.Format.WFSCapabilities.v1,{readers:{wfs:OpenLayers.Util.applyDefaults({Service:function(a,b){b.service={},this.readChildNodes(a,b.service)},Fees:function(a,b){var c=this.getChildValue(a);c&&"none"!=c.toLowerCase()&&(b.fees=c)},AccessConstraints:function(a,b){var c=this.getChildValue(a);c&&"none"!=c.toLowerCase()&&(b.accessConstraints=c)},OnlineResource:function(a,b){var c=this.getChildValue(a);c&&"none"!=c.toLowerCase()&&(b.onlineResource=c)},Keywords:function(a,b){var c=this.getChildValue(a);c&&"none"!=c.toLowerCase()&&(b.keywords=c.split(", "))},Capability:function(a,b){b.capability={},this.readChildNodes(a,b.capability)},Request:function(a,b){b.request={},this.readChildNodes(a,b.request)},GetFeature:function(a,b){b.getfeature={href:{},formats:[]},this.readChildNodes(a,b.getfeature)},ResultFormat:function(a,b){for(var c,d=a.childNodes,e=0;e<d.length;e++)c=d[e],1==c.nodeType&&b.formats.push(c.nodeName)},DCPType:function(a,b){this.readChildNodes(a,b)},HTTP:function(a,b){this.readChildNodes(a,b.href)},Get:function(a,b){b.get=a.getAttribute("onlineResource")},Post:function(a,b){b.post=a.getAttribute("onlineResource")},SRS:function(a,b){var c=this.getChildValue(a);c&&(b.srs=c)}},OpenLayers.Format.WFSCapabilities.v1.prototype.readers.wfs)},CLASS_NAME:"OpenLayers.Format.WFSCapabilities.v1_0_0"}),OpenLayers.Format.WMSCapabilities=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.1.1",profile:null,CLASS_NAME:"OpenLayers.Format.WMSCapabilities"}),OpenLayers.Format.WMSCapabilities.v1=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{wms:"http://www.opengis.net/wms",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},defaultPrefix:"wms",read:function(a){"string"==typeof a&&(a=OpenLayers.Format.XML.prototype.read.apply(this,[a]));var b=a;a&&9==a.nodeType&&(a=a.documentElement);var c={};return this.readNode(a,c),void 0===c.service&&(a=new OpenLayers.Format.OGCExceptionReport,c.error=a.read(b)),c},readers:{wms:{Service:function(a,b){b.service={},this.readChildNodes(a,b.service)},Name:function(a,b){b.name=this.getChildValue(a)},Title:function(a,b){b.title=this.getChildValue(a)},Abstract:function(a,b){b["abstract"]=this.getChildValue(a)},BoundingBox:function(a){var b={};return b.bbox=[parseFloat(a.getAttribute("minx")),parseFloat(a.getAttribute("miny")),parseFloat(a.getAttribute("maxx")),parseFloat(a.getAttribute("maxy"))],a={x:parseFloat(a.getAttribute("resx")),y:parseFloat(a.getAttribute("resy"))},isNaN(a.x)&&isNaN(a.y)||(b.res=a),b},OnlineResource:function(a,b){b.href=this.getAttributeNS(a,this.namespaces.xlink,"href")},ContactInformation:function(a,b){b.contactInformation={},this.readChildNodes(a,b.contactInformation)},ContactPersonPrimary:function(a,b){b.personPrimary={},this.readChildNodes(a,b.personPrimary)},ContactPerson:function(a,b){b.person=this.getChildValue(a)},ContactOrganization:function(a,b){b.organization=this.getChildValue(a)},ContactPosition:function(a,b){b.position=this.getChildValue(a)},ContactAddress:function(a,b){b.contactAddress={},this.readChildNodes(a,b.contactAddress)},AddressType:function(a,b){b.type=this.getChildValue(a)},Address:function(a,b){b.address=this.getChildValue(a)},City:function(a,b){b.city=this.getChildValue(a)},StateOrProvince:function(a,b){b.stateOrProvince=this.getChildValue(a)},PostCode:function(a,b){b.postcode=this.getChildValue(a)},Country:function(a,b){b.country=this.getChildValue(a)},ContactVoiceTelephone:function(a,b){b.phone=this.getChildValue(a)},ContactFacsimileTelephone:function(a,b){b.fax=this.getChildValue(a)},ContactElectronicMailAddress:function(a,b){b.email=this.getChildValue(a)},Fees:function(a,b){var c=this.getChildValue(a);c&&"none"!=c.toLowerCase()&&(b.fees=c)},AccessConstraints:function(a,b){var c=this.getChildValue(a);c&&"none"!=c.toLowerCase()&&(b.accessConstraints=c)},Capability:function(a,b){b.capability={nestedLayers:[],layers:[]},this.readChildNodes(a,b.capability)},Request:function(a,b){b.request={},this.readChildNodes(a,b.request)},GetCapabilities:function(a,b){b.getcapabilities={formats:[]},this.readChildNodes(a,b.getcapabilities)},Format:function(a,b){OpenLayers.Util.isArray(b.formats)?b.formats.push(this.getChildValue(a)):b.format=this.getChildValue(a)},DCPType:function(a,b){this.readChildNodes(a,b)},HTTP:function(a,b){this.readChildNodes(a,b)},Get:function(a,b){b.get={},this.readChildNodes(a,b.get),b.href||(b.href=b.get.href)},Post:function(a,b){b.post={},this.readChildNodes(a,b.post),b.href||(b.href=b.get.href)},GetMap:function(a,b){b.getmap={formats:[]},this.readChildNodes(a,b.getmap)},GetFeatureInfo:function(a,b){b.getfeatureinfo={formats:[]},this.readChildNodes(a,b.getfeatureinfo)},Exception:function(a,b){b.exception={formats:[]},this.readChildNodes(a,b.exception)},Layer:function(a,b){var c,d;b.capability?(d=b.capability,c=b):d=b;var e=a.getAttributeNode("queryable"),f=e&&e.specified?a.getAttribute("queryable"):null,g=(e=a.getAttributeNode("cascaded"))&&e.specified?a.getAttribute("cascaded"):null,e=(e=a.getAttributeNode("opaque"))&&e.specified?a.getAttribute("opaque"):null,h=a.getAttribute("noSubsets"),i=a.getAttribute("fixedWidth"),j=a.getAttribute("fixedHeight"),k=c||{},l=OpenLayers.Util.extend;c={nestedLayers:[],styles:c?[].concat(c.styles):[],srs:c?l({},k.srs):{},metadataURLs:[],bbox:c?l({},k.bbox):{},llbbox:k.llbbox,dimensions:c?l({},k.dimensions):{},authorityURLs:c?l({},k.authorityURLs):{},identifiers:{},keywords:[],queryable:f&&""!==f?"1"===f||"true"===f:k.queryable||!1,cascaded:null!==g?parseInt(g):k.cascaded||0,opaque:e?"1"===e||"true"===e:k.opaque||!1,noSubsets:null!==h?"1"===h||"true"===h:k.noSubsets||!1,fixedWidth:null!=i?parseInt(i):k.fixedWidth||0,fixedHeight:null!=j?parseInt(j):k.fixedHeight||0,minScale:k.minScale,maxScale:k.maxScale,attribution:k.attribution},b.nestedLayers.push(c),c.capability=d,this.readChildNodes(a,c),delete c.capability,c.name&&(f=c.name.split(":"),g=d.request,e=g.getfeatureinfo,0<f.length&&(c.prefix=f[0]),d.layers.push(c),void 0===c.formats&&(c.formats=g.getmap.formats),void 0===c.infoFormats&&e)&&(c.infoFormats=e.formats)},Attribution:function(a,b){b.attribution={},this.readChildNodes(a,b.attribution)},LogoURL:function(a,b){b.logo={width:a.getAttribute("width"),height:a.getAttribute("height")},this.readChildNodes(a,b.logo)},Style:function(a,b){var c={};b.styles.push(c),this.readChildNodes(a,c)},LegendURL:function(a,b){var c={width:a.getAttribute("width"),height:a.getAttribute("height")};b.legend=c,this.readChildNodes(a,c)},MetadataURL:function(a,b){var c={type:a.getAttribute("type")};b.metadataURLs.push(c),this.readChildNodes(a,c)},DataURL:function(a,b){b.dataURL={},this.readChildNodes(a,b.dataURL)},FeatureListURL:function(a,b){b.featureListURL={},this.readChildNodes(a,b.featureListURL)},AuthorityURL:function(a,b){var c=a.getAttribute("name"),d={};this.readChildNodes(a,d),b.authorityURLs[c]=d.href},Identifier:function(a,b){var c=a.getAttribute("authority");b.identifiers[c]=this.getChildValue(a)},KeywordList:function(a,b){this.readChildNodes(a,b)},SRS:function(a,b){b.srs[this.getChildValue(a)]=!0}}},CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1"}),OpenLayers.Format.WMSCapabilities.v1_3=OpenLayers.Class(OpenLayers.Format.WMSCapabilities.v1,{readers:{wms:OpenLayers.Util.applyDefaults({WMS_Capabilities:function(a,b){this.readChildNodes(a,b)},LayerLimit:function(a,b){b.layerLimit=parseInt(this.getChildValue(a))},MaxWidth:function(a,b){b.maxWidth=parseInt(this.getChildValue(a))},MaxHeight:function(a,b){b.maxHeight=parseInt(this.getChildValue(a))},BoundingBox:function(a,b){var c=OpenLayers.Format.WMSCapabilities.v1.prototype.readers.wms.BoundingBox.apply(this,[a,b]);c.srs=a.getAttribute("CRS"),b.bbox[c.srs]=c},CRS:function(a,b){this.readers.wms.SRS.apply(this,[a,b])},EX_GeographicBoundingBox:function(a,b){b.llbbox=[],this.readChildNodes(a,b.llbbox)},westBoundLongitude:function(a,b){b[0]=this.getChildValue(a)},eastBoundLongitude:function(a,b){b[2]=this.getChildValue(a)},southBoundLatitude:function(a,b){b[1]=this.getChildValue(a)},northBoundLatitude:function(a,b){b[3]=this.getChildValue(a)},MinScaleDenominator:function(a,b){b.maxScale=parseFloat(this.getChildValue(a)).toPrecision(16)},MaxScaleDenominator:function(a,b){b.minScale=parseFloat(this.getChildValue(a)).toPrecision(16)},Dimension:function(a,b){var c={name:a.getAttribute("name").toLowerCase(),units:a.getAttribute("units"),unitsymbol:a.getAttribute("unitSymbol"),nearestVal:"1"===a.getAttribute("nearestValue"),multipleVal:"1"===a.getAttribute("multipleValues"),"default":a.getAttribute("default")||"",current:"1"===a.getAttribute("current"),values:this.getChildValue(a).split(",")};b.dimensions[c.name]=c},Keyword:function(a,b){var c={value:this.getChildValue(a),vocabulary:a.getAttribute("vocabulary")};b.keywords&&b.keywords.push(c)}},OpenLayers.Format.WMSCapabilities.v1.prototype.readers.wms),sld:{UserDefinedSymbolization:function(a,b){this.readers.wms.UserDefinedSymbolization.apply(this,[a,b]),b.userSymbols.inlineFeature=1==parseInt(a.getAttribute("InlineFeature")),b.userSymbols.remoteWCS=1==parseInt(a.getAttribute("RemoteWCS"))},DescribeLayer:function(a,b){this.readers.wms.DescribeLayer.apply(this,[a,b])},GetLegendGraphic:function(a,b){this.readers.wms.GetLegendGraphic.apply(this,[a,b])}}},CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1_3"}),OpenLayers.Layer.Zoomify=OpenLayers.Class(OpenLayers.Layer.Grid,{size:null,isBaseLayer:!0,standardTileSize:256,tileOriginCorner:"tl",numberOfTiers:0,tileCountUpToTier:null,tierSizeInTiles:null,tierImageSize:null,initialize:function(a,b,c,d){this.initializeZoomify(c),OpenLayers.Layer.Grid.prototype.initialize.apply(this,[a,b,c,{},d])},initializeZoomify:function(a){var a=a.clone(),b=new OpenLayers.Size(Math.ceil(a.w/this.standardTileSize),Math.ceil(a.h/this.standardTileSize));for(this.tierSizeInTiles=[b],this.tierImageSize=[a];a.w>this.standardTileSize||a.h>this.standardTileSize;)a=new OpenLayers.Size(Math.floor(a.w/2),Math.floor(a.h/2)),b=new OpenLayers.Size(Math.ceil(a.w/this.standardTileSize),Math.ceil(a.h/this.standardTileSize)),this.tierSizeInTiles.push(b),this.tierImageSize.push(a);for(this.tierSizeInTiles.reverse(),this.tierImageSize.reverse(),this.numberOfTiers=this.tierSizeInTiles.length,this.tileCountUpToTier=[0],a=1;a<this.numberOfTiers;a++)this.tileCountUpToTier.push(this.tierSizeInTiles[a-1].w*this.tierSizeInTiles[a-1].h+this.tileCountUpToTier[a-1])},destroy:function(){OpenLayers.Layer.Grid.prototype.destroy.apply(this,arguments),this.tileCountUpToTier.length=0,this.tierSizeInTiles.length=0,this.tierImageSize.length=0},clone:function(a){return null==a&&(a=new OpenLayers.Layer.Zoomify(this.name,this.url,this.size,this.options)),a=OpenLayers.Layer.Grid.prototype.clone.apply(this,[a])},getURL:function(a){var a=this.adjustBounds(a),b=this.map.getResolution(),c=Math.round((a.left-this.tileOrigin.lon)/(b*this.tileSize.w)),a=Math.round((this.tileOrigin.lat-a.top)/(b*this.tileSize.h)),b=this.map.getZoom(),c="TileGroup"+Math.floor((c+a*this.tierSizeInTiles[b].w+this.tileCountUpToTier[b])/256)+"/"+b+"-"+c+"-"+a+".jpg",a=this.url;return OpenLayers.Util.isArray(a)&&(a=this.selectUrl(c,a)),a+c},getImageSize:function(){if(0<arguments.length){var a=this.adjustBounds(arguments[0]),b=this.map.getResolution(),c=Math.round((a.left-this.tileOrigin.lon)/(b*this.tileSize.w)),a=Math.round((this.tileOrigin.lat-a.top)/(b*this.tileSize.h)),b=this.map.getZoom(),d=this.standardTileSize,e=this.standardTileSize;return c==this.tierSizeInTiles[b].w-1&&(d=this.tierImageSize[b].w%this.standardTileSize),a==this.tierSizeInTiles[b].h-1&&(e=this.tierImageSize[b].h%this.standardTileSize),new OpenLayers.Size(d,e)}return this.tileSize},setMap:function(){OpenLayers.Layer.Grid.prototype.setMap.apply(this,arguments),this.tileOrigin=new OpenLayers.LonLat(this.map.maxExtent.left,this.map.maxExtent.top)},calculateGridLayout:function(a,b,c){var d=c*this.tileSize.w,c=c*this.tileSize.h,e=a.left-b.lon,f=Math.floor(e/d)-this.buffer,a=b.lat-a.top+c,g=Math.floor(a/c)-this.buffer;return{tilelon:d,tilelat:c,tileoffsetlon:b.lon+f*d,tileoffsetlat:b.lat-c*g,tileoffsetx:-(e/d-f)*this.tileSize.w,tileoffsety:(g-a/c)*this.tileSize.h}},CLASS_NAME:"OpenLayers.Layer.Zoomify"}),OpenLayers.Layer.MapServer=OpenLayers.Class(OpenLayers.Layer.Grid,{DEFAULT_PARAMS:{mode:"map",map_imagetype:"png"},initialize:function(a,b,c,d){OpenLayers.Layer.Grid.prototype.initialize.apply(this,arguments),this.params=OpenLayers.Util.applyDefaults(this.params,this.DEFAULT_PARAMS),(null==d||null==d.isBaseLayer)&&(this.isBaseLayer="true"!=this.params.transparent&&1!=this.params.transparent)},clone:function(a){return null==a&&(a=new OpenLayers.Layer.MapServer(this.name,this.url,this.params,this.getOptions())),a=OpenLayers.Layer.Grid.prototype.clone.apply(this,[a])},getURL:function(a){var a=this.adjustBounds(a),a=[a.left,a.bottom,a.right,a.top],b=this.getImageSize();return this.getFullRequestString({mapext:a,imgext:a,map_size:[b.w,b.h],imgx:b.w/2,imgy:b.h/2,imgxy:[b.w,b.h]})},getFullRequestString:function(a,b){var c=null==b?this.url:b,d=OpenLayers.Util.extend({},this.params),d=OpenLayers.Util.extend(d,a),e=OpenLayers.Util.getParameterString(d);OpenLayers.Util.isArray(c)&&(c=this.selectUrl(e,c));var f,e=OpenLayers.Util.upperCaseObject(OpenLayers.Util.getParameters(c));for(f in d)f.toUpperCase()in e&&delete d[f];return e=OpenLayers.Util.getParameterString(d),d=c,e=e.replace(/,/g,"+"),""!=e&&(f=c.charAt(c.length-1),d="&"==f||"?"==f?d+e:-1==c.indexOf("?")?d+("?"+e):d+("&"+e)),d},CLASS_NAME:"OpenLayers.Layer.MapServer"}),OpenLayers.Renderer.VML=OpenLayers.Class(OpenLayers.Renderer.Elements,{xmlns:"urn:schemas-microsoft-com:vml",symbolCache:{},offset:null,initialize:function(){if(this.supported()){if(!document.namespaces.olv){document.namespaces.add("olv",this.xmlns);for(var a=document.createStyleSheet(),b="shape rect oval fill stroke imagedata group textbox".split(" "),c=0,d=b.length;d>c;c++)a.addRule("olv\\:"+b[c],"behavior: url(#default#VML); position: absolute; display: inline-block;")}OpenLayers.Renderer.Elements.prototype.initialize.apply(this,arguments)}},supported:function(){return!!document.namespaces},setExtent:function(a,b){var c=OpenLayers.Renderer.Elements.prototype.setExtent.apply(this,arguments),d=this.getResolution(),e=a.left/d|0,d=a.top/d-this.size.h|0;b||!this.offset?(this.offset={x:e,y:d},d=e=0):(e-=this.offset.x,d-=this.offset.y),this.root.coordorigin=e-this.xOffset+" "+d;for(var e=[this.root,this.vectorRoot,this.textRoot],f=0,g=e.length;g>f;++f)d=e[f],d.coordsize=this.size.w+" "+this.size.h;return this.root.style.flip="y",c},setSize:function(){OpenLayers.Renderer.prototype.setSize.apply(this,arguments);for(var a,b=[this.rendererRoot,this.root,this.vectorRoot,this.textRoot],c=this.size.w+"px",d=this.size.h+"px",e=0,f=b.length;f>e;++e)a=b[e],a.style.width=c,a.style.height=d},getNodeType:function(a,b){var c=null;switch(a.CLASS_NAME){case"OpenLayers.Geometry.Point":c=b.externalGraphic?"olv:rect":this.isComplexSymbol(b.graphicName)?"olv:shape":"olv:oval";break;case"OpenLayers.Geometry.Rectangle":c="olv:rect";break;case"OpenLayers.Geometry.LineString":case"OpenLayers.Geometry.LinearRing":case"OpenLayers.Geometry.Polygon":case"OpenLayers.Geometry.Curve":c="olv:shape"}return c},setStyle:function(a,b,c,d){var b=b||a._style,c=c||a._options,e=b.fillColor;if("OpenLayers.Geometry.Point"===a._geometryClass)if(b.externalGraphic){c.isFilled=!0,b.graphicTitle&&(a.title=b.graphicTitle);var e=b.graphicWidth||b.graphicHeight,f=b.graphicHeight||b.graphicWidth,e=e?e:2*b.pointRadius,f=f?f:2*b.pointRadius,g=this.getResolution(),h=void 0!=b.graphicXOffset?b.graphicXOffset:-(.5*e),i=void 0!=b.graphicYOffset?b.graphicYOffset:-(.5*f);a.style.left=((d.x-this.featureDx)/g-this.offset.x+h|0)+"px",a.style.top=(d.y/g-this.offset.y-(i+f)|0)+"px",a.style.width=e+"px",a.style.height=f+"px",a.style.flip="y",e="none",c.isStroked=!1}else this.isComplexSymbol(b.graphicName)?(f=this.importSymbol(b.graphicName),a.path=f.path,a.coordorigin=f.left+","+f.bottom,f=f.size,a.coordsize=f+","+f,this.drawCircle(a,d,b.pointRadius),a.style.flip="y"):this.drawCircle(a,d,b.pointRadius);return c.isFilled?a.fillcolor=e:a.filled="false",d=a.getElementsByTagName("fill"),d=0==d.length?null:d[0],c.isFilled?(d||(d=this.createNode("olv:fill",a.id+"_fill")),d.opacity=b.fillOpacity,"OpenLayers.Geometry.Point"!==a._geometryClass||!b.externalGraphic||(b.graphicOpacity&&(d.opacity=b.graphicOpacity),d.src=b.externalGraphic,d.type="frame",b.graphicWidth&&b.graphicHeight)||(d.aspect="atmost"),d.parentNode!=a&&a.appendChild(d)):d&&a.removeChild(d),e=b.rotation,(void 0!==e||void 0!==a._rotation)&&(a._rotation=e,b.externalGraphic?(this.graphicRotate(a,h,i,b),d.opacity=0):"OpenLayers.Geometry.Point"===a._geometryClass&&(a.style.rotation=e||0)),h=a.getElementsByTagName("stroke"),h=0==h.length?null:h[0],c.isStroked?(h||(h=this.createNode("olv:stroke",a.id+"_stroke"),a.appendChild(h)),h.on=!0,h.color=b.strokeColor,h.weight=b.strokeWidth+"px",h.opacity=b.strokeOpacity,h.endcap="butt"==b.strokeLinecap?"flat":b.strokeLinecap||"round",b.strokeDashstyle&&(h.dashstyle=this.dashStyle(b))):(a.stroked=!1,h&&(h.on=!1)),"inherit"!=b.cursor&&null!=b.cursor&&(a.style.cursor=b.cursor),a},graphicRotate:function(a,b,c,d){var e,f,d=d||a._style,g=d.rotation||0;if(d.graphicWidth&&d.graphicHeight){f=Math.max(d.graphicWidth,d.graphicHeight),e=d.graphicWidth/d.graphicHeight;var h=Math.round(d.graphicWidth||f*e),i=Math.round(d.graphicHeight||f);a.style.width=h+"px",a.style.height=i+"px";var j=document.getElementById(a.id+"_image");j||(j=this.createNode("olv:imagedata",a.id+"_image"),a.appendChild(j)),j.style.width=h+"px",j.style.height=i+"px",j.src=d.externalGraphic,j.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='', sizingMethod='scale')",j=g*Math.PI/180,g=Math.sin(j),j=Math.cos(j),g="progid:DXImageTransform.Microsoft.Matrix(M11="+j+",M12="+-g+",M21="+g+",M22="+j+",SizingMethod='auto expand')\n",(j=d.graphicOpacity||d.fillOpacity)&&1!=j&&(g+="progid:DXImageTransform.Microsoft.BasicImage(opacity="+j+")\n"),a.style.filter=g,g=new OpenLayers.Geometry.Point(-b,-c),h=new OpenLayers.Bounds(0,0,h,i).toGeometry(),h.rotate(d.rotation,g),h=h.getBounds(),a.style.left=Math.round(parseInt(a.style.left)+h.left)+"px",a.style.top=Math.round(parseInt(a.style.top)-h.bottom)+"px"}else{var k=new Image;k.onreadystatechange=OpenLayers.Function.bind(function(){("complete"==k.readyState||"interactive"==k.readyState)&&(e=k.width/k.height,f=Math.max(2*d.pointRadius,d.graphicWidth||0,d.graphicHeight||0),b*=e,d.graphicWidth=f*e,d.graphicHeight=f,this.graphicRotate(a,b,c,d))},this),k.src=d.externalGraphic}},postDraw:function(a){a.style.visibility="visible";var b=a._style.fillColor,c=a._style.strokeColor;"none"==b&&a.fillcolor!=b&&(a.fillcolor=b),"none"==c&&a.strokecolor!=c&&(a.strokecolor=c)},setNodeDimension:function(a,b){var c=b.getBounds();if(c){var d=this.getResolution(),c=new OpenLayers.Bounds((c.left-this.featureDx)/d-this.offset.x|0,c.bottom/d-this.offset.y|0,(c.right-this.featureDx)/d-this.offset.x|0,c.top/d-this.offset.y|0);a.style.left=c.left+"px",a.style.top=c.top+"px",a.style.width=c.getWidth()+"px",a.style.height=c.getHeight()+"px",a.coordorigin=c.left+" "+c.top,a.coordsize=c.getWidth()+" "+c.getHeight()}},dashStyle:function(a){switch(a=a.strokeDashstyle){case"solid":case"dot":case"dash":case"dashdot":case"longdash":case"longdashdot":return a;default:return a=a.split(/[ ,]/),2==a.length?1*a[0]>=2*a[1]?"longdash":1==a[0]||1==a[1]?"dot":"dash":4==a.length?1*a[0]>=2*a[1]?"longdashdot":"dashdot":"solid"}},createNode:function(a,b){var c=document.createElement(a);return b&&(c.id=b),c.unselectable="on",c.onselectstart=OpenLayers.Function.False,c},nodeTypeCompare:function(a,b){var c=b,d=c.indexOf(":");-1!=d&&(c=c.substr(d+1));var e=a.nodeName,d=e.indexOf(":");return-1!=d&&(e=e.substr(d+1)),c==e},createRenderRoot:function(){return this.nodeFactory(this.container.id+"_vmlRoot","div")},createRoot:function(a){return this.nodeFactory(this.container.id+a,"olv:group")},drawPoint:function(a,b){return this.drawCircle(a,b,1)},drawCircle:function(a,b,c){if(!isNaN(b.x)&&!isNaN(b.y)){var d=this.getResolution();return a.style.left=((b.x-this.featureDx)/d-this.offset.x|0)-c+"px",a.style.top=(b.y/d-this.offset.y|0)-c+"px",b=2*c,a.style.width=b+"px",a.style.height=b+"px",a}return!1},drawLineString:function(a,b){return this.drawLine(a,b,!1)},drawLinearRing:function(a,b){return this.drawLine(a,b,!0)},drawLine:function(a,b,c){this.setNodeDimension(a,b);for(var d,e,f=this.getResolution(),g=b.components.length,h=Array(g),i=0;g>i;i++)d=b.components[i],e=(d.x-this.featureDx)/f-this.offset.x|0,d=d.y/f-this.offset.y|0,h[i]=" "+e+","+d+" l ";return a.path="m"+h.join("")+(c?" x e":" e"),a},drawPolygon:function(a,b){this.setNodeDimension(a,b);var c,d,e,f,g,h,i,j,k,l,m=this.getResolution(),n=[];for(c=0,d=b.components.length;d>c;c++){for(n.push("m"),e=b.components[c].components,f=0===c,h=g=null,i=0,j=e.length;j>i;i++)k=e[i],l=(k.x-this.featureDx)/m-this.offset.x|0,k=k.y/m-this.offset.y|0,l=" "+l+","+k,n.push(l),0==i&&n.push(" l"),f||(g?g!=l&&(h?h!=l&&(f=!0):h=l):g=l);n.push(f?" x ":" ")}return n.push("e"),a.path=n.join(""),a},drawRectangle:function(a,b){var c=this.getResolution();return a.style.left=((b.x-this.featureDx)/c-this.offset.x|0)+"px",a.style.top=(b.y/c-this.offset.y|0)+"px",a.style.width=(b.width/c|0)+"px",a.style.height=(b.height/c|0)+"px",a},drawText:function(a,b,c){var d=this.nodeFactory(a+this.LABEL_ID_SUFFIX,"olv:rect"),e=this.nodeFactory(a+this.LABEL_ID_SUFFIX+"_textbox","olv:textbox"),f=this.getResolution();d.style.left=((c.x-this.featureDx)/f-this.offset.x|0)+"px",d.style.top=(c.y/f-this.offset.y|0)+"px",d.style.flip="y",e.innerText=b.label,"inherit"!=b.cursor&&null!=b.cursor&&(e.style.cursor=b.cursor),b.fontColor&&(e.style.color=b.fontColor),b.fontOpacity&&(e.style.filter="alpha(opacity="+100*b.fontOpacity+")"),b.fontFamily&&(e.style.fontFamily=b.fontFamily),b.fontSize&&(e.style.fontSize=b.fontSize),b.fontWeight&&(e.style.fontWeight=b.fontWeight),b.fontStyle&&(e.style.fontStyle=b.fontStyle),!0===b.labelSelect&&(d._featureId=a,e._featureId=a,e._geometry=c,e._geometryClass=c.CLASS_NAME),e.style.whiteSpace="nowrap",e.inset="1px,0px,0px,0px",d.parentNode||(d.appendChild(e),this.textRoot.appendChild(d)),b=b.labelAlign||"cm",1==b.length&&(b+="m"),a=e.clientWidth*OpenLayers.Renderer.VML.LABEL_SHIFT[b.substr(0,1)],e=e.clientHeight*OpenLayers.Renderer.VML.LABEL_SHIFT[b.substr(1,1)],d.style.left=parseInt(d.style.left)-a-1+"px",d.style.top=parseInt(d.style.top)+e+"px"},moveRoot:function(a){var b=this.map.getLayer(a.container.id);b instanceof OpenLayers.Layer.Vector.RootContainer&&(b=this.map.getLayer(this.container.id)),b&&b.renderer.clear(),OpenLayers.Renderer.Elements.prototype.moveRoot.apply(this,arguments),b&&b.redraw()},importSymbol:function(a){var b=this.container.id+"-"+a,c=this.symbolCache[b];if(c)return c;if(c=OpenLayers.Renderer.symbol[a],!c)throw Error(a+" is not a valid symbol name");for(var a=new OpenLayers.Bounds(Number.MAX_VALUE,Number.MAX_VALUE,0,0),d=["m"],e=0;e<c.length;e+=2){var f=c[e],g=c[e+1];a.left=Math.min(a.left,f),a.bottom=Math.min(a.bottom,g),a.right=Math.max(a.right,f),a.top=Math.max(a.top,g),d.push(f),d.push(g),0==e&&d.push("l")}return d.push("x e"),c=d.join(" "),d=(a.getWidth()-a.getHeight())/2,d>0?(a.bottom-=d,a.top+=d):(a.left+=d,a.right-=d),c={path:c,size:a.getWidth(),left:a.left,bottom:a.bottom},this.symbolCache[b]=c},CLASS_NAME:"OpenLayers.Renderer.VML"}),OpenLayers.Renderer.VML.LABEL_SHIFT={l:0,c:.5,r:1,t:0,m:.5,b:1},OpenLayers.Control.CacheRead=OpenLayers.Class(OpenLayers.Control,{fetchEvent:"tileloadstart",layers:null,autoActivate:!0,setMap:function(a){OpenLayers.Control.prototype.setMap.apply(this,arguments);var b,c=this.layers||a.layers;for(b=c.length-1;b>=0;--b)this.addLayer({layer:c[b]});this.layers||a.events.on({addlayer:this.addLayer,removeLayer:this.removeLayer,scope:this})},addLayer:function(a){a.layer.events.register(this.fetchEvent,this,this.fetch)},removeLayer:function(a){a.layer.events.unregister(this.fetchEvent,this,this.fetch)},fetch:function(a){if(this.active&&window.localStorage&&a.tile instanceof OpenLayers.Tile.Image){var b=a.tile,c=b.url;!b.layer.crossOriginKeyword&&OpenLayers.ProxyHost&&0===c.indexOf(OpenLayers.ProxyHost)&&(c=OpenLayers.Control.CacheWrite.urlMap[c]),(c=window.localStorage.getItem("olCache_"+c))&&(b.url=c,"tileerror"===a.type&&b.setImgSrc(c))}},destroy:function(){if(this.layers||this.map){var a,b=this.layers||this.map.layers;for(a=b.length-1;a>=0;--a)this.removeLayer({layer:b[a]})}this.map&&this.map.events.un({addlayer:this.addLayer,removeLayer:this.removeLayer,scope:this}),OpenLayers.Control.prototype.destroy.apply(this,arguments)},CLASS_NAME:"OpenLayers.Control.CacheRead"}),OpenLayers.Protocol.WFS.v1_0_0=OpenLayers.Class(OpenLayers.Protocol.WFS.v1,{version:"1.0.0",CLASS_NAME:"OpenLayers.Protocol.WFS.v1_0_0"}),OpenLayers.Format.WMSGetFeatureInfo=OpenLayers.Class(OpenLayers.Format.XML,{layerIdentifier:"_layer",featureIdentifier:"_feature",regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},gmlFormat:null,read:function(a){"string"==typeof a&&(a=OpenLayers.Format.XML.prototype.read.apply(this,[a]));var b=a.documentElement;if(b)var c=this["read_"+b.nodeName],a=c?c.call(this,b):new OpenLayers.Format.GML(this.options?this.options:{}).read(a);return a},read_msGMLOutput:function(a){var b=[];if(a=this.getSiblingNodesByTagCriteria(a,this.layerIdentifier))for(var c=0,d=a.length;d>c;++c){var e=a[c],f=e.nodeName;if(e.prefix&&(f=f.split(":")[1]),f=f.replace(this.layerIdentifier,""),e=this.getSiblingNodesByTagCriteria(e,this.featureIdentifier))for(var g=0;g<e.length;g++){var h=e[g],i=this.parseGeometry(h),h=this.parseAttributes(h),h=new OpenLayers.Feature.Vector(i.geometry,h,null);
h.bounds=i.bounds,h.type=f,b.push(h)}}return b},read_FeatureInfoResponse:function(a){for(var b=[],a=this.getElementsByTagNameNS(a,"*","FIELDS"),c=0,d=a.length;d>c;c++){var e,f=a[c],g={},h=f.attributes.length;if(h>0)for(e=0;h>e;e++){var i=f.attributes[e];g[i.nodeName]=i.nodeValue}else for(f=f.childNodes,e=0,h=f.length;h>e;++e)i=f[e],3!=i.nodeType&&(g[i.getAttribute("name")]=i.getAttribute("value"));b.push(new OpenLayers.Feature.Vector(null,g,null))}return b},getSiblingNodesByTagCriteria:function(a,b){var c,d,e,f,g=[];if(a&&a.hasChildNodes()){c=a.childNodes,e=c.length;for(var h=0;e>h;h++){for(f=c[h];f&&1!=f.nodeType;)f=f.nextSibling,h++;d=f?f.nodeName:"",0<d.length&&-1<d.indexOf(b)?g.push(f):(d=this.getSiblingNodesByTagCriteria(f,b),0<d.length&&(0==g.length?g=d:g.push(d)))}}return g},parseAttributes:function(a){var b={};if(1==a.nodeType)for(var a=a.childNodes,c=a.length,d=0;c>d;++d){var e=a[d];if(1==e.nodeType){var f=e.childNodes,e=e.prefix?e.nodeName.split(":")[1]:e.nodeName;0==f.length?b[e]=null:1==f.length&&(f=f[0],3==f.nodeType||4==f.nodeType)&&(f=f.nodeValue.replace(this.regExes.trimSpace,""),b[e]=f)}}return b},parseGeometry:function(a){this.gmlFormat||(this.gmlFormat=new OpenLayers.Format.GML);var b,a=this.gmlFormat.parseFeature(a),c=null;return a&&(b=a.geometry&&a.geometry.clone(),c=a.bounds&&a.bounds.clone(),a.destroy()),{geometry:b,bounds:c}},CLASS_NAME:"OpenLayers.Format.WMSGetFeatureInfo"}),OpenLayers.Control.WMTSGetFeatureInfo=OpenLayers.Class(OpenLayers.Control,{hover:!1,requestEncoding:"KVP",drillDown:!1,maxFeatures:10,clickCallback:"click",layers:null,queryVisible:!0,infoFormat:"text/html",vendorParams:{},format:null,formatOptions:null,handlerOptions:null,handler:null,hoverRequest:null,pending:0,initialize:function(a){a=a||{},a.handlerOptions=a.handlerOptions||{},OpenLayers.Control.prototype.initialize.apply(this,[a]),this.format||(this.format=new OpenLayers.Format.WMSGetFeatureInfo(a.formatOptions)),!0===this.drillDown&&(this.hover=!1),this.hover?this.handler=new OpenLayers.Handler.Hover(this,{move:this.cancelHover,pause:this.getInfoForHover},OpenLayers.Util.extend(this.handlerOptions.hover||{},{delay:250})):(a={},a[this.clickCallback]=this.getInfoForClick,this.handler=new OpenLayers.Handler.Click(this,a,this.handlerOptions.click||{}))},getInfoForClick:function(a){this.request(a.xy,{})},getInfoForHover:function(a){this.request(a.xy,{hover:!0})},cancelHover:function(){this.hoverRequest&&(--this.pending,0>=this.pending&&(OpenLayers.Element.removeClass(this.map.viewPortDiv,"olCursorWait"),this.pending=0),this.hoverRequest.abort(),this.hoverRequest=null)},findLayers:function(){for(var a,b=this.layers||this.map.layers,c=[],d=b.length-1;d>=0&&(a=b[d],!(a instanceof OpenLayers.Layer.WMTS&&a.requestEncoding===this.requestEncoding)||this.queryVisible&&!a.getVisibility()||(c.push(a),this.drillDown&&!this.hover));--d);return c},buildRequestOptions:function(a,b){var c=this.map.getLonLatFromPixel(b),d=a.getURL(new OpenLayers.Bounds(c.lon,c.lat,c.lon,c.lat)),d=OpenLayers.Util.getParameters(d),c=a.getTileInfo(c);return OpenLayers.Util.extend(d,{service:"WMTS",version:a.version,request:"GetFeatureInfo",infoFormat:this.infoFormat,i:c.i,j:c.j}),OpenLayers.Util.applyDefaults(d,this.vendorParams),{url:OpenLayers.Util.isArray(a.url)?a.url[0]:a.url,params:OpenLayers.Util.upperCaseObject(d),callback:function(c){this.handleResponse(b,c,a)},scope:this}},request:function(a,b){var b=b||{},c=this.findLayers();if(0<c.length){for(var d,e,f=0,g=c.length;g>f;f++)e=c[f],d=this.events.triggerEvent("beforegetfeatureinfo",{xy:a,layer:e}),!1!==d&&(++this.pending,d=this.buildRequestOptions(e,a),d=OpenLayers.Request.GET(d),!0===b.hover&&(this.hoverRequest=d));0<this.pending&&OpenLayers.Element.addClass(this.map.viewPortDiv,"olCursorWait")}},handleResponse:function(a,b,c){if(--this.pending,0>=this.pending&&(OpenLayers.Element.removeClass(this.map.viewPortDiv,"olCursorWait"),this.pending=0),b.status&&(200>b.status||300<=b.status))this.events.triggerEvent("exception",{xy:a,request:b,layer:c});else{var d=b.responseXML;d&&d.documentElement||(d=b.responseText);var e,f;try{e=this.format.read(d)}catch(g){f=!0,this.events.triggerEvent("exception",{xy:a,request:b,error:g,layer:c})}f||this.events.triggerEvent("getfeatureinfo",{text:b.responseText,features:e,request:b,xy:a,layer:c})}},CLASS_NAME:"OpenLayers.Control.WMTSGetFeatureInfo"}),OpenLayers.Strategy.Paging=OpenLayers.Class(OpenLayers.Strategy,{features:null,length:10,num:null,paging:!1,activate:function(){var a=OpenLayers.Strategy.prototype.activate.call(this);return a&&this.layer.events.on({beforefeaturesadded:this.cacheFeatures,scope:this}),a},deactivate:function(){var a=OpenLayers.Strategy.prototype.deactivate.call(this);return a&&(this.clearCache(),this.layer.events.un({beforefeaturesadded:this.cacheFeatures,scope:this})),a},cacheFeatures:function(a){this.paging||(this.clearCache(),this.features=a.features,this.pageNext(a))},clearCache:function(){if(this.features)for(var a=0;a<this.features.length;++a)this.features[a].destroy();this.num=this.features=null},pageCount:function(){return Math.ceil((this.features?this.features.length:0)/this.length)},pageNum:function(){return this.num},pageLength:function(a){return a&&a>0&&(this.length=a),this.length},pageNext:function(a){var b=!1;return this.features&&(null===this.num&&(this.num=-1),b=this.page((this.num+1)*this.length,a)),b},pagePrevious:function(){var a=!1;return this.features&&(null===this.num&&(this.num=this.pageCount()),a=this.page((this.num-1)*this.length)),a},page:function(a,b){var c=!1;if(this.features&&a>=0&&a<this.features.length){var d=Math.floor(a/this.length);d!=this.num&&(this.paging=!0,c=this.features.slice(a,a+this.length),this.layer.removeFeatures(this.layer.features),this.num=d,b&&b.features?b.features=c:this.layer.addFeatures(c),this.paging=!1,c=!0)}return c},CLASS_NAME:"OpenLayers.Strategy.Paging"}),OpenLayers.Protocol.CSW.v2_0_2=OpenLayers.Class(OpenLayers.Protocol,{formatOptions:null,initialize:function(a){OpenLayers.Protocol.prototype.initialize.apply(this,[a]),a.format||(this.format=new OpenLayers.Format.CSWGetRecords.v2_0_2(OpenLayers.Util.extend({},this.formatOptions)))},destroy:function(){this.options&&!this.options.format&&this.format.destroy(),this.format=null,OpenLayers.Protocol.prototype.destroy.apply(this)},read:function(a){a=OpenLayers.Util.extend({},a),OpenLayers.Util.applyDefaults(a,this.options||{});var b=new OpenLayers.Protocol.Response({requestType:"read"}),c=this.format.write(a.params);return b.priv=OpenLayers.Request.POST({url:a.url,callback:this.createCallback(this.handleRead,b,a),params:a.params,headers:a.headers,data:c}),b},handleRead:function(a,b){if(b.callback){var c=a.priv;200<=c.status&&300>c.status?(a.data=this.parseData(c),a.code=OpenLayers.Protocol.Response.SUCCESS):a.code=OpenLayers.Protocol.Response.FAILURE,b.callback.call(b.scope,a)}},parseData:function(a){var b=a.responseXML;return b&&b.documentElement||(b=a.responseText),!b||0>=b.length?null:this.format.read(b)},CLASS_NAME:"OpenLayers.Protocol.CSW.v2_0_2"}),OpenLayers.Format.WMSCapabilities.v1_1=OpenLayers.Class(OpenLayers.Format.WMSCapabilities.v1,{readers:{wms:OpenLayers.Util.applyDefaults({WMT_MS_Capabilities:function(a,b){this.readChildNodes(a,b)},Keyword:function(a,b){b.keywords&&b.keywords.push(this.getChildValue(a))},DescribeLayer:function(a,b){b.describelayer={formats:[]},this.readChildNodes(a,b.describelayer)},GetLegendGraphic:function(a,b){b.getlegendgraphic={formats:[]},this.readChildNodes(a,b.getlegendgraphic)},GetStyles:function(a,b){b.getstyles={formats:[]},this.readChildNodes(a,b.getstyles)},PutStyles:function(a,b){b.putstyles={formats:[]},this.readChildNodes(a,b.putstyles)},UserDefinedSymbolization:function(a,b){var c={supportSLD:1==parseInt(a.getAttribute("SupportSLD")),userLayer:1==parseInt(a.getAttribute("UserLayer")),userStyle:1==parseInt(a.getAttribute("UserStyle")),remoteWFS:1==parseInt(a.getAttribute("RemoteWFS"))};b.userSymbols=c},LatLonBoundingBox:function(a,b){b.llbbox=[parseFloat(a.getAttribute("minx")),parseFloat(a.getAttribute("miny")),parseFloat(a.getAttribute("maxx")),parseFloat(a.getAttribute("maxy"))]},BoundingBox:function(a,b){var c=OpenLayers.Format.WMSCapabilities.v1.prototype.readers.wms.BoundingBox.apply(this,[a,b]);c.srs=a.getAttribute("SRS"),b.bbox[c.srs]=c},ScaleHint:function(a,b){var c=a.getAttribute("min"),d=a.getAttribute("max"),e=Math.pow(2,.5),f=OpenLayers.INCHES_PER_UNIT.m;b.maxScale=parseFloat((c/e*f*OpenLayers.DOTS_PER_INCH).toPrecision(13)),b.minScale=parseFloat((d/e*f*OpenLayers.DOTS_PER_INCH).toPrecision(13))},Dimension:function(a,b){var c={name:a.getAttribute("name").toLowerCase(),units:a.getAttribute("units"),unitsymbol:a.getAttribute("unitSymbol")};b.dimensions[c.name]=c},Extent:function(a,b){var c=a.getAttribute("name").toLowerCase();if(c in b.dimensions){c=b.dimensions[c],c.nearestVal="1"===a.getAttribute("nearestValue"),c.multipleVal="1"===a.getAttribute("multipleValues"),c.current="1"===a.getAttribute("current"),c["default"]=a.getAttribute("default")||"";var d=this.getChildValue(a);c.values=d.split(",")}}},OpenLayers.Format.WMSCapabilities.v1.prototype.readers.wms)},CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1_1"}),OpenLayers.Control.Graticule=OpenLayers.Class(OpenLayers.Control,{autoActivate:!0,intervals:[45,30,20,10,5,2,1,.5,.2,.1,.05,.01,.005,.002,.001],displayInLayerSwitcher:!0,visible:!0,numPoints:50,targetSize:200,layerName:null,labelled:!0,labelFormat:"dm",lineSymbolizer:{strokeColor:"#333",strokeWidth:1,strokeOpacity:.5},labelSymbolizer:{},gratLayer:null,initialize:function(a){a=a||{},a.layerName=a.layerName||OpenLayers.i18n("Graticule"),OpenLayers.Control.prototype.initialize.apply(this,[a]),this.labelSymbolizer.stroke=!1,this.labelSymbolizer.fill=!1,this.labelSymbolizer.label="${label}",this.labelSymbolizer.labelAlign="${labelAlign}",this.labelSymbolizer.labelXOffset="${xOffset}",this.labelSymbolizer.labelYOffset="${yOffset}"},destroy:function(){this.deactivate(),OpenLayers.Control.prototype.destroy.apply(this,arguments),this.gratLayer&&(this.gratLayer.destroy(),this.gratLayer=null)},draw:function(){if(OpenLayers.Control.prototype.draw.apply(this,arguments),!this.gratLayer){var a=new OpenLayers.Style({},{rules:[new OpenLayers.Rule({symbolizer:{Point:this.labelSymbolizer,Line:this.lineSymbolizer}})]});this.gratLayer=new OpenLayers.Layer.Vector(this.layerName,{styleMap:new OpenLayers.StyleMap({"default":a}),visibility:this.visible,displayInLayerSwitcher:this.displayInLayerSwitcher})}return this.div},activate:function(){return OpenLayers.Control.prototype.activate.apply(this,arguments)?(this.map.addLayer(this.gratLayer),this.map.events.register("moveend",this,this.update),this.update(),!0):!1},deactivate:function(){return OpenLayers.Control.prototype.deactivate.apply(this,arguments)?(this.map.events.unregister("moveend",this,this.update),this.map.removeLayer(this.gratLayer),!0):!1},update:function(){var a=this.map.getExtent();if(a){this.gratLayer.destroyFeatures();var b=new OpenLayers.Projection("EPSG:4326"),c=this.map.getProjectionObject(),d=this.map.getResolution();c.proj&&"longlat"==c.proj.projName&&(this.numPoints=1);var e=this.map.getCenter(),f=new OpenLayers.Pixel(e.lon,e.lat);OpenLayers.Projection.transform(f,c,b);for(var g,e=this.targetSize*d,e=e*e,d=0;d<this.intervals.length;++d){g=this.intervals[d];var h=g/2,i=f.offset({x:-h,y:-h}),h=f.offset({x:h,y:h});if(OpenLayers.Projection.transform(i,b,c),OpenLayers.Projection.transform(h,b,c),(i.x-h.x)*(i.x-h.x)+(i.y-h.y)*(i.y-h.y)<=e)break}f.x=Math.floor(f.x/g)*g,f.y=Math.floor(f.y/g)*g;var j,d=0,e=[f.clone()],h=f.clone();do h=h.offset({x:0,y:g}),j=OpenLayers.Projection.transform(h.clone(),b,c),e.unshift(h);while(a.containsPixel(j)&&1e3>++d);h=f.clone();do h=h.offset({x:0,y:-g}),j=OpenLayers.Projection.transform(h.clone(),b,c),e.push(h);while(a.containsPixel(j)&&1e3>++d);d=0,i=[f.clone()],h=f.clone();do h=h.offset({x:-g,y:0}),j=OpenLayers.Projection.transform(h.clone(),b,c),i.unshift(h);while(a.containsPixel(j)&&1e3>++d);h=f.clone();do h=h.offset({x:g,y:0}),j=OpenLayers.Projection.transform(h.clone(),b,c),i.push(h);while(a.containsPixel(j)&&1e3>++d);for(g=[],d=0;d<i.length;++d){j=i[d].x;for(var f=[],k=null,l=Math.min(e[0].y,90),h=Math.max(e[e.length-1].y,-90),m=(l-h)/this.numPoints,l=h,h=0;h<=this.numPoints;++h){var n=new OpenLayers.Geometry.Point(j,l);n.transform(b,c),f.push(n),l+=m,n.y>=a.bottom&&!k&&(k=n)}this.labelled&&(k=new OpenLayers.Geometry.Point(k.x,a.bottom),j={value:j,label:this.labelled?OpenLayers.Util.getFormattedLonLat(j,"lon",this.labelFormat):"",labelAlign:"cb",xOffset:0,yOffset:2},this.gratLayer.addFeatures(new OpenLayers.Feature.Vector(k,j))),f=new OpenLayers.Geometry.LineString(f),g.push(new OpenLayers.Feature.Vector(f))}for(h=0;h<e.length;++h)if(l=e[h].y,!(-90>l||l>90)){for(f=[],d=i[0].x,m=(i[i.length-1].x-d)/this.numPoints,j=d,k=null,d=0;d<=this.numPoints;++d)n=new OpenLayers.Geometry.Point(j,l),n.transform(b,c),f.push(n),j+=m,n.x<a.right&&(k=n);this.labelled&&(k=new OpenLayers.Geometry.Point(a.right,k.y),j={value:l,label:this.labelled?OpenLayers.Util.getFormattedLonLat(l,"lat",this.labelFormat):"",labelAlign:"rb",xOffset:-2,yOffset:2},this.gratLayer.addFeatures(new OpenLayers.Feature.Vector(k,j))),f=new OpenLayers.Geometry.LineString(f),g.push(new OpenLayers.Feature.Vector(f))}this.gratLayer.addFeatures(g)}},CLASS_NAME:"OpenLayers.Control.Graticule"}),OpenLayers.Layer.UTFGrid=OpenLayers.Class(OpenLayers.Layer.XYZ,{isBaseLayer:!1,projection:new OpenLayers.Projection("EPSG:900913"),useJSONP:!1,tileClass:OpenLayers.Tile.UTFGrid,initialize:function(a){OpenLayers.Layer.Grid.prototype.initialize.apply(this,[a.name,a.url,{},a]),this.tileOptions=OpenLayers.Util.extend({utfgridResolution:this.utfgridResolution},this.tileOptions)},clone:function(a){return null==a&&(a=new OpenLayers.Layer.UTFGrid(this.getOptions())),a=OpenLayers.Layer.Grid.prototype.clone.apply(this,[a])},getFeatureInfo:function(a){var b=null,a=this.getTileData(a);return a.tile&&(b=a.tile.getFeatureInfo(a.i,a.j)),b},getFeatureId:function(a){var b=null,a=this.getTileData(a);return a.tile&&(b=a.tile.getFeatureId(a.i,a.j)),b},CLASS_NAME:"OpenLayers.Layer.UTFGrid"}),OpenLayers.Layer.ArcGISCache=OpenLayers.Class(OpenLayers.Layer.XYZ,{url:null,tileOrigin:null,tileSize:new OpenLayers.Size(256,256),useArcGISServer:!0,type:"png",useScales:!1,overrideDPI:!1,initialize:function(){if(OpenLayers.Layer.XYZ.prototype.initialize.apply(this,arguments),this.resolutions&&(this.serverResolutions=this.resolutions,this.maxExtent=this.getMaxExtentForResolution(this.resolutions[0])),this.layerInfo){var a=this.layerInfo,b=new OpenLayers.Bounds(a.fullExtent.xmin,a.fullExtent.ymin,a.fullExtent.xmax,a.fullExtent.ymax);if(this.projection="EPSG:"+a.spatialReference.wkid,this.sphericalMercator=102100==a.spatialReference.wkid,this.units="esriFeet"==a.units?"ft":"m",a.tileInfo){this.tileSize=new OpenLayers.Size(a.tileInfo.width||a.tileInfo.cols,a.tileInfo.height||a.tileInfo.rows),this.tileOrigin=new OpenLayers.LonLat(a.tileInfo.origin.x,a.tileInfo.origin.y);var c=new OpenLayers.Geometry.Point(b.left,b.top),b=new OpenLayers.Geometry.Point(b.right,b.bottom);this.useScales?this.scales=[]:this.resolutions=[],this.lods=[];for(var d in a.tileInfo.lods)if(a.tileInfo.lods.hasOwnProperty(d)){var e=a.tileInfo.lods[d];this.useScales?this.scales.push(e.scale):this.resolutions.push(e.resolution);var f=this.getContainingTileCoords(c,e.resolution);e.startTileCol=f.x,e.startTileRow=f.y,f=this.getContainingTileCoords(b,e.resolution),e.endTileCol=f.x,e.endTileRow=f.y,this.lods.push(e)}this.maxExtent=this.calculateMaxExtentWithLOD(this.lods[0]),this.serverResolutions=this.resolutions,this.overrideDPI&&a.tileInfo.dpi&&(OpenLayers.DOTS_PER_INCH=a.tileInfo.dpi)}}},getContainingTileCoords:function(a,b){return new OpenLayers.Pixel(Math.max(Math.floor((a.x-this.tileOrigin.lon)/(this.tileSize.w*b)),0),Math.max(Math.floor((this.tileOrigin.lat-a.y)/(this.tileSize.h*b)),0))},calculateMaxExtentWithLOD:function(a){var b=this.tileOrigin.lon+a.startTileCol*this.tileSize.w*a.resolution,c=this.tileOrigin.lat-a.startTileRow*this.tileSize.h*a.resolution;return new OpenLayers.Bounds(b,c-(a.endTileRow-a.startTileRow+1)*this.tileSize.h*a.resolution,b+(a.endTileCol-a.startTileCol+1)*this.tileSize.w*a.resolution,c)},calculateMaxExtentWithExtent:function(a,b){var c=new OpenLayers.Geometry.Point(a.left,a.top),d=new OpenLayers.Geometry.Point(a.right,a.bottom),c=this.getContainingTileCoords(c,b),d=this.getContainingTileCoords(d,b);return this.calculateMaxExtentWithLOD({resolution:b,startTileCol:c.x,startTileRow:c.y,endTileCol:d.x,endTileRow:d.y})},getUpperLeftTileCoord:function(a){return this.getContainingTileCoords(new OpenLayers.Geometry.Point(this.maxExtent.left,this.maxExtent.top),a)},getLowerRightTileCoord:function(a){return this.getContainingTileCoords(new OpenLayers.Geometry.Point(this.maxExtent.right,this.maxExtent.bottom),a)},getMaxExtentForResolution:function(a){var b=this.getUpperLeftTileCoord(a),c=this.getLowerRightTileCoord(a),d=this.tileOrigin.lon+b.x*this.tileSize.w*a,e=this.tileOrigin.lat-b.y*this.tileSize.h*a;return new OpenLayers.Bounds(d,e-(c.y-b.y+1)*this.tileSize.h*a,d+(c.x-b.x+1)*this.tileSize.w*a,e)},clone:function(a){return null==a&&(a=new OpenLayers.Layer.ArcGISCache(this.name,this.url,this.options)),OpenLayers.Layer.XYZ.prototype.clone.apply(this,[a])},getMaxExtent:function(){return this.maxExtent=this.getMaxExtentForResolution(this.map.getResolution())},getTileOrigin:function(){var a=this.getMaxExtent();return new OpenLayers.LonLat(a.left,a.bottom)},getURL:function(a){var b=this.getResolution(),c=this.tileOrigin.lon+b*this.tileSize.w/2,d=this.tileOrigin.lat-b*this.tileSize.h/2,a=a.getCenterLonLat(),c=Math.round(Math.abs((a.lon-c)/(b*this.tileSize.w))),d=Math.round(Math.abs((d-a.lat)/(b*this.tileSize.h))),a=this.map.getZoom();if(this.lods){if(b=this.lods[this.map.getZoom()],c<b.startTileCol||c>b.endTileCol||d<b.startTileRow||d>b.endTileRow)return null}else{var e=this.getUpperLeftTileCoord(b),b=this.getLowerRightTileCoord(b);if(c<e.x||c>=b.x||d<e.y||d>=b.y)return null}return b=this.url,e=""+c+d+a,OpenLayers.Util.isArray(b)&&(b=this.selectUrl(e,b)),this.useArcGISServer?b+="/tile/${z}/${y}/${x}":(c="C"+this.zeroPad(c,8,16),d="R"+this.zeroPad(d,8,16),a="L"+this.zeroPad(a,2,16),b=b+"/${z}/${y}/${x}."+this.type),b=OpenLayers.String.format(b,{x:c,y:d,z:a}),OpenLayers.Util.urlAppend(b,OpenLayers.Util.getParameterString(this.params))},zeroPad:function(a,b,c){for(a=a.toString(c||10);a.length<b;)a="0"+a;return a},CLASS_NAME:"OpenLayers.Layer.ArcGISCache"}),OpenLayers.Control.WMSGetFeatureInfo=OpenLayers.Class(OpenLayers.Control,{hover:!1,drillDown:!1,maxFeatures:10,clickCallback:"click",output:"features",layers:null,queryVisible:!1,url:null,layerUrls:null,infoFormat:"text/html",vendorParams:{},format:null,formatOptions:null,handlerOptions:null,handler:null,hoverRequest:null,initialize:function(a){a=a||{},a.handlerOptions=a.handlerOptions||{},OpenLayers.Control.prototype.initialize.apply(this,[a]),this.format||(this.format=new OpenLayers.Format.WMSGetFeatureInfo(a.formatOptions)),!0===this.drillDown&&(this.hover=!1),this.hover?this.handler=new OpenLayers.Handler.Hover(this,{move:this.cancelHover,pause:this.getInfoForHover},OpenLayers.Util.extend(this.handlerOptions.hover||{},{delay:250})):(a={},a[this.clickCallback]=this.getInfoForClick,this.handler=new OpenLayers.Handler.Click(this,a,this.handlerOptions.click||{}))},getInfoForClick:function(a){this.events.triggerEvent("beforegetfeatureinfo",{xy:a.xy}),OpenLayers.Element.addClass(this.map.viewPortDiv,"olCursorWait"),this.request(a.xy,{})},getInfoForHover:function(a){this.events.triggerEvent("beforegetfeatureinfo",{xy:a.xy}),this.request(a.xy,{hover:!0})},cancelHover:function(){this.hoverRequest&&(this.hoverRequest.abort(),this.hoverRequest=null)},findLayers:function(){for(var a,b,c=this.layers||this.map.layers,d=[],e=c.length-1;e>=0;--e)a=c[e],a instanceof OpenLayers.Layer.WMS&&(!this.queryVisible||a.getVisibility())&&(b=OpenLayers.Util.isArray(a.url)?a.url[0]:a.url,!1===this.drillDown&&!this.url&&(this.url=b),(!0===this.drillDown||this.urlMatches(b))&&d.push(a));return d},urlMatches:function(a){var b=OpenLayers.Util.isEquivalentUrl(this.url,a);if(!b&&this.layerUrls)for(var c=0,d=this.layerUrls.length;d>c;++c)if(OpenLayers.Util.isEquivalentUrl(this.layerUrls[c],a)){b=!0;break}return b},buildWMSOptions:function(a,b,c,d){for(var e=[],f=[],g=0,h=b.length;h>g;g++)null!=b[g].params.LAYERS&&(e=e.concat(b[g].params.LAYERS),f=f.concat(this.getStyleNames(b[g])));return b=b[0],g=this.map.getProjection(),(h=b.projection)&&h.equals(this.map.getProjectionObject())&&(g=h.getCode()),d=OpenLayers.Util.extend({service:"WMS",version:b.params.VERSION,request:"GetFeatureInfo",exceptions:b.params.EXCEPTIONS,bbox:this.map.getExtent().toBBOX(null,b.reverseAxisOrder()),feature_count:this.maxFeatures,height:this.map.getSize().h,width:this.map.getSize().w,format:d,info_format:b.params.INFO_FORMAT||this.infoFormat},1.3<=parseFloat(b.params.VERSION)?{crs:g,i:parseInt(c.x),j:parseInt(c.y)}:{srs:g,x:parseInt(c.x),y:parseInt(c.y)}),0!=e.length&&(d=OpenLayers.Util.extend({layers:e,query_layers:e,styles:f},d)),OpenLayers.Util.applyDefaults(d,this.vendorParams),{url:a,params:OpenLayers.Util.upperCaseObject(d),callback:function(b){this.handleResponse(c,b,a)},scope:this}},getStyleNames:function(a){return a.params.STYLES?a.params.STYLES:OpenLayers.Util.isArray(a.params.LAYERS)?Array(a.params.LAYERS.length):a.params.LAYERS.replace(/[^,]/g,"")},request:function(a,b){var c=this.findLayers();if(0==c.length)this.events.triggerEvent("nogetfeatureinfo"),OpenLayers.Element.removeClass(this.map.viewPortDiv,"olCursorWait");else if(b=b||{},!1===this.drillDown){var c=this.buildWMSOptions(this.url,c,a,c[0].params.FORMAT),d=OpenLayers.Request.GET(c);!0===b.hover&&(this.hoverRequest=d)}else{this._numRequests=this._requestCount=0,this.features=[];for(var e,d={},f=0,g=c.length;g>f;f++){var h=c[f];e=OpenLayers.Util.isArray(h.url)?h.url[0]:h.url,e in d?d[e].push(h):(this._numRequests++,d[e]=[h])}for(e in d)c=d[e],c=this.buildWMSOptions(e,c,a,c[0].params.FORMAT),OpenLayers.Request.GET(c)}},triggerGetFeatureInfo:function(a,b,c){this.events.triggerEvent("getfeatureinfo",{text:a.responseText,features:c,request:a,xy:b}),OpenLayers.Element.removeClass(this.map.viewPortDiv,"olCursorWait")},handleResponse:function(a,b,c){var d=b.responseXML;d&&d.documentElement||(d=b.responseText),d=this.format.read(d),!1===this.drillDown?this.triggerGetFeatureInfo(b,a,d):(this._requestCount++,this._features=(this._features||[]).concat("object"===this.output?{url:c,features:d}:d),this._requestCount===this._numRequests&&(this.triggerGetFeatureInfo(b,a,this._features.concat()),delete this._features,delete this._requestCount,delete this._numRequests))},CLASS_NAME:"OpenLayers.Control.WMSGetFeatureInfo"}),OpenLayers.Format.WMSCapabilities.v1_3_0=OpenLayers.Class(OpenLayers.Format.WMSCapabilities.v1_3,{version:"1.3.0",CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1_3_0"}),OpenLayers.Format.SOSGetFeatureOfInterest=OpenLayers.Class(OpenLayers.Format.XML,{VERSION:"1.0.0",namespaces:{sos:"http://www.opengis.net/sos/1.0",gml:"http://www.opengis.net/gml",sa:"http://www.opengis.net/sampling/1.0",xsi:"http://www.w3.org/2001/XMLSchema-instance"},schemaLocation:"http://www.opengis.net/sos/1.0 http://schemas.opengis.net/sos/1.0.0/sosAll.xsd",defaultPrefix:"sos",regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},read:function(a){"string"==typeof a&&(a=OpenLayers.Format.XML.prototype.read.apply(this,[a])),a&&9==a.nodeType&&(a=a.documentElement);var b={features:[]};this.readNode(a,b);for(var a=[],c=0,d=b.features.length;d>c;c++){var e=b.features[c];this.internalProjection&&this.externalProjection&&e.components[0]&&e.components[0].transform(this.externalProjection,this.internalProjection),e=new OpenLayers.Feature.Vector(e.components[0],e.attributes),a.push(e)}return a},readers:{sa:{SamplingPoint:function(a,b){if(!b.attributes){var c={attributes:{}};b.features.push(c),b=c}b.attributes.id=this.getAttributeNS(a,this.namespaces.gml,"id"),this.readChildNodes(a,b)},position:function(a,b){this.readChildNodes(a,b)}},gml:OpenLayers.Util.applyDefaults({FeatureCollection:function(a,b){this.readChildNodes(a,b)},featureMember:function(a,b){var c={attributes:{}};b.features.push(c),this.readChildNodes(a,c)},name:function(a,b){b.attributes.name=this.getChildValue(a)},pos:function(a,b){this.externalProjection||(this.externalProjection=new OpenLayers.Projection(a.getAttribute("srsName"))),OpenLayers.Format.GML.v3.prototype.readers.gml.pos.apply(this,[a,b])}},OpenLayers.Format.GML.v3.prototype.readers.gml)},writers:{sos:{GetFeatureOfInterest:function(a){for(var b=this.createElementNSPlus("GetFeatureOfInterest",{attributes:{version:this.VERSION,service:"SOS","xsi:schemaLocation":this.schemaLocation}}),c=0,d=a.fois.length;d>c;c++)this.writeNode("FeatureOfInterestId",{foi:a.fois[c]},b);return b},FeatureOfInterestId:function(a){return this.createElementNSPlus("FeatureOfInterestId",{value:a.foi})}}},CLASS_NAME:"OpenLayers.Format.SOSGetFeatureOfInterest"}),OpenLayers.Format.SOSGetObservation=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{ows:"http://www.opengis.net/ows",gml:"http://www.opengis.net/gml",sos:"http://www.opengis.net/sos/1.0",ogc:"http://www.opengis.net/ogc",om:"http://www.opengis.net/om/1.0",sa:"http://www.opengis.net/sampling/1.0",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},VERSION:"1.0.0",schemaLocation:"http://www.opengis.net/sos/1.0 http://schemas.opengis.net/sos/1.0.0/sosGetObservation.xsd",defaultPrefix:"sos",read:function(a){"string"==typeof a&&(a=OpenLayers.Format.XML.prototype.read.apply(this,[a])),a&&9==a.nodeType&&(a=a.documentElement);var b={measurements:[],observations:[]};return this.readNode(a,b),b},write:function(a){return a=this.writeNode("sos:GetObservation",a),a.setAttribute("xmlns:om",this.namespaces.om),a.setAttribute("xmlns:ogc",this.namespaces.ogc),this.setAttributeNS(a,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation),OpenLayers.Format.XML.prototype.write.apply(this,[a])},readers:{om:{ObservationCollection:function(a,b){b.id=this.getAttributeNS(a,this.namespaces.gml,"id"),this.readChildNodes(a,b)},member:function(a,b){this.readChildNodes(a,b)},Measurement:function(a,b){var c={};b.measurements.push(c),this.readChildNodes(a,c)},Observation:function(a,b){var c={};b.observations.push(c),this.readChildNodes(a,c)},samplingTime:function(a,b){var c={};b.samplingTime=c,this.readChildNodes(a,c)},observedProperty:function(a,b){b.observedProperty=this.getAttributeNS(a,this.namespaces.xlink,"href"),this.readChildNodes(a,b)},procedure:function(a,b){b.procedure=this.getAttributeNS(a,this.namespaces.xlink,"href"),this.readChildNodes(a,b)},featureOfInterest:function(a,b){var c={features:[]};b.fois=[],b.fois.push(c),this.readChildNodes(a,c);for(var d=[],e=0,f=c.features.length;f>e;e++){var g=c.features[e];d.push(new OpenLayers.Feature.Vector(g.components[0],g.attributes))}c.features=d},result:function(a,b){var c={};b.result=c,""!==this.getChildValue(a)?(c.value=this.getChildValue(a),c.uom=a.getAttribute("uom")):this.readChildNodes(a,c)}},sa:OpenLayers.Format.SOSGetFeatureOfInterest.prototype.readers.sa,gml:OpenLayers.Util.applyDefaults({TimeInstant:function(a,b){var c={};b.timeInstant=c,this.readChildNodes(a,c)},timePosition:function(a,b){b.timePosition=this.getChildValue(a)}},OpenLayers.Format.SOSGetFeatureOfInterest.prototype.readers.gml)},writers:{sos:{GetObservation:function(a){var b=this.createElementNSPlus("GetObservation",{attributes:{version:this.VERSION,service:"SOS"}});this.writeNode("offering",a,b),a.eventTime&&this.writeNode("eventTime",a,b);for(var c in a.procedures)this.writeNode("procedure",a.procedures[c],b);for(var d in a.observedProperties)this.writeNode("observedProperty",a.observedProperties[d],b);return a.foi&&this.writeNode("featureOfInterest",a.foi,b),this.writeNode("responseFormat",a,b),a.resultModel&&this.writeNode("resultModel",a,b),a.responseMode&&this.writeNode("responseMode",a,b),b},featureOfInterest:function(a){var b=this.createElementNSPlus("featureOfInterest");return this.writeNode("ObjectID",a.objectId,b),b},ObjectID:function(a){return this.createElementNSPlus("ObjectID",{value:a})},responseFormat:function(a){return this.createElementNSPlus("responseFormat",{value:a.responseFormat})},procedure:function(a){return this.createElementNSPlus("procedure",{value:a})},offering:function(a){return this.createElementNSPlus("offering",{value:a.offering})},observedProperty:function(a){return this.createElementNSPlus("observedProperty",{value:a})},eventTime:function(a){var b=this.createElementNSPlus("eventTime");return"latest"===a.eventTime&&this.writeNode("ogc:TM_Equals",a,b),b},resultModel:function(a){return this.createElementNSPlus("resultModel",{value:a.resultModel})},responseMode:function(a){return this.createElementNSPlus("responseMode",{value:a.responseMode})}},ogc:{TM_Equals:function(a){var b=this.createElementNSPlus("ogc:TM_Equals");return this.writeNode("ogc:PropertyName",{property:"urn:ogc:data:time:iso8601"},b),"latest"===a.eventTime&&this.writeNode("gml:TimeInstant",{value:"latest"},b),b},PropertyName:function(a){return this.createElementNSPlus("ogc:PropertyName",{value:a.property})}},gml:{TimeInstant:function(a){var b=this.createElementNSPlus("gml:TimeInstant");return this.writeNode("gml:timePosition",a,b),b},timePosition:function(a){return this.createElementNSPlus("gml:timePosition",{value:a.value})}}},CLASS_NAME:"OpenLayers.Format.SOSGetObservation"}),OpenLayers.Control.UTFGrid=OpenLayers.Class(OpenLayers.Control,{autoActivate:!0,layers:null,defaultHandlerOptions:{delay:300,pixelTolerance:4,stopMove:!1,single:!0,"double":!1,stopSingle:!1,stopDouble:!1},handlerMode:"click",setHandler:function(a){this.handlerMode=a,this.resetHandler()},resetHandler:function(){return this.handler&&(this.handler.deactivate(),this.handler.destroy(),this.handler=null),"hover"==this.handlerMode?this.handler=new OpenLayers.Handler.Hover(this,{pause:this.handleEvent,move:this.reset},this.handlerOptions):"click"==this.handlerMode?this.handler=new OpenLayers.Handler.Click(this,{click:this.handleEvent},this.handlerOptions):"move"==this.handlerMode&&(this.handler=new OpenLayers.Handler.Hover(this,{pause:this.handleEvent,move:this.handleEvent},this.handlerOptions)),this.handler?!0:!1},initialize:function(a){a=a||{},a.handlerOptions=a.handlerOptions||this.defaultHandlerOptions,OpenLayers.Control.prototype.initialize.apply(this,[a]),this.resetHandler()},handleEvent:function(a){if(null==a)this.reset();else{var b=this.map.getLonLatFromPixel(a.xy);if(b){var c=this.findLayers();if(0<c.length){for(var d,e,f={},g=0,h=c.length;h>g;g++)d=c[g],e=OpenLayers.Util.indexOf(this.map.layers,d),f[e]=d.getFeatureInfo(b);this.callback(f,b,a.xy)}}}},callback:function(){},reset:function(){this.callback(null)},findLayers:function(){for(var a,b=this.layers||this.map.layers,c=[],d=b.length-1;d>=0;--d)a=b[d],a instanceof OpenLayers.Layer.UTFGrid&&c.push(a);return c},CLASS_NAME:"OpenLayers.Control.UTFGrid"}),OpenLayers.Format.CQL=function(){function a(a){function b(){var a=d.pop();switch(a.type){case"LOGICAL":var c=b(),f=b();return new OpenLayers.Filter.Logical({filters:[f,c],type:g[a.text.toUpperCase()]});case"NOT":return c=b(),new OpenLayers.Filter.Logical({filters:[c],type:OpenLayers.Filter.Logical.NOT});case"BETWEEN":return d.pop(),f=b(),a=b(),c=b(),new OpenLayers.Filter.Comparison({property:c,lowerBoundary:a,upperBoundary:f,type:OpenLayers.Filter.Comparison.BETWEEN});case"COMPARISON":return f=b(),c=b(),new OpenLayers.Filter.Comparison({property:c,value:f,type:e[a.text.toUpperCase()]});case"VALUE":return/^'.*'$/.test(a.text)?a.text.substr(1,a.text.length-2):Number(a.text);
case"SPATIAL":switch(a.text.toUpperCase()){case"BBOX":var c=b(),a=b(),f=b(),h=b(),i=b();return new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.BBOX,property:i,value:OpenLayers.Bounds.fromArray([h,f,a,c])});case"INTERSECTS":return f=b(),c=b(),new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.INTERSECTS,property:c,value:f});case"WITHIN":return f=b(),c=b(),new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.WITHIN,property:c,value:f});case"CONTAINS":return f=b(),c=b(),new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.CONTAINS,property:c,value:f});case"DWITHIN":return a=b(),f=b(),c=b(),new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.DWITHIN,value:f,property:c,distance:Number(a)})}case"GEOMETRY":return OpenLayers.Geometry.fromWKT(a.text);default:return a.text}}for(var c=[],d=[];a.length;){var f=a.shift();switch(f.type){case"PROPERTY":case"GEOMETRY":case"VALUE":d.push(f);break;case"COMPARISON":case"BETWEEN":case"LOGICAL":for(var h=i[f.type];0<c.length&&i[c[c.length-1].type]<=h;)d.push(c.pop());c.push(f);break;case"SPATIAL":case"NOT":case"LPAREN":c.push(f);break;case"RPAREN":for(;0<c.length&&"LPAREN"!=c[c.length-1].type;)d.push(c.pop());c.pop(),0<c.length&&"SPATIAL"==c[c.length-1].type&&d.push(c.pop());case"COMMA":case"END":break;default:throw Error("Unknown token type "+f.type)}}for(;0<c.length;)d.push(c.pop());if(a=b(),0<d.length){for(a="Remaining tokens after building AST: \n",c=d.length-1;c>=0;c--)a+=d[c].type+": "+d[c].text+"\n";throw Error(a)}return a}var b,c={PROPERTY:/^[_a-zA-Z]\w*/,COMPARISON:/^(=|<>|<=|<|>=|>|LIKE)/i,COMMA:/^,/,LOGICAL:/^(AND|OR)/i,VALUE:/^('\w+'|\d+(\.\d*)?|\.\d+)/,LPAREN:/^\(/,RPAREN:/^\)/,SPATIAL:/^(BBOX|INTERSECTS|DWITHIN|WITHIN|CONTAINS)/i,NOT:/^NOT/i,BETWEEN:/^BETWEEN/i,GEOMETRY:function(a){var b=/^(POINT|LINESTRING|POLYGON|MULTIPOINT|MULTILINESTRING|MULTIPOLYGON|GEOMETRYCOLLECTION)/.exec(a);if(b){var c=a.length,b=a.indexOf("(",b[0].length);if(b>-1)for(var d=1;c>b&&d>0;)switch(b++,a.charAt(b)){case"(":d++;break;case")":d--}return[a.substr(0,b+1)]}},END:/^$/},d={LPAREN:["GEOMETRY","SPATIAL","PROPERTY","VALUE","LPAREN"],RPAREN:["NOT","LOGICAL","END","RPAREN"],PROPERTY:["COMPARISON","BETWEEN","COMMA"],BETWEEN:["VALUE"],COMPARISON:["VALUE"],COMMA:["GEOMETRY","VALUE","PROPERTY"],VALUE:["LOGICAL","COMMA","RPAREN","END"],SPATIAL:["LPAREN"],LOGICAL:["NOT","VALUE","SPATIAL","PROPERTY","LPAREN"],NOT:["PROPERTY","LPAREN"],GEOMETRY:["COMMA","RPAREN"]},e={"=":OpenLayers.Filter.Comparison.EQUAL_TO,"<>":OpenLayers.Filter.Comparison.NOT_EQUAL_TO,"<":OpenLayers.Filter.Comparison.LESS_THAN,"<=":OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO,">":OpenLayers.Filter.Comparison.GREATER_THAN,">=":OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO,LIKE:OpenLayers.Filter.Comparison.LIKE,BETWEEN:OpenLayers.Filter.Comparison.BETWEEN},f={},g={AND:OpenLayers.Filter.Logical.AND,OR:OpenLayers.Filter.Logical.OR},h={},i={RPAREN:3,LOGICAL:2,COMPARISON:1};for(b in e)e.hasOwnProperty(b)&&(f[e[b]]=b);for(b in g)g.hasOwnProperty(b)&&(h[g[b]]=b);return OpenLayers.Class(OpenLayers.Format,{read:function(b){var e,f=b,b=[],g=["NOT","GEOMETRY","SPATIAL","PROPERTY","LPAREN"];do{a:{e=g;for(var h=void 0,g=void 0,i=e.length,h=0;i>h;h++){var g=e[h],j=c[g]instanceof RegExp?c[g].exec(f):c[g](f);if(j){e=j[0],f=f.substr(e.length).replace(/^\s*/,""),e={type:g,text:e,remainder:f};break a}}for(b="ERROR: In parsing: ["+f+"], expected one of: ",h=0;i>h;h++)g=e[h],b+="\n    "+g+": "+c[g];throw Error(b)}if(f=e.remainder,g=d[e.type],"END"!=e.type&&!g)throw Error("No follows list for "+e.type);b.push(e)}while("END"!=e.type);return b=a(b),this.keepData&&(this.data=b),b},write:function(a){if(a instanceof OpenLayers.Geometry)return a.toString();switch(a.CLASS_NAME){case"OpenLayers.Filter.Spatial":switch(a.type){case OpenLayers.Filter.Spatial.BBOX:return"BBOX("+a.property+","+a.value.toBBOX()+")";case OpenLayers.Filter.Spatial.DWITHIN:return"DWITHIN("+a.property+", "+this.write(a.value)+", "+a.distance+")";case OpenLayers.Filter.Spatial.WITHIN:return"WITHIN("+a.property+", "+this.write(a.value)+")";case OpenLayers.Filter.Spatial.INTERSECTS:return"INTERSECTS("+a.property+", "+this.write(a.value)+")";case OpenLayers.Filter.Spatial.CONTAINS:return"CONTAINS("+a.property+", "+this.write(a.value)+")";default:throw Error("Unknown spatial filter type: "+a.type)}case"OpenLayers.Filter.Logical":if(a.type==OpenLayers.Filter.Logical.NOT)return"NOT ("+this.write(a.filters[0])+")";for(var b="(",c=!0,d=0;d<a.filters.length;d++)c?c=!1:b+=") "+h[a.type]+" (",b+=this.write(a.filters[d]);return b+")";case"OpenLayers.Filter.Comparison":return a.type==OpenLayers.Filter.Comparison.BETWEEN?a.property+" BETWEEN "+this.write(a.lowerBoundary)+" AND "+this.write(a.upperBoundary):a.property+" "+f[a.type]+" "+this.write(a.value);case void 0:if("string"==typeof a)return"'"+a+"'";if("number"==typeof a)return""+a;default:throw Error("Can't encode: "+a.CLASS_NAME+" "+a)}},CLASS_NAME:"OpenLayers.Format.CQL"})}(),OpenLayers.Control.Split=OpenLayers.Class(OpenLayers.Control,{layer:null,source:null,sourceOptions:null,tolerance:null,edge:!0,deferDelete:!1,mutual:!0,targetFilter:null,sourceFilter:null,handler:null,initialize:function(a){OpenLayers.Control.prototype.initialize.apply(this,[a]),this.options=a||{},this.options.source&&this.setSource(this.options.source)},setSource:function(a){this.active?(this.deactivate(),this.handler&&(this.handler.destroy(),delete this.handler),this.source=a,this.activate()):this.source=a},activate:function(){var a=OpenLayers.Control.prototype.activate.call(this);return a&&(this.source?this.source.events&&this.source.events.on({sketchcomplete:this.onSketchComplete,afterfeaturemodified:this.afterFeatureModified,scope:this}):(this.handler||(this.handler=new OpenLayers.Handler.Path(this,{done:function(a){this.onSketchComplete({feature:new OpenLayers.Feature.Vector(a)})}},{layerOptions:this.sourceOptions})),this.handler.activate())),a},deactivate:function(){var a=OpenLayers.Control.prototype.deactivate.call(this);return a&&this.source&&this.source.events&&this.layer.events.un({sketchcomplete:this.onSketchComplete,afterfeaturemodified:this.afterFeatureModified,scope:this}),a},onSketchComplete:function(a){return this.feature=null,!this.considerSplit(a.feature)},afterFeatureModified:function(a){a.modified&&"function"==typeof a.feature.geometry.split&&(this.feature=a.feature,this.considerSplit(a.feature))},removeByGeometry:function(a,b){for(var c=0,d=a.length;d>c;++c)if(a[c].geometry===b){a.splice(c,1);break}},isEligible:function(a){return a.geometry?a.state!==OpenLayers.State.DELETE&&"function"==typeof a.geometry.split&&this.feature!==a&&(!this.targetFilter||this.targetFilter.evaluate(a.attributes)):!1},considerSplit:function(a){var b=!1,c=!1;if(!this.sourceFilter||this.sourceFilter.evaluate(a.attributes)){for(var d,e,f,g,h,i=this.layer&&this.layer.features||[],j=[],k=[],l=this.layer===this.source&&this.mutual,m={edge:this.edge,tolerance:this.tolerance,mutual:l},n=[a.geometry],o=0,p=i.length;p>o;++o)if(f=i[o],this.isEligible(f)){g=[f.geometry];for(var q=0;q<n.length;++q){h=n[q];for(var r=0;r<g.length;++r)d=g[r],h.getBounds().intersectsBounds(d.getBounds())&&(d=h.split(d,m))&&(e=this.events.triggerEvent("beforesplit",{source:a,target:f}),!1!==e&&(l&&(e=d[0],1<e.length&&(e.unshift(q,1),Array.prototype.splice.apply(n,e),q+=e.length-3),d=d[1]),1<d.length)&&(d.unshift(r,1),Array.prototype.splice.apply(g,d),r+=d.length-3))}g&&1<g.length&&(this.geomsToFeatures(f,g),this.events.triggerEvent("split",{original:f,features:g}),Array.prototype.push.apply(j,g),k.push(f),c=!0)}if(n&&1<n.length&&(this.geomsToFeatures(a,n),this.events.triggerEvent("split",{original:a,features:n}),Array.prototype.push.apply(j,n),k.push(a),b=!0),b||c){if(this.deferDelete){for(i=[],o=0,p=k.length;p>o;++o)c=k[o],c.state===OpenLayers.State.INSERT?i.push(c):(c.state=OpenLayers.State.DELETE,this.layer.drawFeature(c));for(this.layer.destroyFeatures(i,{silent:!0}),o=0,p=j.length;p>o;++o)j[o].state=OpenLayers.State.INSERT}else this.layer.destroyFeatures(k,{silent:!0});this.layer.addFeatures(j,{silent:!0}),this.events.triggerEvent("aftersplit",{source:a,features:j})}}return b},geomsToFeatures:function(a,b){var c=a.clone();delete c.geometry;for(var d,e=0,f=b.length;f>e;++e)d=c.clone(),d.geometry=b[e],d.state=OpenLayers.State.INSERT,b[e]=d},destroy:function(){this.active&&this.deactivate(),OpenLayers.Control.prototype.destroy.call(this)},CLASS_NAME:"OpenLayers.Control.Split"}),OpenLayers.Layer.WMTS=OpenLayers.Class(OpenLayers.Layer.Grid,{isBaseLayer:!0,version:"1.0.0",requestEncoding:"KVP",url:null,layer:null,matrixSet:null,style:null,format:"image/jpeg",tileOrigin:null,tileFullExtent:null,formatSuffix:null,matrixIds:null,dimensions:null,params:null,zoomOffset:0,serverResolutions:null,formatSuffixMap:{"image/png":"png","image/png8":"png","image/png24":"png","image/png32":"png",png:"png","image/jpeg":"jpg","image/jpg":"jpg",jpeg:"jpg",jpg:"jpg"},matrix:null,initialize:function(a){var b,c={url:!0,layer:!0,style:!0,matrixSet:!0};for(b in c)if(!(b in a))throw Error("Missing property '"+b+"' in layer configuration.");if(a.params=OpenLayers.Util.upperCaseObject(a.params),OpenLayers.Layer.Grid.prototype.initialize.apply(this,[a.name,a.url,a.params,a]),this.formatSuffix||(this.formatSuffix=this.formatSuffixMap[this.format]||this.format.split("/").pop()),this.matrixIds&&(a=this.matrixIds.length)&&"string"==typeof this.matrixIds[0])for(c=this.matrixIds,this.matrixIds=Array(a),b=0;a>b;++b)this.matrixIds[b]={identifier:c[b]}},setMap:function(){OpenLayers.Layer.Grid.prototype.setMap.apply(this,arguments),this.updateMatrixProperties()},updateMatrixProperties:function(){(this.matrix=this.getMatrix())&&(this.matrix.topLeftCorner&&(this.tileOrigin=this.matrix.topLeftCorner),this.matrix.tileWidth&&this.matrix.tileHeight&&(this.tileSize=new OpenLayers.Size(this.matrix.tileWidth,this.matrix.tileHeight)),this.tileOrigin||(this.tileOrigin=new OpenLayers.LonLat(this.maxExtent.left,this.maxExtent.top)),this.tileFullExtent||(this.tileFullExtent=this.maxExtent))},moveTo:function(a,b){return(b||!this.matrix)&&this.updateMatrixProperties(),OpenLayers.Layer.Grid.prototype.moveTo.apply(this,arguments)},clone:function(a){return null==a&&(a=new OpenLayers.Layer.WMTS(this.options)),a=OpenLayers.Layer.Grid.prototype.clone.apply(this,[a])},getIdentifier:function(){return this.getServerZoom()},getMatrix:function(){var a;if(this.matrixIds&&0!==this.matrixIds.length)if("scaleDenominator"in this.matrixIds[0])for(var b,c=OpenLayers.METERS_PER_INCH*OpenLayers.INCHES_PER_UNIT[this.units]*this.getServerResolution()/28e-5,d=Number.POSITIVE_INFINITY,e=0,f=this.matrixIds.length;f>e;++e)b=Math.abs(1-this.matrixIds[e].scaleDenominator/c),d>b&&(d=b,a=this.matrixIds[e]);else a=this.matrixIds[this.getIdentifier()];else a={identifier:this.getIdentifier()};return a},getTileInfo:function(a){var b=this.getServerResolution(),c=(a.lon-this.tileOrigin.lon)/(b*this.tileSize.w),a=(this.tileOrigin.lat-a.lat)/(b*this.tileSize.h),b=Math.floor(c),d=Math.floor(a);return{col:b,row:d,i:Math.floor((c-b)*this.tileSize.w),j:Math.floor((a-d)*this.tileSize.h)}},getURL:function(a){var a=this.adjustBounds(a),b="";if(!this.tileFullExtent||this.tileFullExtent.intersectsBounds(a)){var c=this.getTileInfo(a.getCenterLonLat()),a=this.dimensions;if("REST"===this.requestEncoding.toUpperCase())if(b=this.params,"string"==typeof this.url&&-1!==this.url.indexOf("{")){var d=this.url.replace(/\{/g,"${"),c={style:this.style,Style:this.style,TileMatrixSet:this.matrixSet,TileMatrix:this.matrix.identifier,TileRow:c.row,TileCol:c.col};if(a){var e,f;for(f=a.length-1;f>=0;--f)e=a[f],c[e]=b[e.toUpperCase()]}b=OpenLayers.String.format(d,c)}else{if(d=this.version+"/"+this.layer+"/"+this.style+"/",a)for(f=0;f<a.length;f++)b[a[f]]&&(d=d+b[a[f]]+"/");d=d+this.matrixSet+"/"+this.matrix.identifier+"/"+c.row+"/"+c.col+"."+this.formatSuffix,b=OpenLayers.Util.isArray(this.url)?this.selectUrl(d,this.url):this.url,b.match(/\/$/)||(b+="/"),b+=d}else"KVP"===this.requestEncoding.toUpperCase()&&(b={SERVICE:"WMTS",REQUEST:"GetTile",VERSION:this.version,LAYER:this.layer,STYLE:this.style,TILEMATRIXSET:this.matrixSet,TILEMATRIX:this.matrix.identifier,TILEROW:c.row,TILECOL:c.col,FORMAT:this.format},b=OpenLayers.Layer.Grid.prototype.getFullRequestString.apply(this,[b]))}return b},mergeNewParams:function(a){return"KVP"===this.requestEncoding.toUpperCase()?OpenLayers.Layer.Grid.prototype.mergeNewParams.apply(this,[OpenLayers.Util.upperCaseObject(a)]):void 0},CLASS_NAME:"OpenLayers.Layer.WMTS"}),OpenLayers.Protocol.SOS.v1_0_0=OpenLayers.Class(OpenLayers.Protocol,{fois:null,formatOptions:null,initialize:function(a){OpenLayers.Protocol.prototype.initialize.apply(this,[a]),a.format||(this.format=new OpenLayers.Format.SOSGetFeatureOfInterest(this.formatOptions))},destroy:function(){this.options&&!this.options.format&&this.format.destroy(),this.format=null,OpenLayers.Protocol.prototype.destroy.apply(this)},read:function(a){a=OpenLayers.Util.extend({},a),OpenLayers.Util.applyDefaults(a,this.options||{});var b=new OpenLayers.Protocol.Response({requestType:"read"}),c=this.format,c=OpenLayers.Format.XML.prototype.write.apply(c,[c.writeNode("sos:GetFeatureOfInterest",{fois:this.fois})]);return b.priv=OpenLayers.Request.POST({url:a.url,callback:this.createCallback(this.handleRead,b,a),data:c}),b},handleRead:function(a,b){if(b.callback){var c=a.priv;200<=c.status&&300>c.status?(a.features=this.parseFeatures(c),a.code=OpenLayers.Protocol.Response.SUCCESS):a.code=OpenLayers.Protocol.Response.FAILURE,b.callback.call(b.scope,a)}},parseFeatures:function(a){var b=a.responseXML;return b&&b.documentElement||(b=a.responseText),!b||0>=b.length?null:this.format.read(b)},CLASS_NAME:"OpenLayers.Protocol.SOS.v1_0_0"}),OpenLayers.Layer.KaMapCache=OpenLayers.Class(OpenLayers.Layer.KaMap,{IMAGE_EXTENSIONS:{jpeg:"jpg",gif:"gif",png:"png",png8:"png",png24:"png",dithered:"png"},DEFAULT_FORMAT:"jpeg",initialize:function(){OpenLayers.Layer.KaMap.prototype.initialize.apply(this,arguments),this.extension=this.IMAGE_EXTENSIONS[this.params.i.toLowerCase()||this.DEFAULT_FORMAT]},getURL:function(a){var a=this.adjustBounds(a),b=this.map.getResolution(),c=Math.round(1e4*this.map.getScale())/1e4,d=Math.round(a.left/b),a=-Math.round(a.top/b),b=Math.floor(d/this.tileSize.w/this.params.metaTileSize.w)*this.tileSize.w*this.params.metaTileSize.w,e=Math.floor(a/this.tileSize.h/this.params.metaTileSize.h)*this.tileSize.h*this.params.metaTileSize.h,c=["/",this.params.map,"/",c,"/",this.params.g.replace(/\s/g,"_"),"/def/t",e,"/l",b,"/t",a,"l",d,".",this.extension],d=this.url;return OpenLayers.Util.isArray(d)&&(d=this.selectUrl(c.join(""),d)),d+c.join("")},CLASS_NAME:"OpenLayers.Layer.KaMapCache"}),OpenLayers.Protocol.WFS.v1_1_0=OpenLayers.Class(OpenLayers.Protocol.WFS.v1,{version:"1.1.0",initialize:function(){OpenLayers.Protocol.WFS.v1.prototype.initialize.apply(this,arguments),this.outputFormat&&!this.readFormat&&("gml2"==this.outputFormat.toLowerCase()?this.readFormat=new OpenLayers.Format.GML.v2({featureType:this.featureType,featureNS:this.featureNS,geometryName:this.geometryName}):"json"==this.outputFormat.toLowerCase()&&(this.readFormat=new OpenLayers.Format.GeoJSON))},CLASS_NAME:"OpenLayers.Protocol.WFS.v1_1_0"}),OpenLayers.Format.WMSCapabilities.v1_1_1=OpenLayers.Class(OpenLayers.Format.WMSCapabilities.v1_1,{version:"1.1.1",readers:{wms:OpenLayers.Util.applyDefaults({SRS:function(a,b){b.srs[this.getChildValue(a)]=!0}},OpenLayers.Format.WMSCapabilities.v1_1.prototype.readers.wms)},CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1_1_1"}),OpenLayers.Format.WMSCapabilities.v1_1_1_WMSC=OpenLayers.Class(OpenLayers.Format.WMSCapabilities.v1_1_1,{version:"1.1.1",profile:"WMSC",readers:{wms:OpenLayers.Util.applyDefaults({VendorSpecificCapabilities:function(a,b){b.vendorSpecific={tileSets:[]},this.readChildNodes(a,b.vendorSpecific)},TileSet:function(a,b){var c={srs:{},bbox:{},resolutions:[]};this.readChildNodes(a,c),b.tileSets.push(c)},Resolutions:function(a,b){for(var c=this.getChildValue(a).split(" "),d=0,e=c.length;e>d;d++)""!=c[d]&&b.resolutions.push(parseFloat(c[d]))},Width:function(a,b){b.width=parseInt(this.getChildValue(a))},Height:function(a,b){b.height=parseInt(this.getChildValue(a))},Layers:function(a,b){b.layers=this.getChildValue(a)},Styles:function(a,b){b.styles=this.getChildValue(a)}},OpenLayers.Format.WMSCapabilities.v1_1_1.prototype.readers.wms)},CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1_1_1_WMSC"}),OpenLayers.Format.WMSCapabilities.v1_1_0=OpenLayers.Class(OpenLayers.Format.WMSCapabilities.v1_1,{version:"1.1.0",readers:{wms:OpenLayers.Util.applyDefaults({SRS:function(a,b){for(var c=this.getChildValue(a).split(/ +/),d=0,e=c.length;e>d;d++)b.srs[c[d]]=!0}},OpenLayers.Format.WMSCapabilities.v1_1.prototype.readers.wms)},CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1_1_0"}),OpenLayers.Control.LayerSwitcher=OpenLayers.Class(OpenLayers.Control,{roundedCorner:!1,roundedCornerColor:"darkblue",layerStates:null,layersDiv:null,baseLayersDiv:null,baseLayers:null,dataLbl:null,dataLayersDiv:null,dataLayers:null,minimizeDiv:null,maximizeDiv:null,ascending:!0,initialize:function(){OpenLayers.Control.prototype.initialize.apply(this,arguments),this.layerStates=[],this.roundedCorner&&OpenLayers.Console.warn("roundedCorner option is deprecated")},destroy:function(){this.clearLayersArray("base"),this.clearLayersArray("data"),this.map.events.un({buttonclick:this.onButtonClick,addlayer:this.redraw,changelayer:this.redraw,removelayer:this.redraw,changebaselayer:this.redraw,scope:this}),this.events.unregister("buttonclick",this,this.onButtonClick),OpenLayers.Control.prototype.destroy.apply(this,arguments)},setMap:function(){OpenLayers.Control.prototype.setMap.apply(this,arguments),this.map.events.on({addlayer:this.redraw,changelayer:this.redraw,removelayer:this.redraw,changebaselayer:this.redraw,scope:this}),this.outsideViewport?(this.events.attachToElement(this.div),this.events.register("buttonclick",this,this.onButtonClick)):this.map.events.register("buttonclick",this,this.onButtonClick)},draw:function(){return OpenLayers.Control.prototype.draw.apply(this),this.loadContents(),this.outsideViewport||this.minimizeControl(),this.redraw(),this.div},onButtonClick:function(a){a=a.buttonElement,a===this.minimizeDiv?this.minimizeControl():a===this.maximizeDiv?this.maximizeControl():a._layerSwitcher===this.id&&(a["for"]&&(a=document.getElementById(a["for"])),a.disabled||("radio"==a.type?(a.checked=!0,this.map.setBaseLayer(this.map.getLayer(a._layer))):(a.checked=!a.checked,this.updateMap())))},clearLayersArray:function(a){this[a+"LayersDiv"].innerHTML="",this[a+"Layers"]=[]},checkRedraw:function(){var a=!1;if(this.layerStates.length&&this.map.layers.length==this.layerStates.length)for(var b=0,c=this.layerStates.length;c>b;b++){var d=this.layerStates[b],e=this.map.layers[b];if(d.name!=e.name||d.inRange!=e.inRange||d.id!=e.id||d.visibility!=e.visibility){a=!0;break}}else a=!0;return a},redraw:function(){if(!this.checkRedraw())return this.div;this.clearLayersArray("base"),this.clearLayersArray("data");var a=!1,b=!1,c=this.map.layers.length;this.layerStates=Array(c);for(var d=0;c>d;d++){var e=this.map.layers[d];this.layerStates[d]={name:e.name,visibility:e.visibility,inRange:e.inRange,id:e.id}}var f=this.map.layers.slice();for(this.ascending||f.reverse(),d=0,c=f.length;c>d;d++){var e=f[d],g=e.isBaseLayer;if(e.displayInLayerSwitcher){g?b=!0:a=!0;var h=g?e==this.map.baseLayer:e.getVisibility(),i=document.createElement("input");i.id=this.id+"_input_"+e.name,i.name=g?this.id+"_baseLayers":e.name,i.type=g?"radio":"checkbox",i.value=e.name,i.checked=h,i.defaultChecked=h,i.className="olButton",i._layer=e.id,i._layerSwitcher=this.id,!g&&!e.inRange&&(i.disabled=!0),h=document.createElement("label"),h["for"]=i.id,OpenLayers.Element.addClass(h,"labelSpan olButton"),h._layer=e.id,h._layerSwitcher=this.id,!g&&!e.inRange&&(h.style.color="gray"),h.innerHTML=e.name,h.style.verticalAlign=g?"bottom":"baseline";var j=document.createElement("br");(g?this.baseLayers:this.dataLayers).push({layer:e,inputElem:i,labelSpan:h}),e=g?this.baseLayersDiv:this.dataLayersDiv,e.appendChild(i),e.appendChild(h),e.appendChild(j)}}return this.dataLbl.style.display=a?"":"none",this.baseLbl.style.display=b?"":"none",this.div},updateMap:function(){for(var a=0,b=this.baseLayers.length;b>a;a++){var c=this.baseLayers[a];c.inputElem.checked&&this.map.setBaseLayer(c.layer,!1)}for(a=0,b=this.dataLayers.length;b>a;a++)c=this.dataLayers[a],c.layer.setVisibility(c.inputElem.checked)},maximizeControl:function(a){this.div.style.width="",this.div.style.height="",this.showControls(!1),null!=a&&OpenLayers.Event.stop(a)},minimizeControl:function(a){this.div.style.width="0px",this.div.style.height="0px",this.showControls(!0),null!=a&&OpenLayers.Event.stop(a)},showControls:function(a){this.maximizeDiv.style.display=a?"":"none",this.minimizeDiv.style.display=a?"none":"",this.layersDiv.style.display=a?"none":""},loadContents:function(){this.layersDiv=document.createElement("div"),this.layersDiv.id=this.id+"_layersDiv",OpenLayers.Element.addClass(this.layersDiv,"layersDiv"),this.baseLbl=document.createElement("div"),this.baseLbl.innerHTML=OpenLayers.i18n("Base Layer"),OpenLayers.Element.addClass(this.baseLbl,"baseLbl"),this.baseLayersDiv=document.createElement("div"),OpenLayers.Element.addClass(this.baseLayersDiv,"baseLayersDiv"),this.dataLbl=document.createElement("div"),this.dataLbl.innerHTML=OpenLayers.i18n("Overlays"),OpenLayers.Element.addClass(this.dataLbl,"dataLbl"),this.dataLayersDiv=document.createElement("div"),OpenLayers.Element.addClass(this.dataLayersDiv,"dataLayersDiv"),this.ascending?(this.layersDiv.appendChild(this.baseLbl),this.layersDiv.appendChild(this.baseLayersDiv),this.layersDiv.appendChild(this.dataLbl),this.layersDiv.appendChild(this.dataLayersDiv)):(this.layersDiv.appendChild(this.dataLbl),this.layersDiv.appendChild(this.dataLayersDiv),this.layersDiv.appendChild(this.baseLbl),this.layersDiv.appendChild(this.baseLayersDiv)),this.div.appendChild(this.layersDiv),this.roundedCorner&&(OpenLayers.Rico.Corner.round(this.div,{corners:"tl bl",bgColor:"transparent",color:this.roundedCornerColor,blend:!1}),OpenLayers.Rico.Corner.changeOpacity(this.layersDiv,.75));var a=OpenLayers.Util.getImageLocation("layer-switcher-maximize.png");this.maximizeDiv=OpenLayers.Util.createAlphaImageDiv("OpenLayers_Control_MaximizeDiv",null,null,a,"absolute"),OpenLayers.Element.addClass(this.maximizeDiv,"maximizeDiv olButton"),this.maximizeDiv.style.display="none",this.div.appendChild(this.maximizeDiv),a=OpenLayers.Util.getImageLocation("layer-switcher-minimize.png"),this.minimizeDiv=OpenLayers.Util.createAlphaImageDiv("OpenLayers_Control_MinimizeDiv",null,null,a,"absolute"),OpenLayers.Element.addClass(this.minimizeDiv,"minimizeDiv olButton"),this.minimizeDiv.style.display="none",this.div.appendChild(this.minimizeDiv)},CLASS_NAME:"OpenLayers.Control.LayerSwitcher"}),OpenLayers.Format.Atom=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{atom:"http://www.w3.org/2005/Atom",georss:"http://www.georss.org/georss"},feedTitle:"untitled",defaultEntryTitle:"untitled",gmlParser:null,xy:!1,read:function(a){return"string"==typeof a&&(a=OpenLayers.Format.XML.prototype.read.apply(this,[a])),this.parseFeatures(a)},write:function(a){var b;if(OpenLayers.Util.isArray(a)){b=this.createElementNSPlus("atom:feed"),b.appendChild(this.createElementNSPlus("atom:title",{value:this.feedTitle}));for(var c=0,d=a.length;d>c;c++)b.appendChild(this.buildEntryNode(a[c]))}else b=this.buildEntryNode(a);return OpenLayers.Format.XML.prototype.write.apply(this,[b])},buildContentNode:function(a){var b=this.createElementNSPlus("atom:content",{attributes:{type:a.type||null}});if(a.src)b.setAttribute("src",a.src);else if("text"==a.type||null==a.type)b.appendChild(this.createTextNode(a.value));else if("html"==a.type){if("string"!=typeof a.value)throw"HTML content must be in form of an escaped string";b.appendChild(this.createTextNode(a.value))}else b.appendChild("xhtml"==a.type?a.value:"xhtml"==a.type||a.type.match(/(\+|\/)xml$/)?a.value:this.createTextNode(a.value));return b},buildEntryNode:function(a){var b=a.attributes,c=b.atom||{},d=this.createElementNSPlus("atom:entry");if(c.authors)for(var e=OpenLayers.Util.isArray(c.authors)?c.authors:[c.authors],f=0,g=e.length;g>f;f++)d.appendChild(this.buildPersonConstructNode("author",e[f]));if(c.categories)for(var h,e=OpenLayers.Util.isArray(c.categories)?c.categories:[c.categories],f=0,g=e.length;g>f;f++)h=e[f],d.appendChild(this.createElementNSPlus("atom:category",{attributes:{term:h.term,scheme:h.scheme||null,label:h.label||null}}));if(c.content&&d.appendChild(this.buildContentNode(c.content)),c.contributors)for(e=OpenLayers.Util.isArray(c.contributors)?c.contributors:[c.contributors],f=0,g=e.length;g>f;f++)d.appendChild(this.buildPersonConstructNode("contributor",e[f]));if(a.fid&&d.appendChild(this.createElementNSPlus("atom:id",{value:a.fid})),c.links)for(e=OpenLayers.Util.isArray(c.links)?c.links:[c.links],f=0,g=e.length;g>f;f++)h=e[f],d.appendChild(this.createElementNSPlus("atom:link",{attributes:{href:h.href,rel:h.rel||null,type:h.type||null,hreflang:h.hreflang||null,title:h.title||null,length:h.length||null}}));return c.published&&d.appendChild(this.createElementNSPlus("atom:published",{value:c.published})),c.rights&&d.appendChild(this.createElementNSPlus("atom:rights",{value:c.rights})),(c.summary||b.description)&&d.appendChild(this.createElementNSPlus("atom:summary",{value:c.summary||b.description})),d.appendChild(this.createElementNSPlus("atom:title",{value:c.title||b.title||this.defaultEntryTitle})),c.updated&&d.appendChild(this.createElementNSPlus("atom:updated",{value:c.updated})),a.geometry&&(b=this.createElementNSPlus("georss:where"),b.appendChild(this.buildGeometryNode(a.geometry)),d.appendChild(b)),d},initGmlParser:function(){this.gmlParser=new OpenLayers.Format.GML.v3({xy:this.xy,featureNS:"http://example.com#feature",internalProjection:this.internalProjection,externalProjection:this.externalProjection})},buildGeometryNode:function(a){return this.gmlParser||this.initGmlParser(),this.gmlParser.writeNode("feature:_geometry",a).firstChild},buildPersonConstructNode:function(a,b){var c=["uri","email"],d=this.createElementNSPlus("atom:"+a);d.appendChild(this.createElementNSPlus("atom:name",{value:b.name}));for(var e=0,f=c.length;f>e;e++)b[c[e]]&&d.appendChild(this.createElementNSPlus("atom:"+c[e],{value:b[c[e]]}));return d},getFirstChildValue:function(a,b,c,d){return(a=this.getElementsByTagNameNS(a,b,c))&&0<a.length?this.getChildValue(a[0],d):d},parseFeature:function(a){var b={},c=null,d=null,e=null,f=this.namespaces.atom;this.parsePersonConstructs(a,"author",b),d=this.getElementsByTagNameNS(a,f,"category"),0<d.length&&(b.categories=[]);for(var g=0,h=d.length;h>g;g++)c={},c.term=d[g].getAttribute("term"),(e=d[g].getAttribute("scheme"))&&(c.scheme=e),(e=d[g].getAttribute("label"))&&(c.label=e),b.categories.push(c);d=this.getElementsByTagNameNS(a,f,"content"),0<d.length&&(c={},(e=d[0].getAttribute("type"))&&(c.type=e),(e=d[0].getAttribute("src"))?c.src=e:(c.value="text"==c.type||"html"==c.type||null==c.type?this.getFirstChildValue(a,f,"content",null):"xhtml"==c.type||c.type.match(/(\+|\/)xml$/)?this.getChildEl(d[0]):this.getFirstChildValue(a,f,"content",null),b.content=c)),this.parsePersonConstructs(a,"contributor",b),b.id=this.getFirstChildValue(a,f,"id",null),d=this.getElementsByTagNameNS(a,f,"link"),0<d.length&&(b.links=Array(d.length));for(var i=["rel","type","hreflang","title","length"],g=0,h=d.length;h>g;g++){c={},c.href=d[g].getAttribute("href");for(var j=0,k=i.length;k>j;j++)(e=d[g].getAttribute(i[j]))&&(c[i[j]]=e);b.links[g]=c}return(c=this.getFirstChildValue(a,f,"published",null))&&(b.published=c),(c=this.getFirstChildValue(a,f,"rights",null))&&(b.rights=c),(c=this.getFirstChildValue(a,f,"summary",null))&&(b.summary=c),b.title=this.getFirstChildValue(a,f,"title",null),b.updated=this.getFirstChildValue(a,f,"updated",null),c={title:b.title,description:b.summary,atom:b},a=this.parseLocations(a)[0],a=new OpenLayers.Feature.Vector(a,c),a.fid=b.id,a},parseFeatures:function(a){var b=[],c=this.getElementsByTagNameNS(a,this.namespaces.atom,"entry");0==c.length&&(c=[a]);for(var a=0,d=c.length;d>a;a++)b.push(this.parseFeature(c[a]));return b},parseLocations:function(a){var b=this.namespaces.georss,c={components:[]},d=this.getElementsByTagNameNS(a,b,"where");if(d&&0<d.length){this.gmlParser||this.initGmlParser();for(var e=0,f=d.length;f>e;e++)this.gmlParser.readChildNodes(d[e],c)}if(c=c.components,(d=this.getElementsByTagNameNS(a,b,"point"))&&0<d.length)for(e=0,f=d.length;f>e;e++){var g=OpenLayers.String.trim(d[e].firstChild.nodeValue).split(/\s+/);2!=g.length&&(g=OpenLayers.String.trim(d[e].firstChild.nodeValue).split(/\s*,\s*/)),c.push(new OpenLayers.Geometry.Point(g[1],g[0]))}var h=this.getElementsByTagNameNS(a,b,"line");if(h&&0<h.length)for(var i,e=0,f=h.length;f>e;e++){d=OpenLayers.String.trim(h[e].firstChild.nodeValue).split(/\s+/),i=[];for(var j=0,k=d.length;k>j;j+=2)g=new OpenLayers.Geometry.Point(d[j+1],d[j]),i.push(g);c.push(new OpenLayers.Geometry.LineString(i))}if((a=this.getElementsByTagNameNS(a,b,"polygon"))&&0<a.length)for(e=0,f=a.length;f>e;e++){for(d=OpenLayers.String.trim(a[e].firstChild.nodeValue).split(/\s+/),i=[],j=0,k=d.length;k>j;j+=2)g=new OpenLayers.Geometry.Point(d[j+1],d[j]),i.push(g);c.push(new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing(c)]))}if(this.internalProjection&&this.externalProjection)for(e=0,f=c.length;f>e;e++)c[e]&&c[e].transform(this.externalProjection,this.internalProjection);return c},parsePersonConstructs:function(a,b,c){for(var d=[],e=this.namespaces.atom,a=this.getElementsByTagNameNS(a,e,b),f=["uri","email"],g=0,h=a.length;h>g;g++){var i={};i.name=this.getFirstChildValue(a[g],e,"name",null);for(var j=0,k=f.length;k>j;j++){var l=this.getFirstChildValue(a[g],e,f[j],null);l&&(i[f[j]]=l)}d.push(i)}0<d.length&&(c[b+"s"]=d)},CLASS_NAME:"OpenLayers.Format.Atom"}),OpenLayers.Control.KeyboardDefaults=OpenLayers.Class(OpenLayers.Control,{autoActivate:!0,slideFactor:75,observeElement:null,draw:function(){this.handler=new OpenLayers.Handler.Keyboard(this,{keydown:this.defaultKeyPress},{observeElement:this.observeElement||document})},defaultKeyPress:function(a){var b,c=!0;switch(a.keyCode){case OpenLayers.Event.KEY_LEFT:this.map.pan(-this.slideFactor,0);break;case OpenLayers.Event.KEY_RIGHT:this.map.pan(this.slideFactor,0);break;case OpenLayers.Event.KEY_UP:this.map.pan(0,-this.slideFactor);break;case OpenLayers.Event.KEY_DOWN:this.map.pan(0,this.slideFactor);break;case 33:b=this.map.getSize(),this.map.pan(0,-.75*b.h);break;case 34:b=this.map.getSize(),this.map.pan(0,.75*b.h);break;case 35:b=this.map.getSize(),this.map.pan(.75*b.w,0);break;case 36:b=this.map.getSize(),this.map.pan(-.75*b.w,0);break;case 43:case 61:case 187:case 107:this.map.zoomIn();break;case 45:case 109:case 189:case 95:this.map.zoomOut();break;default:c=!1}c&&OpenLayers.Event.stop(a)},CLASS_NAME:"OpenLayers.Control.KeyboardDefaults"}),OpenLayers.Format.WMTSCapabilities.v1_0_0=OpenLayers.Class(OpenLayers.Format.OWSCommon.v1_1_0,{version:"1.0.0",namespaces:{ows:"http://www.opengis.net/ows/1.1",wmts:"http://www.opengis.net/wmts/1.0",xlink:"http://www.w3.org/1999/xlink"},yx:null,defaultPrefix:"wmts",initialize:function(a){OpenLayers.Format.XML.prototype.initialize.apply(this,[a]),this.options=a,a=OpenLayers.Util.extend({},OpenLayers.Format.WMTSCapabilities.prototype.yx),this.yx=OpenLayers.Util.extend(a,this.yx)},read:function(a){"string"==typeof a&&(a=OpenLayers.Format.XML.prototype.read.apply(this,[a])),a&&9==a.nodeType&&(a=a.documentElement);var b={};return this.readNode(a,b),b.version=this.version,b},readers:{wmts:{Capabilities:function(a,b){this.readChildNodes(a,b)},Contents:function(a,b){b.contents={},b.contents.layers=[],b.contents.tileMatrixSets={},this.readChildNodes(a,b.contents)
},Layer:function(a,b){var c={styles:[],formats:[],dimensions:[],tileMatrixSetLinks:[],layers:[]};this.readChildNodes(a,c),b.layers.push(c)},Style:function(a,b){var c={};c.isDefault="true"===a.getAttribute("isDefault"),this.readChildNodes(a,c),b.styles.push(c)},Format:function(a,b){b.formats.push(this.getChildValue(a))},TileMatrixSetLink:function(a,b){var c={};this.readChildNodes(a,c),b.tileMatrixSetLinks.push(c)},TileMatrixSet:function(a,b){if(b.layers){var c={matrixIds:[]};this.readChildNodes(a,c),b.tileMatrixSets[c.identifier]=c}else b.tileMatrixSet=this.getChildValue(a)},TileMatrix:function(a,b){var c={supportedCRS:b.supportedCRS};this.readChildNodes(a,c),b.matrixIds.push(c)},ScaleDenominator:function(a,b){b.scaleDenominator=parseFloat(this.getChildValue(a))},TopLeftCorner:function(a,b){var c,d=this.getChildValue(a).split(" ");b.supportedCRS&&(c=!!this.yx[b.supportedCRS.replace(/urn:ogc:def:crs:(\w+):.+:(\w+)$/,"urn:ogc:def:crs:$1::$2")]),b.topLeftCorner=c?new OpenLayers.LonLat(d[1],d[0]):new OpenLayers.LonLat(d[0],d[1])},TileWidth:function(a,b){b.tileWidth=parseInt(this.getChildValue(a))},TileHeight:function(a,b){b.tileHeight=parseInt(this.getChildValue(a))},MatrixWidth:function(a,b){b.matrixWidth=parseInt(this.getChildValue(a))},MatrixHeight:function(a,b){b.matrixHeight=parseInt(this.getChildValue(a))},ResourceURL:function(a,b){b.resourceUrl=b.resourceUrl||{},b.resourceUrl[a.getAttribute("resourceType")]={format:a.getAttribute("format"),template:a.getAttribute("template")}},WSDL:function(a,b){b.wsdl={},b.wsdl.href=a.getAttribute("xlink:href")},ServiceMetadataURL:function(a,b){b.serviceMetadataUrl={},b.serviceMetadataUrl.href=a.getAttribute("xlink:href")},LegendURL:function(a,b){b.legend={},b.legend.href=a.getAttribute("xlink:href"),b.legend.format=a.getAttribute("format")},Dimension:function(a,b){var c={values:[]};this.readChildNodes(a,c),b.dimensions.push(c)},Default:function(a,b){b["default"]=this.getChildValue(a)},Value:function(a,b){b.values.push(this.getChildValue(a))}},ows:OpenLayers.Format.OWSCommon.v1_1_0.prototype.readers.ows},CLASS_NAME:"OpenLayers.Format.WMTSCapabilities.v1_0_0"}),Ext.namespace("GeoExt"),GeoExt.LayerLegend=Ext.extend(Ext.Container,{layerRecord:null,showTitle:!0,legendTitle:null,labelCls:null,layerStore:null,initComponent:function(){GeoExt.LayerLegend.superclass.initComponent.call(this),this.autoEl={},this.add({xtype:"label",html:this.getLayerTitle(this.layerRecord),cls:"x-form-item x-form-item-label"+(this.labelCls?" "+this.labelCls:"")}),this.layerRecord&&this.layerRecord.store&&(this.layerStore=this.layerRecord.store,this.layerStore.on("update",this.onStoreUpdate,this),this.layerStore.on("add",this.onStoreAdd,this),this.layerStore.on("remove",this.onStoreRemove,this))},getLabel:function(){var a=this.items.get(0);return a.rendered?a.el.dom.innerHTML:a.html},onStoreRemove:function(){},onStoreAdd:function(){},onStoreUpdate:function(a,b){if(b===this.layerRecord&&this.items.getCount()>0){var c=b.getLayer();this.setVisible(c.getVisibility()&&c.calculateInRange()&&c.displayInLayerSwitcher&&!b.get("hideInLegend")),this.update()}},update:function(){var a=this.getLayerTitle(this.layerRecord),b=this.items.get(0);b instanceof Ext.form.Label&&this.getLabel()!==a&&b.setText(a,!1)},getLayerTitle:function(a){var b=this.legendTitle||"";return this.showTitle&&!b&&a&&!a.get("hideTitle")&&(b=a.getLayer().title||a.get("title")||a.get("name")||a.getLayer().name||""),b},beforeDestroy:function(){this.layerStore&&(this.layerStore.un("update",this.onStoreUpdate,this),this.layerStore.un("remove",this.onStoreRemove,this),this.layerStore.un("add",this.onStoreAdd,this)),GeoExt.LayerLegend.superclass.beforeDestroy.apply(this,arguments)},onDestroy:function(){this.layerRecord=null,this.layerStore=null,GeoExt.LayerLegend.superclass.onDestroy.apply(this,arguments)}}),GeoExt.LayerLegend.getTypes=function(a,b){var c,d,e=(b||[]).concat(),f=[];for(d in GeoExt.LayerLegend.types)c=GeoExt.LayerLegend.types[d].supports(a),c>0?-1==e.indexOf(d)&&f.push({type:d,score:c}):e.remove(d);f.sort(function(a,b){return a.score<b.score?1:a.score==b.score?0:-1});for(var g=f.length,h=new Array(g),i=0;g>i;++i)h[i]=f[i].type;return e.concat(h)},GeoExt.LayerLegend.supports=function(){},GeoExt.LayerLegend.types={},Ext.namespace("GeoExt"),GeoExt.VectorLegend=Ext.extend(GeoExt.LayerLegend,{layerRecord:null,layer:null,rules:null,symbolType:null,untitledPrefix:"Untitled ",clickableSymbol:!1,clickableTitle:!1,selectOnClick:!1,enableDD:!1,bodyBorder:!1,feature:null,selectedRule:null,currentScaleDenominator:null,initComponent:function(){if(GeoExt.VectorLegend.superclass.initComponent.call(this),this.layerRecord&&(this.layer=this.layerRecord.getLayer(),this.layer.map&&(this.map=this.layer.map,this.currentScaleDenominator=this.layer.map.getScale(),this.layer.map.events.on({zoomend:this.onMapZoom,scope:this}))),!this.symbolType)if(this.feature)this.symbolType=this.symbolTypeFromFeature(this.feature);else if(this.layer)if(this.layer.features.length>0){var a=this.layer.features[0].clone();a.attributes={},this.feature=a,this.symbolType=this.symbolTypeFromFeature(this.feature)}else this.layer.events.on({featuresadded:this.onFeaturesAdded,scope:this});this.layer&&this.feature&&!this.rules&&this.setRules(),this.rulesContainer=new Ext.Container({autoEl:{}}),this.add(this.rulesContainer),this.addEvents("titleclick","symbolclick","ruleclick","ruleselected","ruleunselected","rulemoved"),this.update()},onMapZoom:function(){this.setCurrentScaleDenominator(this.layer.map.getScale())},symbolTypeFromFeature:function(a){var b=a.geometry.CLASS_NAME.match(/Point|Line|Polygon/);return b&&b[0]||"Point"},onFeaturesAdded:function(){this.layer.events.un({featuresadded:this.onFeaturesAdded,scope:this});var a=this.layer.features[0].clone();a.attributes={},this.feature=a,this.symbolType=this.symbolTypeFromFeature(this.feature),this.rules||this.setRules(),this.update()},setRules:function(){var a=this.layer.styleMap&&this.layer.styleMap.styles["default"];a||(a=new OpenLayers.Style),this.rules=0===a.rules.length?[new OpenLayers.Rule({title:a.title,symbolizer:a.createSymbolizer(this.feature)})]:a.rules},setCurrentScaleDenominator:function(a){a!==this.currentScaleDenominator&&(this.currentScaleDenominator=a,this.update())},getRuleEntry:function(a){return this.rulesContainer.items.get(this.rules.indexOf(a))},addRuleEntry:function(a,b){this.rulesContainer.add(this.createRuleEntry(a)),b||this.doLayout()},removeRuleEntry:function(a,b){var c=this.getRuleEntry(a);c&&(this.rulesContainer.remove(c),b||this.doLayout())},selectRuleEntry:function(a){var b=a!=this.selectedRule;if(this.selectedRule&&this.unselect(),b){var c=this.getRuleEntry(a);c.body.addClass("x-grid3-row-selected"),this.selectedRule=a,this.fireEvent("ruleselected",this,a)}},unselect:function(){this.rulesContainer.items.each(function(a,b){this.rules[b]==this.selectedRule&&(a.body.removeClass("x-grid3-row-selected"),this.selectedRule=null,this.fireEvent("ruleunselected",this,this.rules[b]))},this)},createRuleEntry:function(a){var b=!0;return null!=this.currentScaleDenominator&&(a.minScaleDenominator&&(b=b&&this.currentScaleDenominator>=a.minScaleDenominator),a.maxScaleDenominator&&(b=b&&this.currentScaleDenominator<a.maxScaleDenominator)),{xtype:"panel",layout:"column",border:!1,hidden:!b,bodyStyle:this.selectOnClick?{cursor:"pointer"}:void 0,defaults:{border:!1},items:[this.createRuleRenderer(a),this.createRuleTitle(a)],listeners:{render:function(b){this.selectOnClick&&b.getEl().on({click:function(){this.selectRuleEntry(a)},scope:this}),1==this.enableDD&&this.addDD(b)},scope:this}}},createRuleRenderer:function(a){var b,c,d=[this.symbolType,"Point","Line","Polygon"],e=a.symbolizers;if(e){var f;a:for(var g=0,h=d.length;h>g;++g)if(b=d[g],f=OpenLayers.Symbolizer[b])for(var i=0,j=e.length;j>i;++i)if(e[i]instanceof f){c=!0;break a}}else{for(var k=a.symbolizer,g=0,l=d.length;l>g;++g)if(b=d[g],k[b]){k=k[b],c=!0;break}e=[k]}return{xtype:"gx_renderer",symbolType:c?b:this.symbolType,symbolizers:e,style:this.clickableSymbol?{cursor:"pointer"}:void 0,listeners:{click:function(){this.clickableSymbol&&(this.fireEvent("symbolclick",this,a),this.fireEvent("ruleclick",this,a))},scope:this}}},createRuleTitle:function(a){return{cls:"x-form-item",style:"padding: 0.2em 0.5em 0;",bodyStyle:Ext.applyIf({background:"transparent"},this.clickableTitle?{cursor:"pointer"}:void 0),html:this.getRuleTitle(a),listeners:{render:function(b){this.clickableTitle&&b.getEl().on({click:function(){this.fireEvent("titleclick",this,a),this.fireEvent("ruleclick",this,a)},scope:this})},scope:this}}},addDD:function(a){var b=a.ownerCt,c=this;new Ext.dd.DragSource(a.getEl(),{ddGroup:b.id,onDragOut:function(a,b){var c=Ext.getCmp(b);return c.removeClass("gx-ruledrag-insert-above"),c.removeClass("gx-ruledrag-insert-below"),Ext.dd.DragZone.prototype.onDragOut.apply(this,arguments)},onDragEnter:function(c,d){var e,f=Ext.getCmp(d),g=b.items.indexOf(a),h=b.items.indexOf(f);return g>h?e="gx-ruledrag-insert-above":h>g&&(e="gx-ruledrag-insert-below"),e&&f.addClass(e),Ext.dd.DragZone.prototype.onDragEnter.apply(this,arguments)},onDragDrop:function(d,e){return c.moveRule(b.items.indexOf(a),b.items.indexOf(Ext.getCmp(e))),Ext.dd.DragZone.prototype.onDragDrop.apply(this,arguments)},getDragData:function(a){var b=a.getTarget(".x-column-inner");if(b){var c=b.cloneNode(!0);return c.id=Ext.id(),{sourceEl:b,repairXY:Ext.fly(b).getXY(),ddel:c}}}}),new Ext.dd.DropTarget(a.getEl(),{ddGroup:b.id,notifyDrop:function(){return!0}})},update:function(){if(GeoExt.VectorLegend.superclass.update.apply(this,arguments),this.symbolType&&this.rules){if(this.rulesContainer.items)for(var a,b=this.rulesContainer.items.length-1;b>=0;--b)a=this.rulesContainer.getComponent(b),this.rulesContainer.remove(a,!0);for(var b=0,c=this.rules.length;c>b;++b)this.addRuleEntry(this.rules[b],!0);this.doLayout(),this.selectedRule&&this.getRuleEntry(this.selectedRule).body.addClass("x-grid3-row-selected")}},updateRuleEntry:function(a){var b=this.getRuleEntry(a);b&&(b.removeAll(),b.add(this.createRuleRenderer(a)),b.add(this.createRuleTitle(a)),b.doLayout())},moveRule:function(a,b){var c=this.rules[a];this.rules.splice(a,1),this.rules.splice(b,0,c),this.update(),this.fireEvent("rulemoved",this,c)},getRuleTitle:function(a){var b=a.title||a.name||"";return!b&&this.untitledPrefix&&(b=this.untitledPrefix+(this.rules.indexOf(a)+1)),b},beforeDestroy:function(){this.layer&&(this.layer.events&&this.layer.events.un({featuresadded:this.onFeaturesAdded,scope:this}),this.layer.map&&this.layer.map.events&&this.layer.map.events.un({zoomend:this.onMapZoom,scope:this})),delete this.layer,delete this.map,delete this.rules,GeoExt.VectorLegend.superclass.beforeDestroy.apply(this,arguments)},onStoreRemove:function(a,b){b.getLayer()===this.layer&&this.map&&this.map.events&&this.map.events.un({zoomend:this.onMapZoom,scope:this})},onStoreAdd:function(a,b){for(var c=0,d=b.length;d>c;c++){var e=b[c];e.getLayer()===this.layer&&this.layer.map&&this.layer.map.events&&this.layer.map.events.on({zoomend:this.onMapZoom,scope:this})}}}),GeoExt.VectorLegend.supports=function(a){return a.getLayer()instanceof OpenLayers.Layer.Vector?1:0},GeoExt.LayerLegend.types.gx_vectorlegend=GeoExt.VectorLegend,Ext.reg("gx_vectorlegend",GeoExt.VectorLegend),Ext.namespace("GeoExt.tree"),GeoExt.tree.LayerContainer=Ext.extend(Ext.tree.AsyncTreeNode,{text:"Layers",constructor:function(a){a=Ext.applyIf(a||{},{text:this.text}),this.loader=a.loader instanceof GeoExt.tree.LayerLoader?a.loader:new GeoExt.tree.LayerLoader(Ext.applyIf(a.loader||{},{store:a.layerStore})),GeoExt.tree.LayerContainer.superclass.constructor.call(this,a)},recordIndexToNodeIndex:function(a){for(var b=this.loader.store,c=b.getCount(),d=this.childNodes.length,e=-1,f=c-1;f>=0&&!(this.loader.filter(b.getAt(f))===!0&&(++e,a===f||e>d-1));--f);return e},destroy:function(){delete this.layerStore,GeoExt.tree.LayerContainer.superclass.destroy.apply(this,arguments)}}),Ext.tree.TreePanel.nodeTypes.gx_layercontainer=GeoExt.tree.LayerContainer,Ext.namespace("GeoExt.tree"),GeoExt.tree.BaseLayerContainer=Ext.extend(GeoExt.tree.LayerContainer,{text:"Base Layer",constructor:function(a){a=Ext.applyIf(a||{},{text:this.text,loader:{}}),a.loader=Ext.applyIf(a.loader,{baseAttrs:Ext.applyIf(a.loader.baseAttrs||{},{iconCls:"gx-tree-baselayer-icon",checkedGroup:"baselayer"}),filter:function(a){var b=a.getLayer();return b.displayInLayerSwitcher===!0&&b.isBaseLayer===!0}}),GeoExt.tree.BaseLayerContainer.superclass.constructor.call(this,a)}}),Ext.tree.TreePanel.nodeTypes.gx_baselayercontainer=GeoExt.tree.BaseLayerContainer,Ext.namespace("GeoExt.plugins"),GeoExt.plugins.PrintExtent=Ext.extend(Ext.util.Observable,{initialConfig:null,printProvider:null,map:null,layer:null,control:null,pages:null,page:null,constructor:function(a){a=a||{},Ext.apply(this,a),this.initialConfig=a,this.printProvider||(this.printProvider=this.pages[0].printProvider),this.pages||(this.pages=[]),this.addEvents("selectpage"),GeoExt.plugins.PrintExtent.superclass.constructor.apply(this,arguments)},print:function(a){this.printProvider.print(this.map,this.pages,a)},init:function(a){this.map=a.map,a.on("destroy",this.onMapPanelDestroy,this),this.layer||(this.layer=new OpenLayers.Layer.Vector(null,{displayInLayerSwitcher:!1})),this.createControl();for(var b=0,c=this.pages.length;c>b;++b)this.addPage(this.pages[b]);this.show()},addPage:function(a){a=a||new GeoExt.data.PrintPage({printProvider:this.printProvider}),-1===this.pages.indexOf(a)&&this.pages.push(a),this.layer.addFeatures([a.feature]),a.on("change",this.onPageChange,this),this.page=a;var b=this.map;return b.getCenter()?this.fitPage():b.events.register("moveend",this,function(){b.events.unregister("moveend",this,arguments.callee),this.fitPage()}),a},removePage:function(a){this.pages.remove(a),a.feature.layer&&this.layer.removeFeatures([a.feature]),a.un("change",this.onPageChange,this)},selectPage:function(a){this.control.active&&this.control.setFeature(a.feature)},show:function(){this.map.addLayer(this.layer),this.map.addControl(this.control),this.control.activate(),this.page&&this.map.getCenter()&&this.updateBox()},hide:function(){var a=this.map,b=this.layer,c=this.control;c&&c.events&&(c.deactivate(),a&&a.events&&c.map&&a.removeControl(c)),a&&a.events&&b&&b.map&&a.removeLayer(b)},onMapPanelDestroy:function(){for(var a=this.map,b=this.pages.length-1,c=b;c>=0;c--)this.removePage(this.pages[c]);this.hide();var d=this.control;a&&a.events&&d&&d.events&&d.destroy();var e=this.layer;!this.initialConfig.layer&&a&&a.events&&e&&e.events&&e.destroy(),delete this.layer,delete this.control,delete this.page,this.map=null},createControl:function(){this.control=new OpenLayers.Control.TransformFeature(this.layer,{preserveAspectRatio:!0,eventListeners:{beforesetfeature:function(a){for(var b=0,c=this.pages.length;c>b;++b)if(this.pages[b].feature===a.feature){this.page=this.pages[b],a.object.rotation=-this.pages[b].rotation;break}},setfeature:function(a){for(var b=0,c=this.pages.length;c>b;++b)if(this.pages[b].feature===a.feature){this.fireEvent("selectpage",this.pages[b]);break}},beforetransform:function(a){this._updating=!0;var b=this.page;if(a.rotation)this.printProvider.layout.get("rotation")?b.setRotation(-a.object.rotation):a.object.setFeature(b.feature);else if(a.center)b.setCenter(OpenLayers.LonLat.fromString(a.center.toShortString()));else{b.fit(a.object.box,{mode:"closest"});var c=this.printProvider.scales.getAt(0),d=this.printProvider.scales.getAt(this.printProvider.scales.getCount()-1),e=a.object.box.geometry.getBounds(),f=b.feature.geometry.getBounds(),g=b.scale===c&&e.containsBounds(f),h=b.scale===d&&f.containsBounds(e);(g===!0||h===!0)&&this.updateBox()}return delete this._updating,!1},transformcomplete:this.updateBox,scope:this}})},fitPage:function(){this.page&&this.page.fit(this.map,{mode:"screen"})},updateBox:function(){var a=this.page;this.control.active&&this.control.setFeature(a.feature,{rotation:-a.rotation})},onPageChange:function(a){this._updating||this.control.active&&this.control.setFeature(a.feature,{rotation:-a.rotation})}}),Ext.preg("gx_printextent",GeoExt.plugins.PrintExtent),Ext.namespace("GeoExt"),GeoExt.SliderTip=Ext.extend(Ext.slider.Tip,{hover:!0,minWidth:10,offsets:[0,-10],dragging:!1,init:function(a){GeoExt.SliderTip.superclass.init.apply(this,arguments),this.hover&&a.on("render",this.registerThumbListeners,this),this.slider=a},registerThumbListeners:function(){for(var a,b,c=0,d=this.slider.thumbs.length;d>c;++c)a=this.slider.thumbs[c],b=a.tracker.el,function(a,b){b.on({mouseover:function(b){this.onSlide(this.slider,b,a),this.dragging=!1},mouseout:function(){this.dragging||this.hide.apply(this,arguments)},scope:this})}.apply(this,[a,b])},onSlide:function(){return this.dragging=!0,GeoExt.SliderTip.superclass.onSlide.apply(this,arguments)}}),Ext.namespace("GeoExt"),GeoExt.Lang=new(Ext.extend(Ext.util.Observable,{locale:navigator.language||navigator.userLanguage,dict:null,constructor:function(){this.addEvents("localize"),this.dict={},Ext.util.Observable.constructor.apply(this,arguments)},add:function(a,b){var c=this.dict[a];if(c)for(var d in b)c[d]=Ext.apply(c[d]||{},b[d]);else this.dict[a]=Ext.apply({},b);a&&a!==this.locale?0===this.locale.indexOf(a+"-")&&this.set(this.locale):this.set(a)},set:function(a){for(var b,c=a?a.split("-"):[],d="",e={},f=0,g=c.length;g>f;++f)if(d+=(d&&"-"||"")+c[f],d in this.dict){b=this.dict[d];for(var h in b)h in e?Ext.apply(e[h],b[h]):e[h]=Ext.apply({},b[h])}for(var h in e){for(var i=window,j=h.split("."),k=!1,f=0,g=j.length;g>f;++f){var l=j[f];if(!(l in i)){k=!0;break}i=i[l]}k||Ext.apply(i,e[h])}this.locale=a,this.fireEvent("localize",a)}})),Ext.namespace("GeoExt"),GeoExt.ZoomSlider=Ext.extend(Ext.slider.SingleSlider,{map:null,baseCls:"gx-zoomslider",aggressive:!1,updating:!1,initComponent:function(){GeoExt.ZoomSlider.superclass.initComponent.call(this),this.map&&(this.map instanceof GeoExt.MapPanel&&(this.map=this.map.map),this.bind(this.map)),this.aggressive===!0?this.on("change",this.changeHandler,this):this.on("changecomplete",this.changeHandler,this),this.on("beforedestroy",this.unbind,this)},onRender:function(){GeoExt.ZoomSlider.superclass.onRender.apply(this,arguments),this.el.addClass(this.baseCls)},afterRender:function(){Ext.slider.SingleSlider.superclass.afterRender.apply(this,arguments),this.update()},addToMapPanel:function(a){this.on({render:function(){var b=this.getEl();b.setStyle({position:"absolute",zIndex:a.map.Z_INDEX_BASE.Control}),b.on({mousedown:this.stopMouseEvents,click:this.stopMouseEvents})},afterrender:function(){this.bind(a.map)},scope:this})},stopMouseEvents:function(a){a.stopEvent()},removeFromMapPanel:function(){var a=this.getEl();a.un("mousedown",this.stopMouseEvents,this),a.un("click",this.stopMouseEvents,this),this.unbind()},bind:function(a){this.map=a,this.map.events.on({zoomend:this.update,changebaselayer:this.initZoomValues,scope:this}),this.map.baseLayer&&(this.initZoomValues(),this.update())},unbind:function(){this.map&&this.map.events&&this.map.events.un({zoomend:this.update,changebaselayer:this.initZoomValues,scope:this})},initZoomValues:function(){var a=this.map.baseLayer;void 0===this.initialConfig.minValue&&(this.minValue=a.minZoomLevel||0),void 0===this.initialConfig.maxValue&&(this.maxValue=null==a.minZoomLevel?a.numZoomLevels-1:a.maxZoomLevel)},getZoom:function(){return this.getValue()},getScale:function(){return OpenLayers.Util.getScaleFromResolution(this.map.getResolutionForZoom(this.getValue()),this.map.getUnits())},getResolution:function(){return this.map.getResolutionForZoom(this.getValue())},changeHandler:function(){this.map&&!this.updating&&this.map.zoomTo(this.getValue())},update:function(){this.rendered&&this.map&&(this.updating=!0,this.setValue(this.map.getZoom()),this.updating=!1)}}),Ext.reg("gx_zoomslider",GeoExt.ZoomSlider),Ext.namespace("GeoExt.tree"),GeoExt.tree.WMSCapabilitiesLoader=function(a){Ext.apply(this,a),GeoExt.tree.WMSCapabilitiesLoader.superclass.constructor.call(this)},Ext.extend(GeoExt.tree.WMSCapabilitiesLoader,Ext.tree.TreeLoader,{url:null,layerOptions:null,layerParams:null,requestMethod:"GET",getParams:function(){return{service:"WMS",request:"GetCapabilities"}},processResponse:function(a,b,c,d){var e=(new OpenLayers.Format.WMSCapabilities).read(a.responseXML||a.responseText);e.capability&&this.processLayer(e.capability,e.capability.request.getmap.href,b),"function"==typeof c&&c.apply(d||b,[b])},createWMSLayer:function(a,b){return a.name?new OpenLayers.Layer.WMS(a.title,b,OpenLayers.Util.extend({formats:a.formats[0],layers:a.name},this.layerParams),OpenLayers.Util.extend({minScale:a.minScale,queryable:a.queryable,maxScale:a.maxScale,metadata:a},this.layerOptions)):null},processLayer:function(a,b,c){Ext.each(a.nestedLayers,function(a){var d=this.createNode({text:a.title||a.name,nodeType:"node",layer:this.createWMSLayer(a,b),leaf:0===a.nestedLayers.length});d&&c.appendChild(d),a.nestedLayers&&this.processLayer(a,b,d)},this)}}),Ext.namespace("GeoExt.data"),GeoExt.data.WMSCapabilitiesReader=function(a,b){a=a||{},a.format||(a.format=new OpenLayers.Format.WMSCapabilities),"function"!=typeof b&&(b=GeoExt.data.LayerRecord.create(b||a.fields||[{name:"name",type:"string"},{name:"title",type:"string"},{name:"abstract",type:"string"},{name:"queryable",type:"boolean"},{name:"opaque",type:"boolean"},{name:"noSubsets",type:"boolean"},{name:"cascaded",type:"int"},{name:"fixedWidth",type:"int"},{name:"fixedHeight",type:"int"},{name:"minScale",type:"float"},{name:"maxScale",type:"float"},{name:"prefix",type:"string"},{name:"formats"},{name:"styles"},{name:"srs"},{name:"dimensions"},{name:"bbox"},{name:"llbbox"},{name:"attribution"},{name:"keywords"},{name:"identifiers"},{name:"authorityURLs"},{name:"metadataURLs"},{name:"infoFormats"}])),GeoExt.data.WMSCapabilitiesReader.superclass.constructor.call(this,a,b)},Ext.extend(GeoExt.data.WMSCapabilitiesReader,Ext.data.DataReader,{attributionCls:"gx-attribution",read:function(a){var b=a.responseXML;return b&&b.documentElement||(b=a.responseText),this.readRecords(b)},serviceExceptionFormat:function(a){return OpenLayers.Util.indexOf(a,"application/vnd.ogc.se_inimage")>-1?"application/vnd.ogc.se_inimage":OpenLayers.Util.indexOf(a,"application/vnd.ogc.se_xml")>-1?"application/vnd.ogc.se_xml":a[0]},imageFormat:function(a){var b=a.formats;return a.opaque&&OpenLayers.Util.indexOf(b,"image/jpeg")>-1?"image/jpeg":OpenLayers.Util.indexOf(b,"image/png")>-1?"image/png":OpenLayers.Util.indexOf(b,"image/png; mode=24bit")>-1?"image/png; mode=24bit":OpenLayers.Util.indexOf(b,"image/gif")>-1?"image/gif":b[0]},imageTransparent:function(a){return void 0==a.opaque||!a.opaque},readRecords:function(a){if(("string"==typeof a||a.nodeType)&&(a=this.meta.format.read(a)),a.error)throw new Ext.data.DataReader.Error("invalid-response",a.error);var b=a.version,c=a.capability||{},d=c.request&&c.request.getmap&&c.request.getmap.href,e=c.layers,f=c.exception?c.exception.formats:[],g=this.serviceExceptionFormat(f),h=[];if(d&&e)for(var i,j,k,l,m,n,o=this.recordType.prototype.fields,p=0,q=e.length;q>p;p++)if(i=e[p],i.name){j={};for(var r=0,s=o.length;s>r;r++)m=o.items[r],n=i[m.mapping||m.name]||m.defaultValue,n=m.convert(n),j[m.name]=n;k={attribution:i.attribution?this.attributionMarkup(i.attribution):void 0,minScale:i.minScale,maxScale:i.maxScale},this.meta.layerOptions&&Ext.apply(k,this.meta.layerOptions),l={layers:i.name,exceptions:g,format:this.imageFormat(i),transparent:this.imageTransparent(i),version:b},this.meta.layerParams&&Ext.apply(l,this.meta.layerParams),j.layer=new OpenLayers.Layer.WMS(i.title||i.name,d,l,k),h.push(new this.recordType(j,j.layer.id))}return{totalRecords:h.length,success:!0,records:h}},attributionMarkup:function(a){var b=[];if(a.logo&&b.push("<img class='"+this.attributionCls+"-image' src='"+a.logo.href+"' />"),a.title&&b.push("<span class='"+this.attributionCls+"-title'>"+a.title+"</span>"),a.href)for(var c=0;c<b.length;c++)b[c]="<a class='"+this.attributionCls+"-link' href="+a.href+">"+b[c]+"</a>";return b.join(" ")}}),Ext.namespace("GeoExt.data"),GeoExt.data.LayerStoreMixin=function(){return{map:null,reader:null,constructor:function(a){a=a||{},a.reader=a.reader||new GeoExt.data.LayerReader({},a.fields),delete a.fields;var b=a.map instanceof GeoExt.MapPanel?a.map.map:a.map;delete a.map,a.layers&&(a.data=a.layers),delete a.layers;var c={initDir:a.initDir};delete a.initDir,arguments.callee.superclass.constructor.call(this,a),this.addEvents("bind"),b&&this.bind(b,c)},bind:function(a,b){if(!this.map){this.map=a,b=b||{};var c=b.initDir;void 0==b.initDir&&(c=GeoExt.data.LayerStore.MAP_TO_STORE|GeoExt.data.LayerStore.STORE_TO_MAP);var d=a.layers.slice(0);c&GeoExt.data.LayerStore.STORE_TO_MAP&&this.each(function(a){this.map.addLayer(a.getLayer())},this),c&GeoExt.data.LayerStore.MAP_TO_STORE&&this.loadData(d,!0),a.events.on({changelayer:this.onChangeLayer,addlayer:this.onAddLayer,removelayer:this.onRemoveLayer,scope:this}),this.on({load:this.onLoad,clear:this.onClear,add:this.onAdd,remove:this.onRemove,update:this.onUpdate,scope:this}),this.data.on({replace:this.onReplace,scope:this}),this.fireEvent("bind",this,a)}},unbind:function(){this.map&&(this.map.events.un({changelayer:this.onChangeLayer,addlayer:this.onAddLayer,removelayer:this.onRemoveLayer,scope:this}),this.un("load",this.onLoad,this),this.un("clear",this.onClear,this),this.un("add",this.onAdd,this),this.un("remove",this.onRemove,this),this.data.un("replace",this.onReplace,this),this.map=null)},onChangeLayer:function(a){var b=a.layer,c=this.findBy(function(a){return a.getLayer()===b});if(c>-1){var d=this.getAt(c);if("order"===a.property){if(!this._adding&&!this._removing){var e=this.map.getLayerIndex(b);e!==c&&(this._removing=!0,this.remove(d),delete this._removing,this._adding=!0,this.insert(e,[d]),delete this._adding)}}else"name"===a.property?d.set("title",b.name):this.fireEvent("update",this,d,Ext.data.Record.EDIT)}},onAddLayer:function(a){if(!this._adding){var b=a.layer;this._adding=!0,this.loadData([b],!0),delete this._adding}},onRemoveLayer:function(a){if(this.map.unloadDestroy){if(!this._removing){var b=a.layer;this._removing=!0,this.remove(this.getById(b.id)),delete this._removing}}else this.unbind()},onLoad:function(a,b,c){if(Ext.isArray(b)||(b=[b]),c&&!c.add){this._removing=!0;for(var d=this.map.layers.length-1;d>=0;d--)this.map.removeLayer(this.map.layers[d]);delete this._removing;var e=b.length;if(e>0){for(var f=new Array(e),g=0;e>g;g++)f[g]=b[g].getLayer();this._adding=!0,this.map.addLayers(f),delete this._adding}}},onClear:function(){this._removing=!0;for(var a=this.map.layers.length-1;a>=0;a--)this.map.removeLayer(this.map.layers[a]);delete this._removing},onAdd:function(a,b,c){if(!this._adding){this._adding=!0;for(var d,e=b.length-1;e>=0;--e)d=b[e].getLayer(),this.map.addLayer(d),c!==this.map.layers.length-1&&this.map.setLayerIndex(d,c);delete this._adding}},onRemove:function(a,b){if(!this._removing){var c=b.getLayer();null!=this.map.getLayer(c.id)&&(this._removing=!0,this.removeMapLayer(b),delete this._removing)}},onUpdate:function(a,b,c){if(c===Ext.data.Record.EDIT&&b.modified&&b.modified.title){var d=b.getLayer(),e=b.get("title");e!==d.name&&d.setName(e)}},removeMapLayer:function(a){this.map.removeLayer(a.getLayer())},onReplace:function(a,b){this.removeMapLayer(b)},getByLayer:function(a){var b=this.findBy(function(b){return b.getLayer()===a});return b>-1?this.getAt(b):void 0},destroy:function(){this.unbind(),GeoExt.data.LayerStore.superclass.destroy.call(this)}}},GeoExt.data.LayerStore=Ext.extend(Ext.data.Store,new GeoExt.data.LayerStoreMixin),GeoExt.data.LayerStore.MAP_TO_STORE=1,GeoExt.data.LayerStore.STORE_TO_MAP=2,Ext.namespace("GeoExt.tree"),GeoExt.tree.LayerLoader=function(a){Ext.apply(this,a),this.addEvents("beforeload","load"),GeoExt.tree.LayerLoader.superclass.constructor.call(this)},Ext.extend(GeoExt.tree.LayerLoader,Ext.util.Observable,{store:null,filter:function(a){return 1==a.getLayer().displayInLayerSwitcher},baseAttrs:null,uiProviders:null,load:function(a,b){if(this.fireEvent("beforeload",this,a)){for(this.removeStoreHandlers();a.firstChild;)a.removeChild(a.firstChild);this.uiProviders||(this.uiProviders=a.getOwnerTree().getLoader().uiProviders),this.store||(this.store=GeoExt.MapPanel.guess().layers),this.store.each(function(b){this.addLayerNode(a,b)},this),this.addStoreHandlers(a),"function"==typeof b&&b(),this.fireEvent("load",this,a)}},onStoreAdd:function(a,b,c,d){if(!this._reordering)for(var e=d.recordIndexToNodeIndex(c+b.length-1),f=0;f<b.length;++f)this.addLayerNode(d,b[f],e)},onStoreRemove:function(a,b,c,d){this._reordering||this.removeLayerNode(d,b)},addLayerNode:function(a,b,c){if(c=c||0,this.filter(b)===!0){var d=this.createNode({nodeType:"gx_layer",layer:b.getLayer(),layerStore:this.store}),e=a.item(c);e?a.insertBefore(d,e):a.appendChild(d),d.on("move",this.onChildMove,this)}},removeLayerNode:function(a,b){if(this.filter(b)===!0){var c=a.findChildBy(function(a){return a.layer==b.getLayer()});c&&(c.un("move",this.onChildMove,this),c.remove(),a.reload())}},onChildMove:function(a,b,c,d,e){this._reordering=!0;var f=this.store.getByLayer(b.layer);if(d instanceof GeoExt.tree.LayerContainer&&this.store===d.loader.store){d.loader._reordering=!0,this.store.remove(f);var g;if(d.childNodes.length>1){var h=0===e?e+1:e-1;g=this.store.findBy(function(a){return d.childNodes[h].layer===a.getLayer()}),0===e&&g++}else if(c.parentNode===d.parentNode){var i=d;do i=i.previousSibling;while(i&&!(i instanceof GeoExt.tree.LayerContainer&&i.lastChild));if(i)g=this.store.findBy(function(a){return i.lastChild.layer===a.getLayer()});else{var j=d;do j=j.nextSibling;while(j&&!(j instanceof GeoExt.tree.LayerContainer&&j.firstChild));j&&(g=this.store.findBy(function(a){return j.firstChild.layer===a.getLayer()})),g++}}void 0!==g?(this.store.insert(g,[f]),window.setTimeout(function(){d.reload(),c.reload()})):this.store.insert(oldRecordIndex,[f]),delete d.loader._reordering}delete this._reordering},addStoreHandlers:function(a){if(!this._storeHandlers){this._storeHandlers={add:this.onStoreAdd.createDelegate(this,[a],!0),remove:this.onStoreRemove.createDelegate(this,[a],!0)};for(var b in this._storeHandlers)this.store.on(b,this._storeHandlers[b],this)}},removeStoreHandlers:function(){if(this._storeHandlers){for(var a in this._storeHandlers)this.store.un(a,this._storeHandlers[a],this);delete this._storeHandlers}},createNode:function(attr){return this.baseAttrs&&Ext.apply(attr,this.baseAttrs),"string"==typeof attr.uiProvider&&(attr.uiProvider=this.uiProviders[attr.uiProvider]||eval(attr.uiProvider)),attr.nodeType=attr.nodeType||"gx_layer",new Ext.tree.TreePanel.nodeTypes[attr.nodeType](attr)},destroy:function(){this.removeStoreHandlers()}}),Ext.namespace("GeoExt.plugins"),GeoExt.plugins.PrintProviderField=Ext.extend(Ext.util.Observable,{target:null,constructor:function(a){this.initialConfig=a,Ext.apply(this,a),GeoExt.plugins.PrintProviderField.superclass.constructor.apply(this,arguments)},init:function(a){this.target=a;var b={scope:this,render:this.onRender,beforedestroy:this.onBeforeDestroy};b[a instanceof Ext.form.ComboBox?"select":"valid"]=this.onFieldChange,a.on(b)},onRender:function(a){var b=this.printProvider||a.ownerCt.printProvider;a.store===b.layouts?(a.setValue(b.layout.get(a.displayField)),b.on({layoutchange:this.onProviderChange,scope:this})):a.store===b.dpis?(a.setValue(b.dpi.get(a.displayField)),b.on({dpichange:this.onProviderChange,scope:this})):void 0===a.initialConfig.value&&a.setValue(b.customParams[a.name])},onFieldChange:function(a,b){var c=this.printProvider||a.ownerCt.printProvider,d=a.getValue();if(this._updating=!0,b)switch(a.store){case c.layouts:c.setLayout(b);break;case c.dpis:c.setDpi(b)}else c.customParams[a.name]=d;delete this._updating},onProviderChange:function(a,b){this._updating||this.target.setValue(b.get(this.target.displayField))},onBeforeDestroy:function(){var a=this.target;
a.un("beforedestroy",this.onBeforeDestroy,this),a.un("render",this.onRender,this),a.un("select",this.onFieldChange,this),a.un("valid",this.onFieldChange,this);var b=this.printProvider||a.ownerCt.printProvider;b.un("layoutchange",this.onProviderChange,this),b.un("dpichange",this.onProviderChange,this)}}),Ext.preg("gx_printproviderfield",GeoExt.plugins.PrintProviderField),Ext.namespace("GeoExt","GeoExt.data"),GeoExt.data.LayerReader=function(a,b){a=a||{},b instanceof Function||(b=GeoExt.data.LayerRecord.create(b||a.fields||{})),GeoExt.data.LayerReader.superclass.constructor.call(this,a,b)},Ext.extend(GeoExt.data.LayerReader,Ext.data.DataReader,{totalRecords:null,readRecords:function(a){var b=[];if(a){var c,d,e,f,g,h,i,j,k=this.recordType,l=k.prototype.fields;for(c=0,d=a.length;d>c;c++){for(g=a[c],h={},e=0,f=l.length;f>e;e++)i=l.items[e],j=g[i.mapping||i.name]||i.defaultValue,j=i.convert(j),h[i.name]=j;h.layer=g,b[b.length]=new k(h,g.id)}}return{records:b,totalRecords:null!=this.totalRecords?this.totalRecords:b.length}}}),Ext.namespace("GeoExt.data"),GeoExt.data.WMSDescribeLayerStore=function(a){a=a||{},GeoExt.data.WMSDescribeLayerStore.superclass.constructor.call(this,Ext.apply(a,{proxy:a.proxy||(a.data?void 0:new Ext.data.HttpProxy({url:a.url,disableCaching:!1,method:"GET"})),reader:new GeoExt.data.WMSDescribeLayerReader(a,a.fields)}))},Ext.extend(GeoExt.data.WMSDescribeLayerStore,Ext.data.Store),Ext.namespace("GeoExt.form"),GeoExt.form.BasicForm=Ext.extend(Ext.form.BasicForm,{protocol:null,prevResponse:null,autoAbort:!0,doAction:function(a,b){return"search"==a&&(b=Ext.applyIf(b||{},{protocol:this.protocol,abortPrevious:this.autoAbort}),a=new GeoExt.form.SearchAction(this,b)),GeoExt.form.BasicForm.superclass.doAction.call(this,a,b)},search:function(a){return this.doAction("search",a)}}),Ext.namespace("GeoExt.plugins"),GeoExt.plugins.TreeNodeRadioButton=Ext.extend(Ext.util.Observable,{constructor:function(a){Ext.apply(this.initialConfig,Ext.apply({},a)),Ext.apply(this,a),this.addEvents("radiochange"),GeoExt.plugins.TreeNodeRadioButton.superclass.constructor.apply(this,arguments)},init:function(a){a.on({rendernode:this.onRenderNode,rawclicknode:this.onRawClickNode,beforedestroy:this.onBeforeDestroy,scope:this})},onRenderNode:function(a){var b=a.attributes;b.radioGroup&&!b.radio&&(b.radio=Ext.DomHelper.insertBefore(a.ui.anchor,['<input type="radio" class="gx-tree-radio" name="',b.radioGroup,'_radio"></input>'].join("")))},onRawClickNode:function(a,b){var c=b.getTarget(".gx-tree-radio",1);return c?(c.defaultChecked=c.checked,this.fireEvent("radiochange",a),!1):void 0},onBeforeDestroy:function(a){a.un("rendernode",this.onRenderNode,this),a.un("rawclicknode",this.onRawClickNode,this),a.un("beforedestroy",this.onBeforeDestroy,this)}}),Ext.preg("gx_treenoderadiobutton",GeoExt.plugins.TreeNodeRadioButton),Ext.namespace("GeoExt.data"),GeoExt.data.StyleReader=Ext.extend(Ext.data.JsonReader,{onMetaChange:function(){GeoExt.data.StyleReader.superclass.onMetaChange.apply(this,arguments),this.recordType.prototype.commit=Ext.createInterceptor(this.recordType.prototype.commit,function(){var a=this.store.reader;a.raw[a.meta.root]=a.meta.storeToData(this.store)})},readRecords:function(a){var b;b=a instanceof OpenLayers.Symbolizer.Raster?"colorMap":"rules",this.raw=a,Ext.applyIf(this.meta,GeoExt.data.StyleReader.metaData[b]);var c={metaData:this.meta};return c[b]=a[b],GeoExt.data.StyleReader.superclass.readRecords.call(this,c)}}),GeoExt.data.StyleReader.metaData={colorMap:{root:"colorMap",idProperty:"filter",fields:[{name:"symbolizers",mapping:function(a){return{fillColor:a.color,fillOpacity:a.opacity,stroke:!1}}},{name:"filter",mapping:"quantity",type:"float"},{name:"label",mapping:function(a){return a.label||a.quantity}}],storeToData:function(a){a.sort("filter","ASC");var b=[];return a.each(function(a){var c=a.get("symbolizers"),d=a.get("label"),e=a.isModified("label"),f=Number(a.get("filter"));a.data.filter=f,(!a.json.label&&!e&&a.isModified("filter")||e&&!d)&&(a.data.label=f),b.push(Ext.apply(a.json,{color:c.fillColor,label:"string"==typeof d?d:void 0,opacity:c.opacity,quantity:f}))}),b}},rules:{root:"rules",fields:["symbolizers","filter",{name:"label",mapping:"title"},"name","description","elseFilter","minScaleDenominator","maxScaleDenominator"],storeToData:function(a){var b=[];return a.each(function(a){var c=a.get("filter");"string"==typeof c&&(c=c?OpenLayers.Format.CQL.prototype.read(c):null),b.push(Ext.apply(a.json,{symbolizers:a.get("symbolizers"),filter:c,title:a.get("label"),name:a.get("name"),description:a.get("description"),elseFilter:a.get("elseFilter"),minScaleDenominator:a.get("minScaleDenominator"),maxScaleDenominator:a.get("maxScaleDenominator")}))}),b}}},Ext.namespace("GeoExt","GeoExt.data"),GeoExt.data.FeatureReader=function(a,b){a=a||{},b instanceof Function||(b=GeoExt.data.FeatureRecord.create(b||a.fields||{})),GeoExt.data.FeatureReader.superclass.constructor.call(this,a,b)},Ext.extend(GeoExt.data.FeatureReader,Ext.data.DataReader,{totalRecords:null,read:function(a){return this.readRecords(a.features)},readRecords:function(a){var b=[];if(a){var c,d,e,f,g,h,i,j,k=this.recordType,l=k.prototype.fields;for(c=0,d=a.length;d>c;c++){if(g=a[c],h={},g.attributes)for(e=0,f=l.length;f>e;e++){if(i=l.items[e],/[\[\.]/.test(i.mapping))try{j=new Function("obj","return obj."+i.mapping)(g.attributes)}catch(m){j=i.defaultValue}else j=g.attributes[i.mapping||i.name]||i.defaultValue;i.convert&&(j=i.convert(j)),h[i.name]=j}h.feature=g,h.state=g.state,h.fid=g.fid;var n=g.state===OpenLayers.State.INSERT?void 0:g.id;b[b.length]=new k(h,n)}}return{records:b,totalRecords:null!=this.totalRecords?this.totalRecords:b.length}}}),Ext.namespace("GeoExt"),GeoExt.WMSLegend=Ext.extend(GeoExt.LayerLegend,{defaultStyleIsFirst:!0,useScaleParameter:!0,baseParams:null,initComponent:function(){GeoExt.WMSLegend.superclass.initComponent.call(this);var a=this.layerRecord.getLayer();this._noMap=!a.map,a.events.register("moveend",this,this.onLayerMoveend),this.update()},onLayerMoveend:function(a){(a.zoomChanged===!0&&this.useScaleParameter===!0||this._noMap)&&(delete this._noMap,this.update())},getLegendUrl:function(a,b){var c,d=this.layerRecord,e=d&&d.get("styles"),f=d.getLayer();b=b||[f.params.LAYERS].join(",").split(",");var g=f.params.STYLES&&[f.params.STYLES].join(",").split(","),h=b.indexOf(a),i=g&&g[h];if(e&&e.length>0&&(i?Ext.each(e,function(a){return c=a.name==i&&a.legend&&a.legend.href,!c}):this.defaultStyleIsFirst!==!0||g||f.params.SLD||f.params.SLD_BODY||(c=e[0].legend&&e[0].legend.href)),c||(c=f.getFullRequestString({REQUEST:"GetLegendGraphic",WIDTH:null,HEIGHT:null,EXCEPTIONS:"application/vnd.ogc.se_xml",LAYER:a,LAYERS:null,STYLE:""!==i?i:null,STYLES:null,SRS:null,FORMAT:null,TIME:null})),-1!=c.toLowerCase().indexOf("request=getlegendgraphic")&&(-1==c.toLowerCase().indexOf("format=")&&(c=Ext.urlAppend(c,"FORMAT=image/gif")),this.useScaleParameter===!0)){var j=f.map.getScale();c=Ext.urlAppend(c,"SCALE="+j)}var k=Ext.apply({},this.baseParams);return f.params._OLSALT&&(k._OLSALT=f.params._OLSALT),c=Ext.urlAppend(c,Ext.urlEncode(k))},update:function(){var a=this.layerRecord.getLayer();if(a&&a.map){GeoExt.WMSLegend.superclass.update.apply(this,arguments);var b,c,d,e;b=[a.params.LAYERS].join(",").split(",");var f=[],g=this.items.get(0);for(this.items.each(function(a){if(d=b.indexOf(a.itemId),0>d&&a!=g)f.push(a);else if(a!==g){c=b[d];var e=this.getLegendUrl(c,b);OpenLayers.Util.isEquivalentUrl(e,a.url)||a.setUrl(e)}},this),d=0,e=f.length;e>d;d++){var h=f[d];this.remove(h),h.destroy()}for(d=0,e=b.length;e>d;d++)c=b[d],this.items&&this.getComponent(c)||this.add({xtype:"gx_legendimage",url:this.getLegendUrl(c,b),itemId:c});this.doLayout()}},beforeDestroy:function(){if(this.useScaleParameter===!0){var a=this.layerRecord.getLayer();a&&a.events&&a.events.unregister("moveend",this,this.onLayerMoveend)}GeoExt.WMSLegend.superclass.beforeDestroy.apply(this,arguments)}}),GeoExt.WMSLegend.supports=function(a){return a.getLayer()instanceof OpenLayers.Layer.WMS?1:0},GeoExt.LayerLegend.types.gx_wmslegend=GeoExt.WMSLegend,Ext.reg("gx_wmslegend",GeoExt.WMSLegend),Ext.namespace("GeoExt.data"),GeoExt.data.WMSDescribeLayerReader=function(a,b){a=a||{},a.format||(a.format=new OpenLayers.Format.WMSDescribeLayer),"function"!=typeof b&&(b=Ext.data.Record.create(b||a.fields||[{name:"owsType",type:"string"},{name:"owsURL",type:"string"},{name:"typeName",type:"string"}])),GeoExt.data.WMSDescribeLayerReader.superclass.constructor.call(this,a,b)},Ext.extend(GeoExt.data.WMSDescribeLayerReader,Ext.data.DataReader,{read:function(a){var b=a.responseXML;return b&&b.documentElement||(b=a.responseText),this.readRecords(b)},readRecords:function(a){("string"==typeof a||a.nodeType)&&(a=this.meta.format.read(a));for(var b,c=[],d=0,e=a.length;e>d;d++)b=a[d],b&&c.push(new this.recordType(b));return{totalRecords:c.length,success:!0,records:c}}}),Ext.namespace("GeoExt.form"),GeoExt.form.SearchAction=Ext.extend(Ext.form.Action,{type:"search",response:null,constructor:function(a,b){GeoExt.form.SearchAction.superclass.constructor.call(this,a,b)},run:function(){var a=this.options,b=GeoExt.form.toFilter(this.form,a.logicalOp,a.wildcard);a.clientValidation===!1||this.form.isValid()?(a.abortPrevious&&this.form.prevResponse&&a.protocol.abort(this.form.prevResponse),this.form.prevResponse=a.protocol.read(Ext.applyIf({filter:b,callback:this.handleResponse,scope:this},a))):a.clientValidation!==!1&&(this.failureType=Ext.form.Action.CLIENT_INVALID,this.form.afterAction(this,!1))},handleResponse:function(a){this.form.prevResponse=null,this.response=a,a.success()?this.form.afterAction(this,!0):this.form.afterAction(this,!1);var b=this.options;b.callback&&b.callback.call(b.scope,a)}}),Ext.namespace("GeoExt.data"),GeoExt.data.FeatureRecord=Ext.data.Record.create([{name:"feature"},{name:"state"},{name:"fid"}]),GeoExt.data.FeatureRecord.prototype.getFeature=function(){return this.get("feature")},GeoExt.data.FeatureRecord.prototype.setFeature=function(a){a!==this.data.feature&&(this.dirty=!0,this.modified||(this.modified={}),void 0===this.modified.feature&&(this.modified.feature=this.data.feature),this.data.feature=a,this.editing||this.afterEdit())},GeoExt.data.FeatureRecord.create=function(a){var b=Ext.extend(GeoExt.data.FeatureRecord,{}),c=b.prototype;if(c.fields=new Ext.util.MixedCollection(!1,function(a){return a.name}),GeoExt.data.FeatureRecord.prototype.fields.each(function(a){c.fields.add(a)}),a)for(var d=0,e=a.length;e>d;d++)c.fields.add(new Ext.data.Field(a[d]));return b.getField=function(a){return c.fields.get(a)},b},Ext.namespace("GeoExt.tree"),GeoExt.tree.LayerParamLoader=function(a){Ext.apply(this,a),this.addEvents("beforeload","load"),GeoExt.tree.LayerParamLoader.superclass.constructor.call(this)},Ext.extend(GeoExt.tree.LayerParamLoader,Ext.util.Observable,{param:null,delimiter:",",load:function(a,b){if(this.fireEvent("beforeload",this,a)){for(;a.firstChild;)a.removeChild(a.firstChild);var c=a.layer instanceof OpenLayers.Layer.HTTPRequest&&a.layer.params[this.param];if(c){var d=c instanceof Array?c.slice():c.split(this.delimiter);Ext.each(d,function(b,c,d){this.addParamNode(b,d,a)},this)}"function"==typeof b&&b(),this.fireEvent("load",this,a)}},addParamNode:function(a,b,c){var d=this.createNode({layer:c.layer,param:this.param,item:a,allItems:b,delimiter:this.delimiter}),e=c.item(0);e?c.insertBefore(d,e):c.appendChild(d)},createNode:function(attr){return this.baseAttrs&&Ext.apply(attr,this.baseAttrs),"string"==typeof attr.uiProvider&&(attr.uiProvider=this.uiProviders[attr.uiProvider]||eval(attr.uiProvider)),attr.nodeType=attr.nodeType||"gx_layerparam",new Ext.tree.TreePanel.nodeTypes[attr.nodeType](attr)}}),Ext.namespace("GeoExt.data"),GeoExt.data.PrintPage=Ext.extend(Ext.util.Observable,{printProvider:null,feature:null,center:null,scale:null,rotation:0,customParams:null,constructor:function(a){this.initialConfig=a,Ext.apply(this,a),this.customParams||(this.customParams={}),this.addEvents("change"),GeoExt.data.PrintPage.superclass.constructor.apply(this,arguments),this.feature=new OpenLayers.Feature.Vector(OpenLayers.Geometry.fromWKT("POLYGON((-1 -1,1 -1,1 1,-1 1,-1 -1))")),this.printProvider.capabilities?this.setScale(this.printProvider.scales.getAt(0)):this.printProvider.on({loadcapabilities:function(){this.setScale(this.printProvider.scales.getAt(0))},scope:this,single:!0}),this.printProvider.on({layoutchange:this.onLayoutChange,scope:this})},getPrintExtent:function(a){return a=a instanceof GeoExt.MapPanel?a.map:a,this.calculatePageBounds(this.scale,a.getUnits())},setScale:function(a,b){var c=this.calculatePageBounds(a,b),d=c.toGeometry(),e=this.rotation;0!=e&&d.rotate(-e,d.getCentroid()),this.updateFeature(d,{scale:a})},setCenter:function(a){var b=this.feature.geometry,c=b.getBounds().getCenterLonLat(),d=a.lon-c.lon,e=a.lat-c.lat;b.move(d,e),this.updateFeature(b,{center:a})},setRotation:function(a,b){if(b||this.printProvider.layout.get("rotation")===!0){var c=this.feature.geometry;c.rotate(this.rotation-a,c.getCentroid()),this.updateFeature(c,{rotation:a})}},fit:function(a,b){b=b||{};var c,d=a;if(a instanceof GeoExt.MapPanel?d=a.map:a instanceof OpenLayers.Feature.Vector&&(d=a.layer.map,c=a.geometry.getBounds()),c||(c=d.getExtent())){this._updating=!0;var e=c.getCenterLonLat();this.setCenter(e);var f=d.getUnits(),g=this.printProvider.scales.getAt(0),h=Number.POSITIVE_INFINITY,i=c.getWidth(),j=c.getHeight();this.printProvider.scales.each(function(a){var d=this.calculatePageBounds(a,f);if("closest"!=b.mode){var e="screen"==b.mode?!c.containsBounds(d):d.containsBounds(c);return(e||"screen"==b.mode&&!e)&&(g=a),e}var k=Math.abs(d.getWidth()-i)+Math.abs(d.getHeight()-j);h>k&&(h=k,g=a)},this),this.setScale(g,f),delete this._updating,this.updateFeature(this.feature.geometry,{center:e,scale:g})}},updateFeature:function(a,b){var c=this.feature,d=c.geometry!==a;if(a.id=c.geometry.id,c.geometry=a,!this._updating){for(var e in b)b[e]===this[e]?delete b[e]:(this[e]=b[e],d=!0);Ext.apply(this,b),c.layer&&c.layer.drawFeature(c),d&&this.fireEvent("change",this,b)}},calculatePageBounds:function(a,b){var c=a.get("value"),d=this.feature,e=this.feature.geometry,f=e.getBounds().getCenterLonLat(),g=this.printProvider.layout.get("size"),b=b||d.layer&&d.layer.map&&d.layer.map.getUnits()||"dd",h=OpenLayers.INCHES_PER_UNIT[b],i=g.width/72/h*c/2,j=g.height/72/h*c/2;return new OpenLayers.Bounds(f.lon-i,f.lat-j,f.lon+i,f.lat+j)},onLayoutChange:function(){this.printProvider.layout.get("rotation")===!1&&this.setRotation(0,!0),this.scale&&this.setScale(this.scale)},destroy:function(){this.printProvider.un("layoutchange",this.onLayoutChange,this)}}),Ext.namespace("GeoExt.data"),GeoExt.data.LayerRecord=Ext.data.Record.create([{name:"layer"},{name:"title",type:"string",mapping:"name"}]),GeoExt.data.LayerRecord.prototype.getLayer=function(){return this.get("layer")},GeoExt.data.LayerRecord.prototype.setLayer=function(a){a!==this.data.layer&&(this.dirty=!0,this.modified||(this.modified={}),void 0===this.modified.layer&&(this.modified.layer=this.data.layer),this.data.layer=a,this.editing||this.afterEdit())},GeoExt.data.LayerRecord.prototype.clone=function(a){var b=this.getLayer()&&this.getLayer().clone();return new this.constructor(Ext.applyIf({layer:b},this.data),a||b.id)},GeoExt.data.LayerRecord.create=function(a){var b=Ext.extend(GeoExt.data.LayerRecord,{}),c=b.prototype;if(c.fields=new Ext.util.MixedCollection(!1,function(a){return a.name}),GeoExt.data.LayerRecord.prototype.fields.each(function(a){c.fields.add(a)}),a)for(var d=0,e=a.length;e>d;d++)c.fields.add(new Ext.data.Field(a[d]));return b.getField=function(a){return c.fields.get(a)},b},Ext.namespace("GeoExt.form"),GeoExt.form.toFilter=function(a,b,c){a instanceof Ext.form.FormPanel&&(a=a.getForm());var d=[],e=a.getValues(!1);for(var f in e){var g,h=f.split("__"),i=e[f];if(h.length>1&&void 0!==(g=GeoExt.form.toFilter.FILTER_MAP[h[1]])?f=h[0]:g=OpenLayers.Filter.Comparison.EQUAL_TO,g===OpenLayers.Filter.Comparison.LIKE)switch(c){case GeoExt.form.ENDS_WITH:i=".*"+i;break;case GeoExt.form.STARTS_WITH:i+=".*";break;case GeoExt.form.CONTAINS:i=".*"+i+".*"}d.push(new OpenLayers.Filter.Comparison({type:g,value:i,property:f}))}return 1==d.length&&b!=OpenLayers.Filter.Logical.NOT?d[0]:new OpenLayers.Filter.Logical({type:b||OpenLayers.Filter.Logical.AND,filters:d})},GeoExt.form.toFilter.FILTER_MAP={eq:OpenLayers.Filter.Comparison.EQUAL_TO,ne:OpenLayers.Filter.Comparison.NOT_EQUAL_TO,lt:OpenLayers.Filter.Comparison.LESS_THAN,le:OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO,gt:OpenLayers.Filter.Comparison.GREATER_THAN,ge:OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO,like:OpenLayers.Filter.Comparison.LIKE},GeoExt.form.ENDS_WITH=1,GeoExt.form.STARTS_WITH=2,GeoExt.form.CONTAINS=3,GeoExt.form.recordToField=function(a,b){b=b||{};var c=a.get("type");if("object"==typeof c&&c.xtype)return c;c=c.split(":").pop();var d,e=a.get("name"),f=a.get("restriction")||{},g=a.get("nillable")||!1,h=a.get("label"),i=b.labelTpl;if(i){var j=i instanceof Ext.Template?i:new Ext.XTemplate(i);h=j.apply(a.data)}else null==h&&(h=e);var k={name:e,labelStyle:g?"":null!=b.mandatoryFieldLabelStyle?b.mandatoryFieldLabelStyle:"font-weight:bold;"},l=GeoExt.form.recordToField.REGEXES;if(c.match(l.text)){var m=void 0!==f.maxLength?parseFloat(f.maxLength):void 0,n=void 0!==f.minLength?parseFloat(f.minLength):void 0;d=Ext.apply({xtype:"textfield",fieldLabel:h,maxLength:m,minLength:n},k)}else if(c.match(l.number)){var o=void 0!==f.maxInclusive?parseFloat(f.maxInclusive):void 0,p=void 0!==f.minInclusive?parseFloat(f.minInclusive):void 0;d=Ext.apply({xtype:"numberfield",fieldLabel:h,maxValue:o,minValue:p},k)}else if(c.match(l["boolean"])){d=Ext.apply({xtype:"checkbox"},k);var q=b.checkboxLabelProperty||"boxLabel";d[q]=h}else c.match(l.date)&&(d=Ext.apply({xtype:"datefield",fieldLabel:h,format:"c"},k));return d},GeoExt.form.recordToField.REGEXES={text:new RegExp("^(text|string)$","i"),number:new RegExp("^(number|float|decimal|double|int|long|integer|short)$","i"),"boolean":new RegExp("^(boolean)$","i"),date:new RegExp("^(date|dateTime)$","i")},Ext.namespace("GeoExt"),GeoExt.FeatureRenderer=Ext.extend(Ext.BoxComponent,{feature:void 0,symbolizers:[OpenLayers.Feature.Vector.style["default"]],symbolType:"Polygon",resolution:1,minWidth:20,minHeight:20,renderers:["SVG","VML","Canvas"],rendererOptions:null,pointFeature:void 0,lineFeature:void 0,polygonFeature:void 0,renderer:null,initComponent:function(){GeoExt.FeatureRenderer.superclass.initComponent.apply(this,arguments),Ext.applyIf(this,{pointFeature:new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(0,0)),lineFeature:new OpenLayers.Feature.Vector(new OpenLayers.Geometry.LineString([new OpenLayers.Geometry.Point(-8,-3),new OpenLayers.Geometry.Point(-3,3),new OpenLayers.Geometry.Point(3,-3),new OpenLayers.Geometry.Point(8,3)])),polygonFeature:new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing([new OpenLayers.Geometry.Point(-8,-4),new OpenLayers.Geometry.Point(-6,-6),new OpenLayers.Geometry.Point(6,-6),new OpenLayers.Geometry.Point(8,-4),new OpenLayers.Geometry.Point(8,4),new OpenLayers.Geometry.Point(6,6),new OpenLayers.Geometry.Point(-6,6),new OpenLayers.Geometry.Point(-8,4)])]))}),this.feature||this.setFeature(null,{draw:!1}),this.addEvents("click")},initCustomEvents:function(){this.clearCustomEvents(),this.el.on("click",this.onClick,this)},clearCustomEvents:function(){this.el&&this.el.removeAllListeners&&this.el.removeAllListeners()},onClick:function(){this.fireEvent("click",this)},onRender:function(){this.el||(this.el=document.createElement("div"),this.el.id=this.getId()),this.renderer&&this.renderer.supported()||this.assignRenderer(),this.renderer.map={getResolution:function(){return this.resolution}.createDelegate(this)},GeoExt.FeatureRenderer.superclass.onRender.apply(this,arguments),this.drawFeature()},afterRender:function(){GeoExt.FeatureRenderer.superclass.afterRender.apply(this,arguments),this.initCustomEvents()},onResize:function(){this.setRendererDimensions(),GeoExt.FeatureRenderer.superclass.onResize.apply(this,arguments)},setRendererDimensions:function(){var a=this.feature.geometry.getBounds(),b=a.getWidth(),c=a.getHeight(),d=this.initialConfig.resolution;d||(d=Math.max(b/this.width||0,c/this.height||0)||1),this.resolution=d;var e=Math.max(this.width||this.minWidth,b/d),f=Math.max(this.height||this.minHeight,c/d),g=a.getCenterPixel(),h=e*d/2,i=f*d/2,j=new OpenLayers.Bounds(g.x-h,g.y-i,g.x+h,g.y+i);this.renderer.setSize(new OpenLayers.Size(Math.round(e),Math.round(f))),this.renderer.setExtent(j,!0)},assignRenderer:function(){for(var a=0,b=this.renderers.length;b>a;++a){var c=OpenLayers.Renderer[this.renderers[a]];if(c&&c.prototype.supported()){this.renderer=new c(this.el,this.rendererOptions);break}}},setSymbolizers:function(a,b){this.symbolizers=a,(!b||b.draw)&&this.drawFeature()},setSymbolType:function(a,b){this.symbolType=a,this.setFeature(null,b)},setFeature:function(a,b){this.feature=a||this[this.symbolType.toLowerCase()+"Feature"],(!b||b.draw)&&this.drawFeature()},drawFeature:function(){this.renderer.clear(),this.setRendererDimensions();for(var a,b,c,d=OpenLayers.Symbolizer,e=d&&d.Text,f=0,g=this.symbolizers.length;g>f;++f)a=this.symbolizers[f],b=this.feature,e&&a instanceof e||(d&&a instanceof d?(a=a.clone(),this.initialConfig.feature||(c=a.CLASS_NAME.split(".").pop().toLowerCase(),b=this[c+"Feature"])):a=Ext.apply({},a),this.renderer.drawFeature(b.clone(),a))},update:function(a){a=a||{},a.feature?this.setFeature(a.feature,{draw:!1}):a.symbolType&&this.setSymbolType(a.symbolType,{draw:!1}),a.symbolizers&&this.setSymbolizers(a.symbolizers,{draw:!1}),this.drawFeature()},beforeDestroy:function(){this.clearCustomEvents(),this.renderer&&this.renderer.destroy()}}),Ext.reg("gx_renderer",GeoExt.FeatureRenderer),Ext.namespace("GeoExt"),GeoExt.Popup=Ext.extend(Ext.Window,{anchored:!0,map:null,panIn:!0,unpinnable:!0,location:null,insideViewport:null,animCollapse:!1,draggable:!1,shadow:!1,popupCls:"gx-popup",ancCls:null,anchorPosition:"auto",initComponent:function(){this.map instanceof GeoExt.MapPanel&&(this.map=this.map.map),!this.map&&this.location instanceof OpenLayers.Feature.Vector&&this.location.layer&&(this.map=this.location.layer.map),this.location instanceof OpenLayers.Feature.Vector&&(this.location=this.location.geometry),this.location instanceof OpenLayers.Geometry?("function"==typeof this.location.getCentroid&&(this.location=this.location.getCentroid()),this.location=this.location.getBounds().getCenterLonLat()):this.location instanceof OpenLayers.Pixel&&(this.location=this.map.getLonLatFromViewPortPx(this.location));var a=this.map.getExtent();a&&this.location&&(this.insideViewport=a.containsLonLat(this.location)),this.anchored&&this.addAnchorEvents(),this.baseCls=this.popupCls+" "+this.baseCls,this.elements+=",anc",GeoExt.Popup.superclass.initComponent.call(this)},onRender:function(a,b){GeoExt.Popup.superclass.onRender.call(this,a,b),this.ancCls=this.popupCls+"-anc",this.createElement("anc",this.el.dom)},initTools:function(){this.unpinnable&&this.addTool({id:"unpin",handler:this.unanchorPopup.createDelegate(this,[])}),GeoExt.Popup.superclass.initTools.call(this)},show:function(){GeoExt.Popup.superclass.show.apply(this,arguments),this.anchored&&(this.position(),this.panIn&&!this._mapMove&&this.panIntoView())},maximize:function(){!this.maximized&&this.anc&&this.unanchorPopup(),GeoExt.Popup.superclass.maximize.apply(this,arguments)},setSize:function(a,b){if(this.anc){var c=this.anc.getSize();"object"==typeof a?(b=a.height-c.height,a=a.width):isNaN(b)||(b-=c.height)}GeoExt.Popup.superclass.setSize.call(this,a,b)},position:function(){if(this._mapMove===!0&&(this.insideViewport=this.map.getExtent().containsLonLat(this.location),this.insideViewport!==this.isVisible()&&this.setVisible(this.insideViewport)),this.isVisible()){var a=this.map.getPixelFromLonLat(this.location),b=Ext.fly(this.map.div).getBox(!0),c=a.y+b.y,d=a.x+b.x,e=this.el.getSize(),f=this.anc.getSize(),g=this.anchorPosition;if(g.indexOf("right")>-1||a.x>b.width/2){this.anc.addClass("right");var h=this.el.getX(!0)+e.width-this.anc.getX(!0)-f.width;d-=e.width-h-f.width/2}else{this.anc.removeClass("right");var i=this.anc.getLeft(!0);d-=i+f.width/2}g.indexOf("bottom")>-1||a.y>b.height/2?(this.anc.removeClass("top"),c-=e.height+f.height):(this.anc.addClass("top"),c+=f.height),this.setPosition(d,c)}},unanchorPopup:function(){this.removeAnchorEvents(),this.draggable=!0,this.header.addClass("x-window-draggable"),this.dd=new Ext.Window.DD(this),this.anc.remove(),this.anc=null,this.tools.unpin.hide()},panIntoView:function(){var a=Ext.fly(this.map.div).getBox(!0),b=this.getPosition(!0);b[0]-=a.x,b[1]-=a.y;var c=[a.width,a.height],d=this.getSize(),e=[b[0],b[1]],f=this.map.paddingForPopups;b[0]<f.left?e[0]=f.left:b[0]+d.width>c[0]-f.right&&(e[0]=c[0]-f.right-d.width),b[1]<f.top?e[1]=f.top:b[1]+d.height>c[1]-f.bottom&&(e[1]=c[1]-f.bottom-d.height);var g=b[0]-e[0],h=b[1]-e[1];this.map.pan(g,h)},onMapMove:function(){this.hidden&&this.insideViewport||(this._mapMove=!0,this.position(),delete this._mapMove)},addAnchorEvents:function(){this.map.events.on({move:this.onMapMove,scope:this}),this.on({resize:this.position,collapse:this.position,expand:this.position,scope:this})},removeAnchorEvents:function(){this.map.events.un({move:this.onMapMove,scope:this}),this.un("resize",this.position,this),this.un("collapse",this.position,this),this.un("expand",this.position,this)},beforeDestroy:function(){this.anchored&&this.removeAnchorEvents(),GeoExt.Popup.superclass.beforeDestroy.call(this)}}),Ext.reg("gx_popup",GeoExt.Popup),Ext.namespace("GeoExt.data"),GeoExt.data.AttributeStoreMixin=function(){return{constructor:function(a){a=a||{},arguments.callee.superclass.constructor.call(this,Ext.apply(a,{proxy:a.proxy||(a.data?void 0:new Ext.data.HttpProxy({url:a.url,disableCaching:!1,method:"GET"})),reader:new GeoExt.data.AttributeReader(a,a.fields||["name","type","restriction",{name:"nillable",type:"boolean"}])})),this.feature&&this.bind()},bind:function(){this.on({update:this.onUpdate,load:this.onLoad,add:this.onAdd,scope:this});var a=[];this.each(function(b){a.push(b)}),this.updateFeature(a)},onUpdate:function(a,b){this.updateFeature([b])},onLoad:function(a,b,c){c&&c.add===!0||this.updateFeature(b)},onAdd:function(a,b){this.updateFeature(b)},updateFeature:function(a){var b,c,d,e,f,g,h,i=this.feature,j=i.layer;for(b=0,c=a.length;c>b;b++)d=a[b],e=d.get("name"),f=d.get("value"),g=i.attributes[e],g!==f&&(h=!0);if(h&&j&&j.events&&j.events.triggerEvent("beforefeaturemodified",{feature:i})!==!1){for(b=0,c=a.length;c>b;b++)d=a[b],e=d.get("name"),f=d.get("value"),i.attributes[e]=f;j.events.triggerEvent("featuremodified",{feature:i}),j.drawFeature(i)}}}},GeoExt.data.AttributeStore=Ext.extend(Ext.data.Store,GeoExt.data.AttributeStoreMixin()),Ext.namespace("GeoExt.form"),GeoExt.form.FormPanel=Ext.extend(Ext.form.FormPanel,{protocol:null,createForm:function(){return delete this.initialConfig.listeners,new GeoExt.form.BasicForm(null,this.initialConfig)},search:function(a){this.getForm().search(a)}}),Ext.reg("gx_formpanel",GeoExt.form.FormPanel),Ext.namespace("GeoExt.data"),GeoExt.data.WMCReader=function(a,b){a=a||{},a.format||(a.format=new OpenLayers.Format.WMC),"function"!=typeof b&&(b=GeoExt.data.LayerRecord.create(b||a.fields||[{name:"abstract",type:"string"},{name:"metadataURL",type:"string"},{name:"queryable",type:"boolean"},{name:"formats"},{name:"styles"}])),GeoExt.data.WMCReader.superclass.constructor.call(this,a,b)},Ext.extend(GeoExt.data.WMCReader,Ext.data.DataReader,{read:function(a){var b=a.responseXML;return b&&b.documentElement||(b=a.responseText),this.readRecords(b)},readRecords:function(a){var b=this.meta.format;("string"==typeof a||a.nodeType)&&(a=b.read(a));var c=a?a.layersContext:void 0,d=[];if(c){var e,f,g,h,i,j,k,l,m=this.recordType,n=m.prototype.fields;for(e=0,f=c.length;f>e;e++){for(i=c[e],j={},g=0,h=n.length;h>g;g++)k=n.items[g],l=i[k.mapping||k.name]||k.defaultValue,l=k.convert(l),j[k.name]=l;j.layer=b.getLayerFromContext(i),d.push(new this.recordType(j,j.layer.id))}}return{totalRecords:d.length,success:!0,records:d}}}),GeoExt.Lang.add("fr",{"GeoExt.tree.LayerContainer.prototype":{text:"Couches"},"GeoExt.tree.BaseLayerContainer.prototype":{text:"Couches de base"},"GeoExt.tree.OverlayLayerContainer.prototype":{text:"Couches additionnelles"}}),Ext.namespace("GeoExt.tree"),GeoExt.tree.OverlayLayerContainer=Ext.extend(GeoExt.tree.LayerContainer,{text:"Overlays",constructor:function(a){a=Ext.applyIf(a||{},{text:this.text}),a.loader=Ext.applyIf(a.loader||{},{filter:function(a){var b=a.getLayer();return b.displayInLayerSwitcher===!0&&b.isBaseLayer===!1}}),GeoExt.tree.OverlayLayerContainer.superclass.constructor.call(this,a)}}),Ext.tree.TreePanel.nodeTypes.gx_overlaylayercontainer=GeoExt.tree.OverlayLayerContainer,Ext.namespace("GeoExt.data"),GeoExt.data.WFSCapabilitiesReader=function(a,b){a=a||{},a.format||(a.format=new OpenLayers.Format.WFSCapabilities),"function"!=typeof b&&(b=GeoExt.data.LayerRecord.create(b||a.fields||[{name:"name",type:"string"},{name:"title",type:"string"},{name:"namespace",type:"string",mapping:"featureNS"},{name:"abstract",type:"string"}])),GeoExt.data.WFSCapabilitiesReader.superclass.constructor.call(this,a,b)},Ext.extend(GeoExt.data.WFSCapabilitiesReader,Ext.data.DataReader,{read:function(a){var b=a.responseXML;return b&&b.documentElement||(b=a.responseText),this.readRecords(b)},readRecords:function(a){("string"==typeof a||a.nodeType)&&(a=this.meta.format.read(a));for(var b,c,d,e,f,g,h=a.featureTypeList.featureTypes,i=this.recordType.prototype.fields,j={url:a.capability.request.getfeature.href.post},k=[],l=0,m=h.length;m>l;l++)if(b=h[l],b.name){c={};for(var n=0,o=i.length;o>n;n++)d=i.items[n],e=b[d.mapping||d.name]||d.defaultValue,e=d.convert(e),c[d.name]=e;g={featureType:b.name,featureNS:b.featureNS},this.meta.protocolOptions?Ext.apply(g,this.meta.protocolOptions,j):Ext.apply(g,{},j),f={protocol:new OpenLayers.Protocol.WFS(g),strategies:[new OpenLayers.Strategy.Fixed]};var p=this.meta.layerOptions;p&&Ext.apply(f,Ext.isFunction(p)?p():p),c.layer=new OpenLayers.Layer.Vector(b.title||b.name,f),k.push(new this.recordType(c,c.layer.id))}return{totalRecords:k.length,success:!0,records:k}}}),Ext.namespace("GeoExt"),GeoExt.LegendPanel=Ext.extend(Ext.Panel,{dynamic:!0,layerStore:null,preferredTypes:null,filter:function(){return!0},initComponent:function(){GeoExt.LegendPanel.superclass.initComponent.call(this)},onRender:function(){GeoExt.LegendPanel.superclass.onRender.apply(this,arguments),this.layerStore||(this.layerStore=GeoExt.MapPanel.guess().layers),this.layerStore.each(function(a){this.addLegend(a)},this),this.dynamic&&this.layerStore.on({add:this.onStoreAdd,remove:this.onStoreRemove,clear:this.onStoreClear,scope:this})},recordIndexToPanelIndex:function(a){for(var b,c,d=this.layerStore,e=d.getCount(),f=-1,g=this.items?this.items.length:0,h=e-1;h>=0;--h){b=d.getAt(h),c=b.getLayer();var i=GeoExt.LayerLegend.getTypes(b);if(c.displayInLayerSwitcher&&i.length>0&&d.getAt(h).get("hideInLegend")!==!0&&(++f,a===h||f>g-1))break}return f},getIdForLayer:function(a){return this.id+"-"+a.id},onStoreAdd:function(a,b,c){for(var d=this.recordIndexToPanelIndex(c+b.length-1),e=0,f=b.length;f>e;e++)this.addLegend(b[e],d);this.doLayout()},onStoreRemove:function(a,b){this.removeLegend(b)},removeLegend:function(a){if(this.items){var b=this.getComponent(this.getIdForLayer(a.getLayer()));b&&(this.remove(b,!0),this.doLayout())}},onStoreClear:function(){this.removeAllLegends()},removeAllLegends:function(){this.removeAll(!0),this.doLayout()},addLegend:function(a,b){if(this.filter(a)===!0){var c=a.getLayer();b=b||0;var d=GeoExt.LayerLegend.getTypes(a,this.preferredTypes);c.displayInLayerSwitcher&&!a.get("hideInLegend")&&d.length>0&&this.insert(b,{xtype:d[0],id:this.getIdForLayer(c),layerRecord:a,hidden:!(!c.map&&c.visibility||c.getVisibility()&&c.calculateInRange())})
}},onDestroy:function(){this.layerStore&&(this.layerStore.un("add",this.onStoreAdd,this),this.layerStore.un("remove",this.onStoreRemove,this),this.layerStore.un("clear",this.onStoreClear,this)),GeoExt.LegendPanel.superclass.onDestroy.apply(this,arguments)}}),Ext.reg("gx_legendpanel",GeoExt.LegendPanel),Ext.namespace("GeoExt.plugins"),GeoExt.plugins.TreeNodeActions=Ext.extend(Ext.util.Observable,{actionsCls:"gx-tree-layer-actions",actionCls:"gx-tree-layer-action",constructor:function(a){Ext.apply(this.initialConfig,Ext.apply({},a)),Ext.apply(this,a),this.addEvents("action"),GeoExt.plugins.TreeNodeActions.superclass.constructor.apply(this,arguments)},init:function(a){a.on({rendernode:this.onRenderNode,rawclicknode:this.onRawClickNode,beforedestroy:this.onBeforeDestroy,scope:this})},onRenderNode:function(a){var b=a.rendered;if(!b){var c=a.attributes,d=c.actions||this.actions;if(d&&d.length>0){for(var e=['<div class="',this.actionsCls,'">'],f=0,g=d.length;g>f;f++){var h=d[f];e=e.concat(['<img id="'+a.id+"_"+h.action,'" ext:qtip="'+h.qtip,'" src="'+Ext.BLANK_IMAGE_URL,'" class="'+this.actionCls+" "+h.action+'" />'])}e.concat(["</div>"]),Ext.DomHelper.insertFirst(a.ui.elNode,e.join(""))}a.layer&&a.layer.map?this.updateActions(a):a.layerStore&&a.layerStore.on({bind:function(){this.updateActions(a)},scope:this})}},updateActions:function(a){var b=a.attributes.actions||this.actions||[];Ext.each(b,function(b){var c=Ext.get(a.id+"_"+b.action);c&&"function"==typeof b.update&&b.update.call(a,c)})},onRawClickNode:function(a,b){if(b.getTarget("."+this.actionCls,1)){var c=b.getTarget("."+this.actionCls,1),d=c.className.replace(this.actionCls+" ","");return this.fireEvent("action",a,d,b),!1}},onBeforeDestroy:function(a){a.un("rendernode",this.onRenderNode,this),a.un("rawclicknode",this.onRawClickNode,this),a.un("beforedestroy",this.onBeforeDestroy,this)}}),Ext.preg("gx_treenodeactions",GeoExt.plugins.TreeNodeActions),GeoExt.Lang.add("nl",{"GeoExt.tree.LayerContainer.prototype":{text:"Kaartlagen"},"GeoExt.tree.BaseLayerContainer.prototype":{text:"Basis kaarten"},"GeoExt.tree.OverlayLayerContainer.prototype":{text:"Kaart overlays"}}),Ext.namespace("GeoExt.plugins"),GeoExt.plugins.PrintPageField=Ext.extend(Ext.util.Observable,{printPage:null,target:null,constructor:function(a){this.initialConfig=a,Ext.apply(this,a),GeoExt.plugins.PrintPageField.superclass.constructor.apply(this,arguments)},init:function(a){this.target=a;var b={beforedestroy:this.onBeforeDestroy,scope:this},c=a instanceof Ext.form.ComboBox?"select":a instanceof Ext.form.Checkbox?"check":"valid";b[c]=this.onFieldChange,a.on(b),this.printPage.on({change:this.onPageChange,scope:this}),this.printPage.printProvider.on({layoutchange:this.onLayoutChange,scope:this}),this.setValue(this.printPage)},onFieldChange:function(a,b){var c=this.printPage.printProvider,d=a.getValue();this._updating=!0,a.store===c.scales||"scale"===a.name?this.printPage.setScale(b):"rotation"==a.name?!isNaN(d)&&this.printPage.setRotation(d):this.printPage.customParams[a.name]=d,delete this._updating},onPageChange:function(a){this._updating||this.setValue(a)},onLayoutChange:function(a,b){var c=this.target;"rotation"==c.name&&c.setDisabled(!b.get("rotation"))},setValue:function(a){var b=this.target;b.suspendEvents(),b.store===a.printProvider.scales||"scale"===b.name?a.scale&&b.setValue(a.scale.get(b.displayField)):"rotation"==b.name&&b.setValue(a.rotation),b.resumeEvents()},onBeforeDestroy:function(){this.target.un("beforedestroy",this.onBeforeDestroy,this),this.target.un("select",this.onFieldChange,this),this.target.un("valid",this.onFieldChange,this),this.printPage.un("change",this.onPageChange,this),this.printPage.printProvider.un("layoutchange",this.onLayoutChange,this)}}),Ext.preg("gx_printpagefield",GeoExt.plugins.PrintPageField),Ext.namespace("GeoExt.tree"),GeoExt.tree.LayerNodeUI=Ext.extend(Ext.tree.TreeNodeUI,{constructor:function(){GeoExt.tree.LayerNodeUI.superclass.constructor.apply(this,arguments)},render:function(){var a=this.node.attributes;void 0===a.checked&&(a.checked=this.node.layer.getVisibility()),GeoExt.tree.LayerNodeUI.superclass.render.apply(this,arguments);var b=this.checkbox;if(a.checkedGroup){var c=Ext.DomHelper.insertAfter(b,['<input type="radio" name="',a.checkedGroup,'_checkbox" class="',b.className,b.checked?'" checked="checked"':"",'"></input>'].join(""));c.defaultChecked=b.defaultChecked,Ext.get(b).remove(),this.checkbox=c}this.enforceOneVisible()},onClick:function(a){a.getTarget(".x-tree-node-cb",1)?this.toggleCheck(this.isChecked()):GeoExt.tree.LayerNodeUI.superclass.onClick.apply(this,arguments)},toggleCheck:function(a){a=void 0===a?!this.isChecked():a,GeoExt.tree.LayerNodeUI.superclass.toggleCheck.call(this,a),this.enforceOneVisible()},enforceOneVisible:function(){var a=this.node.attributes,b=a.checkedGroup;if(b&&"gx_baselayer"!==b){var c=this.node.layer,d=this.node.getOwnerTree().getChecked(),e=0;Ext.each(d,function(d){var f=d.layer;d.hidden||d.attributes.checkedGroup!==b||(e++,f!=c&&a.checked&&f.setVisibility(!1))}),0===e&&0==a.checked&&c.setVisibility(!0)}},appendDDGhost:function(a){var b=this.elNode.cloneNode(!0),c=Ext.DomQuery.select("input[type='radio']",b);Ext.each(c,function(a){a.name=a.name+"_clone"}),a.appendChild(b)}}),GeoExt.tree.LayerNode=Ext.extend(Ext.tree.AsyncTreeNode,{layer:null,layerStore:null,constructor:function(a){a.leaf=a.leaf||!(a.children||a.loader),a.iconCls||a.children||(a.iconCls="gx-tree-layer-icon"),!a.loader||a.loader instanceof Ext.tree.TreeLoader||(a.loader=new GeoExt.tree.LayerParamLoader(a.loader)),this.defaultUI=this.defaultUI||GeoExt.tree.LayerNodeUI,Ext.apply(this,{layer:a.layer,layerStore:a.layerStore}),a.text&&(this.fixedText=!0),GeoExt.tree.LayerNode.superclass.constructor.apply(this,arguments)},render:function(){var a=this.layer instanceof OpenLayers.Layer&&this.layer;if(!a){this.layerStore&&"auto"!=this.layerStore||(this.layerStore=GeoExt.MapPanel.guess().layers);var b=this.layerStore.findBy(function(a){return a.get("title")==this.layer},this);-1!=b&&(a=this.layerStore.getAt(b).getLayer())}if(!this.rendered||!a){var c=this.getUI();a?(this.layer=a,a.isBaseLayer&&(this.draggable=!1,Ext.applyIf(this.attributes,{checkedGroup:"gx_baselayer"})),this.text||(this.text=a.name),c.show(),this.addVisibilityEventHandlers()):c.hide(),this.layerStore instanceof GeoExt.data.LayerStore&&this.addStoreEventHandlers(a)}GeoExt.tree.LayerNode.superclass.render.apply(this,arguments)},addVisibilityEventHandlers:function(){this.layer.events.on({visibilitychanged:this.onLayerVisibilityChanged,scope:this}),this.on({checkchange:this.onCheckChange,scope:this})},onLayerVisibilityChanged:function(){this._visibilityChanging||this.getUI().toggleCheck(this.layer.getVisibility())},onCheckChange:function(a,b){if(b!=this.layer.getVisibility()){this._visibilityChanging=!0;var c=this.layer;b&&c.isBaseLayer&&c.map?c.map.setBaseLayer(c):c.setVisibility(b),delete this._visibilityChanging}},addStoreEventHandlers:function(){this.layerStore.on({add:this.onStoreAdd,remove:this.onStoreRemove,update:this.onStoreUpdate,scope:this})},onStoreAdd:function(a,b){for(var c,d=0;d<b.length;++d){if(c=b[d].getLayer(),this.layer==c){this.getUI().show();break}if(this.layer==c.name){this.render();break}}},onStoreRemove:function(a,b){this.layer==b.getLayer()&&this.getUI().hide()},onStoreUpdate:function(a,b){var c=b.getLayer();this.fixedText||this.layer!=c||this.text===c.name||this.setText(c.name)},destroy:function(){var a=this.layer;a instanceof OpenLayers.Layer&&a.events.un({visibilitychanged:this.onLayerVisibilityChanged,scope:this}),delete this.layer;var b=this.layerStore;b&&(b.un("add",this.onStoreAdd,this),b.un("remove",this.onStoreRemove,this),b.un("update",this.onStoreUpdate,this)),delete this.layerStore,this.un("checkchange",this.onCheckChange,this),GeoExt.tree.LayerNode.superclass.destroy.apply(this,arguments)}}),Ext.tree.TreePanel.nodeTypes.gx_layer=GeoExt.tree.LayerNode,Ext.namespace("GeoExt.tree"),GeoExt.tree.LayerParamNode=Ext.extend(Ext.tree.TreeNode,{layer:null,param:null,item:null,delimiter:null,allItems:null,constructor:function(a){var b=a||{};b.iconCls=b.iconCls||"gx-tree-layerparam-icon",b.text=b.text||b.item,this.param=b.param,this.item=b.item,this.delimiter=b.delimiter||",",this.allItems=b.allItems,GeoExt.tree.LayerParamNode.superclass.constructor.apply(this,arguments),this.getLayer(),this.layer&&(this.allItems||(this.allItems=this.getItemsFromLayer()),null==this.attributes.checked?this.attributes.checked=this.layer.getVisibility()&&this.getItemsFromLayer().indexOf(this.item)>=0:this.onCheckChange(this,this.attributes.checked),this.layer.events.on({visibilitychanged:this.onLayerVisibilityChanged,scope:this}),this.on({checkchange:this.onCheckChange,scope:this}))},getLayer:function(){if(!this.layer){var a=this.attributes.layer;if("string"==typeof a){var b=this.attributes.layerStore||GeoExt.MapPanel.guess().layers,c=b.findBy(function(b){return b.get("title")==a});a=-1!=c?b.getAt(c).getLayer():null}this.layer=a}return this.layer},getItemsFromLayer:function(){var a=this.layer.params[this.param];return a instanceof Array?a:a?a.split(this.delimiter):[]},createParams:function(a){var b={};return b[this.param]=this.layer.params[this.param]instanceof Array?a:a.join(this.delimiter),b},onLayerVisibilityChanged:function(){0===this.getItemsFromLayer().length&&this.layer.mergeNewParams(this.createParams(this.allItems));var a=this.layer.getVisibility();a&&-1!==this.getItemsFromLayer().indexOf(this.item)&&this.getUI().toggleCheck(!0),a||(this.layer.mergeNewParams(this.createParams([])),this.getUI().toggleCheck(!1))},onCheckChange:function(a,b){var c=this.layer,d=[],e=this.getItemsFromLayer();b===!0&&c.getVisibility()===!1&&e.length===this.allItems.length&&(e=[]),Ext.each(this.allItems,function(a){(a!==this.item&&-1!==e.indexOf(a)||b===!0&&a===this.item)&&d.push(a)},this);var f=d.length>0;f&&c.mergeNewParams(this.createParams(d)),f!==c.getVisibility()&&c.setVisibility(f),!f&&c.mergeNewParams(this.createParams([]))},destroy:function(){var a=this.layer;a instanceof OpenLayers.Layer&&a.events.un({visibilitychanged:this.onLayerVisibilityChanged,scope:this}),delete this.layer,this.un("checkchange",this.onCheckChange,this),GeoExt.tree.LayerParamNode.superclass.destroy.apply(this,arguments)}}),Ext.tree.TreePanel.nodeTypes.gx_layerparam=GeoExt.tree.LayerParamNode,Ext.namespace("GeoExt"),GeoExt.UrlLegend=Ext.extend(GeoExt.LayerLegend,{initComponent:function(){GeoExt.UrlLegend.superclass.initComponent.call(this),this.add(new GeoExt.LegendImage({url:this.layerRecord.get("legendURL")}))},update:function(){GeoExt.UrlLegend.superclass.update.apply(this,arguments),this.items.get(1).setUrl(this.layerRecord.get("legendURL"))}}),GeoExt.UrlLegend.supports=function(a){return null==a.get("legendURL")?0:10},GeoExt.LayerLegend.types.gx_urllegend=GeoExt.UrlLegend,Ext.reg("gx_urllegend",GeoExt.UrlLegend),Ext.namespace("GeoExt.state"),GeoExt.state.PermalinkProvider=function(a){GeoExt.state.PermalinkProvider.superclass.constructor.apply(this,arguments),a=a||{};var b=a.url;delete a.url,Ext.apply(this,a),this.state=this.readURL(b)},Ext.extend(GeoExt.state.PermalinkProvider,Ext.state.Provider,{encodeType:!0,readURL:function(a){var b,c,d,e={},f=OpenLayers.Util.getParameters(a);for(b in f)f.hasOwnProperty(b)&&(c=b.split("_"),c.length>1&&(d=c[0],e[d]=e[d]||{},e[d][c.slice(1).join("_")]=this.encodeType?this.decodeValue(f[b]):f[b]));return e},getLink:function(a){a=a||document.location.href;var b,c,d={},e=this.state;for(b in e)if(e.hasOwnProperty(b))for(c in e[b])d[b+"_"+c]=this.encodeType?unescape(this.encodeValue(e[b][c])):e[b][c];OpenLayers.Util.applyDefaults(d,OpenLayers.Util.getParameters(a));var f=OpenLayers.Util.getParameterString(d),g=a.indexOf("?");return g>0&&(a=a.substring(0,g)),Ext.urlAppend(a,f)}}),Ext.namespace("GeoExt"),GeoExt.LegendImage=Ext.extend(Ext.BoxComponent,{url:null,defaultImgSrc:null,imgCls:null,initComponent:function(){GeoExt.LegendImage.superclass.initComponent.call(this),null===this.defaultImgSrc&&(this.defaultImgSrc=Ext.BLANK_IMAGE_URL),this.autoEl={tag:"img","class":this.imgCls?this.imgCls:"",src:this.defaultImgSrc}},setUrl:function(a){this.url=a;var b=this.getEl();b&&(b.un("error",this.onImageLoadError,this),b.on("error",this.onImageLoadError,this,{single:!0}),b.dom.src=a)},onRender:function(a,b){GeoExt.LegendImage.superclass.onRender.call(this,a,b),this.url&&this.setUrl(this.url)},onDestroy:function(){var a=this.getEl();a&&a.un("error",this.onImageLoadError,this),GeoExt.LegendImage.superclass.onDestroy.apply(this,arguments)},onImageLoadError:function(){this.getEl().dom.src=this.defaultImgSrc}}),Ext.reg("gx_legendimage",GeoExt.LegendImage),Ext.namespace("GeoExt"),GeoExt.LayerOpacitySlider=Ext.extend(Ext.slider.SingleSlider,{layer:null,complementaryLayer:null,delay:5,changeVisibilityDelay:5,aggressive:!1,changeVisibility:!1,value:null,inverse:!1,constructor:function(a){a.layer&&(this.layer=this.getLayer(a.layer),this.bind(),this.complementaryLayer=this.getLayer(a.complementaryLayer),void 0!==a.inverse&&(this.inverse=a.inverse),a.value=void 0!==a.value?a.value:this.getOpacityValue(this.layer),delete a.layer,delete a.complementaryLayer),GeoExt.LayerOpacitySlider.superclass.constructor.call(this,a)},bind:function(){this.layer&&this.layer.map&&this.layer.map.events.on({changelayer:this.update,scope:this})},unbind:function(){this.layer&&this.layer.map&&this.layer.map.events&&this.layer.map.events.un({changelayer:this.update,scope:this})},update:function(a){"opacity"!==a.property||a.layer!=this.layer||this._settingOpacity||this.setValue(this.getOpacityValue(this.layer))},setLayer:function(a){this.unbind(),this.layer=this.getLayer(a),this.setValue(this.getOpacityValue(a)),this.bind()},getOpacityValue:function(a){var b;return b=a&&null!==a.opacity?parseInt(a.opacity*(this.maxValue-this.minValue)):this.maxValue,this.inverse===!0&&(b=this.maxValue-this.minValue-b),b},getLayer:function(a){return a instanceof OpenLayers.Layer?a:a instanceof GeoExt.data.LayerRecord?a.getLayer():void 0},initComponent:function(){GeoExt.LayerOpacitySlider.superclass.initComponent.call(this),this.changeVisibility&&this.layer&&(0==this.layer.opacity||this.inverse===!1&&this.value==this.minValue||this.inverse===!0&&this.value==this.maxValue)&&this.layer.setVisibility(!1),this.complementaryLayer&&(this.layer&&1==this.layer.opacity||this.inverse===!1&&this.value==this.maxValue||this.inverse===!0&&this.value==this.minValue)&&this.complementaryLayer.setVisibility(!1),this.aggressive===!0?this.on("change",this.changeLayerOpacity,this,{buffer:this.delay}):this.on("changecomplete",this.changeLayerOpacity,this),this.changeVisibility===!0&&this.on("change",this.changeLayerVisibility,this,{buffer:this.changeVisibilityDelay}),this.complementaryLayer&&this.on("change",this.changeComplementaryLayerVisibility,this,{buffer:this.changeVisibilityDelay}),this.on("beforedestroy",this.unbind,this)},changeLayerOpacity:function(a,b){this.layer&&(b/=this.maxValue-this.minValue,this.inverse===!0&&(b=1-b),this._settingOpacity=!0,this.layer.setOpacity(b),delete this._settingOpacity)},changeLayerVisibility:function(a,b){var c=this.layer.getVisibility();this.inverse===!1&&b==this.minValue||this.inverse===!0&&b==this.maxValue&&c===!0?this.layer.setVisibility(!1):(this.inverse===!1&&b>this.minValue||this.inverse===!0&&b<this.maxValue&&0==c)&&this.layer.setVisibility(!0)},changeComplementaryLayerVisibility:function(a,b){var c=this.complementaryLayer.getVisibility();this.inverse===!1&&b==this.maxValue||this.inverse===!0&&b==this.minValue&&c===!0?this.complementaryLayer.setVisibility(!1):(this.inverse===!1&&b<this.maxValue||this.inverse===!0&&b>this.minValue&&0==c)&&this.complementaryLayer.setVisibility(!0)},addToMapPanel:function(a){this.on({render:function(){var b=this.getEl();b.setStyle({position:"absolute",zIndex:a.map.Z_INDEX_BASE.Control}),b.on({mousedown:this.stopMouseEvents,click:this.stopMouseEvents})},scope:this})},removeFromMapPanel:function(){var a=this.getEl();a.un({mousedown:this.stopMouseEvents,click:this.stopMouseEvents,scope:this}),this.unbind()},stopMouseEvents:function(a){a.stopEvent()}}),Ext.reg("gx_opacityslider",GeoExt.LayerOpacitySlider),Ext.namespace("GeoExt.data"),GeoExt.data.AttributeReader=function(a,b){a=a||{},a.format||(a.format=new OpenLayers.Format.WFSDescribeFeatureType),GeoExt.data.AttributeReader.superclass.constructor.call(this,a,b||a.fields),a.feature&&this.recordType.prototype.fields.add(new Ext.data.Field("value"))},Ext.extend(GeoExt.data.AttributeReader,Ext.data.DataReader,{read:function(a){var b=a.responseXML;return b&&b.documentElement||(b=a.responseText),this.readRecords(b)},readRecords:function(a){var b;b=a instanceof Array?a:this.meta.format.read(a).featureTypes[0].properties;for(var c,d,e,f,g,h,i=this.meta.feature,j=this.recordType,k=j.prototype.fields,l=k.length,m=[],n=0,o=b.length;o>n;++n){f=!1,c=b[n],d={};for(var p=0;l>p;++p){if(h=k.items[p],e=h.name,g=h.convert(c[e]),this.ignoreAttribute(e,g)){f=!0;break}d[e]=g}i&&(g=i.attributes[d.name],void 0!==g&&(this.ignoreAttribute("value",g)?f=!0:d.value=g)),f||(m[m.length]=new j(d))}return{success:!0,records:m,totalRecords:m.length}},ignoreAttribute:function(a,b){var c=!1;if(this.meta.ignore&&this.meta.ignore[a]){var d=this.meta.ignore[a];"string"==typeof d?c=d===b:d instanceof Array?c=d.indexOf(b)>-1:d instanceof RegExp&&(c=d.test(b))}return c}}),Ext.namespace("GeoExt.grid"),GeoExt.grid.SymbolizerColumn=Ext.extend(Ext.grid.Column,{renderer:function(a,b){if(null!=a){var c=Ext.id();return window.setTimeout(function(){var b=Ext.get(c);b&&new GeoExt.FeatureRenderer({symbolizers:a instanceof Array?a:[a],renderTo:b})},0),b.css="gx-grid-symbolizercol",'<div id="'+c+'"></div>'}}}),Ext.grid.Column.types.gx_symbolizercolumn=GeoExt.grid.SymbolizerColumn,Ext.namespace("GeoExt.plugins"),GeoExt.plugins.TreeNodeComponent=Ext.extend(Ext.util.Observable,{constructor:function(a){Ext.apply(this.initialConfig,Ext.apply({},a)),Ext.apply(this,a),GeoExt.plugins.TreeNodeComponent.superclass.constructor.apply(this,arguments)},init:function(a){a.on({rendernode:this.onRenderNode,beforedestroy:this.onBeforeDestroy,scope:this})},onRenderNode:function(a){var b=a.rendered,c=a.attributes,d=c.component||this.component;if(!b&&d){var e=Ext.DomHelper.append(a.ui.elNode,[{tag:"div"}]);"function"==typeof d?d=d(a,e):"object"==typeof d&&"function"==typeof d.fn&&(d=d.fn.apply(d.scope,[a,e])),"object"==typeof d&&"string"==typeof d.xtype&&(d=Ext.ComponentMgr.create(d)),d instanceof Ext.Component&&(d.render(e),a.component=d)}},onBeforeDestroy:function(a){a.un("rendernode",this.onRenderNode,this),a.un("beforedestroy",this.onBeforeDestroy,this)}}),Ext.preg("gx_treenodecomponent",GeoExt.plugins.TreeNodeComponent),Ext.namespace("GeoExt"),GeoExt.ZoomSliderTip=Ext.extend(GeoExt.SliderTip,{template:"<div>Zoom Level: {zoom}</div><div>Resolution: {resolution}</div><div>Scale: 1 : {scale}</div>",compiledTemplate:null,init:function(a){this.compiledTemplate=new Ext.Template(this.template),GeoExt.ZoomSliderTip.superclass.init.call(this,a)},getText:function(a){var b={zoom:a.value,resolution:this.slider.getResolution(),scale:Math.round(this.slider.getScale())};return this.compiledTemplate.apply(b)}}),Ext.namespace("GeoExt.data"),GeoExt.data.PrintProvider=Ext.extend(Ext.util.Observable,{url:null,capabilities:null,method:"POST",encoding:document.charset||document.characterSet||"UTF-8",timeout:3e4,customParams:null,scales:null,dpis:null,layouts:null,dpi:null,layout:null,constructor:function(a){this.initialConfig=a,Ext.apply(this,a),this.customParams||(this.customParams={}),this.addEvents("loadcapabilities","layoutchange","dpichange","beforeprint","print","printexception","beforeencodelayer","encodelayer","beforedownload"),GeoExt.data.PrintProvider.superclass.constructor.apply(this,arguments),this.scales=new Ext.data.JsonStore({root:"scales",sortInfo:{field:"value",direction:"DESC"},fields:["name",{name:"value",type:"float"}]}),this.dpis=new Ext.data.JsonStore({root:"dpis",fields:["name",{name:"value",type:"float"}]}),this.layouts=new Ext.data.JsonStore({root:"layouts",fields:["name",{name:"size",mapping:"map"},{name:"rotation",type:"boolean"}]}),a.capabilities?this.loadStores():(this.url.split("/").pop()&&(this.url+="/"),this.initialConfig.autoLoad&&this.loadCapabilities())},setLayout:function(a){this.layout=a,this.fireEvent("layoutchange",this,a)},setDpi:function(a){this.dpi=a,this.fireEvent("dpichange",this,a)},print:function(a,b,c){if(a instanceof GeoExt.MapPanel&&(a=a.map),b=b instanceof Array?b:[b],c=c||{},this.fireEvent("beforeprint",this,a,b,c)!==!1){var d=Ext.apply({units:a.getUnits(),srs:a.baseLayer.projection.getCode(),layout:this.layout.get("name"),dpi:this.dpi.get("value")},this.customParams),e=b[0].feature.layer,f=[],g=a.layers.concat();g.remove(a.baseLayer),g.unshift(a.baseLayer),Ext.each(g,function(a){if(a!==e&&a.getVisibility()===!0){var b=this.encodeLayer(a);b&&f.push(b)}},this),d.layers=f;var h=[];if(Ext.each(b,function(a){h.push(Ext.apply({center:[a.center.lon,a.center.lat],scale:a.scale.get("value"),rotation:a.rotation},a.customParams))},this),d.pages=h,c.overview){var i=[];Ext.each(c.overview.layers,function(a){var b=this.encodeLayer(a);b&&i.push(b)},this),d.overviewLayers=i}if(c.legend){var j=c.legend,k=j.rendered;k||(j=j.cloneConfig({renderTo:document.body,hidden:!0}));var l=[];j.items&&j.items.each(function(a){if(!a.hidden){var b=this.encoders.legends[a.getXType()];l=l.concat(b.call(this,a,d.pages[0].scale))}},this),k||j.destroy(),d.legends=l}if("GET"===this.method){var m=Ext.urlAppend(this.capabilities.printURL,"spec="+encodeURIComponent(Ext.encode(d)));this.download(m)}else Ext.Ajax.request({url:this.capabilities.createURL,timeout:this.timeout,jsonData:d,headers:{"Content-Type":"application/json; charset="+this.encoding},success:function(a){var b=Ext.decode(a.responseText).getURL;this.download(b)},failure:function(a){this.fireEvent("printexception",this,a)},params:this.initialConfig.baseParams,scope:this})}},download:function(a){this.fireEvent("beforedownload",this,a)!==!1&&(Ext.isOpera?window.open(a):window.location.href=a),this.fireEvent("print",this,a)},loadCapabilities:function(){if(this.url){var a=this.url+"info.json";Ext.Ajax.request({url:a,method:"GET",disableCaching:!1,success:function(a){this.capabilities=Ext.decode(a.responseText),this.loadStores()},params:this.initialConfig.baseParams,scope:this})}},loadStores:function(){this.scales.loadData(this.capabilities),this.dpis.loadData(this.capabilities),this.layouts.loadData(this.capabilities),this.setLayout(this.layouts.getAt(0)),this.setDpi(this.dpis.getAt(0)),this.fireEvent("loadcapabilities",this,this.capabilities)},encodeLayer:function(a){var b;for(var c in this.encoders.layers)if(OpenLayers.Layer[c]&&a instanceof OpenLayers.Layer[c]){if(this.fireEvent("beforeencodelayer",this,a)===!1)return;b=this.encoders.layers[c].call(this,a),this.fireEvent("encodelayer",this,a,b);break}return b&&b.type?b:null},getAbsoluteUrl:function(a){var b;return Ext.isIE6||Ext.isIE7||Ext.isIE8?(b=document.createElement("<a href='"+a+"'/>"),b.style.display="none",document.body.appendChild(b),b.href=b.href,document.body.removeChild(b)):(b=document.createElement("a"),b.href=a),b.href},encoders:{layers:{Layer:function(a){var b={};return a.options&&a.options.maxScale&&(b.minScaleDenominator=a.options.maxScale),a.options&&a.options.minScale&&(b.maxScaleDenominator=a.options.minScale),b},WMS:function(a){var b=this.encoders.layers.HTTPRequest.call(this,a);Ext.apply(b,{type:"WMS",layers:[a.params.LAYERS].join(",").split(","),format:a.params.FORMAT,styles:[a.params.STYLES].join(",").split(",")});var c;for(var d in a.params)c=d.toLowerCase(),a.DEFAULT_PARAMS[c]||-1!="layers,styles,width,height,srs".indexOf(c)||(b.customParams||(b.customParams={}),b.customParams[d]=a.params[d]);return b},OSM:function(a){var b=this.encoders.layers.TileCache.call(this,a);return Ext.apply(b,{type:"OSM",baseURL:b.baseURL.substr(0,b.baseURL.indexOf("$")),extension:"png"})},TMS:function(a){var b=this.encoders.layers.TileCache.call(this,a);return Ext.apply(b,{type:"TMS",format:a.type})},TileCache:function(a){var b=this.encoders.layers.HTTPRequest.call(this,a);return Ext.apply(b,{type:"TileCache",layer:a.layername,maxExtent:a.maxExtent.toArray(),tileSize:[a.tileSize.w,a.tileSize.h],extension:a.extension,resolutions:a.serverResolutions||a.resolutions})},WMTS:function(a){var b=this.encoders.layers.HTTPRequest.call(this,a);return Ext.apply(b,{type:"WMTS",layer:a.layer,version:a.version,requestEncoding:a.requestEncoding,tileOrigin:[a.tileOrigin.lon,a.tileOrigin.lat],tileSize:[a.tileSize.w,a.tileSize.h],style:a.style,formatSuffix:a.formatSuffix,dimensions:a.dimensions,params:a.params,maxExtent:null!=a.tileFullExtent?a.tileFullExtent.toArray():a.maxExtent.toArray(),matrixSet:a.matrixSet,zoomOffset:a.zoomOffset,resolutions:a.serverResolutions||a.resolutions})},KaMapCache:function(a){var b=this.encoders.layers.KaMap.call(this,a);return Ext.apply(b,{type:"KaMapCache",group:a.params.g,metaTileWidth:a.params.metaTileSize.w,metaTileHeight:a.params.metaTileSize.h})},KaMap:function(a){var b=this.encoders.layers.HTTPRequest.call(this,a);return Ext.apply(b,{type:"KaMap",map:a.params.map,extension:a.params.i,group:a.params.g||"",maxExtent:a.maxExtent.toArray(),tileSize:[a.tileSize.w,a.tileSize.h],resolutions:a.serverResolutions||a.resolutions})},HTTPRequest:function(a){var b=this.encoders.layers.Layer.call(this,a);return Ext.apply(b,{baseURL:this.getAbsoluteUrl(a.url instanceof Array?a.url[0]:a.url),opacity:null!=a.opacity?a.opacity:1,singleTile:a.singleTile})},Image:function(a){var b=this.encoders.layers.Layer.call(this,a);return Ext.apply(b,{type:"Image",baseURL:this.getAbsoluteUrl(a.getURL(a.extent)),opacity:null!=a.opacity?a.opacity:1,extent:a.extent.toArray(),pixelSize:[a.size.w,a.size.h],name:a.name})},Vector:function(a){if(a.features.length){for(var b,c,d,e,f,g=[],h={},i=a.features,j=new OpenLayers.Format.GeoJSON,k=new OpenLayers.Format.JSON,l=1,m={},n=0,o=i.length;o>n;++n){b=i[n],c=b.style||a.style||a.styleMap.createSymbolizer(b,b.renderIntent),d=k.write(c),e=m[d],e?f=e:(m[d]=f=l++,h[f]=c.externalGraphic?Ext.applyIf({externalGraphic:this.getAbsoluteUrl(c.externalGraphic)},c):c);var p=j.extract.feature.call(j,b);p.properties=OpenLayers.Util.extend({_gx_style:f},p.properties),g.push(p)}var q=this.encoders.layers.Layer.call(this,a);return Ext.apply(q,{type:"Vector",styles:h,styleProperty:"_gx_style",geoJson:{type:"FeatureCollection",features:g},name:a.name,opacity:null!=a.opacity?a.opacity:1})}},Markers:function(a){for(var b=[],c=0,d=a.markers.length;d>c;c++){var e=a.markers[c],f=new OpenLayers.Geometry.Point(e.lonlat.lon,e.lonlat.lat),g={externalGraphic:e.icon.url,graphicWidth:e.icon.size.w,graphicHeight:e.icon.size.h,graphicXOffset:e.icon.offset.x,graphicYOffset:e.icon.offset.y},h=new OpenLayers.Feature.Vector(f,{},g);b.push(h)}var i=new OpenLayers.Layer.Vector(a.name);i.addFeatures(b);var j=this.encoders.layers.Vector.call(this,i);return i.destroy(),j}},legends:{gx_wmslegend:function(a,b){for(var c=this.encoders.legends.base.call(this,a),d=[],e=1,f=a.items.getCount();f>e;++e){var g=a.items.get(e).url;if(a.useScaleParameter===!0&&-1!=g.toLowerCase().indexOf("request=getlegendgraphic")){var h=g.split("?"),i=Ext.urlDecode(h[1]);i.SCALE=b,g=h[0]+"?"+Ext.urlEncode(i)}d.push(this.getAbsoluteUrl(g))}return c[0].classes[0]={name:"",icons:d},c},gx_urllegend:function(a){var b=this.encoders.legends.base.call(this,a);return b[0].classes.push({name:"",icon:this.getAbsoluteUrl(a.items.get(1).url)}),b},base:function(a){return[{name:a.getLabel(),classes:[]}]}}}}),Ext.namespace("GeoExt"),GeoExt.MapPanel=Ext.extend(Ext.Panel,{map:null,layers:null,center:null,zoom:null,extent:null,prettyStateKeys:!1,stateEvents:["aftermapmove","afterlayervisibilitychange","afterlayeropacitychange","afterlayerorderchange","afterlayernamechange","afterlayeradd","afterlayerremove"],initComponent:function(){this.map instanceof OpenLayers.Map||(this.map=new OpenLayers.Map(Ext.applyIf(this.map||{},{allOverlays:!0})));var a=this.layers;(!a||a instanceof Array)&&(this.layers=new GeoExt.data.LayerStore({layers:a,map:this.map.layers.length>0?this.map:null})),"string"==typeof this.center?this.center=OpenLayers.LonLat.fromString(this.center):this.center instanceof Array&&(this.center=new OpenLayers.LonLat(this.center[0],this.center[1])),"string"==typeof this.extent?this.extent=OpenLayers.Bounds.fromString(this.extent):this.extent instanceof Array&&(this.extent=OpenLayers.Bounds.fromArray(this.extent)),GeoExt.MapPanel.superclass.initComponent.call(this),this.addEvents("aftermapmove","afterlayervisibilitychange","afterlayeropacitychange","afterlayerorderchange","afterlayernamechange","afterlayeradd","afterlayerremove"),this.map.events.on({moveend:this.onMoveend,changelayer:this.onChangelayer,addlayer:this.onAddlayer,removelayer:this.onRemovelayer,scope:this})},onMoveend:function(){this.fireEvent("aftermapmove")},onChangelayer:function(a){a.property&&("visibility"===a.property?this.fireEvent("afterlayervisibilitychange"):"order"===a.property?this.fireEvent("afterlayerorderchange"):"name"===a.property?this.fireEvent("afterlayernamechange"):"opacity"===a.property&&this.fireEvent("afterlayeropacitychange"))},onAddlayer:function(){this.fireEvent("afterlayeradd")},onRemovelayer:function(){this.fireEvent("afterlayerremove")},applyState:function(a){this.center=new OpenLayers.LonLat(a.x,a.y),this.zoom=a.zoom;var b,c,d,e,f,g,h=this.map.layers;for(b=0,c=h.length;c>b;b++)d=h[b],e=this.prettyStateKeys?d.name:d.id,f=a["visibility_"+e],void 0!==f&&(f=/^true$/i.test(f),d.isBaseLayer?f&&this.map.setBaseLayer(d):d.setVisibility(f)),g=a["opacity_"+e],void 0!==g&&d.setOpacity(g)},getState:function(){var a;if(this.map){var b=this.map.getCenter();a=b?{x:b.lon,y:b.lat,zoom:this.map.getZoom()}:{};var c,d,e,f,g=this.map.layers;for(c=0,d=g.length;d>c;c++)e=g[c],f=this.prettyStateKeys?e.name:e.id,a["visibility_"+f]=e.getVisibility(),a["opacity_"+f]=null==e.opacity?1:e.opacity;return a}},updateMapSize:function(){this.map&&this.map.updateSize()},renderMap:function(){var a=this.map;a.render(this.body.dom),this.layers.bind(a),a.layers.length>0?this.setInitialExtent():this.layers.on("add",this.setInitialExtent,this,{single:!0})},setInitialExtent:function(){var a=this.map;this.center||null!=this.zoom?a.setCenter(this.center,this.zoom):this.extent?a.zoomToExtent(this.extent):a.zoomToMaxExtent()},afterRender:function(){GeoExt.MapPanel.superclass.afterRender.apply(this,arguments),this.ownerCt?(this.ownerCt.on("move",this.updateMapSize,this),this.ownerCt.on({afterlayout:this.afterLayout,scope:this})):this.renderMap()},afterLayout:function(){var a=this.getInnerWidth()-this.body.getBorderWidth("lr"),b=this.getInnerHeight()-this.body.getBorderWidth("tb");a>0&&b>0&&(this.ownerCt.un("afterlayout",this.afterLayout,this),this.renderMap())},onResize:function(){GeoExt.MapPanel.superclass.onResize.apply(this,arguments),this.updateMapSize()},onBeforeAdd:function(a){"function"==typeof a.addToMapPanel&&a.addToMapPanel(this),GeoExt.MapPanel.superclass.onBeforeAdd.apply(this,arguments)},remove:function(a){"function"==typeof a.removeFromMapPanel&&a.removeFromMapPanel(this),GeoExt.MapPanel.superclass.remove.apply(this,arguments)},beforeDestroy:function(){this.ownerCt&&this.ownerCt.un("move",this.updateMapSize,this),this.map&&this.map.events&&this.map.events.un({moveend:this.onMoveend,changelayer:this.onChangelayer,addlayer:this.onAddlayer,removelayer:this.onRemovelayer,scope:this}),this.initialConfig.map&&this.initialConfig.map instanceof OpenLayers.Map||this.map&&this.map.destroy&&this.map.destroy(),delete this.map,GeoExt.MapPanel.superclass.beforeDestroy.apply(this,arguments)}}),GeoExt.MapPanel.guess=function(){return Ext.ComponentMgr.all.find(function(a){return a instanceof GeoExt.MapPanel})},Ext.reg("gx_mappanel",GeoExt.MapPanel),Ext.namespace("GeoExt"),GeoExt.PrintMapPanel=Ext.extend(GeoExt.MapPanel,{sourceMap:null,printProvider:null,printPage:null,previewScales:null,center:null,zoom:null,extent:null,currentZoom:null,initComponent:function(){this.sourceMap instanceof GeoExt.MapPanel&&(this.sourceMap=this.sourceMap.map),this.map||(this.map={}),Ext.applyIf(this.map,{projection:this.sourceMap.getProjection(),maxExtent:this.sourceMap.getMaxExtent(),maxResolution:this.sourceMap.getMaxResolution(),units:this.sourceMap.getUnits()}),this.printProvider instanceof GeoExt.data.PrintProvider||(this.printProvider=new GeoExt.data.PrintProvider(this.printProvider)),this.printPage=new GeoExt.data.PrintPage({printProvider:this.printProvider}),this.previewScales=new Ext.data.Store,this.previewScales.add(this.printProvider.scales.getRange()),this.layers=[];
Ext.each(this.sourceMap.layers,function(a){a.getVisibility()===!0&&this.layers.push(a.clone())},this),this.extent=this.sourceMap.getExtent(),GeoExt.PrintMapPanel.superclass.initComponent.call(this)},bind:function(){this.printPage.on("change",this.fitZoom,this),this.printProvider.on("layoutchange",this.syncSize,this),this.map.events.register("moveend",this,this.updatePage),this.printPage.fit(this.sourceMap),this.initialConfig.limitScales===!0&&(this.on("resize",this.calculatePreviewScales,this),this.calculatePreviewScales())},afterRender:function(){GeoExt.PrintMapPanel.superclass.afterRender.apply(this,arguments),this.syncSize(),this.ownerCt?this.ownerCt.on({afterlayout:{fn:this.bind,scope:this,single:!0}}):this.bind()},adjustSize:function(a,b){var c=this.printProvider.layout.get("size"),d=c.width/c.height,e=this.ownerCt,f=e&&e.autoWidth?0:a||this.initialConfig.width,g=e&&e.autoHeight?0:b||this.initialConfig.height;return f?(b=f/d,g&&b>g?(b=g,a=b*d):a=f):g&&(a=g*d,b=g),{width:a,height:b}},fitZoom:function(){if(!this._updating&&this.printPage.scale){this._updating=!0;var a=this.printPage.getPrintExtent(this.map);this.currentZoom=this.map.getZoomForExtent(a),this.map.zoomToExtent(a),delete this._updating}},updatePage:function(){if(!this._updating){var a=this.map.getZoom();this._updating=!0,a===this.currentZoom?this.printPage.setCenter(this.map.getCenter()):this.printPage.fit(this.map),delete this._updating,this.currentZoom=a}},calculatePreviewScales:function(){this.previewScales.removeAll(),this.printPage.suspendEvents();var a=this.printPage.scale,b=this.map.getSize(),c={},d=[];this.printProvider.scales.each(function(a){this.printPage.setScale(a);var e=this.printPage.getPrintExtent(this.map),f=this.map.getZoomForExtent(e),g=Math.max(e.getWidth()/b.w,e.getHeight()/b.h),h=this.map.getResolutionForZoom(f),i=Math.abs(g-h);(!(f in c)||c[f].diff>i)&&(c[f]={rec:a,diff:i},-1==d.indexOf(f)&&d.push(f))},this);for(var e=0,f=d.length;f>e;++e)this.previewScales.add(c[d[e]].rec);if(a&&this.printPage.setScale(a),this.printPage.resumeEvents(),a&&this.previewScales.getCount()>0){var g=this.previewScales.getAt(0),h=this.previewScales.getAt(this.previewScales.getCount()-1);a.get("value")<h.get("value")?this.printPage.setScale(h):a.get("value")>g.get("value")&&this.printPage.setScale(g)}this.fitZoom()},print:function(a){this.printProvider.print(this.map,[this.printPage],a)},beforeDestroy:function(){this.map.events.unregister("moveend",this,this.updatePage),this.printPage.un("change",this.fitZoom,this),this.printProvider.un("layoutchange",this.syncSize,this),GeoExt.PrintMapPanel.superclass.beforeDestroy.apply(this,arguments)}}),Ext.reg("gx_printmappanel",GeoExt.PrintMapPanel),Ext.namespace("GeoExt.data"),GeoExt.data.ScaleStore=Ext.extend(Ext.data.Store,{map:null,constructor:function(a){var b=a.map instanceof GeoExt.MapPanel?a.map.map:a.map;delete a.map,a=Ext.applyIf(a,{reader:new Ext.data.JsonReader({},["level","resolution","scale"])}),GeoExt.data.ScaleStore.superclass.constructor.call(this,a),b&&this.bind(b)},bind:function(a){this.map=a instanceof GeoExt.MapPanel?a.map:a,this.map.events.register("changebaselayer",this,this.populateFromMap),this.map.baseLayer?this.populateFromMap():this.map.events.register("addlayer",this,this.populateOnAdd)},unbind:function(){this.map&&(this.map.events.unregister("addlayer",this,this.populateOnAdd),this.map.events.unregister("changebaselayer",this,this.populateFromMap),delete this.map)},populateOnAdd:function(a){a.layer.isBaseLayer&&(this.populateFromMap(),this.map.events.unregister("addlayer",this,this.populateOnAdd))},populateFromMap:function(){for(var a=[],b=this.map.baseLayer.resolutions,c=this.map.baseLayer.units,d=b.length-1;d>=0;d--){var e=b[d];a.push({level:d,resolution:e,scale:OpenLayers.Util.getScaleFromResolution(e,c)})}this.loadData(a)},destroy:function(){this.unbind(),GeoExt.data.ScaleStore.superclass.destroy.apply(this,arguments)}}),Ext.namespace("GeoExt.data"),GeoExt.data.FeatureStoreMixin=function(){return{layer:null,reader:null,featureFilter:null,constructor:function(a){a=a||{},a.reader=a.reader||new GeoExt.data.FeatureReader({},a.fields);var b=a.layer;delete a.layer,a.features&&(a.data=a.features),delete a.features;var c={initDir:a.initDir};delete a.initDir,arguments.callee.superclass.constructor.call(this,a),b&&this.bind(b,c)},bind:function(a,b){if(!this.layer){this.layer=a,b=b||{};var c=b.initDir;void 0==b.initDir&&(c=GeoExt.data.FeatureStore.LAYER_TO_STORE|GeoExt.data.FeatureStore.STORE_TO_LAYER);var d=a.features.slice(0);if(c&GeoExt.data.FeatureStore.STORE_TO_LAYER)for(var e=this.getRange(),f=e.length-1;f>=0;f--)this.layer.addFeatures([e[f].getFeature()]);c&GeoExt.data.FeatureStore.LAYER_TO_STORE&&this.loadData(d,!0),a.events.on({featuresadded:this.onFeaturesAdded,featuresremoved:this.onFeaturesRemoved,featuremodified:this.onFeatureModified,scope:this}),this.on({load:this.onLoad,clear:this.onClear,add:this.onAdd,remove:this.onRemove,update:this.onUpdate,scope:this})}},unbind:function(){this.layer&&(this.layer.events.un({featuresadded:this.onFeaturesAdded,featuresremoved:this.onFeaturesRemoved,featuremodified:this.onFeatureModified,scope:this}),this.un("load",this.onLoad,this),this.un("clear",this.onClear,this),this.un("add",this.onAdd,this),this.un("remove",this.onRemove,this),this.un("update",this.onUpdate,this),this.layer=null)},getRecordFromFeature:function(a){return this.getByFeature(a)||null},getByFeature:function(a){var b;if(a.state!==OpenLayers.State.INSERT)b=this.getById(a.id);else{var c=this.findBy(function(b){return b.getFeature()===a});c>-1&&(b=this.getAt(c))}return b},onFeaturesAdded:function(a){if(!this._adding){var b=a.features,c=b;if(this.featureFilter){c=[];for(var d,e,f,d=0,e=b.length;e>d;d++)f=b[d],this.featureFilter.evaluate(f)!==!1&&c.push(f)}this._adding=!0,this.loadData(c,!0),delete this._adding}},onFeaturesRemoved:function(a){if(!this._removing){var b,c,d,e=a.features;for(d=e.length-1;d>=0;d--)b=e[d],c=this.getByFeature(b),void 0!==c&&(this._removing=!0,this.remove(c),delete this._removing)}},onFeatureModified:function(a){if(!this._updating){var b=a.feature,c=this.getByFeature(b);if(void 0!==c){c.beginEdit();var d=b.attributes;if(d)for(var e=this.recordType.prototype.fields,f=0,g=e.length;g>f;f++){var h=e.items[f],i=h.mapping||h.name;i in d&&c.set(h.name,h.convert(d[i]))}c.set("state",b.state),c.set("fid",b.fid),c.setFeature(b),this._updating=!0,c.endEdit(),delete this._updating}}},addFeaturesToLayer:function(a){var b,c,d;for(d=new Array(c=a.length),b=0;c>b;b++)d[b]=a[b].getFeature();d.length>0&&(this._adding=!0,this.layer.addFeatures(d),delete this._adding)},onLoad:function(a,b,c){c&&c.add===!0||(this._removing=!0,this.layer.removeFeatures(this.layer.features),delete this._removing,this.addFeaturesToLayer(b))},onClear:function(){this._removing=!0,this.layer.removeFeatures(this.layer.features),delete this._removing},onAdd:function(a,b){this._adding||this.addFeaturesToLayer(b)},onRemove:function(a,b){if(!this._removing){var c=b.getFeature();null!=this.layer.getFeatureById(c.id)&&(this._removing=!0,this.layer.removeFeatures([b.getFeature()]),delete this._removing)}},onUpdate:function(a,b){if(!this._updating){var c=(new GeoExt.data.FeatureRecord).fields,d=b.getFeature();if(d.state!==OpenLayers.State.INSERT&&(d.state=OpenLayers.State.UPDATE),b.fields){var e=this.layer.events.triggerEvent("beforefeaturemodified",{feature:d});if(e!==!1){var f=d.attributes;b.fields.each(function(a){var d=a.mapping||a.name;c.containsKey(d)||(f[d]=b.get(a.name))}),this._updating=!0,this.layer.events.triggerEvent("featuremodified",{feature:d}),delete this._updating,null!=this.layer.getFeatureById(d.id)&&this.layer.drawFeature(d)}}}},destroy:function(){this.unbind(),GeoExt.data.FeatureStore.superclass.destroy.call(this)}}},GeoExt.data.FeatureStore=Ext.extend(Ext.data.Store,new GeoExt.data.FeatureStoreMixin),GeoExt.data.FeatureStore.LAYER_TO_STORE=1,GeoExt.data.FeatureStore.STORE_TO_LAYER=2,Ext.namespace("GeoExt.data"),GeoExt.data.WFSCapabilitiesStore=function(a){a=a||{},GeoExt.data.WFSCapabilitiesStore.superclass.constructor.call(this,Ext.apply(a,{proxy:a.proxy||(a.data?void 0:new Ext.data.HttpProxy({url:a.url,disableCaching:!1,method:"GET"})),reader:new GeoExt.data.WFSCapabilitiesReader(a,a.fields)}))},Ext.extend(GeoExt.data.WFSCapabilitiesStore,Ext.data.Store),Ext.namespace("GeoExt.plugins"),GeoExt.plugins.AttributeForm=function(a){Ext.apply(this,a)},GeoExt.plugins.AttributeForm.prototype={attributeStore:null,formPanel:null,init:function(a){this.formPanel=a,this.attributeStore instanceof Ext.data.Store&&(this.fillForm(),this.bind(this.attributeStore)),a.on("destroy",this.onFormDestroy,this)},bind:function(a){this.unbind(),a.on({load:this.onLoad,scope:this}),this.attributeStore=a},unbind:function(){this.attributeStore&&this.attributeStore.un("load",this.onLoad,this)},onLoad:function(){this.formPanel.items&&this.formPanel.removeAll(),this.fillForm()},fillForm:function(){this.attributeStore.each(function(a){var b=GeoExt.form.recordToField(a,Ext.apply({checkboxLabelProperty:"fieldLabel"},this.recordToFieldOptions||{}));b&&this.formPanel.add(b)},this),this.formPanel.doLayout()},onFormDestroy:function(){this.unbind()}},Ext.preg("gx_attributeform",GeoExt.plugins.AttributeForm),Ext.namespace("GeoExt","GeoExt.data"),GeoExt.data.ProtocolProxy=function(a){Ext.apply(this,a),GeoExt.data.ProtocolProxy.superclass.constructor.apply(this,arguments)},Ext.extend(GeoExt.data.ProtocolProxy,Ext.data.DataProxy,{protocol:null,abortPrevious:!0,setParamsAsOptions:!1,response:null,load:function(a,b,c,d,e){if(this.fireEvent("beforeload",this,a)!==!1){var f={params:a||{},request:{callback:c,scope:d,arg:e},reader:b},g=OpenLayers.Function.bind(this.loadResponse,this,f);this.abortPrevious&&this.abortRequest();var h={params:a,callback:g,scope:this};Ext.applyIf(h,e),this.setParamsAsOptions===!0&&(Ext.applyIf(h,h.params),delete h.params),this.response=this.protocol.read(h)}else c.call(d||this,null,e,!1)},abortRequest:function(){this.response&&(this.protocol.abort(this.response),this.response=null)},loadResponse:function(a,b){if(b.success()){var c=a.reader.read(b);this.fireEvent("load",this,a,a.request.arg),a.request.callback.call(a.request.scope,c,a.request.arg,!0)}else this.fireEvent("loadexception",this,a,b),a.request.callback.call(a.request.scope,null,a.request.arg,!1)}}),Ext.namespace("GeoExt"),GeoExt.Action=Ext.extend(Ext.Action,{control:null,activateOnEnable:!1,deactivateOnDisable:!1,map:null,uScope:null,uHandler:null,uToggleHandler:null,uCheckHandler:null,constructor:function(a){this.uScope=a.scope,this.uHandler=a.handler,this.uToggleHandler=a.toggleHandler,this.uCheckHandler=a.checkHandler,a.scope=this,a.handler=this.pHandler,a.toggleHandler=this.pToggleHandler,a.checkHandler=this.pCheckHandler;var b=this.control=a.control;delete a.control,this.activateOnEnable=!!a.activateOnEnable,delete a.activateOnEnable,this.deactivateOnDisable=!!a.deactivateOnDisable,delete a.deactivateOnDisable,b&&(a.map&&(a.map.addControl(b),delete a.map),(a.pressed||a.checked)&&b.map&&b.activate(),b.active&&(a.pressed=!0,a.checked=!0),b.events.on({activate:this.onCtrlActivate,deactivate:this.onCtrlDeactivate,scope:this})),arguments.callee.superclass.constructor.call(this,a)},pHandler:function(){var a=this.control;a&&a.type==OpenLayers.Control.TYPE_BUTTON&&a.trigger(),this.uHandler&&this.uHandler.apply(this.uScope,arguments)},pToggleHandler:function(a,b){this.changeControlState(b),this.uToggleHandler&&this.uToggleHandler.apply(this.uScope,arguments)},pCheckHandler:function(a,b){this.changeControlState(b),this.uCheckHandler&&this.uCheckHandler.apply(this.uScope,arguments)},changeControlState:function(a){a?this._activating||(this._activating=!0,this.control.activate(),this.initialConfig.pressed=!0,this.initialConfig.checked=!0,this._activating=!1):this._deactivating||(this._deactivating=!0,this.control.deactivate(),this.initialConfig.pressed=!1,this.initialConfig.checked=!1,this._deactivating=!1)},onCtrlActivate:function(){var a=this.control;a.type==OpenLayers.Control.TYPE_BUTTON?this.enable():(this.safeCallEach("toggle",[!0]),this.safeCallEach("setChecked",[!0]))},onCtrlDeactivate:function(){var a=this.control;a.type==OpenLayers.Control.TYPE_BUTTON?this.disable():(this.safeCallEach("toggle",[!1]),this.safeCallEach("setChecked",[!1]))},safeCallEach:function(a,b){for(var c=this.items,d=0,e=c.length;e>d;d++)c[d][a]&&(c[d].rendered?c[d][a].apply(c[d],b):c[d].on({render:c[d][a].createDelegate(c[d],b),single:!0}))},setDisabled:function(a){return!a&&this.activateOnEnable&&this.control&&!this.control.active&&this.control.activate(),a&&this.deactivateOnDisable&&this.control&&this.control.active&&this.control.deactivate(),GeoExt.Action.superclass.setDisabled.apply(this,arguments)}}),Ext.namespace("GeoExt.tree"),GeoExt.tree.TreeNodeUIEventMixin=function(){return{constructor:function(a){a.addEvents("rendernode","rawclicknode"),this.superclass=arguments.callee.superclass,this.superclass.constructor.apply(this,arguments)},render:function(){this.rendered||(this.superclass.render.apply(this,arguments),this.fireEvent("rendernode",this.node))},onClick:function(a){this.fireEvent("rawclicknode",this.node,a)!==!1&&this.superclass.onClick.apply(this,arguments)}}},Ext.namespace("GeoExt.grid"),GeoExt.grid.FeatureSelectionModelMixin=function(){return{autoActivateControl:!0,layerFromStore:!0,selectControl:null,bound:!1,superclass:null,selectedFeatures:[],autoPanMapOnSelection:!1,constructor:function(a){if(a=a||{},a.selectControl instanceof OpenLayers.Control.SelectFeature){if(!a.singleSelect){var b=a.selectControl;a.singleSelect=!(b.multiple||b.multipleKey)}}else a.layer instanceof OpenLayers.Layer.Vector&&(this.selectControl=this.createSelectControl(a.layer,a.selectControl),delete a.layer,delete a.selectControl);a.autoPanMapOnSelection&&(this.autoPanMapOnSelection=!0,delete a.autoPanMapOnSelection),this.superclass=arguments.callee.superclass,this.superclass.constructor.call(this,a)},initEvents:function(){if(this.superclass.initEvents.call(this),this.layerFromStore){var a=this.grid.getStore()&&this.grid.getStore().layer;!a||this.selectControl instanceof OpenLayers.Control.SelectFeature||(this.selectControl=this.createSelectControl(a,this.selectControl))}this.selectControl&&this.bind(this.selectControl)},createSelectControl:function(a,b){b=b||{};var c=void 0!==b.singleSelect?b.singleSelect:this.singleSelect;b=OpenLayers.Util.extend({toggle:!0,multipleKey:c?null:Ext.isMac?"metaKey":"ctrlKey"},b);var d=new OpenLayers.Control.SelectFeature(a,b);return a.map.addControl(d),d},bind:function(a,b){if(!this.bound){b=b||{},this.selectControl=a,a instanceof OpenLayers.Layer.Vector&&(this.selectControl=this.createSelectControl(a,b.controlConfig)),this.autoActivateControl&&this.selectControl.activate();for(var c=this.getLayers(),d=0,e=c.length;e>d;d++)c[d].events.on({featureselected:this.featureSelected,featureunselected:this.featureUnselected,scope:this});this.on("rowselect",this.rowSelected,this),this.on("rowdeselect",this.rowDeselected,this),this.bound=!0}return this.selectControl},unbind:function(){var a=this.selectControl;if(this.bound){for(var b=this.getLayers(),c=0,d=b.length;d>c;c++)b[c].events.un({featureselected:this.featureSelected,featureunselected:this.featureUnselected,scope:this});this.un("rowselect",this.rowSelected,this),this.un("rowdeselect",this.rowDeselected,this),this.autoActivateControl&&a.deactivate(),this.selectControl=null,this.bound=!1}return a},featureSelected:function(a){if(!this._selecting){var b=this.grid.store,c=b.findBy(function(b){return b.getFeature()==a.feature});-1==c||this.isSelected(c)||(this._selecting=!0,this.selectRow(c,!this.singleSelect),this._selecting=!1,this.grid.getView().focusRow(c))}},featureUnselected:function(a){if(!this._selecting){var b=this.grid.store,c=b.findBy(function(b){return b.getFeature()==a.feature});-1!=c&&this.isSelected(c)&&(this._selecting=!0,this.deselectRow(c),this._selecting=!1,this.grid.getView().focusRow(c))}},rowSelected:function(a,b,c){var d=c.getFeature();if(!this._selecting&&d){for(var e=this.getLayers(),f=0,g=e.length;g>f;f++)if(-1==e[f].selectedFeatures.indexOf(d)){this._selecting=!0,this.selectControl.select(d),this._selecting=!1,this.selectedFeatures.push(d);break}this.autoPanMapOnSelection&&this.recenterToSelectionExtent()}},rowDeselected:function(a,b,c){var d=c.getFeature();if(!this._selecting&&d){for(var e=this.getLayers(),f=0,g=e.length;g>f;f++)if(-1!=e[f].selectedFeatures.indexOf(d)){this._selecting=!0,this.selectControl.unselect(d),this._selecting=!1,OpenLayers.Util.removeItem(this.selectedFeatures,d);break}this.autoPanMapOnSelection&&this.selectedFeatures.length>0&&this.recenterToSelectionExtent()}},getLayers:function(){return this.selectControl.layers||[this.selectControl.layer]},recenterToSelectionExtent:function(){var a=this.selectControl.map,b=this.getSelectionExtent(),c=a.getZoomForExtent(b,!1);c>a.getZoom()?a.setCenter(b.getCenterLonLat()):a.zoomToExtent(b)},getSelectionExtent:function(){var a=null,b=this.selectedFeatures;if(b&&b.length>0)for(var c=null,d=0,e=b.length;e>d;d++)c=b[d].geometry,c&&(null===a&&(a=new OpenLayers.Bounds),a.extend(c.getBounds()));return a}}},GeoExt.grid.FeatureSelectionModel=Ext.extend(Ext.grid.RowSelectionModel,new GeoExt.grid.FeatureSelectionModelMixin),Ext.namespace("GeoExt.data"),GeoExt.data.WMSCapabilitiesStore=function(a){a=a||{},GeoExt.data.WMSCapabilitiesStore.superclass.constructor.call(this,Ext.apply(a,{proxy:a.proxy||(a.data?void 0:new Ext.data.HttpProxy({url:a.url,disableCaching:!1,method:"GET"})),reader:new GeoExt.data.WMSCapabilitiesReader(a,a.fields)}))},Ext.extend(GeoExt.data.WMSCapabilitiesStore,Ext.data.Store),Ext.namespace("GeoExt"),GeoExt.LayerOpacitySliderTip=Ext.extend(GeoExt.SliderTip,{template:"<div>{opacity}%</div>",compiledTemplate:null,init:function(a){this.compiledTemplate=new Ext.Template(this.template),GeoExt.LayerOpacitySliderTip.superclass.init.call(this,a)},getText:function(a){var b={opacity:a.value};return this.compiledTemplate.apply(b)}}),GeoExt.version="1.1";var popup,scriptSource=function(a){"use strict";a=document.getElementsByTagName("script");var b=a[a.length-1];return void 0!==b.getAttribute.length?b.src:b.getAttribute("src",-1)}();"undefined"==typeof mygeocloud_host&&(window.mygeocloud_host="/"===scriptSource.charAt(0)?"":scriptSource.split("/")[0]+"//"+scriptSource.split("/")[2]),"undefined"==typeof jQuery&&document.write("<script src='//ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js'></script>"),"undefined"==typeof OpenLayers&&document.write("<script src='"+mygeocloud_host+"/js/openlayers/OpenLayers.js'></script>"),"undefined"==typeof Ext&&(document.write("<script src='"+mygeocloud_host+"/js/ext/adapter/ext/ext-base.js'></script>"),document.write("<script src='"+mygeocloud_host+"/js/ext/ext-all.js'></script>"),document.write("<script src='"+mygeocloud_host+"/js/GeoExt/script/GeoExt.js'></script>"));var mygeocloud_ol=function(){"use strict";var a,b=mygeocloud_host,c=function(a,c){var d,e=this,f={sql:null,onLoad:function(){},styleMap:null,projection:"900913",strategies:null,visibility:!0,rendererOptions:{zIndexing:!0},lifetime:0,movedEnd:function(){},selectControl:{},clientEncoding:"UTF8",jsonp:!0,method:"GET"};if(c)for(d in c)f[d]=c[d];this.sql=f.sql,this.onLoad=f.onLoad,this.movedEnd=f.movedEnd,this.map=null,this.layer=new OpenLayers.Layer.Vector("Vector",{styleMap:f.styleMap,visibility:f.visibility,rendererOptions:f.rendererOptions}),this.hide=function(){this.layer.setVisibility(!1)},this.show=function(){this.layer.setVisibility(!0)},this.pointControl=new OpenLayers.Control.DrawFeature(this.layer,OpenLayers.Handler.Point),this.lineControl=new OpenLayers.Control.DrawFeature(this.layer,OpenLayers.Handler.Path),this.polygonControl=new OpenLayers.Control.DrawFeature(this.layer,OpenLayers.Handler.Polygon),this.selectControl=new OpenLayers.Control.SelectFeature(this.layer,f.selectControl),this.selectControl.handlers.feature.stopDown=!1,this.modifyControl=new OpenLayers.Control.ModifyFeature(this.layer,{}),this.geoJSON={},this.featureStore=null,this.load=function(c){var d=this.sql;try{var g=e.map;d=d.replace("{centerX}",g.getCenter().lat.toString()),d=d.replace("{centerY}",g.getCenter().lon.toString()),d=d.replace("{minX}",g.getExtent().left),d=d.replace("{maxX}",g.getExtent().right),d=d.replace("{minY}",g.getExtent().bottom),d=d.replace("{maxY}",g.getExtent().top),d=d.replace("{bbox}",g.getExtent().toString())}catch(h){}$.ajax({dataType:f.jsonp?"jsonp":"json",data:"q="+encodeURIComponent(d)+"&srs="+f.projection+"&lifetime="+f.lifetime+"&client_encoding="+f.clientEncoding,jsonp:f.jsonp?"jsonp_callback":!1,url:b+"/api/v1/sql/"+a,type:f.method,success:function(a){a.success===!1&&void 0===c&&alert(a.message),a.success===!0&&null!==a.features&&(e.geoJSON=a,e.layer.addFeatures((new OpenLayers.Format.GeoJSON).read(a)),e.featureStore=new GeoExt.data.FeatureStore({fields:a.forStore,layer:e.layer}))},complete:function(){e.onLoad()}})},this.reset=function(){this.layer.destroyFeatures()},this.getWKT=function(){return(new OpenLayers.Format.WKT).write(this.layer.features)}};a=function(a,c,d){var e,f,g={numZoomLevels:20,projection:"EPSG:900913",maxExtent:new OpenLayers.Bounds(-20037508.34,-20037508.34,20037508.34,20037508.34),controls:[new OpenLayers.Control.Attribution,new OpenLayers.Control.Zoom,new OpenLayers.Control.TouchNavigation({dragPanOptions:{enableKinetic:!0}})]};if(d)for(e in d)g[e]=d[e];f=this,this.bingApiKey=null,this.layerStr="",this.db=c,this.geoLocation={x:null,y:null,obj:{}},this.zoomToExtent=function(a,b){a?this.map.zoomToExtent(new OpenLayers.Bounds(a),b):this.map.zoomToExtent(this.map.maxExtent)},this.zoomToExtentOfgeoJsonStore=function(a){this.map.zoomToExtent(a.layer.getDataExtent())},this.getVisibleLayers=function(){for(var a=[],b=0;b<this.map.layers.length;b++)this.map.layers[b].isBaseLayer===!1&&this.map.layers[b].visibility===!0&&"OpenLayers.Layer.WMS"===this.map.layers[b].CLASS_NAME&&a.push(this.map.layers[b].params.LAYERS);return a.join(";")},this.getZoom=function(){return this.map.getZoom()},this.getPixelCoord=function(a,b){var c={};return c.x=this.map.getPixelFromLonLat(new OpenLayers.LonLat(a,b)).x,c.y=this.map.getPixelFromLonLat(new OpenLayers.LonLat(a,b)).y,c},this.zoomToPoint=function(a,b,c){this.map.setCenter(new OpenLayers.LonLat(a,b),c)},this.clickController=OpenLayers.Class(OpenLayers.Control,{defaultHandlerOptions:{single:!0,"double":!1,pixelTolerance:0,stopSingle:!1,stopDouble:!1},initialize:function(){this.handlerOptions=OpenLayers.Util.extend({},this.defaultHandlerOptions),OpenLayers.Control.prototype.initialize.apply(this,arguments),this.handler=new OpenLayers.Handler.Click(this,{click:this.trigger},this.handlerOptions)},trigger:function(a){var b=this.map.getLonLatFromViewPortPx(a.xy);try{popup.destroy()}catch(a){}var d=this.map.getExtent(),e=d.toArray(),g=e.join(","),i=this.map.getSize(),j='<div style="position:relative;"><div></div><div id="queryResult" style="display: table"></div><button onclick="popup.destroy()" style="position:absolute; top: -10px; right: 5px" type="button" class="close" aria-hidden="true">&times;</button></div>',k=new OpenLayers.LonLat(b.lon,b.lat);popup=new OpenLayers.Popup.Anchored("result",k,new OpenLayers.Size(100,150),j,null,!1,null),popup.panMapIfOutOfView=!0,$.ajax({dataType:"jsonp",data:"proj=25832&lon="+b.lon+"&lat="+b.lat+"&layers="+f.getVisibleLayers()+"&extent="+g+"&width="+i.w+"&height="+i.h,jsonp:"jsonp_callback",url:"//plandk2.mapcentia.com/apps/viewer/servers/query/"+c,success:function(a){if(a.html!==!1&&""!==a.html){f.map.addPopup(popup),$("#queryResult").html(a.html);var b=$("#queryResult").width()+35;popup.destroy(),popup=new OpenLayers.Popup.Anchored("result",k,new OpenLayers.Size(b,150),j,null,!1,null),f.map.addPopup(popup),$("#queryResult").html(a.html)}else $("#alert").fadeIn(400).delay(1e3).fadeOut(400),h.removeAllFeatures()}})}}),this.map=new OpenLayers.Map(a,{controls:g.controls,numZoomLevels:g.numZoomLevels,projection:g.projection,maxResolution:g.maxResolution,minResolution:g.minResolution,maxExtent:g.maxExtent});this.map;this.click=new this.clickController,this.map.addControl(this.click);var h=new OpenLayers.Layer.Vector("Mark",{displayInLayerSwitcher:!1});this.map.addLayers([h]),this.addMapQuestOSM=function(){return this.mapQuestOSM=new OpenLayers.Layer.OSM("MapQuest-OSM",["http://otile1.mqcdn.com/tiles/1.0.0/osm/${z}/${x}/${y}.jpg","http://otile2.mqcdn.com/tiles/1.0.0/osm/${z}/${x}/${y}.jpg","http://otile3.mqcdn.com/tiles/1.0.0/osm/${z}/${x}/${y}.jpg","http://otile4.mqcdn.com/tiles/1.0.0/osm/${z}/${x}/${y}.jpg"]),this.map.addLayer(this.mapQuestOSM),this.mapQuestOSM},this.addMapQuestAerial=function(){return this.mapQuestAerial=new OpenLayers.Layer.OSM("MapQuest Open Aerial Tiles",["http://oatile1.mqcdn.com/tiles/1.0.0/sat/${z}/${x}/${y}.jpg","http://oatile2.mqcdn.com/tiles/1.0.0/sat/${z}/${x}/${y}.jpg","http://oatile3.mqcdn.com/tiles/1.0.0/sat/${z}/${x}/${y}.jpg","http://oatile4.mqcdn.com/tiles/1.0.0/sat/${z}/${x}/${y}.jpg"]),this.mapQuestAerial.wrapDateLine=!0,this.map.addLayer(this.mapQuestAerial),this.mapQuestAerial},this.addOSM=function(){return this.osm=new OpenLayers.Layer.OSM("OSM"),this.osm.wrapDateLine=!0,this.map.addLayer(this.osm),this.osm},this.addGoogleStreets=function(){try{this.baseGNORMAL=new OpenLayers.Layer.Google("Google Streets",{type:G_NORMAL_MAP,sphericalMercator:!0,wrapDateLine:!0,numZoomLevels:20})}catch(a){}try{this.baseGNORMAL=new OpenLayers.Layer.Google("Google Streets",{wrapDateLine:!0,numZoomLevels:20})}catch(a){}return this.map.addLayer(this.baseGNORMAL),this.baseGNORMAL},this.addGoogleHybrid=function(){try{this.baseGHYBRID=new OpenLayers.Layer.Google("Google Hybrid",{type:G_HYBRID_MAP,sphericalMercator:!0,wrapDateLine:!0,numZoomLevels:20})}catch(a){}try{this.baseGHYBRID=new OpenLayers.Layer.Google("Google Hybrid",{type:google.maps.MapTypeId.HYBRID,wrapDateLine:!0,numZoomLevels:20})}catch(a){alert(a.message)}return this.map.addLayer(this.baseGHYBRID),this.baseGHYBRID},this.addGoogleSatellite=function(){try{this.baseGSATELLITE=new OpenLayers.Layer.Google("Google Satellite",{type:google.maps.MapTypeId.SATELLITE,wrapDateLine:!0,numZoomLevels:20})}catch(a){alert(a.message)}return this.map.addLayer(this.baseGSATELLITE),this.baseGSATELLITE},this.addGoogleTerrain=function(){try{this.baseGTERRAIN=new OpenLayers.Layer.Google("Google Terrain",{type:google.maps.MapTypeId.TERRAIN,wrapDateLine:!0,numZoomLevels:20})}catch(a){alert(a.message)}return this.map.addLayer(this.baseGTERRAIN),this.baseGTERRAIN},this.addBing=function(a){var b,c;switch(a){case"Road":c="Bing Road";break;case"Aerial":c="Bing Aerial";break;case"AerialWithLabels":c="Bing Aerial With Labels"}return b=new OpenLayers.Layer.Bing({name:c,wrapDateLine:!0,key:this.bingApiKey,type:a}),this.map.addLayer(b),b.baseLayer=!0,b.id=c,b},this.addStamenToner=function(){return this.stamenToner=new OpenLayers.Layer.Stamen("toner"),this.stamenToner.name="Stamen Toner",this.stamenToner.wrapDateLine=!0,this.map.addLayer(this.stamenToner),this.stamenToner},this.addYandex=function(){},this.addDtkSkaermkort=function(a,b){var c,d="//eu1.mapcentia.com/wms/dk/tilecache";return c=new OpenLayers.Layer.WMS(a,d,{layers:b},{wrapDateLine:!0,attribution:"&copy; Geodatastyrelsen"}),this.map.addLayer(c),c.baseLayer=!0,c.id=a,c},this.addHere=function(a){var b,c,d;switch(a){case"hereNormalNightGrey":c="Here Night",d="normal.night.grey";break;case"hereNormalDayGrey":c="Here Day",d="normal.day.grey"}return b=new OpenLayers.Layer.XYZ(a,"//1.base.maps.cit.api.here.com/maptile/2.1/maptile/newest/"+d+"/${z}/${x}/${y}/256/png8?app_id="+window.gc2Options.hereApp.App_Id+"&app_code="+window.gc2Options.hereApp.App_Code,{attribution:"&copy; Nokia</span>&nbsp;<a href='http://maps.nokia.com/services/terms' target='_blank' title='Terms of Use' style='color:#333;text-decoration: underline;'>Terms of Use</a></div> <img src='//api.maps.nokia.com/2.2.4/assets/ovi/mapsapi/by_here.png' border='0'>"}),this.map.addLayer(b),b.setVisibility(!1),b.baseLayer=!0,b.name=c,b.id=a,b},this.addDigitalGlobe=function(a){var b,c,d=this.digitalGlobeKey;switch(a){case"DigitalGlobe:Imagery":c="DigitalGlobe:ImageryTileService"}return b=new OpenLayers.Layer.XYZ(a,"https://services.digitalglobe.com/earthservice/wmtsaccess?CONNECTID="+d+"&Service=WMTS&REQUEST=GetTile&Version=1.0.0&Format=image/png&Layer="+c+"&TileMatrixSet=EPSG:3857&TileMatrix=EPSG:3857:${z}&TileRow=${y}&TileCol=${x}"),this.map.addLayer(b),b.baseLayer=!0,b.id=a,b},this.setBaseLayer=function(a){this.map.setBaseLayer(a)},this.addBaseLayer=function(a){var b;switch(a){case"osm":b=this.addOSM();break;case"mapQuestOSM":b=this.addMapQuestOSM();break;case"mapBoxNaturalEarth":b=this.addMapBoxNaturalEarth();break;case"stamenToner":b=this.addStamenToner();break;case"googleStreets":b=this.addGoogleStreets();break;case"googleHybrid":b=this.addGoogleHybrid();break;case"googleSatellite":b=this.addGoogleSatellite();break;case"googleTerrain":b=this.addGoogleTerrain();break;case"bingRoad":b=this.addBing("Road");break;case"bingAerial":b=this.addBing("Aerial");break;case"bingAerialWithLabels":b=this.addBing("AerialWithLabels");break;case"yandex":b=this.addYandex();break;case"dtkSkaermkort":b=this.addDtkSkaermkort("dtkSkaermkort","dtk_skaermkort");break;case"dtkSkaermkortDaempet":b=this.addDtkSkaermkort("dtkSkaermkortDaempet","dtk_skaermkort_daempet");break;case"DigitalGlobe:Imagery":b=this.addDigitalGlobe("DigitalGlobe:Imagery");break;case"hereNormalDayGrey":b=this.addHere("hereNormalDayGrey");break;case"hereNormalNightGrey":b=this.addHere("hereNormalNightGrey")}return b},this.addTileLayers=function(a,b){var c={db:this.db,singleTile:!1,opacity:1,isBaseLayer:!1,visibility:!0,wrapDateLine:!0,tileCached:!0,displayInLayerSwitcher:!0,name:null};if(b)for(e in b)c[e]=b[e];for(var d=[],f=0;f<a.length;f++){var g=this.createTileLayer(a[f],c);this.map.addLayer(g),d.push(g)}return d},this.createTileLayer=function(a,c){var d,e=a.split(".");d=c.tileCached?b+"/wms/"+c.db+"/tilecache?":b+"/wms/"+c.db+"/"+e[0]+"?";var f=new OpenLayers.Layer.WMS(c.name,d,{layers:a,transparent:!0},c);return f.id=a,f},this.addTileLayerGroup=function(a,b){var c={singleTile:!1,opacity:1,isBaseLayer:!1,visibility:!0,name:null,schema:null};if(b)for(e in b)c[e]=b[e];this.map.addLayer(this.createTileLayerGroup(a,c))},this.createTileLayerGroup=function(a,c){var d=new OpenLayers.Layer.WMS(c.name,b+"/wms/"+this.db+"/"+c.schema+"/?",{layers:a,transparent:!0},c);return d},this.addWmtsLayer=function(a){var b=null;a.options.tileSize=new OpenLayers.Size(256,256),a.options.tileOrigin=new OpenLayers.LonLat(this.map.maxExtent.left,this.map.maxExtent.top),a.options.tileFullExtent=this.map.maxExtent.clone();for(var c in a.options)a[c]=a.options[c];for(var d in a.params)a[d]=a.params[d];return null!=a.matrixIds&&a.matrixIds.indexOf(",")>0&&(a.matrixIds=a.matrixIds.split(",")),b=new OpenLayers.Layer.WMTS(a),this.map.addLayer(b),b},this.removeTileLayerByName=function(a){var b=this.map.getLayersByName(a);this.map.removeLayer(b[0])},this.addGeoJsonStore=function(a){a.map=this.map,this.map.addLayers([a.layer]),this.map.addControl(a.pointControl),this.map.addControl(a.lineControl),this.map.addControl(a.polygonControl),this.map.addControl(a.selectControl),this.map.addControl(a.modifyControl),this.map.events.register("moveend",null,a.movedEnd)},this.addControl=function(a){this.map.addControl(a);try{a.handlers.feature.stopDown=!1}catch(b){}return a.activate(),a},this.removeGeoJsonStore=function(a){this.map.removeLayer(a.layer)},this.hideLayer=function(a){this.map.getLayersByName(a)[0].setVisibility(!1)},this.showLayer=function(a){this.map.getLayersByName(a)[0].setVisibility(!0)},this.getCenter=function(){var a=this.map.center;return{x:a.lon,y:a.lat}},this.getExtent=function(){var a=this.map.getExtent();return a.toArray()},this.getBbox=function(){return this.map.getExtent().toString()};var i=new OpenLayers.Layer.Vector("geolocation_layer",{displayInLayerSwitcher:!1}),j=!0,k={fillColor:"#000",fillOpacity:.1,strokeWidth:0};
this.map.addLayers([i]);var l,m;this.locate=function(a){var b={firstCallBack:function(){},trackCallBack:function(){}};if(a)for(e in a)b[e]=a[e];l=b.firstCallBack,m=b.trackCallBack,i.removeAllFeatures(),n.deactivate(),n.watch=!0,j=!0,n.activate()},this.stopLocate=function(){n.deactivate()};var n=new OpenLayers.Control.Geolocate({bind:!1,geolocationOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:7e3}});this.map.addControl(n),n.events.register("locationupdated",n,function(a){i.removeAllFeatures();var b=new OpenLayers.Feature.Vector(OpenLayers.Geometry.Polygon.createRegularPolygon(new OpenLayers.Geometry.Point(a.point.x,a.point.y),a.position.coords.accuracy/2,40,0),{},k);i.addFeatures([new OpenLayers.Feature.Vector(a.point,{},{graphicName:"cross",strokeColor:"#f00",strokeWidth:1,fillOpacity:0,pointRadius:10}),b]),f.geoLocation={x:a.point.x,y:a.point.y,obj:a},j?(this.map.zoomToExtent(i.getDataExtent()),o(b),j=!1,this.bind=!0,l()):m()}),n.events.register("locationfailed",this,function(){alert("No location")});var o=function(a){var b=a.geometry.getCentroid(),c=a.geometry.getBounds(),d=Math.abs((c.right-c.left)/2),e=0,f="up",g=function(){e>16&&clearInterval(window.resizeInterval);var c=.03*d,g=c/d;switch(e){case 4:case 12:f="down";break;case 8:f="up"}"up"!==f&&(g=-Math.abs(g)),a.geometry.resize(1+g,b),i.drawFeature(a),e++};window.resizeInterval=window.setInterval(g,50,b,d)}};var d=function(a,b,c){var d,e={height:300,selectControl:{onSelect:function(){},onUnselect:function(){}},columns:b.geoJSON.forGrid};if(c)for(d in c)e[d]=c[d];this.grid=new Ext.grid.GridPanel({id:"gridpanel",viewConfig:{forceFit:!0},store:b.featureStore,sm:new GeoExt.grid.FeatureSelectionModel({singleSelect:!1,selectControl:e.selectControl}),cm:new Ext.grid.ColumnModel({defaults:{sortable:!0,editor:{xtype:"textfield"}},columns:e.columns}),listeners:e.listeners}),this.panel=new Ext.Panel({renderTo:a,split:!0,frame:!1,border:!1,layout:"fit",collapsible:!1,collapsed:!1,height:e.height,items:[this.grid]}),this.grid.getSelectionModel().bind().handlers.feature.stopDown=!1,this.selectionModel=this.grid.getSelectionModel().bind()};return{geoJsonStore:c,map:a,grid:d,urlVars:function(){{var a={};window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi,function(b,c,d){a[c]=d})}return a}(),pathName:window.location.pathname.split("/")}}(),geocloud;geocloud=function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l,m,n=function(a){a=document.getElementsByTagName("script");var b=a[a.length-1];return void 0!==b.getAttribute.length?b.src:b.getAttribute("src",-1)}(),o="osm",p="mapQuestOSM",q="mapBoxNaturalEarth",r="stamenToner",s="stamenTonerLite",t="googleStreets",u="googleHybrid",v="googleSatellite",w="googleTerrain",x="bingRoad",y="bingAerial",z="bingAerialWithLabels",A="dtkSkaermkort",B="dtkSkaermkortDaempet",C="DigitalGlobe:Imagery",D="hereNormalDayGrey",E="hereNormalNightGrey",F=void 0===window.mapAttribution?"Powered by <a target='_blank' href='//www.mapcentia.com/en/geocloud/geocloud.htm'>MapCentia GC2</a> ":window.mapAttribution;return"undefined"==typeof window.geocloud_host&&(window.geocloud_host=m="/"===n.charAt(0)?"":n.split("/")[0]+"//"+n.split("/")[2]),m=window.geocloud_host,"object"!=typeof ol&&"object"!=typeof L&&"object"!=typeof OpenLayers&&alert("You need to load neither OpenLayers.js, ol3,js or Leaflet.js"),"object"==typeof OpenLayers&&(l="ol2"),"object"==typeof ol&&(l="ol3"),"object"==typeof L&&(l="leaflet"),"loading"===document.readyState&&"undefined"==typeof jQuery&&document.write("<script src='//ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js'></script>"),c=function(a,b){a.prototype=new b},b=function(){this.defaults={styleMap:null,visibility:!0,lifetime:0,host:m,db:null,sql:null,q:null,name:"Vector",id:null,rendererOptions:{zIndexing:!0},projection:"leaflet"===l?"4326":"900913",pointToLayer:function(a,b){return L.circleMarker(b)},onEachFeature:function(){},onLoad:function(){},index:"",type:"",size:3,clientEncoding:"UTF8",async:!0,jsonp:!0,method:"GET"},this.hide=function(){this.layer.setVisibility(!1)},this.show=function(){this.layer.setVisibility(!0)},this.map=null,this.init=function(){switch(this.onLoad=this.defaults.onLoad,l){case"ol2":this.layer=new OpenLayers.Layer.Vector(this.defaults.name,{styleMap:this.defaults.styleMap,visibility:this.defaults.visibility,renderers:["Canvas","SVG","VML"],rendererOptions:this.defaults.rendererOptions});break;case"ol3":this.layer=new ol.layer.Vector({source:new ol.source.GeoJSON,style:this.defaults.styleMap}),this.layer.id=this.defaults.name;break;case"leaflet":this.layer=L.geoJson(null,{style:this.defaults.styleMap,pointToLayer:this.defaults.pointToLayer,onEachFeature:this.defaults.onEachFeature}),this.layer.id=this.defaults.name}},this.geoJSON={},this.featureStore=null,this.reset=function(){switch(l){case"ol2":this.layer.destroyFeatures();break;case"leaflet":this.layer.clearLayers()}},this.isEmpty=function(){switch(l){case"ol2":return 0===this.layer.features.length?!0:!1;case"leaflet":return 0===Object.keys(this.layer._layers).length?!0:!1}},this.getWKT=function(){return(new OpenLayers.Format.WKT).write(this.layer.features)}},d=e=function(a){var b,c,d,e=this;if(a)for(b in a)this.defaults[b]=a[b];this.init(),this.id=this.defaults.id,this.sql=this.defaults.sql,this.db=this.defaults.db,this.host=this.defaults.host.replace("cdn.",""),this.load=function(a){try{c=e.map,d=this.sql,d=d.replace("{centerX}",c.getCenter().lat.toString()),d=d.replace("{centerY}",c.getCenter().lon.toString()),d=d.replace("{minX}",c.getExtent().left),d=d.replace("{maxX}",c.getExtent().right),d=d.replace("{minY}",c.getExtent().bottom),d=d.replace("{maxY}",c.getExtent().top),d=d.replace("{bbox}",c.getExtent().toString())}catch(b){}return $.ajax({dataType:this.defaults.jsonp?"jsonp":"json",async:this.defaults.async,data:"q="+encodeURIComponent(d)+"&srs="+this.defaults.projection+"&lifetime="+this.defaults.lifetime+"&srs="+this.defaults.projection+"&client_encoding="+this.defaults.clientEncoding,jsonp:this.defaults.jsonp?"jsonp_callback":!1,url:this.host+"/api/v1/sql/"+this.db,type:this.defaults.method,success:function(b){if(b.success===!1&&void 0===a&&alert(b.message),b.success===!0&&null!==b.features)switch(e.geoJSON=b,l){case"ol2":e.layer.addFeatures((new OpenLayers.Format.GeoJSON).read(b));break;case"ol3":e.layer.getSource().addFeatures(new ol.source.GeoJSON({object:b.features[0]}));break;case"leaflet":e.layer.addData(b)}},complete:function(){e.onLoad()}}),this.layer}},f=function(a){var b,c=this;if(a)for(b in a)this.defaults[b]=a[b];this.init(),this.load=function(a){var b=this.defaults.q;try{var d=c.map;b=b.replace(/\{minX\}/g,d.getExtent().left),b=b.replace(/\{maxX\}/g,d.getExtent().right),b=b.replace(/\{minY\}/g,d.getExtent().bottom),b=b.replace(/\{maxY\}/g,d.getExtent().top),b=b.replace(/{bbox}/g,d.getExtent().toString())}catch(e){}return $.ajax({dataType:"jsonp",data:"search="+encodeURIComponent(b),jsonp:"jsonp_callback",url:this.defaults.host+"/api/v1/twitter/"+this.db,success:function(b){if(b.success===!1&&void 0===a&&alert(b.message),b.success===!0&&null!==b.features)switch(c.geoJSON=b,l){case"ol2":c.layer.addFeatures((new OpenLayers.Format.GeoJSON).read(b));break;case"leaflet":c.layer.addData(b)}},complete:function(){c.onLoad()}}),this.layer}},g=function(a){var b,c=this;if(a)for(b in a)this.defaults[b]=a[b];this.init(),this.q=this.defaults.q,this.load=function(){var a=c.map,b=this.q;try{b=b.replace("{minX}",a.getExtent().left),b=b.replace("{maxX}",a.getExtent().right),b=b.replace("{minY}",a.getExtent().bottom),b=b.replace("{maxY}",a.getExtent().top),b=b.replace("{bbox}",a.getExtent().toString())}catch(d){}return $.ajax({dataType:"jsonp",data:"q="+encodeURIComponent(b)+"&size="+this.defaults.size,jsonp:"jsonp_callback",url:this.defaults.host+"/api/v1/elasticsearch/search/"+this.defaults.db+"/"+this.defaults.index+"/"+this.defaults.type,success:function(a){var b=[];if($.each(a.hits.hits,function(a,c){b.push(c._source)}),a.features=b,null!==a.features)switch(c.geoJSON=a,l){case"ol2":c.layer.addFeatures((new OpenLayers.Format.GeoJSON).read(a));break;case"leaflet":c.layer.addData(a)}},complete:function(){c.onLoad()}}),this.layer}},c(e,b),c(f,b),c(g,b),h=function(a){var b,c={host:m,layer:null,db:null,singleTile:!1,opacity:1,wrapDateLine:!0,tileCached:!0,name:null,isBaseLayer:!1};if(a)for(b in a)c[b]=a[b];return i(c.layer,c)},i=function(a,b){var c,d,e,f;if(c=a.split("."),b.tileCached){e=b.host+"/wms/"+b.db+"/tilecache";var g=e,h=e,i=e;f=[g.replace("cdn.","cdn1."),h.replace("cdn.","cdn2."),i.replace("cdn.","cdn3.")],e=e.replace("cdn.","{s}.")}else e=b.host+"/wms/"+b.db+"/"+c[0]+"?",f=[e];switch(l){case"ol2":d=new OpenLayers.Layer.WMS(b.name,f,{layers:a,transparent:!0},b),d.id=a;break;case"ol3":d=new ol.layer.Tile({source:new ol.source.TileWMS({url:e,params:{LAYERS:a}}),visible:b.visibility}),d.id=a;break;case"leaflet":d=new L.TileLayer.WMS(e,{layers:a,format:"image/png",transparent:!0,subdomains:["cdn1","cdn2","cdn3"],maxZoom:20}),d.id=a}return d},a=function(a){var b,c,d=[],e={numZoomLevels:20,projection:"EPSG:900913",fadeAnimation:!0,zoomAnimation:!0};if(a)for(b in a)e[b]=a[b];switch("leaflet"===l&&$("<link/>").attr({rel:"stylesheet",type:"text/css",href:m+"/js/leaflet/leaflet.css"}).appendTo("head"),$("<link/>").attr({rel:"stylesheet",type:"text/css",href:m+"/api/v3/css/styles.css?b1639e04e4f6da62#grunt-cache-bust"}).appendTo("head"),this.bingApiKey=null,this.digitalGlobeKey=null,this.zoomToExtent=function(a,b){var c,d;switch(l){case"ol2":a?this.map.zoomToExtent(new OpenLayers.Bounds(a),b):this.map.zoomToExtent(this.map.maxExtent);break;case"ol3":a?this.map.zoomToExtent(new OpenLayers.Bounds(a),b):(this.map.getView().setCenter([0,0]),this.map.getView().setResolution(39136));break;case"leaflet":a?(c=k(a[0],a[1],"EPSG:900913","EPSG:4326"),d=k(a[2],a[3],"EPSG:900913","EPSG:4326"),this.map.fitBounds([[c.y,c.x],[d.y,d.x]])):this.map.fitWorld()}},this.zoomToExtentOfgeoJsonStore=function(a){switch(l){case"ol2":this.map.zoomToExtent(a.layer.getDataExtent());break;case"leaflet":this.map.fitBounds(a.layer.getBounds())}},this.getBaseLayers=function(){var a=[];switch(l){case"leaflet":var b=this.map._layers;for(var c in b)b.hasOwnProperty(c)&&b[c].baseLayer===!0&&a.push(b)}return a},this.getVisibleLayers=function(a){a=a===!0?!0:!1;var b,c=[];switch(l){case"ol2":for(b=0;b<this.map.layers.length;b++)this.map.layers[b].isBaseLayer!==a&&this.map.layers[b].isBaseLayer!==!1&&null!==this.map.layers[b].isBaseLayer||this.map.layers[b].visibility!==!0||"OpenLayers.Layer.WMS"!==this.map.layers[b].CLASS_NAME||c.push(this.map.layers[b].params.LAYERS);break;case"ol3":for(b=0;b<this.map.getLayers().getLength();b++)this.map.getLayers().a[b].e.visible===!0&&this.map.getLayers().a[b].baseLayer!==!0&&c.push(this.map.getLayers().a[b].id);break;case"leaflet":var d=this.map._layers;for(var e in d)d.hasOwnProperty(e)&&(d[e].baseLayer!==a&&d[e].baseLayer!==!1&&null!==d[e].baseLayer||"object"!=typeof d[e]._tiles||c.push(d[e].id))}return c.join(";")},this.getNamesOfVisibleLayers=function(){var a,b=[];switch(l){case"ol2":for(a=0;a<this.map.layers.length;a++)this.map.layers[a].isBaseLayer===!1&&this.map.layers[a].visibility===!0&&"OpenLayers.Layer.WMS"===this.map.layers[a].CLASS_NAME&&b.push(this.map.layers[a].name);break;case"ol3":for(a=0;a<this.map.getLayers().getLength();a++)this.map.getLayers().a[a].t.visible===!0&&this.map.getLayers().a[a].baseLayer!==!0&&b.push(this.map.getLayers().a[a].id);break;case"leaflet":var c=this.map._layers;for(var d in c)c.hasOwnProperty(d)&&c[d].baseLayer!==!0&&"object"==typeof c[d]._tiles&&b.push(c[d].id)}return b.length>0?b.join(","):!1},this.getBaseLayer=function(){return this.map.baseLayer},this.getBaseLayerName=function(){var a,b;switch(l){case"ol2":a=this.map.baseLayer.name;break;case"ol3":b=this.map.getLayers();for(var c=0;c<b.getLength();c++)b.a[c].t.visible===!0&&b.a[c].baseLayer===!0&&(a=this.map.getLayers().a[c].id);break;case"leaflet":b=this.map._layers;for(var d in b)b.hasOwnProperty(d)&&b[d].baseLayer===!0&&(a=b[d].id)}return a},this.getZoom=function(){var a;switch(l){case"ol2":a=this.map.getZoom();break;case"ol3":var b=this.getResolution();a=Math.round(Math.log(2*Math.PI*6378137/(256*b))/Math.LN2);break;case"leaflet":a=this.map.getZoom()}return a},this.getResolution=function(){return this.map.getView().getResolution()},this.getPixelCoord=function(a,b){var c={};return c.x=this.map.getPixelFromLonLat(new OpenLayers.LonLat(a,b)).x,c.y=this.map.getPixelFromLonLat(new OpenLayers.LonLat(a,b)).y,c},this.zoomToPoint=function(a,b,c){switch(l){case"ol2":this.map.setCenter(new OpenLayers.LonLat(a,b),c);break;case"ol3":this.map.getView().setCenter([a,b]);var d;d=2*Math.PI*6378137/(256*Math.pow(2,c)),this.map.getView().setResolution(d);break;case"leaflet":var e=k(a,b,"EPSG:900913","EPSG:4326");this.map.setView([e.y,e.x],c)}},this.setView=function(a,b){this.map.setView(a,b)},l){case"ol2":this.map=new OpenLayers.Map(e.el,{controls:[new OpenLayers.Control.Zoom,new OpenLayers.Control.Attribution,new OpenLayers.Control.TouchNavigation({dragPanOptions:{enableKinetic:!0}})],numZoomLevels:e.numZoomLevels,projection:e.projection,maxResolution:e.maxResolution,minResolution:e.minResolution,maxExtent:e.maxExtent,eventListeners:e.eventListeners});break;case"ol3":this.map=new ol.Map({target:e.el,view:new ol.View2D({})});break;case"leaflet":this.map=new L.map(e.el,e),c=L.control.layers([],[]),this.map.addControl(c),this.map.attributionControl.setPrefix(F)}this.map;this.addMapQuestOSM=function(){switch(l){case"ol2":this.mapQuestOSM=new OpenLayers.Layer.OSM("mapQuestOSM",["http://otile1.mqcdn.com/tiles/1.0.0/osm/${z}/${x}/${y}.jpg","http://otile2.mqcdn.com/tiles/1.0.0/osm/${z}/${x}/${y}.jpg","http://otile3.mqcdn.com/tiles/1.0.0/osm/${z}/${x}/${y}.jpg","http://otile4.mqcdn.com/tiles/1.0.0/osm/${z}/${x}/${y}.jpg"]),this.mapQuestOSM.wrapDateLine=!1,this.map.addLayer(this.mapQuestOSM),this.mapQuestOSM.setVisibility(!1);break;case"ol3":this.mapQuestOSM=new ol.layer.TileLayer({source:new ol.source.MapQuestOSM,visible:!1}),this.map.addLayer(this.mapQuestOSM);break;case"leaflet":this.mapQuestOSM=new L.tileLayer("http://otile1.mqcdn.com/tiles/1.0.0/osm/{z}/{x}/{y}.jpg",{attribution:"&copy; <a target='_blank' href='http://www.openstreetmap.org/copyright'>OpenStreetMap</a> contributors",maxZoom:20,maxNativeZoom:18}),c.addBaseLayer(this.mapQuestOSM)}return this.mapQuestOSM.baseLayer=!0,this.mapQuestOSM.id="mapQuestOSM",this.mapQuestOSM},this.addMapQuestAerial=function(){switch(l){case"ol2":this.mapQuestAerial=new OpenLayers.Layer.OSM("mapQuestAerial",["http://oatile1.mqcdn.com/tiles/1.0.0/sat/${z}/${x}/${y}.jpg","http://oatile2.mqcdn.com/tiles/1.0.0/sat/${z}/${x}/${y}.jpg","http://oatile3.mqcdn.com/tiles/1.0.0/sat/${z}/${x}/${y}.jpg","http://oatile4.mqcdn.com/tiles/1.0.0/sat/${z}/${x}/${y}.jpg"]),this.mapQuestAerial.wrapDateLine=!1,this.map.addLayer(this.mapQuestAerial),this.mapQuestAerial.setVisibility(!1);break;case"ol3":this.mapQuestAerial=new ol.layer.TileLayer({source:new ol.source.MapQuestOpenAerial,visible:!1}),this.map.addLayer(this.mapQuestAerial);break;case"leaflet":this.mapQuestAerial=new L.tileLayer("http://oatile1.mqcdn.com/tiles/1.0.0/sat/{z}/{x}/{y}.jpg",{maxZoom:20,maxNativeZoom:18}),c.addBaseLayer(this.mapQuestAerial)}return this.mapQuestAerial.baseLayer=!0,this.mapQuestAerial.id="mapQuestAerial",this.mapQuestAerial},this.addOSM=function(){switch(l){case"ol2":this.osm=new OpenLayers.Layer.OSM("osm"),this.osm.wrapDateLine=!1,this.map.addLayer(this.osm),this.osm.setVisibility(!1);break;case"ol3":this.osm=new ol.layer.Tile({source:new ol.source.OSM,visible:!1}),this.map.addLayer(this.osm);break;case"leaflet":this.osm=new L.tileLayer("//{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"&copy; <a target='_blank' href='http://www.openstreetmap.org/copyright'>OpenStreetMap</a> contributors",maxZoom:20,maxNativeZoom:18}),c.addBaseLayer(this.osm)}return this.osm.baseLayer=!0,this.osm.id="osm",this.osm},this.addStamen=function(a){var b;switch(a){case"toner":b="stamenToner";break;case"toner-lite":b="stamenTonerLite"}switch(l){case"ol2":this.stamenToner=new OpenLayers.Layer.Stamen(a),this.stamenToner.name=b,this.map.addLayer(this.stamenToner),this.stamenToner.setVisibility(!1);break;case"ol3":this.stamenToner=new ol.layer.TileLayer({source:new ol.source.Stamen({layer:a}),visible:!1}),this.map.addLayer(this.stamenToner);break;case"leaflet":try{this.stamenToner=new L.StamenTileLayer(a),c.addBaseLayer(this.stamenToner)}catch(d){}}return this.stamenToner.baseLayer=!0,this.stamenToner.id=b,this.stamenToner},this.addMapBoxNaturalEarth=function(){switch(l){case"ol2":this.mapBoxNaturalEarth=new OpenLayers.Layer.XYZ("mapBoxNaturalEarth",["//a.tiles.mapbox.com/v3/mapbox.natural-earth-hypso-bathy/${z}/${x}/${y}.png","//b.tiles.mapbox.com/v3/mapbox.natural-earth-hypso-bathy/${z}/${x}/${y}.png","//c.tiles.mapbox.com/v3/mapbox.natural-earth-hypso-bathy/${z}/${x}/${y}.png","//d.tiles.mapbox.com/v3/mapbox.natural-earth-hypso-bathy/${z}/${x}/${y}.png"]),this.mapBoxNaturalEarth.wrapDateLine=!1,this.map.addLayer(this.mapBoxNaturalEarth),this.mapBoxNaturalEarth.setVisibility(!1);break;case"ol3":this.mapBoxNaturalEarth=new ol.layer.TileLayer({source:new ol.source.OSM,visible:!1}),this.map.addLayer(this.mapBoxNaturalEarth);break;case"leaflet":this.mapBoxNaturalEarth=new L.tileLayer("//a.tiles.mapbox.com/v3/mapbox.natural-earth-hypso-bathy/{z}/{x}/{y}.png"),c.addBaseLayer(this.mapBoxNaturalEarth)}return this.mapBoxNaturalEarth.baseLayer=!0,this.mapBoxNaturalEarth.id="mapBoxNaturalEarth",this.mapBoxNaturalEarth},this.addGoogle=function(a){var b,d,e=this;switch(a){case"ROADMAP":d="googleStreets";break;case"HYBRID":d="googleHybrid";break;case"SATELLITE":d="googleSatellite";break;case"TERRAIN":d="googleTerrain"}"undefined"!=typeof window.GoogleMapsDirty||"undefined"!=typeof google&&"undefined"!=typeof google.maps?"undefined"==typeof window.GoogleMapsDirty&&window.gc2SetLGoogle():(window.GoogleMapsDirty=!0,jQuery.getScript("//maps.googleapis.com/maps/api/js?v=3.exp&sensor=false&callback=gc2SetLGoogle")),function f(){if("undefined"!=typeof google&&"undefined"!=typeof google.maps){switch(l){case"ol2":b=new OpenLayers.Layer.Google(d,{type:google.maps.MapTypeId[a],wrapDateLine:!0,numZoomLevels:20}),e.map.addLayer(b),b.setVisibility(!1),b.baseLayer=!0,b.id=d;break;case"leaflet":if("undefined"!=typeof L.Google){b=new L.Google(a),b.baseLayer=!0,c.addBaseLayer(b),b.id=d;break}setTimeout(f,10)}return b}setTimeout(f,10)}()},this.addBing=function(a){var b,d;switch(a){case"Road":d="bingRoad";break;case"Aerial":d="bingAerial";break;case"AerialWithLabels":d="bingAerialWithLabels"}switch(l){case"ol2":return b=new OpenLayers.Layer.Bing({name:d,wrapDateLine:!0,key:this.bingApiKey,type:a}),this.map.addLayer(b),b.setVisibility(!1),b.baseLayer=!0,b.id=d,b;case"leaflet":return b=new L.BingLayer(this.bingApiKey,{type:a,maxZoom:20,maxNativeZoom:18}),b.baseLayer=!0,c.addBaseLayer(b),b.id=d,b}},this.addDigitalGlobe=function(a){var b,d,e=this.digitalGlobeKey;switch(a){case"DigitalGlobe:Imagery":d="DigitalGlobe:ImageryTileService"}switch(l){case"ol2":b=new OpenLayers.Layer.XYZ(a,"https://services.digitalglobe.com/earthservice/wmtsaccess?CONNECTID="+e+"&Service=WMTS&REQUEST=GetTile&Version=1.0.0&Format=image/png&Layer="+d+"&TileMatrixSet=EPSG:3857&TileMatrix=EPSG:3857:${z}&TileRow=${y}&TileCol=${x}"),this.map.addLayer(b),b.setVisibility(!1);break;case"leaflet":b=new L.TileLayer("https://services.digitalglobe.com/earthservice/wmtsaccess?CONNECTID="+e+"&Service=WMTS&REQUEST=GetTile&Version=1.0.0&Format=image/png&Layer="+d+"&TileMatrixSet=EPSG:3857&TileMatrix=EPSG:3857:{z}&TileRow={y}&TileCol={x}",{maxZoom:20}),c.addBaseLayer(b)}return b.baseLayer=!0,b.id=a,b},this.addHere=function(a){var b,d;switch(a){case"hereNormalNightGrey":d="normal.night.grey";break;case"hereNormalDayGrey":d="normal.day.grey"}switch(l){case"ol2":b=new OpenLayers.Layer.XYZ(a,"//1.base.maps.cit.api.here.com/maptile/2.1/maptile/newest/"+d+"/${z}/${x}/${y}/256/png8?app_id="+window.gc2Options.hereApp.App_Id+"&app_code="+window.gc2Options.hereApp.App_Code,{attribution:"&copy; Nokia</span>&nbsp;<a href='http://maps.nokia.com/services/terms' target='_blank' title='Terms of Use' style='color:#333;text-decoration: underline;'>Terms of Use</a></div> <img src='//api.maps.nokia.com/2.2.4/assets/ovi/mapsapi/by_here.png' border='0'>"}),this.map.addLayer(b),b.setVisibility(!1);break;case"leaflet":b=new L.TileLayer("//{s}.base.maps.cit.api.here.com/maptile/2.1/maptile/newest/"+d+"/{z}/{x}/{y}/256/png8?app_id="+window.gc2Options.hereApp.App_Id+"&app_code="+window.gc2Options.hereApp.App_Code,{maxZoom:20,subdomains:["1","2","3","4"],attribution:"&copy; Nokia</span>&nbsp;<a href='http://maps.nokia.com/services/terms' target='_blank' title='Terms of Use' style='color:#333;text-decoration: underline;'>Terms of Use</a></div> <img src='//api.maps.nokia.com/2.2.4/assets/ovi/mapsapi/by_here.png' border='0'>"}),c.addBaseLayer(b)}return b.baseLayer=!0,b.id=a,b},this.addDtkSkaermkort=function(a,b){var d,e="//eu1.mapcentia.com/wms/dk/tilecache";switch(l){case"ol2":d=new OpenLayers.Layer.WMS(a,e,{layers:b},{wrapDateLine:!0,attribution:"&copy; Geodatastyrelsen"}),this.map.addLayer(d),d.setVisibility(!1);break;case"leaflet":e=e.replace("cdn.","{s}."),d=new L.TileLayer.WMS(e,{layers:b,format:"image/png",transparent:!0,subdomains:["cdn1","cdn2","cdn3"],attribution:"&copy; Geodatastyrelsen",maxZoom:20}),c.addBaseLayer(d)}return d.baseLayer=!0,d.id=a,d},this.addYandex=function(){},this.setBaseLayer=function(a){var b,d=this;!function e(){if(a.search("google")>-1&&"undefined"!=typeof L.Google&&"undefined"!=typeof google&&"undefined"!=typeof google.maps||-1===a.search("google"))switch(l){case"ol2":d.showLayer(a),d.map.setBaseLayer(d.getLayersByName(a));break;case"ol3":b=d.map.getLayers();for(var f=0;f<b.getLength();f++)b.a[f].baseLayer===!0&&b.a[f].set("visible",!1);d.getLayersByName(a).set("visible",!0);break;case"leaflet":b=c._layers;for(var g in b)b.hasOwnProperty(g)&&(b[g].layer.baseLayer===!0&&d.map.hasLayer(b[g].layer)&&d.map.removeLayer(b[g].layer),b[g].layer.baseLayer===!0&&b[g].layer.id===a&&(-1===a.search("google")&&b[g].layer.setZIndex(1),d.map.addLayer(b[g].layer,!1)))}else setTimeout(e,10)}()},this.addBaseLayer=function(a,b){var c;switch(a){case"osm":c=this.addOSM();break;case"mapQuestOSM":c=this.addMapQuestOSM();break;case"mapBoxNaturalEarth":c=this.addMapBoxNaturalEarth();break;case"stamenToner":c=this.addStamen("toner");break;case"stamenTonerLite":c=this.addStamen("toner-lite");break;case"googleStreets":c=this.addGoogle("ROADMAP");break;case"googleHybrid":c=this.addGoogle("HYBRID");break;case"googleSatellite":c=this.addGoogle("SATELLITE");break;case"googleTerrain":c=this.addGoogle("TERRAIN");break;case"bingRoad":c=this.addBing("Road");break;case"bingAerial":c=this.addBing("Aerial");break;case"bingAerialWithLabels":c=this.addBing("AerialWithLabels");break;case"yandex":c=this.addYandex();break;case"dtkSkaermkort":c=this.addDtkSkaermkort("dtkSkaermkort","dtk_skaermkort");break;case"dtkSkaermkortDaempet":c=this.addDtkSkaermkort("dtkSkaermkortDaempet","dtk_skaermkort_daempet");break;case"DigitalGlobe:Imagery":c=this.addDigitalGlobe("DigitalGlobe:Imagery");break;case"hereNormalDayGrey":c=this.addHere("hereNormalDayGrey");break;case"hereNormalNightGrey":c=this.addHere("hereNormalNightGrey");break;default:this.addTileLayers({layers:[a],db:b,isBaseLayer:!0,visibility:!1,wrapDateLine:!1,displayInLayerSwitcher:!0,name:a})}return c},this.addTileLayers=function(a){var d={host:m,layers:[],db:null,singleTile:!1,opacity:1,isBaseLayer:!1,visibility:!0,wrapDateLine:!0,tileCached:!0,displayInLayerSwitcher:!0,name:null};if(a)for(b in a)d[b]=a[b];for(var e=d.layers,f=[],g=0;g<e.length;g++){var h=i(e[g],d);switch(h.baseLayer=d.isBaseLayer,l){case"ol2":this.map.addLayer(h);break;case"ol3":this.map.addLayer(h);break;case"leaflet":d.isBaseLayer===!0?c.addBaseLayer(h):c.addOverlay(h),d.visibility===!0&&this.showLayer(e[g])}f.push(h)}return f},this.removeTileLayerByName=function(a){var b=this.map.getLayersByName(a);this.map.removeLayer(b[0])},this.setZIndexOfLayer=function(a,b){switch(l){case"ol2":break;case"leaflet":a.setZIndex(b)}},this.addGeoJsonStore=function(a){switch(a.map=this,l){case"ol2":this.map.addLayers([a.layer]);break;case"ol3":this.map.addLayer(a.layer);break;case"leaflet":c.addOverlay(a.layer),this.showLayer(a.layer.id)}},this.removeGeoJsonStore=function(a){switch(l){case"ol2":this.map.removeLayer(a.layer);break;case"leaflet":this.map.removeLayer(a.layer)}},this.hideLayer=function(a){switch(l){case"ol2":this.getLayersByName(a).setVisibility(!1);break;case"ol3":this.getLayersByName(a).set("visible",!1);break;case"leaflet":this.map.removeLayer(this.getLayersByName(a))}},this.showLayer=function(a){switch(l){case"ol2":this.getLayersByName(a).setVisibility(!0);break;case"ol3":this.getLayersByName(a).set("visible",!0);break;case"leaflet":this.getLayersByName(a).addTo(this.map)}},this.getLayerById=function(a){return this.map.getLayer(a)},this.getLayersByName=function(a){var b;switch(l){case"ol2":b=this.map.getLayersByName(a)[0];break;case"ol3":for(var d=0;d<this.map.getLayers().getLength();d++)this.map.getLayers().a[d].id===a&&(b=this.map.getLayers().a[d]);break;case"leaflet":var e=c._layers;for(var f in e)e.hasOwnProperty(f)&&e[f].layer.id===a&&(b=e[f].layer)}return b},this.hideAllTileLayers=function(){for(var a=0;a<this.map.layers.length;a++)this.map.layers[a].isBaseLayer===!1&&"OpenLayers.Layer.WMS"===this.map.layers[a].CLASS_NAME&&this.map.layers[a].setVisibility(!1)},this.getCenter=function(){var a;switch(l){case"ol2":return a=this.map.center,{x:a.lon,y:a.lat};case"ol3":return a=this.map.getView().getCenter(),{x:a[0],y:a[1]};case"leaflet":a=this.map.getCenter();var b=k(a.lng,a.lat,"EPSG:4326","EPSG:900913");return{x:b.x,y:b.y,lon:a.lng,lat:a.lat}}},this.getExtent=function(){var a,b;switch(l){case"ol2":a=this.map.getExtent(),b=a.toArray();break;case"ol3":break;case"leaflet":a=this.map.getBounds().toBBoxString().split(","),b={left:a[0],right:a[2],top:a[3],bottom:a[1]}}return b},this.getBbox=function(){return this.map.getExtent().toString()},this.locate=function(){this.map.locate({setView:!0})},this.addLayerFromWkt=function(a){switch(l){case"ol2":this.removeQueryLayers();for(var b,c,e,f=new OpenLayers.Format.WKT,g=0;g<a.length;g++)b=f.read(a[g]),d[g]=new OpenLayers.Layer.Vector(null,{displayInLayerSwitcher:!1,styleMap:new OpenLayers.StyleMap({"default":new OpenLayers.Style({strokeColor:"#000000",strokeWidth:3,fillOpacity:0,strokeOpacity:.8})})}),c=b.geometry.transform(new OpenLayers.Projection("EPSG:4326"),new OpenLayers.Projection("EPSG:900913")),e=new OpenLayers.Feature.Vector(c,{}),d[g].addFeatures([e]),this.map.addLayers([d[g]]);break;case"ol3":break;case"leaflet":this.removeQueryLayers();for(var f=new Wkt.Wkt,g=0;g<a.length;g++)f.read(a[g]),d[g]=f.toObject({color:"#000000",weight:3,opacity:.8,fillOpacity:0}).addTo(this.map)}},this.removeQueryLayers=function(){switch(l){case"ol2":try{for(var a=0;a<d.length;a++)this.map.removeLayer(d[a])}catch(b){}break;case"ol3":break;case"leaflet":try{for(var a=0;a<d.length;a++)this.map.removeLayer(d[a])}catch(b){}}},this.on=function(a,b){switch(l){case"ol2":if("click"===a){OpenLayers.Control.Click=OpenLayers.Class(OpenLayers.Control,{defaultHandlerOptions:{single:!0,"double":!1,pixelTolerance:0,stopSingle:!1,stopDouble:!1},initialize:function(){this.handlerOptions=OpenLayers.Util.extend({},this.defaultHandlerOptions),OpenLayers.Control.prototype.initialize.apply(this,arguments),this.handler=new OpenLayers.Handler.Click(this,{click:this.trigger},this.handlerOptions)},trigger:function(a){b(a)}});var c=new OpenLayers.Control.Click;this.map.addControl(c),c.activate()}"moveend"===a&&this.map.events.register("moveend",null,b);break;case"ol3":this.map.on(a,b);break;case"leaflet":this.map.on(a,b)}}},j=function(a,b){this.getCoordinate=function(){var c;switch(l){case"ol2":return c=b.map.getLonLatFromPixel(a.xy),{x:c.lon,y:c.lat};case"ol3":return c=a.coordinate,{x:c[0],y:c[1]};case"leaflet":c=a.latlng;var d=k(c.lng,c.lat,"EPSG:4326","EPSG:900913");return{x:d.x,y:d.y}}}},k=function(a,b,c,d){var e=[];if("object"==typeof Proj4js){var f=new Proj4js.Proj(c),g=new Proj4js.Proj(d);e=new Proj4js.Point(a,b),Proj4js.transform(f,g,e)}else e.x=null,e.y=null;return e},{geoJsonStore:d,sqlStore:e,tileLayer:h,elasticStore:g,tweetStore:f,map:a,MAPLIB:l,clickEvent:j,transformPoint:k,urlVars:function(){{var a={};window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi,function(b,c,d){a[c]=d})}return a}(),pathName:window.location.pathname.split("/"),urlHash:window.location.hash,OSM:o,MAPQUESTOSM:p,MAPBOXNATURALEARTH:q,STAMENTONER:r,STAMENTONERLITE:s,GOOGLESTREETS:t,GOOGLEHYBRID:u,GOOGLESATELLITE:v,GOOGLETERRAIN:w,BINGROAD:x,BINGAERIAL:y,BINGAERIALWITHLABELS:z,DTKSKAERMKORT:A,DTKSKAERMKORTDAEMPET:B,DIGITALGLOBE:C,HERENORMALDAYGREY:D,HERENORMALNIGHTGREY:E}}(),function(a){"use strict";var b=" a. b. c. d.".split(" "),c=function(a,c,d,e){return{url:["https://stamen-tiles.a.ssl.fastly.net/",a,"/{Z}/{X}/{Y}.",c].join(""),type:c,subdomains:b.slice(),minZoom:d,maxZoom:e,attribution:['Map tiles by <a href="http://stamen.com">Stamen Design</a>, ','under <a href="http://creativecommons.org/licenses/by/3.0">CC BY 3.0</a>. ','Data by <a href="http://openstreetmap.org">OpenStreetMap</a>, ','under <a href="http://creativecommons.org/licenses/by-sa/3.0">CC BY SA</a>.'].join("")}},d={toner:c("toner","png",0,20),terrain:c("terrain","jpg",4,18),watercolor:c("watercolor","jpg",1,18)},e=function(a){if(a in d)return d[a];throw"No such provider ("+a+")"},f=function(a,b,f){for(var g=e(a),h=0;h<b.length;h++){var i=[a,b[h]].join("-");d[i]=c(i,f||g.type,g.minZoom,g.maxZoom)}};if(f("toner",["hybrid","labels","lines","background","lite"]),f("toner",["2010"]),f("toner",["2011","2011-lines","2011-labels","2011-lite"]),f("terrain",["background"]),f("terrain",["labels","lines"],"png"),a.stamen=a.stamen||{},a.stamen.tile=a.stamen.tile||{},a.stamen.tile.providers=d,a.stamen.tile.getProvider=e,"object"==typeof L&&(L.StamenTileLayer=L.TileLayer.extend({initialize:function(a){var b=e(a),c=b.url.replace(/({[A-Z]})/g,function(a){return a.toLowerCase()});L.TileLayer.prototype.initialize.call(this,c,{minZoom:b.minZoom,maxZoom:b.maxZoom,subdomains:b.subdomains,scheme:"xyz",attribution:b.attribution})}})),"object"==typeof OpenLayers){var g=function(a){return a.replace(/({.})/g,function(a){return"$"+a.toLowerCase()})};OpenLayers.Layer.Stamen=OpenLayers.Class(OpenLayers.Layer.OSM,{initialize:function(a,b){var c=e(a),d=c.url,f=c.subdomains,h=[];if(d.indexOf("{S}")>-1)for(var i=0;i<f.length;i++)h.push(g(d.replace("{S}",f[i])));else h.push(g(d));return b=OpenLayers.Util.extend({numZoomLevels:c.maxZoom,buffer:0,transitionEffect:"resize",tileOptions:{crossOriginKeyword:null}},b),OpenLayers.Layer.OSM.prototype.initialize.call(this,a,h,b)}})}}("undefined"==typeof exports?this:exports),"leaflet"===geocloud.MAPLIB&&(L.BingLayer=L.TileLayer.extend({options:{subdomains:[0,1,2,3],type:"Aerial",attribution:"Bing",culture:""},initialize:function(a,b){L.Util.setOptions(this,b),this._key=a,this._url=null,this.meta={},this.loadMetadata()},tile2quad:function(a,b,c){for(var d="",e=c;e>0;e--){var f=0,g=1<<e-1;0!=(a&g)&&(f+=1),0!=(b&g)&&(f+=2),d+=f}return d},getTileUrl:function(a,b){var b=this._getZoomForUrl(),c=this.options.subdomains,d=this.options.subdomains[Math.abs((a.x+a.y)%c.length)];return this._url.replace("{subdomain}",d).replace("http:","https:").replace("{quadkey}",this.tile2quad(a.x,a.y,b)).replace("{culture}",this.options.culture)},loadMetadata:function(){var a=this,b="_bing_metadata_"+L.Util.stamp(this);window[b]=function(c){a.meta=c,window[b]=void 0;var d=document.getElementById(b);return d.parentNode.removeChild(d),c.errorDetails?void alert("Got metadata"+c.errorDetails):void a.initMetadata()};var c="//dev.virtualearth.net/REST/v1/Imagery/Metadata/"+this.options.type+"?include=ImageryProviders&jsonp="+b+"&key="+this._key,d=document.createElement("script");
d.type="text/javascript",d.src=c,d.id=b,document.getElementsByTagName("head")[0].appendChild(d)},initMetadata:function(){var a=this.meta.resourceSets[0].resources[0];this.options.subdomains=a.imageUrlSubdomains,this._url=a.imageUrl,this._providers=[];for(var b=0;b<a.imageryProviders.length;b++)for(var c=a.imageryProviders[b],d=0;d<c.coverageAreas.length;d++){var e=c.coverageAreas[d],f={zoomMin:e.zoomMin,zoomMax:e.zoomMax,active:!1},g=new L.LatLngBounds(new L.LatLng(e.bbox[0]+.01,e.bbox[1]+.01),new L.LatLng(e.bbox[2]-.01,e.bbox[3]-.01));f.bounds=g,f.attrib=c.attribution,this._providers.push(f)}this._update()},_update:function(){null!=this._url&&this._map&&(this._update_attribution(),L.TileLayer.prototype._update.apply(this,[]))},_update_attribution:function(){for(var a=this._map.getBounds(),b=this._map.getZoom(),c=0;c<this._providers.length;c++){var d=this._providers[c];b<=d.zoomMax&&b>=d.zoomMin&&a.intersects(d.bounds)?(d.active||this._map.attributionControl.addAttribution(d.attrib),d.active=!0):(d.active&&this._map.attributionControl.removeAttribution(d.attrib),d.active=!1)}},onRemove:function(a){for(var b=0;b<this._providers.length;b++){var c=this._providers[b];c.active&&(this._map.attributionControl.removeAttribution(c.attrib),c.active=!1)}L.TileLayer.prototype.onRemove.apply(this,[a])}}),function(a,b){"use strict";L.AwesomeMarkers={},L.AwesomeMarkers.version="2.0.1",L.AwesomeMarkers.Icon=L.Icon.extend({options:{iconSize:[35,45],iconAnchor:[17,42],popupAnchor:[1,-32],shadowAnchor:[10,12],shadowSize:[36,16],className:"awesome-marker",prefix:"glyphicon",spinClass:"fa-spin",icon:"home",markerColor:"blue",iconColor:"white"},initialize:function(a){a=L.Util.setOptions(this,a)},createIcon:function(){var a=b.createElement("div"),c=this.options;return c.icon&&(a.innerHTML=this._createInner()),c.bgPos&&(a.style.backgroundPosition=-c.bgPos.x+"px "+-c.bgPos.y+"px"),this._setIconStyles(a,"icon-"+c.markerColor),a},_createInner:function(){var a,b="",c="",d="",e=this.options;return a=e.icon.slice(0,e.prefix.length+1)===e.prefix+"-"?e.icon:e.prefix+"-"+e.icon,e.spin&&"string"==typeof e.spinClass&&(b=e.spinClass),e.iconColor&&("white"===e.iconColor||"black"===e.iconColor?c="icon-"+e.iconColor:d="style='color: "+e.iconColor+"' "),"<i "+d+"class='"+e.prefix+" "+a+" "+b+" "+c+"'></i>"},_setIconStyles:function(a,b){var c,d=this.options,e=L.point(d["shadow"===b?"shadowSize":"iconSize"]);c=L.point("shadow"===b?d.shadowAnchor||d.iconAnchor:d.iconAnchor),!c&&e&&(c=e.divideBy(2,!0)),a.className="awesome-marker-"+b+" "+d.className,c&&(a.style.marginLeft=-c.x+"px",a.style.marginTop=-c.y+"px"),e&&(a.style.width=e.x+"px",a.style.height=e.y+"px")},createShadow:function(){var a=b.createElement("div");return this._setIconStyles(a,"shadow"),a}}),L.AwesomeMarkers.icon=function(a){return new L.AwesomeMarkers.Icon(a)}}(this,document));var gc2SetLGoogle=function(){"leaflet"===geocloud.MAPLIB&&(L.Google=L.Class.extend({includes:L.Mixin.Events,options:{minZoom:0,maxZoom:20,tileSize:256,subdomains:"abc",errorTileUrl:"",attribution:"",opacity:1,continuousWorld:!1,noWrap:!1,mapOptions:{backgroundColor:"#dddddd"}},initialize:function(a,b){L.Util.setOptions(this,b),this._ready=void 0!=google.maps.Map,this._ready||L.Google.asyncWait.push(this),this._type=a||"SATELLITE"},onAdd:function(a,b){this._map=a,this._insertAtTheBottom=b,this._initContainer(),this._initMapObject(),a.on("viewreset",this._resetCallback,this),this._limitedUpdate=L.Util.limitExecByInterval(this._update,150,this),a.on("move",this._update,this),a.on("zoomanim",this._handleZoomAnim,this),a._controlCorners.bottomright.style.marginBottom="20px",this._reset(),this._update()},onRemove:function(a){this._map._container.removeChild(this._container),this._map.off("viewreset",this._resetCallback,this),this._map.off("move",this._update,this),this._map.off("zoomanim",this._handleZoomAnim,this),a._controlCorners.bottomright.style.marginBottom="0em"},getAttribution:function(){return this.options.attribution},setOpacity:function(a){this.options.opacity=a,1>a&&L.DomUtil.setOpacity(this._container,a)},setElementSize:function(a,b){a.style.width=b.x+"px",a.style.height=b.y+"px"},_initContainer:function(){var a=this._map._container,b=a.firstChild;this._container||(this._container=L.DomUtil.create("div","leaflet-google-layer leaflet-top leaflet-left"),this._container.id="_GMapContainer_"+L.Util.stamp(this),this._container.style.zIndex="auto"),a.insertBefore(this._container,b),this.setOpacity(this.options.opacity),this.setElementSize(this._container,this._map.getSize())},_initMapObject:function(){if(this._ready){this._google_center=new google.maps.LatLng(0,0);var a=new google.maps.Map(this._container,{center:this._google_center,zoom:0,tilt:0,mapTypeId:google.maps.MapTypeId[this._type],disableDefaultUI:!0,keyboardShortcuts:!1,draggable:!1,disableDoubleClickZoom:!0,scrollwheel:!1,streetViewControl:!1,styles:this.options.mapOptions.styles,backgroundColor:this.options.mapOptions.backgroundColor}),b=this;this._reposition=google.maps.event.addListenerOnce(a,"center_changed",function(){b.onReposition()}),this._google=a,google.maps.event.addListenerOnce(a,"idle",function(){b._checkZoomLevels()})}},_checkZoomLevels:function(){this._google.getZoom()!==this._map.getZoom()&&this._map.setZoom(this._google.getZoom())},_resetCallback:function(a){this._reset(a.hard)},_reset:function(){this._initContainer()},_update:function(a){if(this._google){this._resize();var b=a&&a.latlng?a.latlng:this._map.getCenter(),c=new google.maps.LatLng(b.lat,b.lng);this._google.setCenter(c),this._google.setZoom(this._map.getZoom()),this._checkZoomLevels()}},_resize:function(){var a=this._map.getSize();(this._container.style.width!=a.x||this._container.style.height!=a.y)&&(this.setElementSize(this._container,a),this.onReposition())},_handleZoomAnim:function(a){var b=a.center,c=new google.maps.LatLng(b.lat,b.lng);this._google.setCenter(c),this._google.setZoom(a.zoom)},onReposition:function(){this._google&&google.maps.event.trigger(this._google,"resize")}}),L.Google.asyncWait=[],L.Google.asyncInitialize=function(){var a;for(a=0;a<L.Google.asyncWait.length;a++){var b=L.Google.asyncWait[a];b._ready=!0,b._container&&(b._initMapObject(),b._update())}L.Google.asyncWait=[]})};Ext.BLANK_IMAGE_URL="/js/ext/resources/images/default/s.gif";var App=new Ext.App({}),cloud,gc2,layer,grid,store,map,wfsTools,viewport,drawControl,gridPanel,modifyControl,tree,viewerSettings,loadTree,reLoadTree,layerBeingEditing,layerBeingEditingGeomField,saveStrategy,getMetaData,searchWin,measureWin,placeMarkers,placePopup,measureControls;$(document).ready(function(){"use strict";function handleMeasurements(a){var b=(a.geometry,a.units),c=a.order,d=a.measure,e=document.getElementById("output"),f="";f+=1===c?__("Measure")+": "+d.toFixed(3)+" "+b:__("Measure")+": "+d.toFixed(3)+" "+b+"<sup>2</sup>",e.innerHTML=f}function openMeasureWin(a){measureWin||(measureWin=new Ext.Window({title:__("Measure"),layout:"fit",width:300,height:90,plain:!0,closeAction:"hide",html:'<div style="padding: 5px"><div id="output" style="height: 20px; margin-bottom: 10px"></div><div>'+__("Close this window to disable measure tool")+"</div></div>",x:250,y:35,listeners:{hide:{fn:function(){measureControls.polygon.deactivate(),measureControls.line.deactivate()}}}})),"object"==typeof a?measureWin.show(a):measureWin.show()}var bl=null;$("#upload").click(function(){window.parent.onAdd()}),cloud=new mygeocloud_ol.map(null,screenName,{controls:[new OpenLayers.Control.Navigation({}),new OpenLayers.Control.Zoom,new OpenLayers.Control.Attribution]}),map=cloud.map;var metaData,metaDataKeys=[],metaDataKeysTitle=[],extent=null,gc2=new geocloud.map({});gc2.map=map,getMetaData=function(){$.ajax({url:"/api/v1/meta/"+screenName+"/"+schema,async:!0,dataType:"json",type:"GET",success:function(a){metaData=a;for(var b=0;b<metaData.data.length;b++)metaDataKeys[metaData.data[b].f_table_name]=metaData.data[b],metaData.data[b].f_table_title||(metaData.data[b].f_table_title=metaData.data[b].f_table_name),metaDataKeysTitle[metaData.data[b].f_table_title]=metaData.data[b]}})};var clicktimer;window.getMetaData(),gc2.on("dblclick",function(){clicktimer=void 0});var qstore=[],queryWin=new Ext.Window({title:"Query result",modal:!1,border:!1,layout:"fit",width:400,height:400,closeAction:"hide",x:100,y:100,plain:!0,listeners:{hide:{fn:function(){Ext.iterate(qstore,function(a){a.reset()})}}},items:[new Ext.TabPanel({activeTab:0,frame:!0,id:"queryTabs"})]});gc2.on("click",function(a){var b,c,d=0,e=!1,f=new geocloud.clickEvent(a,cloud),g=screenName;clicktimer?clearTimeout(clicktimer):clicktimer=setTimeout(function(){clicktimer=void 0;var a=f.getCoordinate();$.each(qstore,function(a,b){try{b.reset(),gc2.removeGeoJsonStore(b)}catch(c){}}),b=gc2.getVisibleLayers().split(";"),Ext.getCmp("queryTabs").removeAll(),$.each(b,function(b,f){var h=!0,i=metaDataKeys[f.split(".")[1]].srid,j=metaDataKeys[f.split(".")[1]].pkey,k=metaDataKeys[f.split(".")[1]].f_geometry_column,l=metaDataKeys[f.split(".")[1]].type,m=metaDataKeys[f.split(".")[1]].f_table_name,n=metaDataKeys[f.split(".")[1]].versioning;if("POLYGON"!==l&&"MULTIPOLYGON"!==l){var o=[156543.033928,78271.516964,39135.758482,19567.879241,9783.9396205,4891.96981025,2445.98490513,1222.99245256,611.496226281,305.748113141,152.87405657,76.4370282852,38.2185141426,19.1092570713,9.55462853565,4.77731426782,2.38865713391,1.19432856696,.597164283478,.298582141739];c=5*o[cloud.getZoom()]}qstore[b]=new geocloud.sqlStore({db:g,id:b,styleMap:new OpenLayers.StyleMap({"default":new OpenLayers.Style({fillColor:"#000000",fillOpacity:0,pointRadius:8,strokeColor:"#FF0000",strokeWidth:3,strokeOpacity:.7,graphicZIndex:3})}),onLoad:function(){var a,b=qstore[this.id],c=[],f={};if(h=b.isEmpty(),h||(queryWin.show(),$.each(b.geoJSON.features,function(b,d){$.each(d.properties,function(a,b){c.push([a,0,a,b])}),c.sort(function(a,b){return a[1]-b[1]}),$.each(c,function(b,c){c[2]===j&&(a=c[3]),f[c[2]]=c[3]}),c=[]}),Ext.getCmp("queryTabs").add({title:m,layout:"fit",border:!1,items:[{xtype:"panel",layout:"fit",id:m,border:!1,tbar:[{text:"<i class='icon-pencil btn-gc'></i> Edit feature #"+a,handler:function(){if("GEOMETRY"===l||"RASTER"===l)return Ext.MessageBox.show({title:"No geometry type on layer",msg:"The layer has no geometry type or type is GEOMETRY. You can set geom type for the layer in 'Settings' to the right.",buttons:Ext.MessageBox.OK,width:400,height:300,icon:Ext.MessageBox.ERROR}),!1;var b=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO,property:'"'+j+'"',value:a});attributeForm.init(m,k),startWfsEdition(m,k,b,!0),Ext.iterate(qstore,function(a){a.reset()}),queryWin.hide()}}],items:[new Ext.grid.PropertyGrid({autoHeight:!1,border:!1,startEditing:Ext.emptyFn,source:f})]}]}),e=!0),!e)try{queryWin.hide()}catch(g){}d++,Ext.getCmp("queryTabs").activate(0)}}),gc2.addGeoJsonStore(qstore[b]);var p,q=metaDataKeys[f.split(".")[1]].f_geometry_column;"POLYGON"!==l&&"MULTIPOLYGON"!==l?(p="SELECT * FROM "+f+' WHERE round(ST_Distance(ST_Transform("'+q+"\",3857), ST_GeomFromText('POINT("+a.x+" "+a.y+")',3857))) < "+c,n&&(p+=" AND gc2_version_end_date IS NULL"),p=p+' ORDER BY round(ST_Distance(ST_Transform("'+q+"\",3857), ST_GeomFromText('POINT("+a.x+" "+a.y+")',3857)))"):(p="SELECT * FROM "+f+" WHERE ST_Intersects(ST_Transform(ST_geomfromtext('POINT("+a.x+" "+a.y+")',900913),"+i+'),"'+q+'")',n&&(p+=" AND gc2_version_end_date IS NULL")),p+=" LIMIT 1",qstore[b].sql=p,qstore[b].load()})},250)}),"object"!=typeof window.setBaseLayers&&(window.setBaseLayers=[{id:"mapQuestOSM",name:"MapQuset OSM"},{id:"osm",name:"OSM"}]),cloud.bingApiKey=window.bingApiKey,cloud.digitalGlobeKey=window.digitalGlobeKey,window.setBaseLayers=window.setBaseLayers.reverse();for(var i=0;i<window.setBaseLayers.length;i++)bl=cloud.addBaseLayer(window.setBaseLayers[i].id);null!==bl&&cloud.setBaseLayer(bl);var LayerNodeUI=Ext.extend(GeoExt.tree.LayerNodeUI,new GeoExt.tree.TreeNodeUIEventMixin),layers={};loadTree=function(){var a=[{id:"baselayers",nodeType:"gx_baselayercontainer"}];$.ajax({url:"/api/v1/meta/"+screenName+"/"+schema,dataType:"json",type:"GET",success:function(b){var c,d=[];if(void 0!==b.data){for(var e=0;e<b.data.length;++e)d[e]=b.data[e].layergroup;for(var f=array_unique(d),g=0;g<b.data.length;++g){c=b.data[g].baselayer?!0:!1;try{cloud.removeTileLayerByName([[b.data[g].f_table_schema+"."+b.data[g].f_table_name]])}catch(h){}layers[[b.data[g].f_table_schema+"."+b.data[g].f_table_name]]=cloud.addTileLayers([b.data[g].f_table_schema+"."+b.data[g].f_table_name],{singleTile:!1,visibility:!1,wrapDateLine:!1,tileCached:!0,displayInLayerSwitcher:!0,name:b.data[g].f_table_schema+"."+b.data[g].f_table_name})}for(var e=0;e<f.length;++e){for(var i=[],g=0;g<b.data.length;++g)b.data[g].layergroup===f[e]&&i.push({text:null===b.data[g].f_table_title||""===b.data[g].f_table_title?b.data[g].f_table_name:b.data[g].f_table_title,id:b.data[g].f_table_schema+"."+b.data[g].f_table_name+"."+b.data[g].f_geometry_column,leaf:!0,checked:!1,geomField:b.data[g].f_geometry_column,geomType:b.data[g].type});a.push({text:f[e],isLeaf:!1,expanded:!1,children:i.reverse()})}}a.push(a.shift()),tree=new Ext.tree.TreePanel({id:"tree",border:!1,region:"center",width:200,split:!0,autoScroll:!0,root:{text:"Ext JS",children:Ext.decode((new OpenLayers.Format.JSON).write(a.reverse(),!0)),id:"source"},loader:new Ext.tree.TreeLoader({applyLoader:!1,uiProviders:{layernodeui:LayerNodeUI}}),listeners:{click:{fn:function(a){try{stopEdit()}catch(b){}"undefined"!=typeof filter.win&&("undefined"!=typeof filter.win.hide&&filter.win.hide(),filter.win=!1),a.leaf===!0&&"baselayers"!==a.parentNode.id?(window.parent.onEditWMSClasses(a.id),Ext.getCmp("editlayerbutton").setDisabled(!1),Ext.getCmp("quickdrawbutton").setDisabled(!1)):(Ext.getCmp("editlayerbutton").setDisabled(!0),Ext.getCmp("quickdrawbutton").setDisabled(!0))}}},rootVisible:!1,lines:!1}),tree.on("checkchange",function(a,b){if(null===a.lastChild&&"baselayers"!==a.parentNode.id){var c=a.id.split(".")[0]+"."+a.id.split(".")[1];layers[c][0].setVisibility(b?!0:!1)}}),"undefined"==typeof viewport?(viewport=new Ext.Viewport({layout:"border",items:[{region:"center",layout:"fit",border:!1,items:[new Ext.Panel({layout:"border",border:!1,items:[{region:"center",id:"mappanel",xtype:"gx_mappanel",map:map,zoom:5,split:!0,tbar:wfsTools},{region:"south",id:"attrtable",title:"Attribute table",split:!0,frame:!1,layout:"fit",height:200,collapsible:!0,collapsed:!0,contentEl:"instructions"}]})]},new Ext.Panel({border:!1,region:"west",collapsible:!1,width:200,items:[{xtype:"panel",border:!1,html:'<div class="layer-desc">Click on a layer title to access settings and to edit data. Check the box to see the layer in the map.</div>',height:70},new Ext.Panel({border:!1,id:"treepanel",style:{height:Ext.getBody().getViewSize().height-180+"px",overflow:"auto"},collapsible:!1})]})]}),null!==window.parent.initExtent?cloud.map.zoomToExtent(window.parent.initExtent,!1):cloud.map.zoomToMaxExtent()):window.parent.App.setAlert(App.STATUS_NOTICE,"Layer tree (re)loaded");var j=Ext.getCmp("treepanel");j.remove(tree),j.add(tree),j.doLayout(),window.parent.writeFiles()}})},wfsTools=[{text:"<i class='icon-edit btn-gc'></i> "+__("Start edit"),id:"editlayerbutton",disabled:!0,handler:function(){try{stopEdit()}catch(a){}var b=tree.getSelectionModel().getSelectedNode(),c=b.id.split("."),d=b.attributes.geomField,e=b.attributes.geomType;if(attributeForm.init(c[1],d),"GEOMETRY"===e||"RASTER"===e)Ext.MessageBox.show({title:"No geometry type on layer",msg:"The layer has no geometry type or type is GEOMETRY. You can set geom type for the layer in 'Settings' to the right.",buttons:Ext.MessageBox.OK,width:400,height:300,icon:Ext.MessageBox.ERROR});else{var f=function(){"object"==typeof filter.win?filter.win.show():setTimeout(f,10)};f()}}},"-",new GeoExt.Action({control:drawControl,text:"<i class='icon-pencil btn-gc'></i> "+__("Draw"),id:"editcreatebutton",disabled:!0,enableToggle:!0}),{text:"<i class='icon-trash btn-gc'></i> "+__("Delete"),id:"editdeletebutton",disabled:!0,handler:function(){gridPanel.getSelectionModel().each(function(a){var b=a.get("feature");modifyControl.unselectFeature(b),gridPanel.store.remove(a),b.state!==OpenLayers.State.INSERT&&(b.state=OpenLayers.State.DELETE,layer.addFeatures([b]))})}},{text:"<i class='icon-ok btn-gc'></i> "+__("Save"),disabled:!0,id:"editsavebutton",handler:function(){modifyControl.feature&&modifyControl.selectControl.unselectAll(),store.commitChanges(),saveStrategy.save()}},"-",{text:"<i class='icon-stop btn-gc'></i> "+__("Stop editing"),disabled:!0,id:"editstopbutton",handler:stopEdit},"-",{text:"<i class='icon-edit btn-gc'></i> "+__("Quick draw"),id:"quickdrawbutton",disabled:!0,handler:function(){var a=tree.getSelectionModel().getSelectedNode(),b=a.id.split("."),c=a.attributes.geomField,d=a.attributes.geomType;if("GEOMETRY"===d||"RASTER"===d)return Ext.MessageBox.show({title:"No geometry type on layer",msg:"The layer has no geometry type or type is GEOMETRY. You can set geom type for the layer in 'Settings' to the right.",buttons:Ext.MessageBox.OK,width:400,height:300,icon:Ext.MessageBox.ERROR}),!1;var e=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO,property:'"dummy"',value:"-1"});attributeForm.init(b[1],c),startWfsEdition(b[1],c,e),wfsTools[2].control.activate(),Ext.getCmp("editcreatebutton").toggle(!0),Ext.iterate(qstore,function(a){a.reset()}),queryWin.hide()}},"->",{text:"<i class='icon-resize-vertical btn-gc'></i> "+__("Measure"),menu:new Ext.menu.Menu({items:[{text:__("Distance"),handler:function(){openMeasureWin(),measureControls.polygon.deactivate(),measureControls.line.activate()}},{text:__("Area"),handler:function(){openMeasureWin(),measureControls.line.deactivate(),measureControls.polygon.activate()}}]})},{text:"<i class='icon-search btn-gc'></i> "+__("Search"),handler:function(a){searchWin||(searchWin=new Ext.Window({title:"Find",layout:"fit",width:300,height:70,plain:!0,closeAction:"hide",html:'<div style="padding: 5px" id="searchContent"><input style="width: 270px" type="text" id="gAddress" name="gAddress" value="" /></div>',x:250,y:35})),"object"==typeof a?searchWin.show(a):searchWin.show();var b=document.getElementById("gAddress"),c={},d=new google.maps.places.Autocomplete(b,c);google.maps.event.addListener(d,"place_changed",function(){var a=d.getPlace(),b=function(a,b,c,d){var e=[];if("object"==typeof Proj4js){var f=new Proj4js.Proj(c),g=new Proj4js.Proj(d);e=new Proj4js.Point(a,b),Proj4js.transform(f,g,e)}else e.x=null,e.y=null;return e},c=b(a.geometry.location.lng(),a.geometry.location.lat(),"EPSG:4326","EPSG:900913"),e=new OpenLayers.LonLat(c.x,c.y);map.setCenter(e,17);try{placeMarkers.destroy()}catch(f){}try{placePopup.destroy()}catch(f){}placeMarkers=new OpenLayers.Layer.Markers("Markers"),map.addLayer(placeMarkers);var g=new OpenLayers.Size(21,25),h=new OpenLayers.Pixel(-(g.w/2),-g.h),i=new OpenLayers.Icon("http://www.openlayers.org/dev/img/marker.png",g,h);placeMarkers.addMarker(new OpenLayers.Marker(e,i)),placePopup=new OpenLayers.Popup.FramedCloud("place",e,null,"<div id='placeResult' style='z-index:1000;width:200px;height:50px;overflow:auto'>"+a.formatted_address+"</div>",null,!0),map.addPopup(placePopup)})},tooltip:"Search with Google Places"},"-",{text:"<i class='icon-refresh btn-gc'></i> "+__("Reload tree"),handler:function(){stopEdit(),reLoadTree()}},"-",{text:"<i class='icon-globe btn-gc'></i> "+__("Save extent"),id:"extentbutton",disabled:!1,handler:function(){Ext.Ajax.request({url:"/controllers/setting/extent/",method:"put",params:Ext.util.JSON.encode({data:{schema:schema,extent:cloud.getExtent(),zoom:cloud.getZoom(),center:[cloud.getCenter().x,cloud.getCenter().y]}}),headers:{"Content-Type":"application/json; charset=utf-8"},success:function(response){window.parent.App.setAlert(App.STATUS_NOTICE,eval("("+response.responseText+")").message)},failure:function(a){Ext.MessageBox.show({title:"Failure",msg:__(Ext.decode(a.responseText).message),buttons:Ext.MessageBox.OK,width:400,height:300,icon:Ext.MessageBox.ERROR})}})}},"-",{text:"<i class='icon-th-list btn-gc'></i> "+__("Attributes"),id:"infobutton",disabled:!0,handler:function(){attributeForm.win.show()}}],reLoadTree=function(){loadTree()};var sketchSymbolizers={Point:{pointRadius:4,graphicName:"square",fillColor:"white",fillOpacity:1,strokeWidth:1,strokeOpacity:1,strokeColor:"#333333"},Line:{strokeWidth:3,strokeOpacity:1,strokeColor:"#666666",strokeDashstyle:"dash"},Polygon:{strokeWidth:2,strokeOpacity:1,strokeColor:"#666666",fillColor:"white",fillOpacity:.3}},measureStyle=new OpenLayers.Style;measureStyle.addRules([new OpenLayers.Rule({symbolizer:sketchSymbolizers})]);var measureStyleMap=new OpenLayers.StyleMap({"default":measureStyle});measureControls={line:new OpenLayers.Control.Measure(OpenLayers.Handler.Path,{persist:!0,geodesic:!0,immediate:!0,handlerOptions:{layerOptions:{styleMap:measureStyleMap}}}),polygon:new OpenLayers.Control.Measure(OpenLayers.Handler.Polygon,{persist:!0,geodesic:!0,immediate:!0,handlerOptions:{layerOptions:{styleMap:measureStyleMap}}})},measureControls.line.events.on({measure:handleMeasurements,measurepartial:handleMeasurements}),map.addControl(measureControls.line),measureControls.polygon.events.on({measure:handleMeasurements,measurepartial:handleMeasurements}),map.addControl(measureControls.polygon),loadTree()}),saveStrategy=new OpenLayers.Strategy.Save({onCommit:function(a){var b,c,d;if(a.success()){saveStrategy.layer.refresh(),b=new OpenLayers.Format.XML,c=b.read(a.priv.responseText);try{var e=c.getElementsByTagName("wfs:totalInserted")[0].firstChild.data}catch(f){}try{var g=c.getElementsByTagName("wfs:totalDeleted")[0].firstChild.data}catch(f){}try{var h=c.getElementsByTagName("wfs:totalUpdated")[0].firstChild.data}catch(f){}try{var h=c.getElementsByTagName("wfs:Message")[0].firstChild.data}catch(f){}try{var e=c.getElementsByTagName("totalInserted")[0].firstChild.data}catch(f){}try{var g=c.getElementsByTagName("totalDeleted")[0].firstChild.data}catch(f){}try{var h=c.getElementsByTagName("totalUpdated")[0].firstChild.data}catch(f){}try{var h=c.getElementsByTagName("Message")[0].firstChild.data}catch(f){}var i="";e&&(i="<p>Inserted: "+e+"</p>",window.parent.App.setAlert(App.STATUS_OK,i)),h&&(i="<p>Updated: "+h+"</p>",window.parent.App.setAlert(App.STATUS_OK,i)),g&&(i="<p>Deleted: "+g+"</p>",window.parent.App.setAlert(App.STATUS_OK,i)),window.parent.writeFiles(schema+"."+layerBeingEditing+"."+layerBeingEditingGeomField,map)}else{b=new OpenLayers.Format.XML,c=b.read(a.priv.responseText);try{d=c.getElementsByTagName("ServiceException")[0].firstChild.data}catch(f){}try{d=c.getElementsByTagName("wfs:ServiceException")[0].firstChild.data}catch(f){}i="<p>Sorry, but something went wrong. The whole transaction is rolled back. Try to correct the problem and hit save again. You can look at the error below, maybe it will give you a hint about what's wrong</p><br/><textarea rows='5' cols='31'>"+d+"</textarea>",Ext.MessageBox.show({title:"Failure",msg:i,buttons:Ext.MessageBox.OK,width:400,height:300,icon:Ext.MessageBox.ERROR})}}}),Ext.namespace("attributeForm"),Ext.namespace("filter"),attributeForm.init=function(a,b){Ext.QuickTips.init(),attributeForm.attributeStore=new GeoExt.data.AttributeStore({url:"/wfs/"+screenName+"/"+schema+"?REQUEST=DescribeFeatureType&TYPENAME="+a,listeners:{load:{scope:this,fn:function(c){attributeForm.attributeStoreCopy=new Ext.data.ArrayStore({fields:["value","name"],data:[]}),c.each(function(a){var b=/gml:((Multi)?(Point|Line|Polygon|Curve|Surface)).*/.exec(a.get("type"));if(!b){var c={name:a.get("name"),value:getFieldType(a.get("type"))},d=new attributeForm.attributeStore.recordType(c);attributeForm.attributeStoreCopy.add(d)}},this),filter.filterBuilder=new gxp.FilterBuilder({attributes:attributeForm.attributeStoreCopy,allowGroups:!1}),filter.queryPanel=new Ext.Panel({id:"uploadpanel",frame:!1,region:"center",bodyStyle:{background:"#ffffff",padding:"7px"},tbar:["->",{text:"<i class='icon-filter btn-gc'></i> "+__("Load"),disabled:!1,handler:function(){filter.queryPanel.query()}}],query:function(){var c,d=filter.filterBuilder.getFilter(),e=!0;if("object"==typeof d.filters&&$.each(d.filters,function(a,b){b===!1&&(e=!1)}),"undefined"!=typeof Ext.getCmp("timeSliceField").items.items[0].items.items[0].value&&filter.filterBuilder.timeSliceQuery===!0&&(c=Ext.getCmp("timeSliceField").items.items[0].items.items[0].value),e)if(layerBeingEditing&&!c){var f=store.proxy.protocol;f.defaultFilter=filter.filterBuilder.getFilter(),saveStrategy.layer.refresh()}else startWfsEdition(a,b,d,!1,c)},items:[filter.filterBuilder]}),filter.win=new Ext.Window({title:__("Load features"),modal:!1,layout:"fit",initCenter:!0,border:!1,width:400,height:400,closeAction:"hide",plain:!0,items:[new Ext.Panel({frame:!1,layout:"border",items:[filter.queryPanel]})]})}}}}),attributeForm.form=new Ext.form.FormPanel({autoScroll:!0,region:"center",border:!1,bodyStyle:{background:"#ffffff",padding:"7px"},defaults:{width:110,maxLengthText:"too long",minLengthText:"too short"},plugins:[new GeoExt.plugins.AttributeForm({attributeStore:attributeForm.attributeStore})],buttons:[{text:"<i class='icon-ok btn-gc'></i> "+__("Update table"),handler:function(){if(attributeForm.form.form.isValid()){var a=grid.getSelectionModel().getSelected();attributeForm.form.getForm().updateRecord(a);var b=a.get("feature");b.state!==OpenLayers.State.INSERT&&(b.state=OpenLayers.State.UPDATE)}else{var c="";Ext.iterate(detailForm.form.form.getValues(),function(a,b){c+=String.format("{0} = {1}<br />",a,b)},this)}}}]}),attributeForm.attributeStore.load()},Ext.namespace("gxp.form"),gxp.form.FilterField=Ext.extend(Ext.form.CompositeField,{filter:null,attributes:null,attributesComboConfig:null,initComponent:function(){this.filter||(this.filter=this.createDefaultFilter()),this.attributes||(this.attributes=new GeoExt.data.AttributeStore);var a={xtype:"combo",store:this.attributes,editable:!1,triggerAction:"all",allowBlank:!1,displayField:"name",valueField:"name",mode:"local",value:this.filter.property,listeners:{select:function(a,b){this.filter.property=b.get("name"),this.fireEvent("change",this.filter)},scope:this},width:120};this.attributesComboConfig=this.attributesComboConfig||{},Ext.applyIf(this.attributesComboConfig,a),this.items=this.createFilterItems(),this.addEvents("change"),gxp.form.FilterField.superclass.initComponent.call(this)},createDefaultFilter:function(){return new OpenLayers.Filter.Comparison},createFilterItems:function(){return[this.attributesComboConfig,{xtype:"gx_comparisoncombo",value:this.filter.type,listeners:{select:function(a,b){this.filter.type=b.get("value"),this.fireEvent("change",this.filter)},scope:this}},{xtype:"textfield",value:this.filter.value,width:50,grow:!0,growMin:50,anchor:"100%",allowBlank:!1,listeners:{change:function(a,b){this.filter.value=b,this.fireEvent("change",this.filter)},scope:this}}]}}),Ext.reg("gx_filterfield",gxp.form.FilterField),Ext.namespace("gxp"),gxp.FilterBuilder=Ext.extend(Ext.Container,{builderTypeNames:["any","all","none","not all"],attributeQuery:!1,spatialQuery:!0,timeSliceQuery:!1,allowedBuilderTypes:null,preComboText:"Match",postComboText:"of the following:",cls:"gx-filterbuilder",builderType:null,childFilterContainer:null,customizeFilterOnInit:!0,allowGroups:!0,initComponent:function(){var a={defaultBuilderType:gxp.FilterBuilder.ANY_OF};Ext.applyIf(this,a),this.customizeFilterOnInit&&(this.filter=this.customizeFilter(this.filter)),this.builderType=this.getBuilderType(),this.items=[{xtype:"fieldset",title:__("Filter by location"),checkboxToggle:!0,anchor:"95%",html:"Only features within the map view will be loaded.",listeners:{collapse:function(){this.spatialQuery=!1},expand:function(){this.spatialQuery=!0},scope:this}},{xtype:"fieldset",title:__("Filter by attributes"),checkboxToggle:!0,collapsed:!this.attributeQuery,anchor:"95%",items:[{xtype:"container",layout:"form",defaults:{anchor:"100%"},hideLabels:!0,items:[{xtype:"compositefield",style:"padding-left: 2px",items:[{xtype:"label",style:"padding-top: 0.3em",text:this.preComboText},this.createBuilderTypeCombo(),{xtype:"label",style:"padding-top: 0.3em",text:this.postComboText}]},this.createChildFiltersPanel(),{xtype:"toolbar",items:this.createToolBar()}]}],listeners:{collapse:function(){this.attributeQuery=!1},expand:function(){this.attributeQuery=!0},scope:this}},{xtype:"fieldset",title:__("Time slicing (only versioned layers)"),id:"timeSliceField",checkboxToggle:!0,collapsed:!this.timeSliceQuery,anchor:"95%",html:__("Either select 'latest, 'all' or write a date/time in the form yyyy-mm-dd hh:mm:ss<br><br>If you are tracking changes on your table, you can either load the latest (current) versions or you can 'slice' at a given point in time. You can also load all versions.<br><br>Earlier features will be shown with a red dashed line."),items:[{xtype:"container",layout:"form",hideLabels:!0,items:[{xtype:"combo",hideLabels:!0,width:300,store:new Ext.data.ArrayStore({fields:["type","display"],data:[["latest","latest"],["all","all"]]}),displayField:"display",valueField:"type",editable:!0,triggerAction:"all",name:"timeslice",value:"latest",allowBlank:!0,mode:"local"}]}],listeners:{collapse:function(){this.timeSliceQuery=!1},expand:function(){this.timeSliceQuery=!0},scope:this}}],this.addEvents("change"),gxp.FilterBuilder.superclass.initComponent.call(this)},createToolBar:function(){var a=[{text:"<i class='icon-plus-sign btn-gc'></i> Add condition",handler:function(){this.addCondition()},scope:this}];return this.allowGroups&&a.push({text:"add group",iconCls:"silk-add",handler:function(){this.addCondition(!0)},scope:this}),a},getFilter:function(){var a,b=this.attributeQuery&&this.filter,c=this.spatialQuery&&new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.BBOX,value:map.getExtent()});return b&&c?(a=this.filter.clone(),a instanceof OpenLayers.Filter.Logical&&(b=this.cleanFilter(b),a=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.AND,filters:[c,b]}))):(b=this.cleanFilter(b),a=b||c),a},cleanFilter:function(a){if(a instanceof OpenLayers.Filter.Logical){if(a.type!==OpenLayers.Filter.Logical.NOT&&1===a.filters.length)a=this.cleanFilter(a.filters[0]);else for(var b,c=0,d=a.filters.length;d>c;++c)if(b=a.filters[c],b instanceof OpenLayers.Filter.Logical){if(b=this.cleanFilter(b),!b){a=b;break}a.filters[c]=b}else if(!b||null===b.type||null===b.property||null===b.value){a=!1;break}}else a&&null!==a.type&&null!==a.property&&null!==a.value||(a=!1);return a},customizeFilter:function(a){if(a)switch(a=this.cleanFilter(a),a.type){case OpenLayers.Filter.Logical.AND:case OpenLayers.Filter.Logical.OR:if(a.filters&&0!==a.filters.length)for(var b,c=0,d=a.filters.length;d>c;++c)b=a.filters[c],b instanceof OpenLayers.Filter.Logical&&(a.filters[c]=this.customizeFilter(b));else a.filters=[this.createDefaultFilter()];a=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.OR,filters:[a]});break;case OpenLayers.Filter.Logical.NOT:if(a.filters&&0!==a.filters.length){var b=a.filters[0];if(b instanceof OpenLayers.Filter.Logical)if(b.type!==OpenLayers.Filter.Logical.NOT)for(var e,c=0,d=b.filters.length;d>c;++c)e=b.filters[c],e instanceof OpenLayers.Filter.Logical&&(b.filters[c]=this.customizeFilter(e));else a=b.filters&&b.filters.length>0?this.customizeFilter(b.filters[0]):this.wrapFilter(this.createDefaultFilter());else{var f;f=this.defaultBuilderType===gxp.FilterBuilder.NOT_ALL_OF?OpenLayers.Filter.Logical.AND:OpenLayers.Filter.Logical.OR,a.filters=[new OpenLayers.Filter.Logical({type:f,filters:[b]})]}}else a.filters=[new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.OR,filters:[this.createDefaultFilter()]})];break;default:a=this.wrapFilter(a)}else a=this.wrapFilter(this.createDefaultFilter());return a},createDefaultFilter:function(){return new OpenLayers.Filter.Comparison},wrapFilter:function(a){var b;
return b=this.defaultBuilderType===gxp.FilterBuilder.ALL_OF?OpenLayers.Filter.Logical.AND:OpenLayers.Filter.Logical.OR,new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.OR,filters:[new OpenLayers.Filter.Logical({type:b,filters:[a]})]})},addCondition:function(a){var b,c;a?(c="gx_filterbuilder",b=this.wrapFilter(this.createDefaultFilter())):(c="gx_filterfield",b=this.createDefaultFilter());var d=this.newRow({xtype:c,filter:b,columnWidth:1,attributes:this.attributes,customizeFilterOnInit:a&&!1,listeners:{change:function(){this.fireEvent("change",this)},scope:this}});this.childFilterContainer.add(d),this.filter.filters[0].filters.push(b),this.childFilterContainer.doLayout()},removeCondition:function(a,b){var c=this.filter.filters[0].filters;c.length>1&&(c.remove(b),this.childFilterContainer.remove(a,!0)),this.fireEvent("change",this)},createBuilderTypeCombo:function(){for(var a,b=this.allowedBuilderTypes||[gxp.FilterBuilder.ANY_OF,gxp.FilterBuilder.ALL_OF],c=b.length,d=new Array(c),e=0;c>e;++e)a=b[e],d[e]=[a,this.builderTypeNames[a]];return{xtype:"combo",store:new Ext.data.SimpleStore({data:d,fields:["value","name"]}),value:this.builderType,displayField:"name",valueField:"value",triggerAction:"all",mode:"local",listeners:{select:function(a,b){this.changeBuilderType(b.get("value")),this.fireEvent("change",this)},scope:this},width:60}},changeBuilderType:function(a){if(a!==this.builderType){this.builderType=a;var b=this.filter.filters[0];switch(a){case gxp.FilterBuilder.ANY_OF:this.filter.type=OpenLayers.Filter.Logical.OR,b.type=OpenLayers.Filter.Logical.OR;break;case gxp.FilterBuilder.ALL_OF:this.filter.type=OpenLayers.Filter.Logical.OR,b.type=OpenLayers.Filter.Logical.AND;break;case gxp.FilterBuilder.NONE_OF:this.filter.type=OpenLayers.Filter.Logical.NOT,b.type=OpenLayers.Filter.Logical.OR;break;case gxp.FilterBuilder.NOT_ALL_OF:this.filter.type=OpenLayers.Filter.Logical.NOT,b.type=OpenLayers.Filter.Logical.AND}}},createChildFiltersPanel:function(){this.childFilterContainer=new Ext.Container;for(var a,b=this.filter.filters[0].filters,c=0,d=b.length;d>c;++c){a=b[c];var e={xtype:"gx_filterfield",columnWidth:1,filter:a,attributes:this.attributes,listeners:{change:function(){this.fireEvent("change",this)},scope:this}},f=Ext.applyIf(a instanceof OpenLayers.Filter.Logical?{xtype:"gx_filterbuilder"}:{xtype:"container",layout:"form",hideLabels:!0,items:e},e);this.childFilterContainer.add(this.newRow(f))}return this.childFilterContainer},newRow:function(a){var b=new Ext.Container({layout:"column",items:[{xtype:"container",width:28,style:"padding-left: 2px",items:{xtype:"button",text:"<i class='icon-minus-sign btn-gc'></i>",tooltip:"remove condition",handler:function(){this.removeCondition(b,a.filter)},scope:this}},a]});return b},getBuilderType:function(){var a=this.defaultBuilderType;if(this.filter){var b=this.filter.filters[0];if(this.filter.type===OpenLayers.Filter.Logical.NOT)switch(b.type){case OpenLayers.Filter.Logical.OR:a=gxp.FilterBuilder.NONE_OF;break;case OpenLayers.Filter.Logical.AND:a=gxp.FilterBuilder.NOT_ALL_OF}else switch(b.type){case OpenLayers.Filter.Logical.OR:a=gxp.FilterBuilder.ANY_OF;break;case OpenLayers.Filter.Logical.AND:a=gxp.FilterBuilder.ALL_OF}}return a}}),gxp.FilterBuilder.ANY_OF=0,gxp.FilterBuilder.ALL_OF=1,gxp.FilterBuilder.NONE_OF=2,gxp.FilterBuilder.NOT_ALL_OF=3,Ext.reg("gx_filterbuilder",gxp.FilterBuilder),Ext.namespace("gxp.form"),gxp.form.ComarisonComboBox=Ext.extend(Ext.form.ComboBox,{allowedTypes:[[OpenLayers.Filter.Comparison.EQUAL_TO,"="],[OpenLayers.Filter.Comparison.NOT_EQUAL_TO,"<>"],[OpenLayers.Filter.Comparison.LESS_THAN,"<"],[OpenLayers.Filter.Comparison.GREATER_THAN,">"],[OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO,"<="],[OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO,">="],[OpenLayers.Filter.Comparison.LIKE,"like"]],allowBlank:!1,mode:"local",triggerAction:"all",width:50,editable:!1,initComponent:function(){var a={displayField:"name",valueField:"value",store:new Ext.data.SimpleStore({data:this.allowedTypes,fields:["value","name"]}),value:void 0===this.value?this.allowedTypes[0][0]:this.value};Ext.applyIf(this,a),gxp.form.ComarisonComboBox.superclass.initComponent.call(this)}}),Ext.reg("gx_comparisoncombo",gxp.form.ComarisonComboBox),Proj4js={defaultDatum:"WGS84",transform:function(a,b,c){if(!a.readyToUse)return this.reportError("Proj4js initialization for:"+a.srsCode+" not yet complete"),c;if(!b.readyToUse)return this.reportError("Proj4js initialization for:"+b.srsCode+" not yet complete"),c;if("900913"==a.srsProjNumber&&"WGS84"!=b.datumCode&&!b.datum_params||"900913"==b.srsProjNumber&&"WGS84"!=a.datumCode&&!a.datum_params){var d=Proj4js.WGS84;this.transform(a,d,c),a=d}return"enu"!=a.axis&&this.adjust_axis(a,!1,c),"longlat"==a.projName?(c.x*=Proj4js.common.D2R,c.y*=Proj4js.common.D2R):(a.to_meter&&(c.x*=a.to_meter,c.y*=a.to_meter),a.inverse(c)),a.from_greenwich&&(c.x+=a.from_greenwich),c=this.datum_transform(a.datum,b.datum,c),b.from_greenwich&&(c.x-=b.from_greenwich),"longlat"==b.projName?(c.x*=Proj4js.common.R2D,c.y*=Proj4js.common.R2D):(b.forward(c),b.to_meter&&(c.x/=b.to_meter,c.y/=b.to_meter)),"enu"!=b.axis&&this.adjust_axis(b,!0,c),c},datum_transform:function(a,b,c){return a.compare_datums(b)?c:a.datum_type==Proj4js.common.PJD_NODATUM||b.datum_type==Proj4js.common.PJD_NODATUM?c:(a.datum_type==Proj4js.common.PJD_GRIDSHIFT&&alert("ERROR: Grid shift transformations are not implemented yet."),b.datum_type==Proj4js.common.PJD_GRIDSHIFT&&alert("ERROR: Grid shift transformations are not implemented yet."),(a.es!=b.es||a.a!=b.a||a.datum_type==Proj4js.common.PJD_3PARAM||a.datum_type==Proj4js.common.PJD_7PARAM||b.datum_type==Proj4js.common.PJD_3PARAM||b.datum_type==Proj4js.common.PJD_7PARAM)&&(a.geodetic_to_geocentric(c),(a.datum_type==Proj4js.common.PJD_3PARAM||a.datum_type==Proj4js.common.PJD_7PARAM)&&a.geocentric_to_wgs84(c),(b.datum_type==Proj4js.common.PJD_3PARAM||b.datum_type==Proj4js.common.PJD_7PARAM)&&b.geocentric_from_wgs84(c),b.geocentric_to_geodetic(c)),b.datum_type==Proj4js.common.PJD_GRIDSHIFT&&alert("ERROR: Grid shift transformations are not implemented yet."),c)},adjust_axis:function(a,b,c){for(var d,e,f=c.x,g=c.y,h=c.z||0,i=0;3>i;i++)if(!b||2!=i||void 0!==c.z)switch(0==i?(d=f,e="x"):1==i?(d=g,e="y"):(d=h,e="z"),a.axis[i]){case"e":c[e]=d;break;case"w":c[e]=-d;break;case"n":c[e]=d;break;case"s":c[e]=-d;break;case"u":void 0!==c[e]&&(c.z=d);break;case"d":void 0!==c[e]&&(c.z=-d);break;default:return alert("ERROR: unknow axis ("+a.axis[i]+") - check definition of "+src.projName),null}return c},reportError:function(){},extend:function(a,b){if(a=a||{},b)for(var c in b){var d=b[c];void 0!==d&&(a[c]=d)}return a},Class:function(){for(var a,b=function(){this.initialize.apply(this,arguments)},c={},d=0;d<arguments.length;++d)a="function"==typeof arguments[d]?arguments[d].prototype:arguments[d],Proj4js.extend(c,a);return b.prototype=c,b},bind:function(a,b){var c=Array.prototype.slice.apply(arguments,[2]);return function(){var d=c.concat(Array.prototype.slice.apply(arguments,[0]));return a.apply(b,d)}},scriptName:"proj4js-combined.js",defsLookupService:"http://spatialreference.org/ref",libPath:null,getScriptLocation:function(){if(this.libPath)return this.libPath;for(var a=this.scriptName,b=a.length,c=document.getElementsByTagName("script"),d=0;d<c.length;d++){var e=c[d].getAttribute("src");if(e){var f=e.lastIndexOf(a);if(f>-1&&f+b==e.length){this.libPath=e.slice(0,-b);break}}}return this.libPath||""},loadScript:function(a,b,c,d){var e=document.createElement("script");e.defer=!1,e.type="text/javascript",e.id=a,e.src=a,e.onload=b,e.onerror=c,e.loadCheck=d,/MSIE/.test(navigator.userAgent)&&(e.onreadystatechange=this.checkReadyState),document.getElementsByTagName("head")[0].appendChild(e)},checkReadyState:function(){"loaded"==this.readyState&&(this.loadCheck()?this.onload():this.onerror())}},Proj4js.Proj=Proj4js.Class({readyToUse:!1,title:null,projName:null,units:null,datum:null,x0:0,y0:0,localCS:!1,queue:null,initialize:function(a,b){if(this.srsCodeInput=a,this.queue=[],b&&this.queue.push(b),a.indexOf("GEOGCS")>=0||a.indexOf("GEOCCS")>=0||a.indexOf("PROJCS")>=0||a.indexOf("LOCAL_CS")>=0)return this.parseWKT(a),this.deriveConstants(),void this.loadProjCode(this.projName);if(0==a.indexOf("urn:")){var c=a.split(":");"ogc"!=c[1]&&"x-ogc"!=c[1]||"def"!=c[2]||"crs"!=c[3]||(a=c[4]+":"+c[c.length-1])}else if(0==a.indexOf("http://")){var d=a.split("#");d[0].match(/epsg.org/)?a="EPSG:"+d[1]:d[0].match(/RIG.xml/)&&(a="IGNF:"+d[1])}this.srsCode=a.toUpperCase(),0==this.srsCode.indexOf("EPSG")?(this.srsCode=this.srsCode,this.srsAuth="epsg",this.srsProjNumber=this.srsCode.substring(5)):0==this.srsCode.indexOf("IGNF")?(this.srsCode=this.srsCode,this.srsAuth="IGNF",this.srsProjNumber=this.srsCode.substring(5)):0==this.srsCode.indexOf("CRS")?(this.srsCode=this.srsCode,this.srsAuth="CRS",this.srsProjNumber=this.srsCode.substring(4)):(this.srsAuth="",this.srsProjNumber=this.srsCode),this.loadProjDefinition()},loadProjDefinition:function(){if(Proj4js.defs[this.srsCode])return void this.defsLoaded();var a=Proj4js.getScriptLocation()+"defs/"+this.srsAuth.toUpperCase()+this.srsProjNumber+".js";Proj4js.loadScript(a,Proj4js.bind(this.defsLoaded,this),Proj4js.bind(this.loadFromService,this),Proj4js.bind(this.checkDefsLoaded,this))},loadFromService:function(){var a=Proj4js.defsLookupService+"/"+this.srsAuth+"/"+this.srsProjNumber+"/proj4js/";Proj4js.loadScript(a,Proj4js.bind(this.defsLoaded,this),Proj4js.bind(this.defsFailed,this),Proj4js.bind(this.checkDefsLoaded,this))},defsLoaded:function(){this.parseDefs(),this.loadProjCode(this.projName)},checkDefsLoaded:function(){return Proj4js.defs[this.srsCode]?!0:!1},defsFailed:function(){Proj4js.reportError("failed to load projection definition for: "+this.srsCode),Proj4js.defs[this.srsCode]=Proj4js.defs.WGS84,this.defsLoaded()},loadProjCode:function(a){if(Proj4js.Proj[a])return void this.initTransforms();var b=Proj4js.getScriptLocation()+"projCode/"+a+".js";Proj4js.loadScript(b,Proj4js.bind(this.loadProjCodeSuccess,this,a),Proj4js.bind(this.loadProjCodeFailure,this,a),Proj4js.bind(this.checkCodeLoaded,this,a))},loadProjCodeSuccess:function(a){Proj4js.Proj[a].dependsOn?this.loadProjCode(Proj4js.Proj[a].dependsOn):this.initTransforms()},loadProjCodeFailure:function(a){Proj4js.reportError("failed to find projection file for: "+a)},checkCodeLoaded:function(a){return Proj4js.Proj[a]?!0:!1},initTransforms:function(){if(Proj4js.extend(this,Proj4js.Proj[this.projName]),this.init(),this.readyToUse=!0,this.queue)for(var a;a=this.queue.shift();)a.call(this,this)},wktRE:/^(\w+)\[(.*)\]$/,parseWKT:function(a){var b=a.match(this.wktRE);if(b){var c,d=b[1],e=b[2],f=e.split(",");c="TOWGS84"==d.toUpperCase()?d:f.shift(),c=c.replace(/^\"/,""),c=c.replace(/\"$/,"");for(var g=new Array,h=0,i="",j=0;j<f.length;++j){for(var k=f[j],l=0;l<k.length;++l)"["==k.charAt(l)&&++h,"]"==k.charAt(l)&&--h;i+=k,0===h?(g.push(i),i=""):i+=","}switch(d){case"LOCAL_CS":this.projName="identity",this.localCS=!0,this.srsCode=c;break;case"GEOGCS":this.projName="longlat",this.geocsCode=c,this.srsCode||(this.srsCode=c);break;case"PROJCS":this.srsCode=c;break;case"GEOCCS":break;case"PROJECTION":this.projName=Proj4js.wktProjections[c];break;case"DATUM":this.datumName=c;break;case"LOCAL_DATUM":this.datumCode="none";break;case"SPHEROID":this.ellps=c,this.a=parseFloat(g.shift()),this.rf=parseFloat(g.shift());break;case"PRIMEM":this.from_greenwich=parseFloat(g.shift());break;case"UNIT":this.units=c,this.unitsPerMeter=parseFloat(g.shift());break;case"PARAMETER":var m=c.toLowerCase(),n=parseFloat(g.shift());switch(m){case"false_easting":this.x0=n;break;case"false_northing":this.y0=n;break;case"scale_factor":this.k0=n;break;case"central_meridian":this.long0=n*Proj4js.common.D2R;break;case"latitude_of_origin":this.lat0=n*Proj4js.common.D2R;break;case"more_here":}break;case"TOWGS84":this.datum_params=g;break;case"AXIS":var m=c.toLowerCase(),n=g.shift();switch(n){case"EAST":n="e";break;case"WEST":n="w";break;case"NORTH":n="n";break;case"SOUTH":n="s";break;case"UP":n="u";break;case"DOWN":n="d";break;case"OTHER":default:n=" "}switch(this.axis||(this.axis="enu"),m){case"X":this.axis=n+this.axis.substr(1,2);break;case"Y":this.axis=this.axis.substr(0,1)+n+this.axis.substr(2,1);break;case"Z":this.axis=this.axis.substr(0,2)+n}case"MORE_HERE":}for(var j=0;j<g.length;++j)this.parseWKT(g[j])}},parseDefs:function(){this.defData=Proj4js.defs[this.srsCode];var a,b;if(this.defData){for(var c=this.defData.split("+"),d=0;d<c.length;d++){var e=c[d].split("=");switch(a=e[0].toLowerCase(),b=e[1],a.replace(/\s/gi,"")){case"":break;case"title":this.title=b;break;case"proj":this.projName=b.replace(/\s/gi,"");break;case"units":this.units=b.replace(/\s/gi,"");break;case"datum":this.datumCode=b.replace(/\s/gi,"");break;case"nadgrids":this.nagrids=b.replace(/\s/gi,"");break;case"ellps":this.ellps=b.replace(/\s/gi,"");break;case"a":this.a=parseFloat(b);break;case"b":this.b=parseFloat(b);break;case"rf":this.rf=parseFloat(b);break;case"lat_0":this.lat0=b*Proj4js.common.D2R;break;case"lat_1":this.lat1=b*Proj4js.common.D2R;break;case"lat_2":this.lat2=b*Proj4js.common.D2R;break;case"lat_ts":this.lat_ts=b*Proj4js.common.D2R;break;case"lon_0":this.long0=b*Proj4js.common.D2R;break;case"alpha":this.alpha=parseFloat(b)*Proj4js.common.D2R;break;case"lonc":this.longc=b*Proj4js.common.D2R;break;case"x_0":this.x0=parseFloat(b);break;case"y_0":this.y0=parseFloat(b);break;case"k_0":this.k0=parseFloat(b);break;case"k":this.k0=parseFloat(b);break;case"r_a":this.R_A=!0;break;case"zone":this.zone=parseInt(b);break;case"south":this.utmSouth=!0;break;case"towgs84":this.datum_params=b.split(",");break;case"to_meter":this.to_meter=parseFloat(b);break;case"from_greenwich":this.from_greenwich=b*Proj4js.common.D2R;break;case"pm":b=b.replace(/\s/gi,""),this.from_greenwich=Proj4js.PrimeMeridian[b]?Proj4js.PrimeMeridian[b]:parseFloat(b),this.from_greenwich*=Proj4js.common.D2R;break;case"axis":b=b.replace(/\s/gi,"");var f="ewnsud";3==b.length&&-1!=f.indexOf(b.substr(0,1))&&-1!=f.indexOf(b.substr(1,1))&&-1!=f.indexOf(b.substr(2,1))&&(this.axis=b);break;case"no_defs":}}this.deriveConstants()}},deriveConstants:function(){if("@null"==this.nagrids&&(this.datumCode="none"),this.datumCode&&"none"!=this.datumCode){var a=Proj4js.Datum[this.datumCode];a&&(this.datum_params=a.towgs84?a.towgs84.split(","):null,this.ellps=a.ellipse,this.datumName=a.datumName?a.datumName:this.datumCode)}if(!this.a){var b=Proj4js.Ellipsoid[this.ellps]?Proj4js.Ellipsoid[this.ellps]:Proj4js.Ellipsoid.WGS84;Proj4js.extend(this,b)}this.rf&&!this.b&&(this.b=(1-1/this.rf)*this.a),Math.abs(this.a-this.b)<Proj4js.common.EPSLN&&(this.sphere=!0,this.b=this.a),this.a2=this.a*this.a,this.b2=this.b*this.b,this.es=(this.a2-this.b2)/this.a2,this.e=Math.sqrt(this.es),this.R_A&&(this.a*=1-this.es*(Proj4js.common.SIXTH+this.es*(Proj4js.common.RA4+this.es*Proj4js.common.RA6)),this.a2=this.a*this.a,this.b2=this.b*this.b,this.es=0),this.ep2=(this.a2-this.b2)/this.b2,this.k0||(this.k0=1),this.axis||(this.axis="enu"),this.datum=new Proj4js.datum(this)}}),Proj4js.Proj.longlat={init:function(){},forward:function(a){return a},inverse:function(a){return a}},Proj4js.Proj.identity=Proj4js.Proj.longlat,Proj4js.defs={WGS84:"+title=long/lat:WGS84 +proj=longlat +ellps=WGS84 +datum=WGS84 +units=degrees","EPSG:4326":"+title=long/lat:WGS84 +proj=longlat +a=6378137.0 +b=6356752.31424518 +ellps=WGS84 +datum=WGS84 +units=degrees","EPSG:4269":"+title=long/lat:NAD83 +proj=longlat +a=6378137.0 +b=6356752.31414036 +ellps=GRS80 +datum=NAD83 +units=degrees","EPSG:3785":"+title= Google Mercator +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs"},Proj4js.defs.GOOGLE=Proj4js.defs["EPSG:3785"],Proj4js.defs["EPSG:900913"]=Proj4js.defs["EPSG:3785"],Proj4js.defs["EPSG:102113"]=Proj4js.defs["EPSG:3785"],Proj4js.common={PI:3.141592653589793,HALF_PI:1.5707963267948966,TWO_PI:6.283185307179586,FORTPI:.7853981633974483,R2D:57.29577951308232,D2R:.017453292519943295,SEC_TO_RAD:484813681109536e-20,EPSLN:1e-10,MAX_ITER:20,COS_67P5:.3826834323650898,AD_C:1.0026,PJD_UNKNOWN:0,PJD_3PARAM:1,PJD_7PARAM:2,PJD_GRIDSHIFT:3,PJD_WGS84:4,PJD_NODATUM:5,SRS_WGS84_SEMIMAJOR:6378137,SIXTH:.16666666666666666,RA4:.04722222222222222,RA6:.022156084656084655,RV4:.06944444444444445,RV6:.04243827160493827,msfnz:function(a,b,c){var d=a*b;return c/Math.sqrt(1-d*d)},tsfnz:function(a,b,c){var d=a*c,e=.5*a;return d=Math.pow((1-d)/(1+d),e),Math.tan(.5*(this.HALF_PI-b))/d},phi2z:function(a,b){for(var c,d,e=.5*a,f=this.HALF_PI-2*Math.atan(b),g=0;15>=g;g++)if(c=a*Math.sin(f),d=this.HALF_PI-2*Math.atan(b*Math.pow((1-c)/(1+c),e))-f,f+=d,Math.abs(d)<=1e-10)return f;return alert("phi2z has NoConvergence"),-9999},qsfnz:function(a,b){var c;return a>1e-7?(c=a*b,(1-a*a)*(b/(1-c*c)-.5/a*Math.log((1-c)/(1+c)))):2*b},asinz:function(a){return Math.abs(a)>1&&(a=a>1?1:-1),Math.asin(a)},e0fn:function(a){return 1-.25*a*(1+a/16*(3+1.25*a))},e1fn:function(a){return.375*a*(1+.25*a*(1+.46875*a))},e2fn:function(a){return.05859375*a*a*(1+.75*a)},e3fn:function(a){return a*a*a*(35/3072)},mlfn:function(a,b,c,d,e){return a*e-b*Math.sin(2*e)+c*Math.sin(4*e)-d*Math.sin(6*e)},srat:function(a,b){return Math.pow((1-a)/(1+a),b)},sign:function(a){return 0>a?-1:1},adjust_lon:function(a){return a=Math.abs(a)<this.PI?a:a-this.sign(a)*this.TWO_PI},adjust_lat:function(a){return a=Math.abs(a)<this.HALF_PI?a:a-this.sign(a)*this.PI},latiso:function(a,b,c){if(Math.abs(b)>this.HALF_PI)return+Number.NaN;if(b==this.HALF_PI)return Number.POSITIVE_INFINITY;if(b==-1*this.HALF_PI)return-1*Number.POSITIVE_INFINITY;var d=a*c;return Math.log(Math.tan((this.HALF_PI+b)/2))+a*Math.log((1-d)/(1+d))/2},fL:function(a,b){return 2*Math.atan(a*Math.exp(b))-this.HALF_PI},invlatiso:function(a,b){var c=this.fL(1,b),d=0,e=0;do d=c,e=a*Math.sin(d),c=this.fL(Math.exp(a*Math.log((1+e)/(1-e))/2),b);while(Math.abs(c-d)>1e-12);return c},sinh:function(a){var b=Math.exp(a);return b=(b-1/b)/2},cosh:function(a){var b=Math.exp(a);return b=(b+1/b)/2},tanh:function(a){var b=Math.exp(a);return b=(b-1/b)/(b+1/b)},asinh:function(a){var b=a>=0?1:-1;return b*Math.log(Math.abs(a)+Math.sqrt(a*a+1))},acosh:function(a){return 2*Math.log(Math.sqrt((a+1)/2)+Math.sqrt((a-1)/2))},atanh:function(a){return Math.log((a-1)/(a+1))/2},gN:function(a,b,c){var d=b*c;return a/Math.sqrt(1-d*d)}},Proj4js.datum=Proj4js.Class({initialize:function(a){if(this.datum_type=Proj4js.common.PJD_WGS84,a.datumCode&&"none"==a.datumCode&&(this.datum_type=Proj4js.common.PJD_NODATUM),a&&a.datum_params){for(var b=0;b<a.datum_params.length;b++)a.datum_params[b]=parseFloat(a.datum_params[b]);(0!=a.datum_params[0]||0!=a.datum_params[1]||0!=a.datum_params[2])&&(this.datum_type=Proj4js.common.PJD_3PARAM),a.datum_params.length>3&&(0!=a.datum_params[3]||0!=a.datum_params[4]||0!=a.datum_params[5]||0!=a.datum_params[6])&&(this.datum_type=Proj4js.common.PJD_7PARAM,a.datum_params[3]*=Proj4js.common.SEC_TO_RAD,a.datum_params[4]*=Proj4js.common.SEC_TO_RAD,a.datum_params[5]*=Proj4js.common.SEC_TO_RAD,a.datum_params[6]=a.datum_params[6]/1e6+1)}a&&(this.a=a.a,this.b=a.b,this.es=a.es,this.ep2=a.ep2,this.datum_params=a.datum_params)},compare_datums:function(a){return this.datum_type!=a.datum_type?!1:this.a!=a.a||Math.abs(this.es-a.es)>5e-11?!1:this.datum_type==Proj4js.common.PJD_3PARAM?this.datum_params[0]==a.datum_params[0]&&this.datum_params[1]==a.datum_params[1]&&this.datum_params[2]==a.datum_params[2]:this.datum_type==Proj4js.common.PJD_7PARAM?this.datum_params[0]==a.datum_params[0]&&this.datum_params[1]==a.datum_params[1]&&this.datum_params[2]==a.datum_params[2]&&this.datum_params[3]==a.datum_params[3]&&this.datum_params[4]==a.datum_params[4]&&this.datum_params[5]==a.datum_params[5]&&this.datum_params[6]==a.datum_params[6]:this.datum_type==Proj4js.common.PJD_GRIDSHIFT?0==strcmp(pj_param(this.params,"snadgrids").s,pj_param(a.params,"snadgrids").s):!0},geodetic_to_geocentric:function(a){var b,c,d,e,f,g,h,i=a.x,j=a.y,k=a.z?a.z:0,l=0;if(j<-Proj4js.common.HALF_PI&&j>-1.001*Proj4js.common.HALF_PI)j=-Proj4js.common.HALF_PI;else if(j>Proj4js.common.HALF_PI&&j<1.001*Proj4js.common.HALF_PI)j=Proj4js.common.HALF_PI;else if(j<-Proj4js.common.HALF_PI||j>Proj4js.common.HALF_PI)return Proj4js.reportError("geocent:lat out of range:"+j),null;return i>Proj4js.common.PI&&(i-=2*Proj4js.common.PI),f=Math.sin(j),h=Math.cos(j),g=f*f,e=this.a/Math.sqrt(1-this.es*g),b=(e+k)*h*Math.cos(i),c=(e+k)*h*Math.sin(i),d=(e*(1-this.es)+k)*f,a.x=b,a.y=c,a.z=d,l},geocentric_to_geodetic:function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s=1e-12,t=s*s,u=30,v=a.x,w=a.y,x=a.z?a.z:0;if(n=!1,b=Math.sqrt(v*v+w*w),c=Math.sqrt(v*v+w*w+x*x),b/this.a<s){if(n=!0,p=0,c/this.a<s)return q=Proj4js.common.HALF_PI,void(r=-this.b)}else p=Math.atan2(w,v);d=x/c,e=b/c,f=1/Math.sqrt(1-this.es*(2-this.es)*e*e),i=e*(1-this.es)*f,j=d*f,o=0;do o++,h=this.a/Math.sqrt(1-this.es*j*j),r=b*i+x*j-h*(1-this.es*j*j),g=this.es*h/(h+r),f=1/Math.sqrt(1-g*(2-g)*e*e),k=e*(1-g)*f,l=d*f,m=l*i-k*j,i=k,j=l;while(m*m>t&&u>o);return q=Math.atan(l/Math.abs(k)),a.x=p,a.y=q,a.z=r,a},geocentric_to_geodetic_noniter:function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s=a.x,t=a.y,u=a.z?a.z:0;if(s=parseFloat(s),t=parseFloat(t),u=parseFloat(u),r=!1,0!=s)b=Math.atan2(t,s);else if(t>0)b=Proj4js.common.HALF_PI;else if(0>t)b=-Proj4js.common.HALF_PI;else if(r=!0,b=0,u>0)c=Proj4js.common.HALF_PI;else{if(!(0>u))return c=Proj4js.common.HALF_PI,void(d=-this.b);c=-Proj4js.common.HALF_PI}return f=s*s+t*t,e=Math.sqrt(f),g=u*Proj4js.common.AD_C,i=Math.sqrt(g*g+f),k=g/i,m=e/i,l=k*k*k,h=u+this.b*this.ep2*l,q=e-this.a*this.es*m*m*m,j=Math.sqrt(h*h+q*q),n=h/j,o=q/j,p=this.a/Math.sqrt(1-this.es*n*n),d=o>=Proj4js.common.COS_67P5?e/o-p:o<=-Proj4js.common.COS_67P5?e/-o-p:u/n+p*(this.es-1),0==r&&(c=Math.atan(n/o)),a.x=b,a.y=c,a.z=d,a},geocentric_to_wgs84:function(a){if(this.datum_type==Proj4js.common.PJD_3PARAM)a.x+=this.datum_params[0],a.y+=this.datum_params[1],a.z+=this.datum_params[2];else if(this.datum_type==Proj4js.common.PJD_7PARAM){var b=this.datum_params[0],c=this.datum_params[1],d=this.datum_params[2],e=this.datum_params[3],f=this.datum_params[4],g=this.datum_params[5],h=this.datum_params[6],i=h*(a.x-g*a.y+f*a.z)+b,j=h*(g*a.x+a.y-e*a.z)+c,k=h*(-f*a.x+e*a.y+a.z)+d;a.x=i,a.y=j,a.z=k}},geocentric_from_wgs84:function(a){if(this.datum_type==Proj4js.common.PJD_3PARAM)a.x-=this.datum_params[0],a.y-=this.datum_params[1],a.z-=this.datum_params[2];else if(this.datum_type==Proj4js.common.PJD_7PARAM){var b=this.datum_params[0],c=this.datum_params[1],d=this.datum_params[2],e=this.datum_params[3],f=this.datum_params[4],g=this.datum_params[5],h=this.datum_params[6],i=(a.x-b)/h,j=(a.y-c)/h,k=(a.z-d)/h;a.x=i+g*j-f*k,a.y=-g*i+j+e*k,a.z=f*i-e*j+k}}}),Proj4js.Point=Proj4js.Class({initialize:function(a,b,c){if("object"==typeof a)this.x=a[0],this.y=a[1],this.z=a[2]||0;else if("string"==typeof a&&"undefined"==typeof b){var d=a.split(",");this.x=parseFloat(d[0]),this.y=parseFloat(d[1]),this.z=parseFloat(d[2])||0}else this.x=a,this.y=b,this.z=c||0},clone:function(){return new Proj4js.Point(this.x,this.y,this.z)},toString:function(){return"x="+this.x+",y="+this.y},toShortString:function(){return this.x+", "+this.y}}),Proj4js.PrimeMeridian={greenwich:0,lisbon:-9.131906111111,paris:2.337229166667,bogota:-74.080916666667,madrid:-3.687938888889,rome:12.452333333333,bern:7.439583333333,jakarta:106.807719444444,ferro:-17.666666666667,brussels:4.367975,stockholm:18.058277777778,athens:23.7163375,oslo:10.722916666667},Proj4js.Ellipsoid={MERIT:{a:6378137,rf:298.257,ellipseName:"MERIT 1983"},SGS85:{a:6378136,rf:298.257,ellipseName:"Soviet Geodetic System 85"},GRS80:{a:6378137,rf:298.257222101,ellipseName:"GRS 1980(IUGG, 1980)"},IAU76:{a:6378140,rf:298.257,ellipseName:"IAU 1976"},airy:{a:6377563.396,b:6356256.91,ellipseName:"Airy 1830"},"APL4.":{a:6378137,rf:298.25,ellipseName:"Appl. Physics. 1965"},NWL9D:{a:6378145,rf:298.25,ellipseName:"Naval Weapons Lab., 1965"},mod_airy:{a:6377340.189,b:6356034.446,ellipseName:"Modified Airy"},andrae:{a:6377104.43,rf:300,ellipseName:"Andrae 1876 (Den., Iclnd.)"},aust_SA:{a:6378160,rf:298.25,ellipseName:"Australian Natl & S. Amer. 1969"},GRS67:{a:6378160,rf:298.247167427,ellipseName:"GRS 67(IUGG 1967)"},bessel:{a:6377397.155,rf:299.1528128,ellipseName:"Bessel 1841"},bess_nam:{a:6377483.865,rf:299.1528128,ellipseName:"Bessel 1841 (Namibia)"},clrk66:{a:6378206.4,b:6356583.8,ellipseName:"Clarke 1866"},clrk80:{a:6378249.145,rf:293.4663,ellipseName:"Clarke 1880 mod."},CPM:{a:6375738.7,rf:334.29,ellipseName:"Comm. des Poids et Mesures 1799"},delmbr:{a:6376428,rf:311.5,ellipseName:"Delambre 1810 (Belgium)"},engelis:{a:6378136.05,rf:298.2566,ellipseName:"Engelis 1985"},evrst30:{a:6377276.345,rf:300.8017,ellipseName:"Everest 1830"},evrst48:{a:6377304.063,rf:300.8017,ellipseName:"Everest 1948"},evrst56:{a:6377301.243,rf:300.8017,ellipseName:"Everest 1956"},evrst69:{a:6377295.664,rf:300.8017,ellipseName:"Everest 1969"},evrstSS:{a:6377298.556,rf:300.8017,ellipseName:"Everest (Sabah & Sarawak)"},fschr60:{a:6378166,rf:298.3,ellipseName:"Fischer (Mercury Datum) 1960"},fschr60m:{a:6378155,rf:298.3,ellipseName:"Fischer 1960"},fschr68:{a:6378150,rf:298.3,ellipseName:"Fischer 1968"},helmert:{a:6378200,rf:298.3,ellipseName:"Helmert 1906"},hough:{a:6378270,rf:297,ellipseName:"Hough"},intl:{a:6378388,rf:297,ellipseName:"International 1909 (Hayford)"},kaula:{a:6378163,rf:298.24,ellipseName:"Kaula 1961"},lerch:{a:6378139,rf:298.257,ellipseName:"Lerch 1979"},mprts:{a:6397300,rf:191,ellipseName:"Maupertius 1738"},new_intl:{a:6378157.5,b:6356772.2,ellipseName:"New International 1967"},plessis:{a:6376523,rf:6355863,ellipseName:"Plessis 1817 (France)"},krass:{a:6378245,rf:298.3,ellipseName:"Krassovsky, 1942"},SEasia:{a:6378155,b:6356773.3205,ellipseName:"Southeast Asia"},walbeck:{a:6376896,b:6355834.8467,ellipseName:"Walbeck"},WGS60:{a:6378165,rf:298.3,ellipseName:"WGS 60"},WGS66:{a:6378145,rf:298.25,ellipseName:"WGS 66"},WGS72:{a:6378135,rf:298.26,ellipseName:"WGS 72"},WGS84:{a:6378137,rf:298.257223563,ellipseName:"WGS 84"},sphere:{a:6370997,b:6370997,ellipseName:"Normal Sphere (r=6370997)"}},Proj4js.Datum={WGS84:{towgs84:"0,0,0",ellipse:"WGS84",datumName:"WGS84"},GGRS87:{towgs84:"-199.87,74.79,246.62",ellipse:"GRS80",datumName:"Greek_Geodetic_Reference_System_1987"},NAD83:{towgs84:"0,0,0",ellipse:"GRS80",datumName:"North_American_Datum_1983"},NAD27:{nadgrids:"@conus,@alaska,@ntv2_0.gsb,@ntv1_can.dat",ellipse:"clrk66",datumName:"North_American_Datum_1927"},potsdam:{towgs84:"606.0,23.0,413.0",ellipse:"bessel",datumName:"Potsdam Rauenberg 1950 DHDN"},carthage:{towgs84:"-263.0,6.0,431.0",ellipse:"clark80",datumName:"Carthage 1934 Tunisia"},hermannskogel:{towgs84:"653.0,-212.0,449.0",ellipse:"bessel",datumName:"Hermannskogel"},ire65:{towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"mod_airy",datumName:"Ireland 1965"},nzgd49:{towgs84:"59.47,-5.04,187.44,0.47,-0.1,1.024,-4.5993",ellipse:"intl",datumName:"New Zealand Geodetic Datum 1949"},OSGB36:{towgs84:"446.448,-125.157,542.060,0.1502,0.2470,0.8421,-20.4894",ellipse:"airy",datumName:"Airy 1830"}},Proj4js.WGS84=new Proj4js.Proj("WGS84"),Proj4js.Datum.OSB36=Proj4js.Datum.OSGB36,Proj4js.wktProjections={"Lambert Tangential Conformal Conic Projection":"lcc",Mercator:"merc","Popular Visualisation Pseudo Mercator":"merc",Transverse_Mercator:"tmerc","Transverse Mercator":"tmerc","Lambert Azimuthal Equal Area":"laea","Universal Transverse Mercator System":"utm"},Proj4js.Proj.aea={init:function(){return Math.abs(this.lat1+this.lat2)<Proj4js.common.EPSLN?void Proj4js.reportError("aeaInitEqualLatitudes"):(this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e3=Math.sqrt(this.es),this.sin_po=Math.sin(this.lat1),this.cos_po=Math.cos(this.lat1),this.t1=this.sin_po,this.con=this.sin_po,this.ms1=Proj4js.common.msfnz(this.e3,this.sin_po,this.cos_po),this.qs1=Proj4js.common.qsfnz(this.e3,this.sin_po,this.cos_po),this.sin_po=Math.sin(this.lat2),this.cos_po=Math.cos(this.lat2),this.t2=this.sin_po,this.ms2=Proj4js.common.msfnz(this.e3,this.sin_po,this.cos_po),this.qs2=Proj4js.common.qsfnz(this.e3,this.sin_po,this.cos_po),this.sin_po=Math.sin(this.lat0),this.cos_po=Math.cos(this.lat0),this.t3=this.sin_po,this.qs0=Proj4js.common.qsfnz(this.e3,this.sin_po,this.cos_po),this.ns0=Math.abs(this.lat1-this.lat2)>Proj4js.common.EPSLN?(this.ms1*this.ms1-this.ms2*this.ms2)/(this.qs2-this.qs1):this.con,this.c=this.ms1*this.ms1+this.ns0*this.qs1,void(this.rh=this.a*Math.sqrt(this.c-this.ns0*this.qs0)/this.ns0))},forward:function(a){var b=a.x,c=a.y;this.sin_phi=Math.sin(c),this.cos_phi=Math.cos(c);var d=Proj4js.common.qsfnz(this.e3,this.sin_phi,this.cos_phi),e=this.a*Math.sqrt(this.c-this.ns0*d)/this.ns0,f=this.ns0*Proj4js.common.adjust_lon(b-this.long0),g=e*Math.sin(f)+this.x0,h=this.rh-e*Math.cos(f)+this.y0;return a.x=g,a.y=h,a},inverse:function(a){var b,c,d,e,f,g;return a.x-=this.x0,a.y=this.rh-a.y+this.y0,this.ns0>=0?(b=Math.sqrt(a.x*a.x+a.y*a.y),d=1):(b=-Math.sqrt(a.x*a.x+a.y*a.y),d=-1),e=0,0!=b&&(e=Math.atan2(d*a.x,d*a.y)),d=b*this.ns0/this.a,c=(this.c-d*d)/this.ns0,this.e3>=1e-10?(d=1-.5*(1-this.es)*Math.log((1-this.e3)/(1+this.e3))/this.e3,g=Math.abs(Math.abs(d)-Math.abs(c))>1e-10?this.phi1z(this.e3,c):c>=0?.5*PI:-.5*PI):g=this.phi1z(e3,c),f=Proj4js.common.adjust_lon(e/this.ns0+this.long0),a.x=f,a.y=g,a},phi1z:function(a,b){var c,d,e,f=Proj4js.common.asinz(.5*b);if(a<Proj4js.common.EPSLN)return f;for(var g=a*a,h=1;25>=h;h++)if(sinphi=Math.sin(f),cosphi=Math.cos(f),c=a*sinphi,d=1-c*c,e=.5*d*d/cosphi*(b/(1-g)-sinphi/d+.5/a*Math.log((1-c)/(1+c))),f+=e,Math.abs(e)<=1e-7)return f;return Proj4js.reportError("aea:phi1z:Convergence error"),null}},Proj4js.Proj.sterea={dependsOn:"gauss",init:function(){return Proj4js.Proj.gauss.init.apply(this),this.rc?(this.sinc0=Math.sin(this.phic0),this.cosc0=Math.cos(this.phic0),this.R2=2*this.rc,void(this.title||(this.title="Oblique Stereographic Alternative"))):void Proj4js.reportError("sterea:init:E_ERROR_0")},forward:function(a){return a.x=Proj4js.common.adjust_lon(a.x-this.long0),Proj4js.Proj.gauss.forward.apply(this,[a]),sinc=Math.sin(a.y),cosc=Math.cos(a.y),cosl=Math.cos(a.x),k=this.k0*this.R2/(1+this.sinc0*sinc+this.cosc0*cosc*cosl),a.x=k*cosc*Math.sin(a.x),a.y=k*(this.cosc0*sinc-this.sinc0*cosc*cosl),a.x=this.a*a.x+this.x0,a.y=this.a*a.y+this.y0,a},inverse:function(a){var b,d;return a.x=(a.x-this.x0)/this.a,a.y=(a.y-this.y0)/this.a,a.x/=this.k0,a.y/=this.k0,(rho=Math.sqrt(a.x*a.x+a.y*a.y))?(c=2*Math.atan2(rho,this.R2),sinc=Math.sin(c),cosc=Math.cos(c),d=Math.asin(cosc*this.sinc0+a.y*sinc*this.cosc0/rho),b=Math.atan2(a.x*sinc,rho*this.cosc0*cosc-a.y*this.sinc0*sinc)):(d=this.phic0,b=0),a.x=b,a.y=d,Proj4js.Proj.gauss.inverse.apply(this,[a]),a.x=Proj4js.common.adjust_lon(a.x+this.long0),a}},Proj4js.Proj.poly={init:function(){(this.lat0=0)&&(this.lat0=90),this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=Proj4js.common.e0fn(this.es),this.e1=Proj4js.common.e1fn(this.es),this.e2=Proj4js.common.e2fn(this.es),this.e3=Proj4js.common.e3fn(this.es),this.ml0=Proj4js.common.mlfn(this.e0,this.e1,this.e2,this.e3,this.lat0)},forward:function(a){var b,c,d,e,f,g,h,i=a.x,j=a.y;return d=Proj4js.common.adjust_lon(i-this.long0),Math.abs(j)<=1e-7?(g=this.x0+this.a*d,h=this.y0-this.a*this.ml0):(b=Math.sin(j),c=Math.cos(j),e=Proj4js.common.mlfn(this.e0,this.e1,this.e2,this.e3,j),f=Proj4js.common.msfnz(this.e,b,c),d=b,g=this.x0+this.a*f*Math.sin(d)/b,h=this.y0+this.a*(e-this.ml0+f*(1-Math.cos(d))/b)),a.x=g,a.y=h,a},inverse:function(a){var b,c,d,e,f,g;if(a.x-=this.x0,a.y-=this.y0,b=this.ml0+a.y/this.a,e=0,Math.abs(b)<=1e-7)f=a.x/this.a+this.long0,g=0;else{if(c=b*b+a.x/this.a*(a.x/this.a),e=phi4z(this.es,this.e0,this.e1,this.e2,this.e3,this.al,c,d,g),1!=e)return e;f=Proj4js.common.adjust_lon(Proj4js.common.asinz(a.x*d/this.a)/Math.sin(g)+this.long0)}return a.x=f,a.y=g,a
}},Proj4js.Proj.equi={init:function(){this.x0||(this.x0=0),this.y0||(this.y0=0),this.lat0||(this.lat0=0),this.long0||(this.long0=0)},forward:function(a){var b=a.x,c=a.y,d=Proj4js.common.adjust_lon(b-this.long0),e=this.x0+this.a*d*Math.cos(this.lat0),f=this.y0+this.a*c;return this.t1=e,this.t2=Math.cos(this.lat0),a.x=e,a.y=f,a},inverse:function(a){a.x-=this.x0,a.y-=this.y0;var b=a.y/this.a;Math.abs(b)>Proj4js.common.HALF_PI&&Proj4js.reportError("equi:Inv:DataError");var c=Proj4js.common.adjust_lon(this.long0+a.x/(this.a*Math.cos(this.lat0)));a.x=c,a.y=b}},Proj4js.Proj.merc={init:function(){this.lat_ts&&(this.k0=this.sphere?Math.cos(this.lat_ts):Proj4js.common.msfnz(this.es,Math.sin(this.lat_ts),Math.cos(this.lat_ts)))},forward:function(a){var b=a.x,c=a.y;if(c*Proj4js.common.R2D>90&&c*Proj4js.common.R2D<-90&&b*Proj4js.common.R2D>180&&b*Proj4js.common.R2D<-180)return Proj4js.reportError("merc:forward: llInputOutOfRange: "+b+" : "+c),null;var d,e;if(Math.abs(Math.abs(c)-Proj4js.common.HALF_PI)<=Proj4js.common.EPSLN)return Proj4js.reportError("merc:forward: ll2mAtPoles"),null;if(this.sphere)d=this.x0+this.a*this.k0*Proj4js.common.adjust_lon(b-this.long0),e=this.y0+this.a*this.k0*Math.log(Math.tan(Proj4js.common.FORTPI+.5*c));else{var f=Math.sin(c),g=Proj4js.common.tsfnz(this.e,c,f);d=this.x0+this.a*this.k0*Proj4js.common.adjust_lon(b-this.long0),e=this.y0-this.a*this.k0*Math.log(g)}return a.x=d,a.y=e,a},inverse:function(a){var b,c,d=a.x-this.x0,e=a.y-this.y0;if(this.sphere)c=Proj4js.common.HALF_PI-2*Math.atan(Math.exp(-e/this.a*this.k0));else{var f=Math.exp(-e/(this.a*this.k0));if(c=Proj4js.common.phi2z(this.e,f),-9999==c)return Proj4js.reportError("merc:inverse: lat = -9999"),null}return b=Proj4js.common.adjust_lon(this.long0+d/(this.a*this.k0)),a.x=b,a.y=c,a}},Proj4js.Proj.utm={dependsOn:"tmerc",init:function(){return this.zone?(this.lat0=0,this.long0=(6*Math.abs(this.zone)-183)*Proj4js.common.D2R,this.x0=5e5,this.y0=this.utmSouth?1e7:0,this.k0=.9996,Proj4js.Proj.tmerc.init.apply(this),this.forward=Proj4js.Proj.tmerc.forward,void(this.inverse=Proj4js.Proj.tmerc.inverse)):void Proj4js.reportError("utm:init: zone must be specified for UTM")}},Proj4js.Proj.eqdc={init:function(){this.mode||(this.mode=0),this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=Proj4js.common.e0fn(this.es),this.e1=Proj4js.common.e1fn(this.es),this.e2=Proj4js.common.e2fn(this.es),this.e3=Proj4js.common.e3fn(this.es),this.sinphi=Math.sin(this.lat1),this.cosphi=Math.cos(this.lat1),this.ms1=Proj4js.common.msfnz(this.e,this.sinphi,this.cosphi),this.ml1=Proj4js.common.mlfn(this.e0,this.e1,this.e2,this.e3,this.lat1),0!=this.mode?(Math.abs(this.lat1+this.lat2)<Proj4js.common.EPSLN&&Proj4js.reportError("eqdc:Init:EqualLatitudes"),this.sinphi=Math.sin(this.lat2),this.cosphi=Math.cos(this.lat2),this.ms2=Proj4js.common.msfnz(this.e,this.sinphi,this.cosphi),this.ml2=Proj4js.common.mlfn(this.e0,this.e1,this.e2,this.e3,this.lat2),this.ns=Math.abs(this.lat1-this.lat2)>=Proj4js.common.EPSLN?(this.ms1-this.ms2)/(this.ml2-this.ml1):this.sinphi):this.ns=this.sinphi,this.g=this.ml1+this.ms1/this.ns,this.ml0=Proj4js.common.mlfn(this.e0,this.e1,this.e2,this.e3,this.lat0),this.rh=this.a*(this.g-this.ml0)},forward:function(a){var b=a.x,c=a.y,d=Proj4js.common.mlfn(this.e0,this.e1,this.e2,this.e3,c),e=this.a*(this.g-d),f=this.ns*Proj4js.common.adjust_lon(b-this.long0),g=this.x0+e*Math.sin(f),h=this.y0+this.rh-e*Math.cos(f);return a.x=g,a.y=h,a},inverse:function(a){a.x-=this.x0,a.y=this.rh-a.y+this.y0;var b,c;if(this.ns>=0)var c=Math.sqrt(a.x*a.x+a.y*a.y),b=1;else c=-Math.sqrt(a.x*a.x+a.y*a.y),b=-1;var d=0;0!=c&&(d=Math.atan2(b*a.x,b*a.y));var e=this.g-c/this.a,f=this.phi3z(e,this.e0,this.e1,this.e2,this.e3),g=Proj4js.common.adjust_lon(this.long0+d/this.ns);return a.x=g,a.y=f,a},phi3z:function(a,b,c,d,e){var f,g;f=a;for(var h=0;15>h;h++)if(g=(a+c*Math.sin(2*f)-d*Math.sin(4*f)+e*Math.sin(6*f))/b-f,f+=g,Math.abs(g)<=1e-10)return f;return Proj4js.reportError("PHI3Z-CONV:Latitude failed to converge after 15 iterations"),null}},Proj4js.Proj.tmerc={init:function(){this.e0=Proj4js.common.e0fn(this.es),this.e1=Proj4js.common.e1fn(this.es),this.e2=Proj4js.common.e2fn(this.es),this.e3=Proj4js.common.e3fn(this.es),this.ml0=this.a*Proj4js.common.mlfn(this.e0,this.e1,this.e2,this.e3,this.lat0)},forward:function(a){var b,c,d,e=a.x,f=a.y,g=Proj4js.common.adjust_lon(e-this.long0),h=Math.sin(f),i=Math.cos(f);if(this.sphere){var j=i*Math.sin(g);if(Math.abs(Math.abs(j)-1)<1e-10)return Proj4js.reportError("tmerc:forward: Point projects into infinity"),93;c=.5*this.a*this.k0*Math.log((1+j)/(1-j)),b=Math.acos(i*Math.cos(g)/Math.sqrt(1-j*j)),0>f&&(b=-b),d=this.a*this.k0*(b-this.lat0)}else{var k=i*g,l=Math.pow(k,2),m=this.ep2*Math.pow(i,2),n=Math.tan(f),o=Math.pow(n,2);b=1-this.es*Math.pow(h,2);var p=this.a/Math.sqrt(b),q=this.a*Proj4js.common.mlfn(this.e0,this.e1,this.e2,this.e3,f);c=this.k0*p*k*(1+l/6*(1-o+m+l/20*(5-18*o+Math.pow(o,2)+72*m-58*this.ep2)))+this.x0,d=this.k0*(q-this.ml0+p*n*l*(.5+l/24*(5-o+9*m+4*Math.pow(m,2)+l/30*(61-58*o+Math.pow(o,2)+600*m-330*this.ep2))))+this.y0}return a.x=c,a.y=d,a},inverse:function(a){var b,c,d,e,f,g,h=6;if(this.sphere){var i=Math.exp(a.x/(this.a*this.k0)),j=.5*(i-1/i),k=this.lat0+a.y/(this.a*this.k0),l=Math.cos(k);b=Math.sqrt((1-l*l)/(1+j*j)),f=Proj4js.common.asinz(b),0>k&&(f=-f),g=0==j&&0==l?this.long0:Proj4js.common.adjust_lon(Math.atan2(j,l)+this.long0)}else{var m=a.x-this.x0,n=a.y-this.y0;for(b=(this.ml0+n/this.k0)/this.a,c=b,e=0;!0&&(d=(b+this.e1*Math.sin(2*c)-this.e2*Math.sin(4*c)+this.e3*Math.sin(6*c))/this.e0-c,c+=d,!(Math.abs(d)<=Proj4js.common.EPSLN));e++)if(e>=h)return Proj4js.reportError("tmerc:inverse: Latitude failed to converge"),95;if(Math.abs(c)<Proj4js.common.HALF_PI){var o=Math.sin(c),p=Math.cos(c),q=Math.tan(c),r=this.ep2*Math.pow(p,2),s=Math.pow(r,2),t=Math.pow(q,2),u=Math.pow(t,2);b=1-this.es*Math.pow(o,2);var v=this.a/Math.sqrt(b),w=v*(1-this.es)/b,x=m/(v*this.k0),y=Math.pow(x,2);f=c-v*q*y/w*(.5-y/24*(5+3*t+10*r-4*s-9*this.ep2-y/30*(61+90*t+298*r+45*u-252*this.ep2-3*s))),g=Proj4js.common.adjust_lon(this.long0+x*(1-y/6*(1+2*t+r-y/20*(5-2*r+28*t-3*s+8*this.ep2+24*u)))/p)}else f=Proj4js.common.HALF_PI*Proj4js.common.sign(n),g=this.long0}return a.x=g,a.y=f,a}},Proj4js.defs.GOOGLE="+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs",Proj4js.defs["EPSG:900913"]=Proj4js.defs.GOOGLE,Proj4js.Proj.gstmerc={init:function(){var a=this.b/this.a;this.e=Math.sqrt(1-a*a),this.lc=this.long0,this.rs=Math.sqrt(1+this.e*this.e*Math.pow(Math.cos(this.lat0),4)/(1-this.e*this.e));var b=Math.sin(this.lat0),c=Math.asin(b/this.rs),d=Math.sin(c);this.cp=Proj4js.common.latiso(0,c,d)-this.rs*Proj4js.common.latiso(this.e,this.lat0,b),this.n2=this.k0*this.a*Math.sqrt(1-this.e*this.e)/(1-this.e*this.e*b*b),this.xs=this.x0,this.ys=this.y0-this.n2*c,this.title||(this.title="Gauss Schreiber transverse mercator")},forward:function(a){var b=a.x,c=a.y,d=this.rs*(b-this.lc),e=this.cp+this.rs*Proj4js.common.latiso(this.e,c,Math.sin(c)),f=Math.asin(Math.sin(d)/Proj4js.common.cosh(e)),g=Proj4js.common.latiso(0,f,Math.sin(f));return a.x=this.xs+this.n2*g,a.y=this.ys+this.n2*Math.atan(Proj4js.common.sinh(e)/Math.cos(d)),a},inverse:function(a){var b=a.x,c=a.y,d=Math.atan(Proj4js.common.sinh((b-this.xs)/this.n2)/Math.cos((c-this.ys)/this.n2)),e=Math.asin(Math.sin((c-this.ys)/this.n2)/Proj4js.common.cosh((b-this.xs)/this.n2)),f=Proj4js.common.latiso(0,e,Math.sin(e));return a.x=this.lc+d/this.rs,a.y=Proj4js.common.invlatiso(this.e,(f-this.cp)/this.rs),a}},Proj4js.Proj.ortho={init:function(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0)},forward:function(a){var b,c,d,e,f,g,h=a.x,i=a.y;if(d=Proj4js.common.adjust_lon(h-this.long0),b=Math.sin(i),c=Math.cos(i),e=Math.cos(d),g=this.sin_p14*b+this.cos_p14*c*e,f=1,g>0||Math.abs(g)<=Proj4js.common.EPSLN)var j=this.a*f*c*Math.sin(d),k=this.y0+this.a*f*(this.cos_p14*b-this.sin_p14*c*e);else Proj4js.reportError("orthoFwdPointError");return a.x=j,a.y=k,a},inverse:function(a){var b,c,d,e,f,g,h;return a.x-=this.x0,a.y-=this.y0,b=Math.sqrt(a.x*a.x+a.y*a.y),b>this.a+1e-7&&Proj4js.reportError("orthoInvDataError"),c=Proj4js.common.asinz(b/this.a),d=Math.sin(c),e=Math.cos(c),g=this.long0,Math.abs(b)<=Proj4js.common.EPSLN&&(h=this.lat0),h=Proj4js.common.asinz(e*this.sin_p14+a.y*d*this.cos_p14/b),f=Math.abs(this.lat0)-Proj4js.common.HALF_PI,Math.abs(f)<=Proj4js.common.EPSLN&&(g=Proj4js.common.adjust_lon(this.lat0>=0?this.long0+Math.atan2(a.x,-a.y):this.long0-Math.atan2(-a.x,a.y))),f=e-this.sin_p14*Math.sin(h),a.x=g,a.y=h,a}},Proj4js.Proj.somerc={init:function(){var a=this.lat0;this.lambda0=this.long0;var b=Math.sin(a),c=this.a,d=this.rf,e=1/d,f=2*e-Math.pow(e,2),g=this.e=Math.sqrt(f);this.R=this.k0*c*Math.sqrt(1-f)/(1-f*Math.pow(b,2)),this.alpha=Math.sqrt(1+f/(1-f)*Math.pow(Math.cos(a),4)),this.b0=Math.asin(b/this.alpha),this.K=Math.log(Math.tan(Math.PI/4+this.b0/2))-this.alpha*Math.log(Math.tan(Math.PI/4+a/2))+this.alpha*g/2*Math.log((1+g*b)/(1-g*b))},forward:function(a){var b=Math.log(Math.tan(Math.PI/4-a.y/2)),c=this.e/2*Math.log((1+this.e*Math.sin(a.y))/(1-this.e*Math.sin(a.y))),d=-this.alpha*(b+c)+this.K,e=2*(Math.atan(Math.exp(d))-Math.PI/4),f=this.alpha*(a.x-this.lambda0),g=Math.atan(Math.sin(f)/(Math.sin(this.b0)*Math.tan(e)+Math.cos(this.b0)*Math.cos(f))),h=Math.asin(Math.cos(this.b0)*Math.sin(e)-Math.sin(this.b0)*Math.cos(e)*Math.cos(f));return a.y=this.R/2*Math.log((1+Math.sin(h))/(1-Math.sin(h)))+this.y0,a.x=this.R*g+this.x0,a},inverse:function(a){for(var b=a.x-this.x0,c=a.y-this.y0,d=b/this.R,e=2*(Math.atan(Math.exp(c/this.R))-Math.PI/4),f=Math.asin(Math.cos(this.b0)*Math.sin(e)+Math.sin(this.b0)*Math.cos(e)*Math.cos(d)),g=Math.atan(Math.sin(d)/(Math.cos(this.b0)*Math.cos(d)-Math.sin(this.b0)*Math.tan(e))),h=this.lambda0+g/this.alpha,i=0,j=f,k=-1e3,l=0;Math.abs(j-k)>1e-7;){if(++l>20)return void Proj4js.reportError("omercFwdInfinity");i=1/this.alpha*(Math.log(Math.tan(Math.PI/4+f/2))-this.K)+this.e*Math.log(Math.tan(Math.PI/4+Math.asin(this.e*Math.sin(j))/2)),k=j,j=2*Math.atan(Math.exp(i))-Math.PI/2}return a.x=h,a.y=j,a}},Proj4js.Proj.stere={ssfn_:function(a,b,c){return b*=c,Math.tan(.5*(Proj4js.common.HALF_PI+a))*Math.pow((1-b)/(1+b),.5*c)},TOL:1e-8,NITER:8,CONV:1e-10,S_POLE:0,N_POLE:1,OBLIQ:2,EQUIT:3,init:function(){this.phits=this.lat_ts?this.lat_ts:Proj4js.common.HALF_PI;var a=Math.abs(this.lat0);if(this.mode=Math.abs(a)-Proj4js.common.HALF_PI<Proj4js.common.EPSLN?this.lat0<0?this.S_POLE:this.N_POLE:a>Proj4js.common.EPSLN?this.OBLIQ:this.EQUIT,this.phits=Math.abs(this.phits),this.es){var b;switch(this.mode){case this.N_POLE:case this.S_POLE:Math.abs(this.phits-Proj4js.common.HALF_PI)<Proj4js.common.EPSLN?this.akm1=2*this.k0/Math.sqrt(Math.pow(1+this.e,1+this.e)*Math.pow(1-this.e,1-this.e)):(a=Math.sin(this.phits),this.akm1=Math.cos(this.phits)/Proj4js.common.tsfnz(this.e,this.phits,a),a*=this.e,this.akm1/=Math.sqrt(1-a*a));break;case this.EQUIT:this.akm1=2*this.k0;break;case this.OBLIQ:a=Math.sin(this.lat0),b=2*Math.atan(this.ssfn_(this.lat0,a,this.e))-Proj4js.common.HALF_PI,a*=this.e,this.akm1=2*this.k0*Math.cos(this.lat0)/Math.sqrt(1-a*a),this.sinX1=Math.sin(b),this.cosX1=Math.cos(b)}}else switch(this.mode){case this.OBLIQ:this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0);case this.EQUIT:this.akm1=2*this.k0;break;case this.S_POLE:case this.N_POLE:this.akm1=Math.abs(this.phits-Proj4js.common.HALF_PI)>=Proj4js.common.EPSLN?Math.cos(this.phits)/Math.tan(Proj4js.common.FORTPI-.5*this.phits):2*this.k0}},forward:function(a){var b=a.x;b=Proj4js.common.adjust_lon(b-this.long0);var c,d,e=a.y;if(this.sphere){var f,g,h,i;switch(f=Math.sin(e),g=Math.cos(e),h=Math.cos(b),i=Math.sin(b),this.mode){case this.EQUIT:d=1+g*h,d<=Proj4js.common.EPSLN,d=this.akm1/d,c=d*g*i,d*=f;break;case this.OBLIQ:d=1+this.sinph0*f+this.cosph0*g*h,d<=Proj4js.common.EPSLN,d=this.akm1/d,c=d*g*i,d*=this.cosph0*f-this.sinph0*g*h;break;case this.N_POLE:h=-h,e=-e;case this.S_POLE:Math.abs(e-Proj4js.common.HALF_PI)<this.TOL,d=this.akm1*Math.tan(Proj4js.common.FORTPI+.5*e),c=i*d,d*=h}}else{switch(h=Math.cos(b),i=Math.sin(b),f=Math.sin(e),(this.mode==this.OBLIQ||this.mode==this.EQUIT)&&(X=2*Math.atan(this.ssfn_(e,f,this.e)),sinX=Math.sin(X-Proj4js.common.HALF_PI),cosX=Math.cos(X)),this.mode){case this.OBLIQ:A=this.akm1/(this.cosX1*(1+this.sinX1*sinX+this.cosX1*cosX*h)),d=A*(this.cosX1*sinX-this.sinX1*cosX*h),c=A*cosX;break;case this.EQUIT:A=2*this.akm1/(1+cosX*h),d=A*sinX,c=A*cosX;break;case this.S_POLE:e=-e,h=-h,f=-f;case this.N_POLE:c=this.akm1*Proj4js.common.tsfnz(this.e,e,f),d=-c*h}c*=i}return a.x=c*this.a+this.x0,a.y=d*this.a+this.y0,a},inverse:function(a){var b,c,d,e,f,g,h=(a.x-this.x0)/this.a,i=(a.y-this.y0)/this.a,j=0,k=0,l=0,m=0;if(this.sphere){var n,o,p,q;switch(o=Math.sqrt(h*h+i*i),n=2*Math.atan(o/this.akm1),p=Math.sin(n),q=Math.cos(n),b=0,this.mode){case this.EQUIT:c=Math.abs(o)<=Proj4js.common.EPSLN?0:Math.asin(i*p/o),(0!=q||0!=h)&&(b=Math.atan2(h*p,q*o));break;case this.OBLIQ:c=Math.abs(o)<=Proj4js.common.EPSLN?this.phi0:Math.asin(q*sinph0+i*p*cosph0/o),n=q-sinph0*Math.sin(c),(0!=n||0!=h)&&(b=Math.atan2(h*p*cosph0,n*o));break;case this.N_POLE:i=-i;case this.S_POLE:c=Math.abs(o)<=Proj4js.common.EPSLN?this.phi0:Math.asin(this.mode==this.S_POLE?-q:q),b=0==h&&0==i?0:Math.atan2(h,i)}a.x=Proj4js.common.adjust_lon(b+this.long0),a.y=c}else{switch(f=Math.sqrt(h*h+i*i),this.mode){case this.OBLIQ:case this.EQUIT:j=2*Math.atan2(f*this.cosX1,this.akm1),d=Math.cos(j),e=Math.sin(j),k=Math.asin(0==f?d*this.sinX1:d*this.sinX1+i*e*this.cosX1/f),j=Math.tan(.5*(Proj4js.common.HALF_PI+k)),h*=e,i=f*this.cosX1*d-i*this.sinX1*e,m=Proj4js.common.HALF_PI,l=.5*this.e;break;case this.N_POLE:i=-i;case this.S_POLE:j=-f/this.akm1,k=Proj4js.common.HALF_PI-2*Math.atan(j),m=-Proj4js.common.HALF_PI,l=-.5*this.e}for(g=this.NITER;g--;k=c)if(e=this.e*Math.sin(k),c=2*Math.atan(j*Math.pow((1+e)/(1-e),l))-m,Math.abs(k-c)<this.CONV)return this.mode==this.S_POLE&&(c=-c),b=0==h&&0==i?0:Math.atan2(h,i),a.x=Proj4js.common.adjust_lon(b+this.long0),a.y=c,a}}},Proj4js.Proj.nzmg={iterations:1,init:function(){this.A=new Array,this.A[1]=.6399175073,this.A[2]=-.1358797613,this.A[3]=.063294409,this.A[4]=-.02526853,this.A[5]=.0117879,this.A[6]=-.0055161,this.A[7]=.0026906,this.A[8]=-.001333,this.A[9]=67e-5,this.A[10]=-34e-5,this.B_re=new Array,this.B_im=new Array,this.B_re[1]=.7557853228,this.B_im[1]=0,this.B_re[2]=.249204646,this.B_im[2]=.003371507,this.B_re[3]=-.001541739,this.B_im[3]=.04105856,this.B_re[4]=-.10162907,this.B_im[4]=.01727609,this.B_re[5]=-.26623489,this.B_im[5]=-.36249218,this.B_re[6]=-.6870983,this.B_im[6]=-1.1651967,this.C_re=new Array,this.C_im=new Array,this.C_re[1]=1.3231270439,this.C_im[1]=0,this.C_re[2]=-.577245789,this.C_im[2]=-.007809598,this.C_re[3]=.508307513,this.C_im[3]=-.112208952,this.C_re[4]=-.15094762,this.C_im[4]=.18200602,this.C_re[5]=1.01418179,this.C_im[5]=1.64497696,this.C_re[6]=1.9660549,this.C_im[6]=2.5127645,this.D=new Array,this.D[1]=1.5627014243,this.D[2]=.5185406398,this.D[3]=-.03333098,this.D[4]=-.1052906,this.D[5]=-.0368594,this.D[6]=.007317,this.D[7]=.0122,this.D[8]=.00394,this.D[9]=-.0013},forward:function(a){var b=a.x,c=a.y,d=c-this.lat0,e=b-this.long0,f=d/Proj4js.common.SEC_TO_RAD*1e-5,g=e,h=1,i=0;for(n=1;10>=n;n++)h*=f,i+=this.A[n]*h;var j,k,l=i,m=g,o=1,p=0,q=0,r=0;for(n=1;6>=n;n++)j=o*l-p*m,k=p*l+o*m,o=j,p=k,q=q+this.B_re[n]*o-this.B_im[n]*p,r=r+this.B_im[n]*o+this.B_re[n]*p;return x=r*this.a+this.x0,y=q*this.a+this.y0,a.x=x,a.y=y,a},inverse:function(a){var b,c,d=a.x,e=a.y,f=d-this.x0,g=e-this.y0,h=g/this.a,j=f/this.a,k=1,l=0,m=0,o=0;for(n=1;6>=n;n++)b=k*h-l*j,c=l*h+k*j,k=b,l=c,m=m+this.C_re[n]*k-this.C_im[n]*l,o=o+this.C_im[n]*k+this.C_re[n]*l;for(i=0;i<this.iterations;i++){var p,q,r=m,s=o,t=h,u=j;for(n=2;6>=n;n++)p=r*m-s*o,q=s*m+r*o,r=p,s=q,t+=(n-1)*(this.B_re[n]*r-this.B_im[n]*s),u+=(n-1)*(this.B_im[n]*r+this.B_re[n]*s);r=1,s=0;var v=this.B_re[1],w=this.B_im[1];for(n=2;6>=n;n++)p=r*m-s*o,q=s*m+r*o,r=p,s=q,v+=n*(this.B_re[n]*r-this.B_im[n]*s),w+=n*(this.B_im[n]*r+this.B_re[n]*s);var x=v*v+w*w;m=(t*v+u*w)/x,o=(u*v-t*w)/x}var y=m,z=o,A=1,B=0;for(n=1;9>=n;n++)A*=y,B+=this.D[n]*A;var C=this.lat0+B*Proj4js.common.SEC_TO_RAD*1e5,D=this.long0+z;return a.x=D,a.y=C,a}},Proj4js.Proj.mill={init:function(){},forward:function(a){var b=a.x,c=a.y,d=Proj4js.common.adjust_lon(b-this.long0),e=this.x0+this.a*d,f=this.y0+this.a*Math.log(Math.tan(Proj4js.common.PI/4+c/2.5))*1.25;return a.x=e,a.y=f,a},inverse:function(a){a.x-=this.x0,a.y-=this.y0;var b=Proj4js.common.adjust_lon(this.long0+a.x/this.a),c=2.5*(Math.atan(Math.exp(.8*a.y/this.a))-Proj4js.common.PI/4);return a.x=b,a.y=c,a}},Proj4js.Proj.gnom={init:function(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0),this.infinity_dist=1e3*this.a,this.rc=1},forward:function(a){var b,c,d,e,f,g,h=a.x,i=a.y;return d=Proj4js.common.adjust_lon(h-this.long0),b=Math.sin(i),c=Math.cos(i),e=Math.cos(d),g=this.sin_p14*b+this.cos_p14*c*e,f=1,g>0||Math.abs(g)<=Proj4js.common.EPSLN?(x=this.x0+this.a*f*c*Math.sin(d)/g,y=this.y0+this.a*f*(this.cos_p14*b-this.sin_p14*c*e)/g):(Proj4js.reportError("orthoFwdPointError"),x=this.x0+this.infinity_dist*c*Math.sin(d),y=this.y0+this.infinity_dist*(this.cos_p14*b-this.sin_p14*c*e)),a.x=x,a.y=y,a},inverse:function(a){var b,c,d,e,f,g;return a.x=(a.x-this.x0)/this.a,a.y=(a.y-this.y0)/this.a,a.x/=this.k0,a.y/=this.k0,(b=Math.sqrt(a.x*a.x+a.y*a.y))?(e=Math.atan2(b,this.rc),c=Math.sin(e),d=Math.cos(e),g=Proj4js.common.asinz(d*this.sin_p14+a.y*c*this.cos_p14/b),f=Math.atan2(a.x*c,b*this.cos_p14*d-a.y*this.sin_p14*c),f=Proj4js.common.adjust_lon(this.long0+f)):(g=this.phic0,f=0),a.x=f,a.y=g,a}},Proj4js.Proj.sinu={init:function(){this.R=6370997},forward:function(a){var b,c,d,e=a.x,f=a.y;return d=Proj4js.common.adjust_lon(e-this.long0),b=this.R*d*Math.cos(f)+this.x0,c=this.R*f+this.y0,a.x=b,a.y=c,a},inverse:function(a){var b,c,d;return a.x-=this.x0,a.y-=this.y0,b=a.y/this.R,Math.abs(b)>Proj4js.common.HALF_PI&&Proj4js.reportError("sinu:Inv:DataError"),c=Math.abs(b)-Proj4js.common.HALF_PI,Math.abs(c)>Proj4js.common.EPSLN?(c=this.long0+a.x/(this.R*Math.cos(b)),d=Proj4js.common.adjust_lon(c)):d=this.long0,a.x=d,a.y=b,a}},Proj4js.Proj.vandg={init:function(){this.R=6370997},forward:function(a){var b,c,d=a.x,e=a.y,f=Proj4js.common.adjust_lon(d-this.long0);Math.abs(e)<=Proj4js.common.EPSLN&&(b=this.x0+this.R*f,c=this.y0);var g=Proj4js.common.asinz(2*Math.abs(e/Proj4js.common.PI));(Math.abs(f)<=Proj4js.common.EPSLN||Math.abs(Math.abs(e)-Proj4js.common.HALF_PI)<=Proj4js.common.EPSLN)&&(b=this.x0,c=e>=0?this.y0+Proj4js.common.PI*this.R*Math.tan(.5*g):this.y0+Proj4js.common.PI*this.R*-Math.tan(.5*g));var h=.5*Math.abs(Proj4js.common.PI/f-f/Proj4js.common.PI),i=h*h,j=Math.sin(g),k=Math.cos(g),l=k/(j+k-1),m=l*l,n=l*(2/j-1),o=n*n,p=Proj4js.common.PI*this.R*(h*(l-o)+Math.sqrt(i*(l-o)*(l-o)-(o+i)*(m-o)))/(o+i);return 0>f&&(p=-p),b=this.x0+p,p=Math.abs(p/(Proj4js.common.PI*this.R)),c=e>=0?this.y0+Proj4js.common.PI*this.R*Math.sqrt(1-p*p-2*h*p):this.y0-Proj4js.common.PI*this.R*Math.sqrt(1-p*p-2*h*p),a.x=b,a.y=c,a},inverse:function(a){var b,c,d,e,f,g,h,i,j,k,l;return a.x-=this.x0,a.y-=this.y0,j=Proj4js.common.PI*this.R,b=a.x/j,c=a.y/j,d=b*b+c*c,e=-Math.abs(c)*(1+d),f=e-2*c*c+b*b,g=-2*e+1+2*c*c+d*d,l=c*c/g+(2*f*f*f/g/g/g-9*e*f/g/g)/27,h=(e-f*f/3/g)/g,i=2*Math.sqrt(-h/3),j=3*l/h/i,Math.abs(j)>1&&(j=j>=0?1:-1),k=Math.acos(j)/3,lat=a.y>=0?(-i*Math.cos(k+Proj4js.common.PI/3)-f/3/g)*Proj4js.common.PI:-(-i*Math.cos(k+Proj4js.common.PI/3)-f/3/g)*Proj4js.common.PI,Math.abs(b)<Proj4js.common.EPSLN&&(lon=this.long0),lon=Proj4js.common.adjust_lon(this.long0+Proj4js.common.PI*(d-1+Math.sqrt(1+2*(b*b-c*c)+d*d))/2/b),a.x=lon,a.y=lat,a}},Proj4js.Proj.cea={init:function(){},forward:function(a){var b=a.x,c=a.y;dlon=Proj4js.common.adjust_lon(b-this.long0);var d=this.x0+this.a*dlon*Math.cos(this.lat_ts),e=this.y0+this.a*Math.sin(c)/Math.cos(this.lat_ts);return a.x=d,a.y=e,a},inverse:function(a){a.x-=this.x0,a.y-=this.y0;var b=Proj4js.common.adjust_lon(this.long0+a.x/this.a/Math.cos(this.lat_ts)),c=Math.asin(a.y/this.a*Math.cos(this.lat_ts));return a.x=b,a.y=c,a}},Proj4js.Proj.eqc={init:function(){this.x0||(this.x0=0),this.y0||(this.y0=0),this.lat0||(this.lat0=0),this.long0||(this.long0=0),this.lat_ts||(this.lat_ts=0),this.title||(this.title="Equidistant Cylindrical (Plate Carre)"),this.rc=Math.cos(this.lat_ts)},forward:function(a){var b=a.x,c=a.y,d=Proj4js.common.adjust_lon(b-this.long0),e=Proj4js.common.adjust_lat(c-this.lat0);return a.x=this.x0+this.a*d*this.rc,a.y=this.y0+this.a*e,a},inverse:function(a){var b=a.x,c=a.y;return a.x=Proj4js.common.adjust_lon(this.long0+(b-this.x0)/(this.a*this.rc)),a.y=Proj4js.common.adjust_lat(this.lat0+(c-this.y0)/this.a),a}},Proj4js.Proj.cass={init:function(){this.sphere||(this.en=this.pj_enfn(this.es),this.m0=this.pj_mlfn(this.lat0,Math.sin(this.lat0),Math.cos(this.lat0),this.en))},C1:.16666666666666666,C2:.008333333333333333,C3:.041666666666666664,C4:.3333333333333333,C5:.06666666666666667,forward:function(a){var b,c,d=a.x,e=a.y;return d=Proj4js.common.adjust_lon(d-this.long0),this.sphere?(b=Math.asin(Math.cos(e)*Math.sin(d)),c=Math.atan2(Math.tan(e),Math.cos(d))-this.phi0):(this.n=Math.sin(e),this.c=Math.cos(e),c=this.pj_mlfn(e,this.n,this.c,this.en),this.n=1/Math.sqrt(1-this.es*this.n*this.n),this.tn=Math.tan(e),this.t=this.tn*this.tn,this.a1=d*this.c,this.c*=this.es*this.c/(1-this.es),this.a2=this.a1*this.a1,b=this.n*this.a1*(1-this.a2*this.t*(this.C1-(8-this.t+8*this.c)*this.a2*this.C2)),c-=this.m0-this.n*this.tn*this.a2*(.5+(5-this.t+6*this.c)*this.a2*this.C3)),a.x=this.a*b+this.x0,a.y=this.a*c+this.y0,a},inverse:function(a){a.x-=this.x0,a.y-=this.y0;var b=a.x/this.a,c=a.y/this.a;return this.sphere?(this.dd=c+this.lat0,phi=Math.asin(Math.sin(this.dd)*Math.cos(b)),lam=Math.atan2(Math.tan(b),Math.cos(this.dd))):(ph1=this.pj_inv_mlfn(this.m0+c,this.es,this.en),this.tn=Math.tan(ph1),this.t=this.tn*this.tn,this.n=Math.sin(ph1),this.r=1/(1-this.es*this.n*this.n),this.n=Math.sqrt(this.r),this.r*=(1-this.es)*this.n,this.dd=b/this.n,this.d2=this.dd*this.dd,phi=ph1-this.n*this.tn/this.r*this.d2*(.5-(1+3*this.t)*this.d2*this.C3),lam=this.dd*(1+this.t*this.d2*(-this.C4+(1+3*this.t)*this.d2*this.C5))/Math.cos(ph1)),a.x=Proj4js.common.adjust_lon(this.long0+lam),a.y=phi,a},pj_enfn:function(a){en=new Array,en[0]=this.C00-a*(this.C02+a*(this.C04+a*(this.C06+a*this.C08))),en[1]=a*(this.C22-a*(this.C04+a*(this.C06+a*this.C08)));var b=a*a;return en[2]=b*(this.C44-a*(this.C46+a*this.C48)),b*=a,en[3]=b*(this.C66-a*this.C68),en[4]=b*a*this.C88,en},pj_mlfn:function(a,b,c,d){return c*=b,b*=b,d[0]*a-c*(d[1]+b*(d[2]+b*(d[3]+b*d[4])))},pj_inv_mlfn:function(a,b,c){for(k=1/(1-b),phi=a,i=Proj4js.common.MAX_ITER;i;--i)if(s=Math.sin(phi),t=1-b*s*s,t=(this.pj_mlfn(phi,s,Math.cos(phi),c)-a)*t*Math.sqrt(t)*k,phi-=t,Math.abs(t)<Proj4js.common.EPSLN)return phi;return Proj4js.reportError("cass:pj_inv_mlfn: Convergence error"),phi},C00:1,C02:.25,C04:.046875,C06:.01953125,C08:.01068115234375,C22:.75,C44:.46875,C46:.013020833333333334,C48:.007120768229166667,C66:.3645833333333333,C68:.005696614583333333,C88:.3076171875},Proj4js.Proj.gauss={init:function(){sphi=Math.sin(this.lat0),cphi=Math.cos(this.lat0),cphi*=cphi,this.rc=Math.sqrt(1-this.es)/(1-this.es*sphi*sphi),this.C=Math.sqrt(1+this.es*cphi*cphi/(1-this.es)),this.phic0=Math.asin(sphi/this.C),this.ratexp=.5*this.C*this.e,this.K=Math.tan(.5*this.phic0+Proj4js.common.FORTPI)/(Math.pow(Math.tan(.5*this.lat0+Proj4js.common.FORTPI),this.C)*Proj4js.common.srat(this.e*sphi,this.ratexp))},forward:function(a){var b=a.x,c=a.y;return a.y=2*Math.atan(this.K*Math.pow(Math.tan(.5*c+Proj4js.common.FORTPI),this.C)*Proj4js.common.srat(this.e*Math.sin(c),this.ratexp))-Proj4js.common.HALF_PI,a.x=this.C*b,a},inverse:function(a){var b=1e-14,c=a.x/this.C,d=a.y;num=Math.pow(Math.tan(.5*d+Proj4js.common.FORTPI)/this.K,1/this.C);for(var e=Proj4js.common.MAX_ITER;e>0&&(d=2*Math.atan(num*Proj4js.common.srat(this.e*Math.sin(a.y),-.5*this.e))-Proj4js.common.HALF_PI,!(Math.abs(d-a.y)<b));--e)a.y=d;return e?(a.x=c,a.y=d,a):(Proj4js.reportError("gauss:inverse:convergence failed"),null)}},Proj4js.Proj.omerc={init:function(){this.mode||(this.mode=0),this.lon1||(this.lon1=0,this.mode=1),this.lon2||(this.lon2=0),this.lat2||(this.lat2=0);{var a=this.b/this.a,b=1-Math.pow(a,2);Math.sqrt(b)}this.sin_p20=Math.sin(this.lat0),this.cos_p20=Math.cos(this.lat0),this.con=1-this.es*this.sin_p20*this.sin_p20,this.com=Math.sqrt(1-b),this.bl=Math.sqrt(1+this.es*Math.pow(this.cos_p20,4)/(1-b)),this.al=this.a*this.bl*this.k0*this.com/this.con,Math.abs(this.lat0)<Proj4js.common.EPSLN?(this.ts=1,this.d=1,this.el=1):(this.ts=Proj4js.common.tsfnz(this.e,this.lat0,this.sin_p20),this.con=Math.sqrt(this.con),this.d=this.bl*this.com/(this.cos_p20*this.con),this.f=this.d*this.d-1>0?this.lat0>=0?this.d+Math.sqrt(this.d*this.d-1):this.d-Math.sqrt(this.d*this.d-1):this.d,this.el=this.f*Math.pow(this.ts,this.bl)),0!=this.mode?(this.g=.5*(this.f-1/this.f),this.gama=Proj4js.common.asinz(Math.sin(this.alpha)/this.d),this.longc=this.longc-Proj4js.common.asinz(this.g*Math.tan(this.gama))/this.bl,this.con=Math.abs(this.lat0),this.con>Proj4js.common.EPSLN&&Math.abs(this.con-Proj4js.common.HALF_PI)>Proj4js.common.EPSLN?(this.singam=Math.sin(this.gama),this.cosgam=Math.cos(this.gama),this.sinaz=Math.sin(this.alpha),this.cosaz=Math.cos(this.alpha),this.u=this.lat0>=0?this.al/this.bl*Math.atan(Math.sqrt(this.d*this.d-1)/this.cosaz):-(this.al/this.bl)*Math.atan(Math.sqrt(this.d*this.d-1)/this.cosaz)):Proj4js.reportError("omerc:Init:DataError")):(this.sinphi=Math.sin(this.at1),this.ts1=Proj4js.common.tsfnz(this.e,this.lat1,this.sinphi),this.sinphi=Math.sin(this.lat2),this.ts2=Proj4js.common.tsfnz(this.e,this.lat2,this.sinphi),this.h=Math.pow(this.ts1,this.bl),this.l=Math.pow(this.ts2,this.bl),this.f=this.el/this.h,this.g=.5*(this.f-1/this.f),this.j=(this.el*this.el-this.l*this.h)/(this.el*this.el+this.l*this.h),this.p=(this.l-this.h)/(this.l+this.h),this.dlon=this.lon1-this.lon2,this.dlon<-Proj4js.common.PI&&(this.lon2=this.lon2-2*Proj4js.common.PI),this.dlon>Proj4js.common.PI&&(this.lon2=this.lon2+2*Proj4js.common.PI),this.dlon=this.lon1-this.lon2,this.longc=.5*(this.lon1+this.lon2)-Math.atan(this.j*Math.tan(.5*this.bl*this.dlon)/this.p)/this.bl,this.dlon=Proj4js.common.adjust_lon(this.lon1-this.longc),this.gama=Math.atan(Math.sin(this.bl*this.dlon)/this.g),this.alpha=Proj4js.common.asinz(this.d*Math.sin(this.gama)),Math.abs(this.lat1-this.lat2)<=Proj4js.common.EPSLN?Proj4js.reportError("omercInitDataError"):this.con=Math.abs(this.lat1),this.con<=Proj4js.common.EPSLN||Math.abs(this.con-HALF_PI)<=Proj4js.common.EPSLN?Proj4js.reportError("omercInitDataError"):Math.abs(Math.abs(this.lat0)-Proj4js.common.HALF_PI)<=Proj4js.common.EPSLN&&Proj4js.reportError("omercInitDataError"),this.singam=Math.sin(this.gam),this.cosgam=Math.cos(this.gam),this.sinaz=Math.sin(this.alpha),this.cosaz=Math.cos(this.alpha),this.u=this.lat0>=0?this.al/this.bl*Math.atan(Math.sqrt(this.d*this.d-1)/this.cosaz):-(this.al/this.bl)*Math.atan(Math.sqrt(this.d*this.d-1)/this.cosaz))},forward:function(a){var b,c,d,e,f,g,h,i,j,k,l,m=a.x,n=a.y;b=Math.sin(n),k=Proj4js.common.adjust_lon(m-this.longc),g=Math.sin(this.bl*k),Math.abs(Math.abs(n)-Proj4js.common.HALF_PI)>Proj4js.common.EPSLN?(l=Proj4js.common.tsfnz(this.e,n,b),e=this.el/Math.pow(l,this.bl),j=.5*(e-1/e),c=.5*(e+1/e),h=(j*this.singam-g*this.cosgam)/c,d=Math.cos(this.bl*k),Math.abs(d)<1e-7?f=this.al*this.bl*k:(f=this.al*Math.atan((j*this.cosgam+g*this.singam)/d)/this.bl,0>d&&(f+=Proj4js.common.PI*this.al/this.bl))):(h=n>=0?this.singam:-this.singam,f=this.al*n/this.bl),Math.abs(Math.abs(h)-1)<=Proj4js.common.EPSLN&&Proj4js.reportError("omercFwdInfinity"),i=.5*this.al*Math.log((1-h)/(1+h))/this.bl,f-=this.u;var o=this.x0+i*this.cosaz+f*this.sinaz,p=this.y0+f*this.cosaz-i*this.sinaz;return a.x=o,a.y=p,a},inverse:function(a){var b,c,d,e,f,g,h,i,j,k,l;return a.x-=this.x0,a.y-=this.y0,l=0,e=a.x*this.cosaz-a.y*this.sinaz,f=a.y*this.cosaz+a.x*this.sinaz,f+=this.u,g=Math.exp(-this.bl*e/this.al),h=.5*(g-1/g),c=.5*(g+1/g),j=Math.sin(this.bl*f/this.al),k=(j*this.cosgam+h*this.singam)/c,Math.abs(Math.abs(k)-1)<=Proj4js.common.EPSLN?(lon=this.longc,lat=k>=0?Proj4js.common.HALF_PI:-Proj4js.common.HALF_PI):(d=1/this.bl,i=Math.pow(this.el/Math.sqrt((1+k)/(1-k)),d),lat=Proj4js.common.phi2z(this.e,i),b=this.longc-Math.atan2(h*this.cosgam-j*this.singam,d)/this.bl,lon=Proj4js.common.adjust_lon(b)),a.x=lon,a.y=lat,a}},Proj4js.Proj.lcc={init:function(){if(this.lat2||(this.lat2=this.lat0),this.k0||(this.k0=1),Math.abs(this.lat1+this.lat2)<Proj4js.common.EPSLN)return void Proj4js.reportError("lcc:init: Equal Latitudes");var a=this.b/this.a;this.e=Math.sqrt(1-a*a);var b=Math.sin(this.lat1),c=Math.cos(this.lat1),d=Proj4js.common.msfnz(this.e,b,c),e=Proj4js.common.tsfnz(this.e,this.lat1,b),f=Math.sin(this.lat2),g=Math.cos(this.lat2),h=Proj4js.common.msfnz(this.e,f,g),i=Proj4js.common.tsfnz(this.e,this.lat2,f),j=Proj4js.common.tsfnz(this.e,this.lat0,Math.sin(this.lat0));this.ns=Math.abs(this.lat1-this.lat2)>Proj4js.common.EPSLN?Math.log(d/h)/Math.log(e/i):b,this.f0=d/(this.ns*Math.pow(e,this.ns)),this.rh=this.a*this.f0*Math.pow(j,this.ns),this.title||(this.title="Lambert Conformal Conic")},forward:function(a){var b=a.x,c=a.y;if(!(90>=c&&c>=-90&&180>=b&&b>=-180))return Proj4js.reportError("lcc:forward: llInputOutOfRange: "+b+" : "+c),null;var d,e,f=Math.abs(Math.abs(c)-Proj4js.common.HALF_PI);if(f>Proj4js.common.EPSLN)d=Proj4js.common.tsfnz(this.e,c,Math.sin(c)),e=this.a*this.f0*Math.pow(d,this.ns);else{if(f=c*this.ns,0>=f)return Proj4js.reportError("lcc:forward: No Projection"),null;e=0}var g=this.ns*Proj4js.common.adjust_lon(b-this.long0);return a.x=this.k0*e*Math.sin(g)+this.x0,a.y=this.k0*(this.rh-e*Math.cos(g))+this.y0,a},inverse:function(a){var b,c,d,e,f,g=(a.x-this.x0)/this.k0,h=this.rh-(a.y-this.y0)/this.k0;this.ns>0?(b=Math.sqrt(g*g+h*h),c=1):(b=-Math.sqrt(g*g+h*h),c=-1);var i=0;if(0!=b&&(i=Math.atan2(c*g,c*h)),0!=b||this.ns>0){if(c=1/this.ns,d=Math.pow(b/(this.a*this.f0),c),e=Proj4js.common.phi2z(this.e,d),-9999==e)return null}else e=-Proj4js.common.HALF_PI;return f=Proj4js.common.adjust_lon(i/this.ns+this.long0),a.x=f,a.y=e,a}},Proj4js.Proj.laea={S_POLE:1,N_POLE:2,EQUIT:3,OBLIQ:4,init:function(){var a=Math.abs(this.lat0);if(this.mode=Math.abs(a-Proj4js.common.HALF_PI)<Proj4js.common.EPSLN?this.lat0<0?this.S_POLE:this.N_POLE:Math.abs(a)<Proj4js.common.EPSLN?this.EQUIT:this.OBLIQ,this.es>0){var b;switch(this.qp=Proj4js.common.qsfnz(this.e,1),this.mmf=.5/(1-this.es),this.apa=this.authset(this.es),this.mode){case this.N_POLE:case this.S_POLE:this.dd=1;break;case this.EQUIT:this.rq=Math.sqrt(.5*this.qp),this.dd=1/this.rq,this.xmf=1,this.ymf=.5*this.qp;break;case this.OBLIQ:this.rq=Math.sqrt(.5*this.qp),b=Math.sin(this.lat0),this.sinb1=Proj4js.common.qsfnz(this.e,b)/this.qp,this.cosb1=Math.sqrt(1-this.sinb1*this.sinb1),this.dd=Math.cos(this.lat0)/(Math.sqrt(1-this.es*b*b)*this.rq*this.cosb1),this.ymf=(this.xmf=this.rq)/this.dd,this.xmf*=this.dd}}else this.mode==this.OBLIQ&&(this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0))},forward:function(a){var b,c,d=a.x,e=a.y;if(d=Proj4js.common.adjust_lon(d-this.long0),this.sphere){var f,g,h;switch(h=Math.sin(e),g=Math.cos(e),f=Math.cos(d),this.mode){case this.OBLIQ:case this.EQUIT:if(c=this.mode==this.EQUIT?1+g*f:1+this.sinph0*h+this.cosph0*g*f,c<=Proj4js.common.EPSLN)return Proj4js.reportError("laea:fwd:y less than eps"),null;c=Math.sqrt(2/c),b=c*g*Math.sin(d),c*=this.mode==this.EQUIT?h:this.cosph0*h-this.sinph0*g*f;break;case this.N_POLE:f=-f;case this.S_POLE:if(Math.abs(e+this.phi0)<Proj4js.common.EPSLN)return Proj4js.reportError("laea:fwd:phi < eps"),null;c=Proj4js.common.FORTPI-.5*e,c=2*(this.mode==this.S_POLE?Math.cos(c):Math.sin(c)),b=c*Math.sin(d),c*=f
}}else{var f,i,h,j,k=0,l=0,m=0;switch(f=Math.cos(d),i=Math.sin(d),h=Math.sin(e),j=Proj4js.common.qsfnz(this.e,h),(this.mode==this.OBLIQ||this.mode==this.EQUIT)&&(k=j/this.qp,l=Math.sqrt(1-k*k)),this.mode){case this.OBLIQ:m=1+this.sinb1*k+this.cosb1*l*f;break;case this.EQUIT:m=1+l*f;break;case this.N_POLE:m=Proj4js.common.HALF_PI+e,j=this.qp-j;break;case this.S_POLE:m=e-Proj4js.common.HALF_PI,j=this.qp+j}if(Math.abs(m)<Proj4js.common.EPSLN)return Proj4js.reportError("laea:fwd:b < eps"),null;switch(this.mode){case this.OBLIQ:case this.EQUIT:m=Math.sqrt(2/m),c=this.mode==this.OBLIQ?this.ymf*m*(this.cosb1*k-this.sinb1*l*f):(m=Math.sqrt(2/(1+l*f)))*k*this.ymf,b=this.xmf*m*l*i;break;case this.N_POLE:case this.S_POLE:j>=0?(b=(m=Math.sqrt(j))*i,c=f*(this.mode==this.S_POLE?m:-m)):b=c=0}}return a.x=this.a*b+this.x0,a.y=this.a*c+this.y0,a},inverse:function(a){a.x-=this.x0,a.y-=this.y0;var b=a.x/this.a,c=a.y/this.a;if(this.sphere){var d,e=0,f=0;d=Math.sqrt(b*b+c*c);var g=.5*d;if(g>1)return Proj4js.reportError("laea:Inv:DataError"),null;switch(g=2*Math.asin(g),(this.mode==this.OBLIQ||this.mode==this.EQUIT)&&(f=Math.sin(g),e=Math.cos(g)),this.mode){case this.EQUIT:g=Math.abs(d)<=Proj4js.common.EPSLN?0:Math.asin(c*f/d),b*=f,c=e*d;break;case this.OBLIQ:g=Math.abs(d)<=Proj4js.common.EPSLN?this.phi0:Math.asin(e*sinph0+c*f*cosph0/d),b*=f*cosph0,c=(e-Math.sin(g)*sinph0)*d;break;case this.N_POLE:c=-c,g=Proj4js.common.HALF_PI-g;break;case this.S_POLE:g-=Proj4js.common.HALF_PI}lam=0!=c||this.mode!=this.EQUIT&&this.mode!=this.OBLIQ?Math.atan2(b,c):0}else{var h,i,j,k,l=0;switch(this.mode){case this.EQUIT:case this.OBLIQ:if(b/=this.dd,c*=this.dd,k=Math.sqrt(b*b+c*c),k<Proj4js.common.EPSLN)return a.x=0,a.y=this.phi0,a;i=2*Math.asin(.5*k/this.rq),h=Math.cos(i),b*=i=Math.sin(i),this.mode==this.OBLIQ?(l=h*this.sinb1+c*i*this.cosb1/k,j=this.qp*l,c=k*this.cosb1*h-c*this.sinb1*i):(l=c*i/k,j=this.qp*l,c=k*h);break;case this.N_POLE:c=-c;case this.S_POLE:if(j=b*b+c*c,!j)return a.x=0,a.y=this.phi0,a;l=1-j/this.qp,this.mode==this.S_POLE&&(l=-l)}lam=Math.atan2(b,c),g=this.authlat(Math.asin(l),this.apa)}return a.x=Proj4js.common.adjust_lon(this.long0+lam),a.y=g,a},P00:.3333333333333333,P01:.17222222222222222,P02:.10257936507936508,P10:.06388888888888888,P11:.0664021164021164,P20:.016415012942191543,authset:function(a){var b,c=new Array;return c[0]=a*this.P00,b=a*a,c[0]+=b*this.P01,c[1]=b*this.P10,b*=a,c[0]+=b*this.P02,c[1]+=b*this.P11,c[2]=b*this.P20,c},authlat:function(a,b){var c=a+a;return a+b[0]*Math.sin(c)+b[1]*Math.sin(c+c)+b[2]*Math.sin(c+c+c)}},Proj4js.Proj.aeqd={init:function(){this.sin_p12=Math.sin(this.lat0),this.cos_p12=Math.cos(this.lat0)},forward:function(a){var b,c=a.x,d=(a.y,Math.sin(a.y)),e=Math.cos(a.y),f=Proj4js.common.adjust_lon(c-this.long0),g=Math.cos(f),h=this.sin_p12*d+this.cos_p12*e*g;if(Math.abs(Math.abs(h)-1)<Proj4js.common.EPSLN){if(b=1,0>h)return void Proj4js.reportError("aeqd:Fwd:PointError")}else{var i=Math.acos(h);b=i/Math.sin(i)}return a.x=this.x0+this.a*b*e*Math.sin(f),a.y=this.y0+this.a*b*(this.cos_p12*d-this.sin_p12*e*g),a},inverse:function(a){a.x-=this.x0,a.y-=this.y0;var b=Math.sqrt(a.x*a.x+a.y*a.y);if(b>2*Proj4js.common.HALF_PI*this.a)return void Proj4js.reportError("aeqdInvDataError");var c,d=b/this.a,e=Math.sin(d),f=Math.cos(d),g=this.long0;if(Math.abs(b)<=Proj4js.common.EPSLN)c=this.lat0;else{c=Proj4js.common.asinz(f*this.sin_p12+a.y*e*this.cos_p12/b);var h=Math.abs(this.lat0)-Proj4js.common.HALF_PI;if(Math.abs(h)<=Proj4js.common.EPSLN)g=Proj4js.common.adjust_lon(lat0>=0?this.long0+Math.atan2(a.x,-a.y):this.long0-Math.atan2(-a.x,a.y));else if(h=f-this.sin_p12*Math.sin(c),Math.abs(h)<Proj4js.common.EPSLN&&Math.abs(a.x)<Proj4js.common.EPSLN);else{{Math.atan2(a.x*e*this.cos_p12,h*b)}g=Proj4js.common.adjust_lon(this.long0+Math.atan2(a.x*e*this.cos_p12,h*b))}}return a.x=g,a.y=c,a}},Proj4js.Proj.moll={init:function(){},forward:function(a){for(var b=a.x,c=a.y,d=Proj4js.common.adjust_lon(b-this.long0),e=c,f=Proj4js.common.PI*Math.sin(c),g=0;!0;g++){var h=-(e+Math.sin(e)-f)/(1+Math.cos(e));if(e+=h,Math.abs(h)<Proj4js.common.EPSLN)break;g>=50&&Proj4js.reportError("moll:Fwd:IterationError")}e/=2,Proj4js.common.PI/2-Math.abs(c)<Proj4js.common.EPSLN&&(d=0);var i=.900316316158*this.a*d*Math.cos(e)+this.x0,j=1.4142135623731*this.a*Math.sin(e)+this.y0;return a.x=i,a.y=j,a},inverse:function(a){var b,c;a.x-=this.x0;var c=a.y/(1.4142135623731*this.a);Math.abs(c)>.999999999999&&(c=.999999999999);var b=Math.asin(c),d=Proj4js.common.adjust_lon(this.long0+a.x/(.900316316158*this.a*Math.cos(b)));d<-Proj4js.common.PI&&(d=-Proj4js.common.PI),d>Proj4js.common.PI&&(d=Proj4js.common.PI),c=(2*b+Math.sin(2*b))/Proj4js.common.PI,Math.abs(c)>1&&(c=1);var e=Math.asin(c);return a.x=d,a.y=e,a}};