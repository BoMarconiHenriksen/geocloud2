<script src="http://cowi.mapcentia.com/apps/widgets/gc2map/js/gc2map.js"></script>
<script src="http://cowi.mapcentia.com/apps/widgets/gc2table/js/gc2table.js"></script>
    <script src="http://cowi.mapcentia.com/apps/widgets/gc2map/js/searchModules/danish.js"></script>
    <style>
#legend-popover-li-map, #open-win-li-map{
    display:none;
}
.table > thead > tr > th > div,
.table > tbody > tr > td
{
    font-size: 12px !important;
    line-height: 2 !important;
    vertical-align: top !important;


}

}
</style>
<div>
<div style="position:relative" id="map"></div>
    <div>
    <table id="table" data-show-toggle="true" data-show-export="true" data-show-columns="true"
data-filter-control="true"></table>
    </div>
    </div>

    <script>

// Render function for creating hyperlink in grid
var formatURL = function(value){
    myURL = '';
    if(value !== ''){
        myURL = '<a href="' + value + '" target="_blank">' + "Link" +'</a>';
    }
    return myURL;
};


// Lav en widget på normal vis
gc2map.init({
    key: "map",
    db: 'slagelse',
    zoom: [11.3904,55.3127,10],
    layers: ['public.nabo'],
    baseLayers: [{"id": "osm", "name": "OSM"}],
    setBaseLayer: 'osm',
    width: '100%',
    height: '400px',
    callBack: function (m, w) {

        // Aktiver søgning med kommune nr.
        gc2map.createSearch(m, "330");

        // Lav et SQL store på normal vis
        var store = new geocloud.sqlStore({
            db: "slagelse",
            sql: "SELECT * FROM (SELECT udpegede_straekninger.gid, udpegede_straekninger.the_geom, fysisketiltag_tsp_join.overskrift, fysisketiltag_tsp_join.status, fysisketiltag_tsp_join.baggrund, fysisketiltag_tsp_join.join_id, fysisketiltag_tsp_join.budget_aar, fysisketiltag_tsp_join.html, 'linje' as reg_type FROM trafiksikkerhedsplan.udpegede_straekninger, trafiksikkerhedsplan.fysisketiltag_tsp_join WHERE udpegede_straekninger.join_id::text = fysisketiltag_tsp_join.join_id::text UNION SELECT udpegede_kryds.gid, udpegede_kryds.the_geom, fysisketiltag_tsp_join.overskrift, fysisketiltag_tsp_join.status, fysisketiltag_tsp_join.baggrund, fysisketiltag_tsp_join.join_id, fysisketiltag_tsp_join.budget_aar, fysisketiltag_tsp_join.html,'kryds' as reg_type FROM trafiksikkerhedsplan.udpegede_kryds, trafiksikkerhedsplan.fysisketiltag_tsp_join WHERE udpegede_kryds.join_id = fysisketiltag_tsp_join.join_id::text) AS FOO WHERE ST_transform(the_geom, 4326) && ST_MakeEnvelope({minX}, {minY}, {maxX}, {maxY}, 4326)",

            // StyleMap laves som en funktion
            styleMap: function (feature) {
                return {
                    weight: (function (d) {
                        return d === "linje" ? 5 :
                            d === "kryds" ? 2 :
                                2
                    }(feature.properties.reg_type)),
                    opacity: 1,
                    color: '#006666',
                    fillOpacity: 0.5
                }
            },

            onLoad: function () {
                // Brug IKKE denne funktion sammen med autoUpdate
                // m.zoomToExtentOfgeoJsonStore(store);
            }
        });

        // Tilføj store til kort og load
        m.addGeoJsonStore(store);
        store.load();



        // Indtil nu er det normal widget. Nu begynder tabel 

        // Definer en column model
        var cm = [{
            "header" : "Område",
            "dataIndex" : "overskrift",
            "type" : "varchar",
            filterControl: "input",
            "showInPopup": true,
            "sortable" : true
        },	{
            "header" : "Status",
            "dataIndex" : "status",
            "type" : "varchar",
            "showInPopup": false,
            filterControl: "select",
            "sortable" : true,
        },	{
            "header" : "Planlagt",
            "dataIndex" : "budget_aar",
            "type" : "varchar",
            "showInPopup": false,
            filterControl: "select",
            "sortable" : true,
        },	{
            "header" : "Baggrund",
            "dataIndex" : "baggrund",
            "type" : "varchar",
            "showInPopup": false,
            filterControl: "select",
            "sortable" : true,
        },	{
            "header" : "Se Projekt",
            "dataIndex" : "html",
            "type" : "varchar",
            "showInPopup": true,
            "sortable" : false,
            "link": "<span style='white-space: nowrap'>Link</span>",
            "renderer": formatURL
        }];

        // Start tabel widget

        gc2table.init({
            el: "#table", // Element som tabellen skal lave i
            geocloud2: m, // geocloud object
            store: store, // store object
            cm: cm, // Column model
            autoUpdate: true, // Skal kortet opdateres ved zoom?
            height: null, // Skal være null, hvis filter funktioner bruges pga. bug i bootstrap-table
            tableBodyHeight: 600, // Hack til at afhjælpe ovenstående
            setViewOnSelect: true, // Zoom når det vælges i tabellen
            openPopUp: true, // Vis pop up på valgte features
            setSelectedStyle: true, // Skal valgte features have en Selected style?
            locale: 'da-DK'
        });
    }
});


</script>

<div id="map_example3" style="width: 100%;height: 300px"></div>
    <div id="grid_example3" style="width: 100%;height: 350px"></div>